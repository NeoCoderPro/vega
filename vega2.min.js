!function(a,b){if("function"==typeof define&&define.amd)define(["d3","topojson"],b);else if("object"==typeof exports)module.exports=b(require("d3"),require("topojson"));else{var c="undefined"==typeof topojson?null:topojson;a.vg=b(d3,c)}}(this,function(a,b){var c,d,e;return function(a){function b(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(b,c){return function(){var d=v.call(arguments,0);return"string"!=typeof d[0]&&1===d.length&&d.push(null),n.apply(a,d.concat([b,c]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(c){if(b(r,c)){var d=r[c];delete r[c],t[c]=!0,m.apply(a,d)}if(!b(q,c)&&!b(t,c))throw new Error("No "+c);return q[c]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(c,d,e,f){var h,k,l,m,n,s,u=[],v=typeof e;if(f=f||c,"undefined"===v||"function"===v){for(d=!d.length&&e.length?["require","exports","module"]:d,n=0;n<d.length;n+=1)if(m=o(d[n],f),k=m.f,"require"===k)u[n]=p.require(c);else if("exports"===k)u[n]=p.exports(c),s=!0;else if("module"===k)h=u[n]=p.module(c);else if(b(q,k)||b(r,k)||b(t,k))u[n]=j(k);else{if(!m.p)throw new Error(c+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=e?e.apply(q[c],u):void 0,c&&(h&&h.exports!==a&&h.exports!==q[c]?q[c]=h.exports:l===a&&s||(q[c]=l))}else c&&(q[c]=e)},c=d=n=function(b,c,d,e,f){if("string"==typeof b)return p[b]?p[b](c):j(o(b,c).f);if(!b.splice){if(s=b,s.deps&&n(s.deps,s.callback),!c)return;c.splice?(b=c,c=d,d=null):b=a}return c=c||function(){},"function"==typeof d&&(d=e,e=f),e?m(a,b,c,d):setTimeout(function(){m(a,b,c,d)},4),n},n.config=function(a){return n(a)},c._defined=q,e=function(a,c,d){c.splice||(d=c,c=[]),b(q,a)||b(r,a)||(r[a]=[a,c,d])},e.amd={jQuery:!0}}(),e("../node_modules/almond/almond",function(){}),e("util/constants",["require","exports","module"],function(){return{DATA:"data",FIELDS:"fields",SCALES:"scales",SIGNALS:"signals",DEPS:[this.DATA,this.FIELDS,this.SCALES,this.SIGNALS],GROUP:"group",ENTER:"enter",UPDATE:"update",EXIT:"exit",SENTINEL:{sentinel:1},ADD:"add",REMOVE:"remove",TOGGLE:"toggle",CLEAR:"clear",LINEAR:"linear",ORDINAL:"ordinal",LOG:"log",POWER:"pow",TIME:"time",QUANTILE:"quantile",MARK:"mark",AXIS:"axis"}}),e("dataflow/changeset",["require","exports","module","../util/constants"],function(a){function b(a,b){var c={};return d(a,c),c.add=[],c.mod=[],c.rem=[],c.touch=b,c}function c(){}function d(a,b){b.stamp=a?a.stamp:0,b.sort=a?a.sort:null,b.facet=a?a.facet:null,b.trans=a?a.trans:null,e.DEPS.forEach(function(c){b[c]=a?a[c]:{}})}var e=a("../util/constants");return{create:b,done:c,copy:d}}),e("util/config",["require","exports","module","d3"],function(a,b,c){var d=a("d3"),e={};return e.debug=!1,e.isNode="undefined"!=typeof c&&this.exports!==c,e.domainWhiteList=!1,e.safeMode=!1,e.baseURL="",e.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',e.autopadInset=5,e.scale={time:d.time.scale,utc:d.time.scale.utc},e.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},e.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},e.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},e.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},e.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},e}),e("util/index",["require","exports","module","./config"],function(a){function b(a){return a.replace(h,"$1\\'")}function c(a,b,c){var d=0,e=a.split(i);return a=c?(e=e.reverse()).filter(function(a){return d+=a.length,b>=d}).reverse():e.filter(function(a){return d+=a.length,b>=d}),a.length?a.join("").trim():e[0].slice(0,b)}function d(a){console.log(a)}var e=a("./config"),f={},g=Object.prototype.toString;f.isObject=function(a){return a===Object(a)},f.isFunction=function(a){return"[object Function]"==g.call(a)},f.isString=function(a){return"[object String]"==g.call(a)},f.isArray=Array.isArray||function(a){return"[object Array]"==g.call(a)},f.isNumber=function(a){return"[object Number]"==g.call(a)},f.isBoolean=function(a){return"[object Boolean]"==g.call(a)},f.isTree=function(a){return a&&a.__vgtree__},f.tree=function(a,b){var c=[a];return c.__vgtree__=!0,c.children=b||"children",c},f.number=function(a){return+a},f["boolean"]=function(a){return!!a},f.identity=function(a){return a},f["true"]=function(){return!0},f.extend=function(a){for(var b,c,d=1,e=arguments.length;e>d;++d){b=arguments[d];for(c in b)a[c]=b[c]}return a},f.duplicate=function(a){return JSON.parse(JSON.stringify(a))},f.field=function(a){return a.split("\\.").map(function(a){return a.split(".")}).reduce(function(a,b){return a.length&&(a[a.length-1]+="."+b.shift()),a.push.apply(a,b),a},[])},f.accessor=function(a){var b;return f.isFunction(a)||null==a?a:f.isString(a)&&(b=f.field(a)).length>1?function(a){return b.reduce(function(a,b){return a[b]},a)}:function(b){return b[a]}},f.comparator=function(a){var b=[];return void 0===a&&(a=[]),a=f.array(a).map(function(a){var c=1;return"-"===a[0]?(c=-1,a=a.slice(1)):"+"===a[0]&&(c=1,a=a.slice(1)),b.push(c),f.accessor(a)}),function(c,d){var e,f,g,h,i;for(e=0,f=a.length;f>e;++e){if(g=a[e],h=g(c),i=g(d),i>h)return-1*b[e];if(h>i)return b[e]}return 0}},f.cmp=function(a,b){return b>a?-1:a>b?1:0},f.numcmp=function(a,b){return a-b},f.array=function(a){return null!=a?f.isArray(a)?a:[a]:[]},f.values=function(a){return f.isObject(a)&&!f.isArray(a)&&a.values?f.isFunction(a.values)?a.values():a.values:a},f.tuple_ids=function(a){return a.reduce(function(a,b){return a[b._id]=1,a},{})},f.str=function(a){return f.isArray(a)?"["+a.map(f.str)+"]":f.isObject(a)?JSON.stringify(a):f.isString(a)?"'"+b(a)+"'":a};var h=/(^|[^\\])'/g;f.keys=function(a){var b=[];for(var c in a)b.push(c);return b},f.unique=function(a,b,c){if(!f.isArray(a)||0==a.length)return[];b=b||f.identity,c=c||[];for(var d,e=0,g=a.length;g>e;++e)d=b(a[e]),c.indexOf(d)<0&&c.push(d);return c},f.minIndex=function(a,b){if(!f.isArray(a)||0==a.length)return-1;b=b||f.identity;for(var c=0,d=b(a[0]),e=d,g=1,h=a.length;h>g;++g)e=b(a[g]),d>e&&(d=e,c=g);return c},f.maxIndex=function(a,b){if(!f.isArray(a)||0==a.length)return-1;b=b||f.identity;for(var c=0,d=b(a[0]),e=d,g=1,h=a.length;h>g;++g)e=b(a[g]),e>d&&(d=e,c=g);return c},f.truncate=function(a,b,d,e,f){var g=a.length;if(b>=g)return a;f=f||"...";var h=Math.max(0,b-f.length);switch(d){case"left":return f+(e?c(a,h,1):a.slice(g-h));case"middle":case"center":var i=Math.ceil(h/2),j=Math.floor(h/2);return(e?c(a,i):a.slice(0,i))+f+(e?c(a,j,1):a.slice(g-j));default:return(e?c(a,h):a.slice(0,h))+f}};var i=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;return f.fontString=function(a){return(a.fontStyle?a.fontStyle+" ":"")+(a.fontVariant?a.fontVariant+" ":"")+(a.fontWeight?a.fontWeight+" ":"")+(null!=a.fontSize?a.fontSize:e.render.fontSize)+"px "+(a.font||e.render.font)},f.log=function(a){d("[Vega Log] "+a)},f.error=function(a){a="[Vega Err] "+a,d(a),"undefined"!=typeof alert&&alert(a)},f.debug=function(a,b){if(e.debug){var c=Function.prototype.bind.call(console.log,console);b.unshift(a.stamp||-1),a.add&&b.push(a.add.length,a.mod.length,a.rem.length,!!a.touch),c.apply(console,b)}},f}),e("dataflow/tuple",["require","exports","module","../util/index","../util/constants"],function(a){function b(a,b){var c=Object.create(f.isObject(a)?a:{data:a});return c._id=++h,c._prev=b||g.SENTINEL,c}function c(a,b,c){var e=a[b];e!==c&&(e&&a._prev&&d(a,b),a[b]=c)}function d(a,b,c){a._prev=a._prev===g.SENTINEL?{}:a._prev,a._prev[b]={value:a[b],stamp:c}}function e(){h=1}var f=a("../util/index"),g=a("../util/constants"),h=1;return{create:b,set:c,prev:d,reset:e}}),e("dataflow/Node",["require","exports","module","../util/constants"],function(a){function b(a){return this._graph=a,this._rank=++a._rank,this._stamp=0,this._listeners=[],this._deps={data:[],fields:[],scales:[],signals:[]},this._router=!1,this._collector=!1,this}var c=a("../util/constants"),d=b.prototype;return d.last=function(){return this._stamp},d.dependency=function(a,b){var c=this._deps[a];if(1===arguments.length)return c;if(null===b)for(;c.length>0;)c.pop();else c.push.apply(c,util.array(b));return this},d.router=function(a){return arguments.length?(this._router=a,this):this._router},d.collector=function(a){return arguments.length?(this._collector=a,this):this._collector},d.addListener=function(a){if(!(a instanceof b))throw"Listener is not a Node";if(-1===this._listeners.indexOf(a)){if(this._listeners.push(a),this._rank>a._rank)for(var c=[a];c.length;){var d=c.splice(0,1)[0];d._rank=++this._graph._rank,c=c.concat(d._listeners)}return this}},d.removeListener=function(a){for(var b=0,c=this._listeners.length;c>b&&!foundSending;b++)this._listeners[b]===a&&this._listeners.splice(b,1);return this},d.disconnect=function(){for(;this._listeners.length>0;)this._listeners.pop()},d.evaluate=function(a){return a},d.reevaluate=function(a){var b=this,d=!1;return c.DEPS.some(function(c){return d=d||b._deps[c].some(function(b){return!!a[c][b]})})},b}),e("dataflow/Collector",["require","exports","module","./Node","./changeset","../util/index","../util/constants"],function(a){var b=a("./Node"),c=a("./changeset"),d=a("../util/index"),e=(a("../util/constants"),Bin.prototype=new b);e.data=function(){return this._data},e.evaluate=function(a){if(d.debug(a,["collecting"]),a.touch)return a=c.create(a),a.mod=this._data.slice(),a;if(a.rem.length){var b=a.rem.reduce(function(a,b){return a[b._id]=1,a},{});this._data=this._data.filter(function(a){return 1!==b[a._id]})}return a.add.length&&(this._data=this._data.length?this._data.concat(a.add):a.add),a.sort&&this._data.sort(a.sort),a}}),e("dataflow/Datasource",["require","exports","module","./changeset","./tuple","./Collector","../util/index","../util/constants"],function(a){function b(a,b,d){this._graph=a,this._name=b,this._data=[],this._source=null,this._facet=d,this._input=c.create(),this._output=null,this._pipeline=null,this._collector=null}var c=a("./changeset"),d=a("./tuple"),e=a("./Collector"),f=a("../util/index"),g=a("../util/constants"),h=b.prototype;return h.source=function(a){return arguments.length?(this._source=this._graph.data(a),this):this._source},h.add=function(a){var b=this._input.add;return b.push.apply(b,f.array(a).map(function(a){return d.create(a)})),this},h.remove=function(a){var b=this._data.filter(a);return this._input.rem.push.apply(this._input.rem,b),this},h.update=function(a,b,c){var e=this._input.mod;return this._input.fields[b]=1,this._data.filter(a).forEach(function(a){var f=a[b],g=c(a);f!==g&&(d.prev(a,b),a.__proto__[b]=g,e.indexOf(a)<0&&e.push(a))}),this},h.values=function(a){return arguments.length?(this._input.rem=this._data.slice(),a&&this.add(a),this):this._collector?this._collector.data():this._data},h.last=function(){return this._output},h.fire=function(a){a&&(this._input=a),this._graph.propagate(this._input,this._pipeline[0])},h.pipeline=function(a){var b=this;a.length&&(b._collector=new e(this._graph),a.push(b._collector));var d=new Node(this._graph).router(!0).collector(!0);d.evaluate=function(a){f.debug(a,["input",b._name]);var d=b._input,e=c.create(a);if(e.facet=b._facet,a.touch)e.mod=b._source?b._source.values().slice():b._data.slice();else{var d=b._input,h=f.tuple_ids(d.rem);b._data=b._data.filter(function(a){return 1!==h[a._id]}).concat(d.add),b._input=c.create(),e.add=d.add,e.rem=d.rem,e.mod=d.mod.map(function(b){var c;if(b._prev===g.SENTINEL)return b;for(c in b._prev)void 0===b._prev[c].stamp&&(b._prev[c].stamp=a.stamp);return b})}return e},a.unshift(d);var h=new Node(this._graph).router(!0).collector(!0);return h.evaluate=function(a){f.debug(a,["output",b._name]);var d=c.create(a,!0);return b._facet&&(b._facet.values=b.values(),a.facet=null),b._output=a,d.data[b._name]=1,d},a.push(h),this._pipeline=a,this._graph.connect(b._pipeline),this},h.addListener=function(a){if(a instanceof b){var c=this,d=a;a=new Node(this._graph),a.evaluate=function(a){return d._input=c._output,a},a.addListener(d._pipeline[0])}this._pipeline[this._pipeline.length-1].addListener(a)},h.removeListener=function(a){this._pipeline[this._pipeline.length-1].removeListener(a)},b}),e("dataflow/Signal",["require","exports","module","./Node","./changeset","../util/index"],function(a){function b(a,b,d){return c.prototype.call(this,a),this._name=b,this._value=d,this}var c=a("./Node"),d=a("./changeset"),e=(a("../util/index"),Bin.prototype=new c);return e.name=function(){return this._name},e.value=function(a){return arguments.length?(this._value=a,this):this._value},e.fire=function(a){a||(a=d.create(null,!0)),a.signals[this._name]=1,this._graph.propagate(a,this)},b}),e("dataflow/Graph",["require","exports","module","d3","./Datasource","./Signal","./changeset","../util/index","../util/constants"],function(a){function b(){this._stamp=0,this._rank=0,this._data={},this._signals={},this.doNotPropagate={}}function c(a){var b=this;return h.isArray(a)?a.map(function(a){b._signals[a]}):this._signals[a]}function d(a,b){var c,d,e,f;for(e=0,f=a.length;f>e;++e)c=a[e],n.collector()&&(d=c),b(c,d,e)}var e=a("d3"),f=a("./Datasource"),g=a("./Signal"),h=(a("./changeset"),a("../util/index")),i=a("../util/constants"),j=b.prototype;j.data=function(a,b,c){return 1===arguments.length?this._data[a]:this._data[a]=new f(this,a,c).pipeline(b)},j.signal=function(a,b){return 1===arguments.length?c.call(this,a):this._signals[a]=new g(this,a,b)},j.signalValues=function(a){var b,c,d,e={};if(!h.isArray(a))return this._signals[a].value();for(b=0,c=a.length;c>b;++b)d=a[b],e[d]=this._signals[d].value();return e},j.signalRef=function(a){h.isArray(a)||(a=h.field(a));var b=this.signal(a.shift()).value();if(a.length>0){var c=Function("s","return s["+a.map(h.str).join("][")+"]");b=c.call(null,b)}return b};var k=e.bisector(function(a,b){return a.node==b.node?a.pulse.touch?-1:1:b.rank-a.rank});return j.propagate=function(a,b){var c,d,e,f,g,i,j,l=[];if(l.enq=function(a){var b=k.left(this,a);this.splice(b,0,a)},a.stamp)throw"Pulse already has a non-zero stamp";for(a.stamp=++this._stamp,l.enq({node:b,pulse:a,rank:b._rank});l.length>0;)if(c=l.pop(),e=c.node,f=c.pulse,g=c.rank,d=e._listeners,g==e._rank){var m=f.touch&&e.last()>=f.stamp;if(!m){var n=!!f.add.length||!!f.rem.length||e.router();if(n=n||!m,n=n||e.reevaluate(f),n&&(a=e.evaluate(f),e._stamp=a.stamp),a!=doNotPropagate||!n)for(i=0,j=d.length;j>i;i++)l.enq({node:d[i],pulse:a,rank:d[i]._rank})}}else h.debug(f,["Rank mismatch",g,e._rank]),l.enq({node:e,pulse:f,rank:e._rank})},j.connect=function(a){h.debug({},["connecting"]);var b=this;return d(a,function(c,d,e){var f=c.dependency(i.DATA),g=c.dependency(i.SIGNALS);f.length>0&&f.forEach(function(a){b.data(a).addListener(d)}),g.length>0&&g.forEach(function(a){b.signal(a).addListener(d)}),e>0&&a[e-1].addListener(a[e])}),a},j.disconnect=function(a){h.debug({},["disconnecting"]);var b=this;return d(a,function(a,c){var d=a.dependency(i.DATA),e=a.dependency(i.SIGNALS);d.length>0&&d.forEach(function(a){b.data(a).removeListener(c)}),e.length>0&&e.forEach(function(a){b.signal(a).removeListener(c)}),a.disconnect()}),a},b}),e("core/Model",["require","exports","module","../dataflow/Graph","../dataflow/changeset","../util/index"],function(a){function b(){this._stamp=0,this._rank=0,this._defs={},this._predicates={},this.graph=new d,this._node=new Node(this.graph)}function c(a){var b=this,c={};return f.isArray(a)?(a.forEach(function(a){c[a]=b._predicates[a]}),c):this._predicates[a]}var d=a("../dataflow/Graph"),e=a("../dataflow/changeset"),f=a("../util/index"),g=b.prototype;return g.data=function(){var a=this.graph.data.apply(this.graph,arguments);return arguments.length>1&&this._node.addListener(a._pipeline[0]),a},g.predicate=function(a,b){return 1===arguments.length?c.call(this,a):this._predicates[a]=b},g.addListener=function(a){this._node.addListener(a)},g.removeListener=function(a){this._node.removeListener(a)},g.fire=function(a){a||(a=e.create()),this.graph.propagate(a,this._node)},b}),e("parse/expr",["require","exports","module","../util/index"],function(a){function b(a,b){var g,h,i,j,k,l,m,n=b.split(f),o={},p={};for(k=0,l=0,i=0,j=n.length;j>i;++i){var g=n[i];"'"!==g?'"'!==g?l||k||(d[g]&&(n[i]=d[g]),e[g]&&(h=n[i+1])&&"("===h[0]&&(n[i]=e[g]),":"==n[i+1]&&(m=g+":"+n[i+2],a.signal((m=c.field(m))[0])&&(o[m[0]]=1,h=c.field(n[i+2]),n[i]="sg['"+n[i],n[i+2]=n[i+2].replace(h[0],h[0]+"']"),i+=2)),a.signal((h=c.field(g))[0])&&(o[h[0]]=1,n[i]=n[i].replace(h[0],"sg["+c.str(h[0])+"]")),"d"==h[0]&&(p[h.splice(1).join("")]=1)):k||(l=!l):l||(k=!k)}return{fn:Function("d","e","i","p","sg","return ("+n.join("")+");"),signals:c.keys(o),fields:c.keys(p)}}var c=a("../util/index"),d={E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},e={abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",date:"Date.parse"},f=/([\"\']|[\=\<\>\~\&\|\?\:\+\-\/\*\%\!\^\,\;\[\]\{\}\(\) ]+)/;return b.eval=function(a,b,d,e,f,g,h){return h=a.signalValues(c.array(h)),b.call(null,d,e,f,g,h)},b}),e("transforms/Parameter",["require","exports","module","../parse/expr","../util/index","../util/constants"],function(a){function b(a,b){this._name=a,this._type=b,this._stamp=0,this._value=[],this._accessors=[],this._resolution=!1,this._signals={}}var c=a("../parse/expr"),d=a("../util/index"),e=a("../util/constants"),f=/array/i,g=/field/i,h=/expr/i,i=b.prototype;return i._get=function(){var a=f(this._type),b=g(this._field);return b?a?{fields:this._value,accessors:this._accessors}:{field:this._value[0],accessor:this._accessors[0]}:a?this._value:this._value[0]},i.get=function(a){var b,c,e,f,g;if(!this._resolution)return this._get();for(b in this._signals)e=this._signals[b],c=a.signal(b),f=c.value(),g=c.last(),isField&&(this._accessors[e]=this._stamp<=g?d.accessor(f):this._accessors[e]),this._value[e]=f,this._stamp=Math.max(this._stamp,g);return this._get()},i.set=function(a,b){var f=this;return this._value=d.array(b).map(function(b,g){if(!d.isObject(b)){if(h.test(this._type)){var i=c(a._graph,b);return a.dependency(e.FIELDS,i.fields),a.dependency(e.SIGNALS,i.signals),i}return b}return void 0!==b.value?b.value:void 0!==b.field?(f._accessors[g]=d.accessor(b.field),a.dependency(e.FIELDS,b.field),b.field):void 0!==b.signal?(f._resolution=!0,f._signals[b.signal]=g,a.dependency(e.SIGNALS,b.signal),b.signal):void 0}),a},b}),e("transforms/Transform",["require","exports","module","../dataflow/Node","./Parameter","../util/index","../util/constants"],function(a){function b(a){return c.prototype.call(this,a)}var c=a("../dataflow/Node"),d=a("./Parameter"),e=(a("../util/index"),a("../util/constants"));b.addParameters=function(a,b){var c;for(var e in b)c=b[e],a[e]=new d(e,c.type),c["default"]&&a[e].set(c["default"])};var f=b.prototype=new c;return f.transform=function(a){return a},f.evaluate=function(a){var b=this.dependency(e.SIGNALS).some(function(b){return!!a.signals[b]});return this.transform(a,b)},f.output=function(a){for(var b in this._output)void 0!==a[b]&&(this._output[b]=a[b]);return this},b}),e("transforms/Filter",["require","exports","module","./Transform","../dataflow/changeset","../parse/expr","../util/index","../util/constants"],function(a){function b(a){return c.prototype.call(this,a),c.addParameters(this,{test:{type:"expr"}}),this._skip={},this}var c=a("./Transform"),d=a("../dataflow/changeset"),e=a("../parse/expr"),f=a("../util/index"),g=a("../util/constants"),h=b.prototype=new c;h._test=function(a){return e.eval(this._graph,this.test.get(),a,null,null,null,this.dependency(g.SIGNALS))},h.transform=function(a){f.debug(a,["filtering"]);var b=d.create(a),c=this._skip,e=this._test;return a.rem.forEach(function(a){1!==c[a._id]?b.rem.push(a):c[a._id]=0}),a.add.forEach(function(a){e(a)?b.add.push(a):c[a._id]=1}),a.mod.forEach(function(a){var d=e(a),f=1===c[a._id];d&&f?(c[a._id]=0,b.add.push(a)):d&&!f?b.mod.push(a):!d&&f||(b.rem.push(a),c[a._id]=1)}),b}}),e("transforms/Fold",["require","exports","module","./Transform","../util/index","../dataflow/tuple","../dataflow/changeset"],function(a){function b(a){return c.prototype.call(this,a),c.addParameters(this,{on:{type:"array<field>"}}),this._output={key:"key",value:"value"},this._cache={},this.router(!0)}var c=a("./Transform"),d=a("../util/index"),e=a("../dataflow/tuple"),f=a("../dataflow/changeset"),g=b.prototype=new c;g._reset=function(a,b){for(var c in this._cache)b.rem.push.apply(b.rem,this._cache[c]);this._cache={}},g._get_tuple=function(a,b){var c=this._cache[a._id]||(this._cache[a._id]=Array(fields.length));return c[b]||(c[b]=e.create(a,a._prev))},g._fold=function(a,b,c,d,f){for(var g,h,i=0,j=a.length,k=0,l=b.length;j>i;++i)for(g=a[i];l>k;++k)h=this._get_tuple(g,i),e.set(h,this._output.key,b[k],f),e.set(h,this._output.value,c[k](x),f),d.push(h)},g.transform=function(a,b){d.debug(a,["folding"]);var c=this,e=this.on.get(),g=e.fields,h=e.accessors,i=f.create(a);return b&&this._reset(a,i),this._fold(a.add,g,h,i.add,a.stamp),this._fold(a.mod,g,h,i.mod,a.stamp),a.rem.forEach(function(a){i.rem.push.apply(i.rem,c._cache[a._id]),c._cache[a._id]=null}),(a.add.length||a.rem.length||g.some(function(b){return!!a.fields[b]}))&&(i.fields[this._output.key]=1,i.fields[this._output.value]=1),i}}),e("transforms/Formula",["require","exports","module","./Transform","../dataflow/tuple","../parse/expr","../util/index","../util/constants"],function(a){function b(a){return c.prototype.call(this,a),c.addParameters(this,{field:{type:"string"},expr:{type:"expr"}}),this}var c=a("./Transform"),d=a("../dataflow/tuple"),e=a("../parse/expr"),f=a("../util/index"),g=a("../util/constants"),h=b.prototype=new c;h._expr=function(a,b){var c=e.eval(this._graph,this._expr.get(),a,null,null,null,this.dependency(g.SIGNALS));d.set(a,this._field.get(),c,b)},h.transform=function(a){f.debug(a,["formulating"]);var b=this;return a.add.forEach(function(c){b._expr(c,a.stamp)}),a.mod.forEach(function(c){b._expr(c,a.stamp)}),a.fields[this._field.get()]=1,a}}),e("transforms/Sort",["require","exports","module","./Transform","../parse/expr","../util/index"],function(a){function b(a){return c.prototype.call(this,a),c.addParameters(this,{by:{type:"array<field>"}}),this.router(!0)}var c=a("./Transform"),d=(a("../parse/expr"),a("../util/index")),e=b.prototype=new c;e.transform=function(a){return d.debug(a,["sorting"]),(a.add.length||a.mod.length||a.rem.length)&&(a.sort=d.comparator(this.by.get().fields)),a}}),e("transforms/Zip",["require","exports","module","../util/index","../dataflow/Collector"],function(a){function b(a){return Transform.prototype.call(this,a),Transform.addParameters(this,{"with":{type:"string"},as:{type:"string"},key:{type:"field","default":"data"},withKey:{type:"field","default":null},"default":{type:"*"}}),this._map={},this._collector=new d(a),this._lastJoin=0,this}var c=a("../util/index"),d=a("../dataflow/Collector"),e=b.prototype=new Transform;e.__map=function(a){return this._map[a]||(this._map[a]=[])},e.transform=function(a){c.debug(a,["zipping",z]);var b=this["with"].get(),d=this._graph.data(b),e=d.last(),f=d.values(),g=this.key.get(),h=this.withKey.get(),i=this.as.get(),j=this["default"].get(),k=this.__map;if(h.field)e&&e.stamp>this._lastJoin&&(e.add.forEach(function(a){var b=k(h.accessor(a));b[0]&&(b[0][i]=a),b[1]=a}),e.rem.forEach(function(a){var b=k(h.accessor(a));b[0]&&(b[0][i]=j),b[1]=null}),e.fields[h.field]&&e.mod.forEach(function(a){var b=h.accessor(a._prev);if(b&&!(b.stamp<this._lastJoin)){var c=k(b.value);c[0]&&(c[0][i]=j),c[1]=null;var d=k(h.accessor(a));d[0]&&(d[0][i]=a),d[1]=a}}),this._lastJoin=e.stamp),a.add.forEach(function(a){var b=k(g.accessor(a));a[i]=b[1]||j,b[0]=a}),a.rem.forEach(function(a){k(g.accessor(a))[0]=null}),a.fields[g.field]&&a.mod.forEach(function(b){var c=g.accessor(b._prev);if(c&&!(c.stamp<a.stamp)){k(c.value)[0]=null;var d=k(g.accessor(b));b[i]=d[1]||j,d[0]=b}});else{if(0==a.add.length&&0==a.rem.length&&0==e.add.length&&0==e.rem.length)return a;this._collector.evaluate(a);var l,m=this._collector.data(),n=f.length;for(l=0;l<m.length;l++)m[l][i]=f[l%n]}return a}}),e("transforms/index",["require","exports","module","./Filter","./Fold","./Formula","./Sort","./Zip"],function(a){return{filter:a("./Filter"),fold:a("./Fold"),formula:a("./Formula"),sort:a("./Sort"),zip:a("./Zip")}}),e("parse/transforms",["require","exports","module","../util/index","../transforms/index"],function(a){var b=a("../util/index"),c=a("../transforms/index");return function d(a,e){var f=c[e.type](a);if("facet"==e.type){var g=(e.transform||[]).map(function(b){return d(a,b)});f.pipeline(g)}return b.keys(e).forEach(function(a){"type"!==a&&("transform"!==a||"facet"!==e.type)&&f[a](e[a])}),f}}),e("transforms/modify",["require","exports","module","../dataflow/tuple","../util/index","../util/constants"],function(a){var b=a("../dataflow/tuple"),c=a("../util/index"),d=a("../util/constants"),e=function(a,b,c,d){for(var e=c.length-1;e>=0;--e)c[e][a]==b&&d.push.apply(d,c.splice(e,1))};return function(a,f,g){var h=f.signal?c.field(f.signal):null,i=h?h[0]:null,j=f.predicate?a.predicate(f.predicate):null,k=null===j,l=new a.Node(function(i){if(null!==j){var l={};(j.data||[]).forEach(function(b){l[b]=a.data(b).values()}),k=j({},l,a.signalValues(j.signals||[]),a._predicates)}if(c.debug(i,[f.type+"ing",k]),!k)return i;var m={},n=h?a.signalRef(f.signal):null,o=a.data(g.name),p=null;if(m[f.field]=n,f.type==d.ADD)p=b.create(m),i.add.push(p),o._data.push(p);else if(f.type==d.REMOVE)e(f.field,n,i.add,i.rem),e(f.field,n,i.mod,i.rem),o._data=o._data.filter(function(a){return a[f.field]!==n});else if(f.type==d.TOGGLE){var q=[],r=[];e(f.field,n,i.rem,q),e(f.field,n,i.add,r),e(f.field,n,i.mod,r),0==q.length&&0==r.length&&q.push(b.create(m)),i.add.push.apply(i.add,q),o._data.push.apply(o._data,q),i.rem.push.apply(i.rem,r),o._data=o._data.filter(function(a){return-1===r.indexOf(a)})}else f.type==d.CLEAR&&(i.rem.push.apply(i.rem,i.add),i.rem.push.apply(i.rem,i.mod),i.add=[],i.mod=[],o._data=[]);return i.fields[f.field]=1,i}),m=l._deps.signals;return i&&m.push(i),j&&m.push.apply(m,j.signals),l}}),e("util/load",["require","exports","module","./index","./config"],function(b){function c(a){return h.test(a)}function d(b,c){return f.log("LOAD: "+b),e(b)?void a.xhr(b,function(a,b){b&&(b=b.responseText),c(a,b)}):void f.error("URL is not whitelisted: "+b)}function e(a){if(!g.domainWhiteList)return!0;var b=document.createElement("a");b.href=a;var c=b.hostname.toLowerCase();return g.domainWhiteList.some(function(a){return a===c||c.lastIndexOf("."+a)===c.length-a.length-1})}var f=b("./index"),g=b("./config"),h=/^[A-Za-z]+\:\/\//;return function(a,b){var e=c(a)?a:g.baseURL+a;d(e,b)}}),e("util/read",["require","exports","module","./index"],function(c){function d(a,b){var c=b&&b.type||"json";return a=h[c](a,b),b&&b.parse&&e(a,b.parse),a}function e(a,b){var c=g.keys(b),d=c.map(function(a){return i[b[a]]}),e=g.isTree(a);f(e?[a]:a,c,d,e)}function f(a,b,c,d){var f,g,h,i,j;for(g=0,i=a.length;i>g;++g){for(f=a[g],h=0,j=b.length;j>h;++h)f[b[h]]=c[h](f[b[h]]);d&&f.values&&e(f,b,c,!0)}}var g=c("./index"),h={},i={number:g.number,"boolean":g["boolean"],date:Date.parse};return h.json=function(a,b){var c=g.isObject(a)?a:JSON.parse(a);return b&&b.property&&(c=g.accessor(b.property)(c)),c},h.csv=function(b){var c=a.csv.parse(b);return c},h.tsv=function(b){var c=a.tsv.parse(b);return c},h.topojson=function(a,c){if(null==b)return g.error("TopoJSON library not loaded."),[];var d=g.isObject(a)?a:JSON.parse(a),e=[];return c&&c.feature?e=(e=d.objects[c.feature])?b.feature(d,e).features:(g.error("Invalid TopoJSON object: "+c.feature),[]):c&&c.mesh?e=(e=d.objects[c.mesh])?[b.mesh(d,d.objects[c.mesh])]:(g.error("Invalid TopoJSON object: "+c.mesh),[]):g.error("Missing TopoJSON feature or mesh parameter."),e},h.treejson=function(a,b){return a=g.isObject(a)?a:JSON.parse(a),g.tree(a,b.children)},d.formats=h,d.parse=e,d}),e("parse/data",["require","exports","module","./transforms","../transforms/modify","../util/index","../util/load","../util/read"],function(a){var b=a("./transforms"),c=a("../transforms/modify"),d=a("../util/index"),e=a("../util/load"),f=a("../util/read"),g=function(a,b,c){function h(b){return function(e,g){e?d.error("LOADING FAILED: "+b.url):a.data(b.name).values(f(g.toString(),b.format)),0===--i&&c()}}var i=0;return(b||[]).forEach(function(b){b.url&&(i+=1,e(b.url,h(b))),g.datasource(a,b)}),0===i&&setTimeout(c,1),b};return g.datasource=function(a,d){var e=(d.transform||[]).map(function(c){return b(a,c)}),g=(d.modify||[]).map(function(b){return c(a,b,d)}),h=a.data(d.name,g.concat(e));return d.values?h.values(f(d.values,d.format)):d.source&&(h.source(d.source),a.data(d.source).addListener(h)),h},g}),e("parse/spec",["require","exports","module","../core/Model","../parse/data","../util/index"],function(a){var b=a("../core/Model"),c=a("../parse/data"),d=a("../util/index");return function(a,e,f){a=d.duplicate(a),f=f||View.factory;var g=(a.width||500,a.height||500,a.viewport||null,new b);parseInteractors(g,a,function(){g._defs={data:c(g,a.data,function(){e(f(g))})}})}}),e("d3",[],function(){return a}),e("topojson",[],function(){return b}),{parse:{spec:d("parse/spec")},util:d("util/index"),config:d("util/config")}});