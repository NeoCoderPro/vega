!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.vg=t()}}(function(){var t;return function e(t,n,i){function r(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){e.exports={core:{View:t("./core/View")},dataflow:{changeset:t("./dataflow/changeset"),Datasource:t("./dataflow/Datasource"),Graph:t("./dataflow/Graph"),Node:t("./dataflow/Node")},parse:{spec:t("./parse/spec")},scene:{Builder:t("./scene/Builder"),GroupBuilder:t("./scene/GroupBuilder")},util:t("./util/index"),config:t("./util/config")}},{"./core/View":6,"./dataflow/Datasource":8,"./dataflow/Graph":9,"./dataflow/Node":10,"./dataflow/changeset":12,"./parse/spec":26,"./scene/Builder":39,"./scene/GroupBuilder":41,"./util/config":64,"./util/index":66}],2:[function(t,e,n){e.exports=t("./lib/heap")},{"./lib/heap":3}],3:[function(e,n,i){(function(){var e,r,a,s,o,l,u,c,d,h,f,p,g,m,v;a=Math.floor,h=Math.min,r=function(t,e){return e>t?-1:t>e?1:0},d=function(t,e,n,i,s){var o;if(null==n&&(n=0),null==s&&(s=r),0>n)throw new Error("lo must be non-negative");for(null==i&&(i=t.length);i>n;)o=a((n+i)/2),s(e,t[o])<0?i=o:n=o+1;return[].splice.apply(t,[n,n-n].concat(e)),e},l=function(t,e,n){return null==n&&(n=r),t.push(e),m(t,0,t.length-1,n)},o=function(t,e){var n,i;return null==e&&(e=r),n=t.pop(),t.length?(i=t[0],t[0]=n,v(t,0,e)):i=n,i},c=function(t,e,n){var i;return null==n&&(n=r),i=t[0],t[0]=e,v(t,0,n),i},u=function(t,e,n){var i;return null==n&&(n=r),t.length&&n(t[0],e)<0&&(i=[t[0],e],e=i[0],t[0]=i[1],v(t,0,n)),e},s=function(t,e){var n,i,s,o,l,u;for(null==e&&(e=r),o=function(){u=[];for(var e=0,n=a(t.length/2);n>=0?n>e:e>n;n>=0?e++:e--)u.push(e);return u}.apply(this).reverse(),l=[],i=0,s=o.length;s>i;i++)n=o[i],l.push(v(t,n,e));return l},g=function(t,e,n){var i;return null==n&&(n=r),i=t.indexOf(e),-1!==i?(m(t,0,i,n),v(t,i,n)):void 0},f=function(t,e,n){var i,a,o,l,c;if(null==n&&(n=r),a=t.slice(0,e),!a.length)return a;for(s(a,n),c=t.slice(e),o=0,l=c.length;l>o;o++)i=c[o],u(a,i,n);return a.sort(n).reverse()},p=function(t,e,n){var i,a,l,u,c,f,p,g,m,v;if(null==n&&(n=r),10*e<=t.length){if(u=t.slice(0,e).sort(n),!u.length)return u;for(l=u[u.length-1],g=t.slice(e),c=0,p=g.length;p>c;c++)i=g[c],n(i,l)<0&&(d(u,i,0,null,n),u.pop(),l=u[u.length-1]);return u}for(s(t,n),v=[],a=f=0,m=h(e,t.length);m>=0?m>f:f>m;a=m>=0?++f:--f)v.push(o(t,n));return v},m=function(t,e,n,i){var a,s,o;for(null==i&&(i=r),a=t[n];n>e&&(o=n-1>>1,s=t[o],i(a,s)<0);)t[n]=s,n=o;return t[n]=a},v=function(t,e,n){var i,a,s,o,l;for(null==n&&(n=r),a=t.length,l=e,s=t[e],i=2*e+1;a>i;)o=i+1,a>o&&!(n(t[i],t[o])<0)&&(i=o),t[e]=t[i],e=i,i=2*e+1;return t[e]=s,m(t,l,e,n)},e=function(){function t(t){this.cmp=null!=t?t:r,this.nodes=[]}return t.push=l,t.pop=o,t.replace=c,t.pushpop=u,t.heapify=s,t.updateItem=g,t.nlargest=f,t.nsmallest=p,t.prototype.push=function(t){return l(this.nodes,t,this.cmp)},t.prototype.pop=function(){return o(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},t.prototype.replace=function(t){return c(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return u(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return s(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return g(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var e;return e=new t,e.nodes=this.nodes.slice(0),e},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),function(e,r){return"function"==typeof t&&t.amd?t([],r):"object"==typeof i?n.exports=r():e.Heap=r()}(this,function(){return e})}).call(this)},{}],4:[function(t,e,n){var i=function(t){this.clear(),t&&this.union(t)},r=i.prototype;r.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},r.set=function(t,e,n,i){return this.x1=t,this.y1=e,this.x2=n,this.y2=i,this},r.add=function(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},r.expand=function(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},r.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},r.translate=function(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},r.rotate=function(t,e,n){var i=Math.cos(t),r=Math.sin(t),a=e-e*i+n*r,s=n-e*r-n*i,o=this.x1,l=this.x2,u=this.y1,c=this.y2;return this.clear().add(i*o-r*u+a,r*o+i*u+s).add(i*o-r*c+a,r*o+i*c+s).add(i*l-r*u+a,r*l+i*u+s).add(i*l-r*c+a,r*l+i*c+s)},r.union=function(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},r.encloses=function(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},r.intersects=function(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},r.contains=function(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},r.width=function(){return this.x2-this.x1},r.height=function(){return this.y2-this.y1},e.exports=i},{}],5:[function(t,e,n){function i(){this._defs={},this._predicates={},this._scene=null,this.graph=new a,this._node=new s(this.graph),this._builder=null}function r(t){var e=this,n={};return u.isArray(t)?(t.forEach(function(t){n[t]=e._predicates[t]}),n):this._predicates[t]}var a=t("../dataflow/Graph"),s=t("../dataflow/Node"),o=t("../scene/GroupBuilder"),l=t("../dataflow/changeset"),u=t("../util/index"),c=i.prototype;c.defs=function(t){return arguments.length?(this._defs=t,this):this._defs},c.data=function(){var t=this.graph.data.apply(this.graph,arguments);return arguments.length>1&&this._node.addListener(t.pipeline()[0]),t},c.predicate=function(t,e){return 1===arguments.length?r.call(this,t):this._predicates[t]=e},c.predicates=function(){return this._predicates},c.scene=function(t){if(!arguments.length)return this._scene;this._builder&&this._node.removeListener(this._builder.disconnect()),this._builder=new o(this,this._defs.marks,this._scene={}),this._node.addListener(this._builder.connect());var e=this._builder.pipeline();return e[e.length-1].addListener(t),this},c.addListener=function(t){this._node.addListener(t)},c.removeListener=function(t){this._node.removeListener(t)},c.fire=function(t){t||(t=l.create()),this.graph.propagate(t,this._node)},e.exports=i},{"../dataflow/Graph":9,"../dataflow/Node":10,"../dataflow/changeset":12,"../scene/GroupBuilder":41,"../util/index":66}],6:[function(t,e,n){(function(n){var i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,r=t("../dataflow/Node"),a=t("../parse/streams"),s=t("../render/canvas/index"),o=t("../render/svg/index"),l=t("../scene/Transition"),u=t("../util/config"),c=t("../util/index"),d=t("../dataflow/changeset"),h=function(t,e,n,i){this._el=null,this._model=null,this._width=this.__width=e||500,this._height=this.__height=n||300,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=s,t&&this.initialize(t)},f=h.prototype;f.model=function(t){return arguments.length?(this._model!==t&&(this._model=t,this._handler&&this._handler.model(t)),this):this._model},f.data=function(t){var e=this.model();return arguments.length?(c.keys(t).forEach(function(n){e.data(n).add(c.duplicate(t[n]))}),this):e.data()},f.width=function(t){return arguments.length?(this.__width!==t&&(this._width=this.__width=t,this._el&&this.initialize(this._el.parentNode),this._strict&&(this._autopad=1)),this):this.__width},f.height=function(t){return arguments.length?(this.__height!==t&&(this._height=this.__height=t,this._el&&this.initialize(this._el.parentNode),this._strict&&(this._autopad=1)),this):this.__height},f.padding=function(t){return arguments.length?(this._padding!==t&&(c.isString(t)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===t):(this._autopad=0,this._padding=t,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,t),this._handler.padding(t))),this):this._padding},f.autopad=function(t){if(this._autopad<1)return this;this._autopad=0;var e=this._padding,n=this.model().scene().bounds,i=u.autopadInset,r=n.x1<0?Math.ceil(-n.x1)+i:0,a=n.y1<0?Math.ceil(-n.y1)+i:0,s=n.x2>this._width?Math.ceil(+n.x2-this._width)+i:0,n=n.y2>this._height?Math.ceil(+n.y2-this._height)+i:0;return e={left:r,top:a,right:s,bottom:n},this._strict?(this._autopad=0,this._padding=e,this._width=Math.max(0,this.__width-(r+s)),this._height=Math.max(0,this.__height-(a+n)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(this._el.parentNode),this.update()):this.padding(e).update(t),this},f.viewport=function(t){return arguments.length?(this._viewport!==t&&(this._viewport=t,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},f.renderer=function(t){return arguments.length?("canvas"===t&&(t=s),"svg"===t&&(t=o),this._io!==t&&(this._io=t,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},f.initialize=function(t){var e,n=this,r=n._width,s=n._height,o=n._padding;return i.select(t).select("div.vega").remove(),this._el=t=i.select(t).append("div").attr("class","vega").style("position","relative").node(),n._viewport&&i.select(t).style("width",(n._viewport[0]||r)+"px").style("height",(n._viewport[1]||s)+"px").style("overflow","auto"),n._renderer=(n._renderer||new this._io.Renderer).initialize(t,r,s,o),e=n._handler,n._handler=(new this._io.Handler).initialize(t,o,n).model(n._model),e?e.handlers().forEach(function(t){n._handler.on(t.type,t.handler)}):a(this),this},f.update=function(t){t=t||{};var e=this,n=t.duration?new l(t.duration,t.ease):null,i=d.create();return n&&(i.trans=n),void 0!==t.reflow&&(i.reflow=t.reflow),e._build||(e._renderNode=new r(e._model.graph).router(!0),e._renderNode.evaluate=function(t){c.debug(t,["rendering"]);var n=e._model.scene();t.trans?t.trans.start(function(t){e._renderer.render(n,t)}):e._renderer.render(n);var i,r;for(i in t.data)r=e._model.data(i),r.revises()&&d.finalize(r.last());return t},e._model.scene(e._renderNode),e._build=!0),e._model.fire(i),e.autopad(t)},f.on=function(){return this._handler.on.apply(this._handler,arguments),this},f.off=function(){return this._handler.off.apply(this._handler,arguments),this},h.factory=function(t){return function(e){e=e||{};var n=t.defs(),i=(new h).model(t).width(n.width).height(n.height).padding(n.padding).renderer(e.renderer||"canvas");return e.el&&i.initialize(e.el),e.data&&i.data(e.data),i}},e.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/Node":10,"../dataflow/changeset":12,"../parse/streams":27,"../render/canvas/index":31,"../render/svg/index":36,"../scene/Transition":44,"../util/config":64,"../util/index":66}],7:[function(t,e,n){function i(t){return r.prototype.init.call(this,t),this._data=[],this.router(!0).collector(!0)}var r=t("./Node"),a=t("./changeset"),s=t("../util/index"),o=(t("../util/constants"),i.prototype=new r);o.data=function(){return this._data},o.evaluate=function(t){if(s.debug(t,["collecting"]),t.reflow)return t=a.create(t),t.mod=this._data.slice(),t;if(t.rem.length){var e=t.rem.reduce(function(t,e){return t[e._id]=1,t},{});this._data=this._data.filter(function(t){return 1!==e[t._id]})}return t.add.length&&(this._data=this._data.length?this._data.concat(t.add):t.add),t.sort&&this._data.sort(t.sort),t},e.exports=i},{"../util/constants":65,"../util/index":66,"./Node":10,"./changeset":12}],8:[function(t,e,n){function i(t,e,n){this._graph=t,this._name=e,this._data=[],this._source=null,this._facet=n,this._input=a.create(),this._output=null,this._pipeline=null,this._collector=null,this._revises=!1}function r(t){void 0===t._prev&&(t._prev=c.SENTINEL)}var a=t("./changeset"),s=t("./tuple"),o=t("./Node"),l=t("./Collector"),u=t("../util/index"),c=t("../util/constants"),d=i.prototype;d.name=function(t){return arguments.length?(this._name=t,this):this._name},d.source=function(t){return arguments.length?this._source=this._graph.data(t):this._source},d.add=function(t){var e=this._revises?null:void 0;return this._input.add=this._input.add.concat(u.array(t).map(function(t){return s.ingest(t,e)})),this},d.remove=function(t){var e=this._data.filter(t);return this._input.rem=this._input.rem.concat(e),this},d.update=function(t,e,n){{var i=this._input.mod,r=u.tuple_ids(i);this._revises?null:void 0}return this._input.fields[e]=1,this._data.filter(t).forEach(function(t){var a=t[e],o=n(t);a!==o&&(s.set(t,e,o),1!==r[t._id]&&(i.push(t),r[t._id]=1))}),this},d.values=function(t){return arguments.length?(this._input.rem=this._data.slice(),t&&this.add(t),this):this._collector?this._collector.data():this._data},d.revises=function(t){return arguments.length?(!this._revises&&t&&(this._data.forEach(r),this._input.add.forEach(r)),this._revises=this._revises||t,this):this._revises},d.last=function(){return this._output},d.fire=function(t){t&&(this._input=t),this._graph.propagate(this._input,this._pipeline[0])},d.pipeline=function(t){var e=this;if(!arguments.length)return this._pipeline;t.length&&(e._collector=new l(this._graph),t.push(e._collector),e._revises=t.some(function(t){return t.revises()}));var n=new o(this._graph).router(!0).collector(!0);n.evaluate=function(t){u.debug(t,["input",e._name]);var n,i=e._input,r=a.create(t);return u.keys(i.fields).forEach(function(t){r.fields[t]=1}),t.reflow?r.mod=e._data.slice():(i.rem.length&&(n=u.tuple_ids(i.rem),e._data=e._data.filter(function(t){return 1!==n[t._id]})),i.add.length&&(e._data=e._data.concat(i.add)),e._input=a.create(),r.add=i.add,r.mod=i.mod,r.rem=i.rem),r.facet=e._facet,r},t.unshift(n);var i=new o(this._graph).router(!0).collector(!0);return i.evaluate=function(t){u.debug(t,["output",e._name]);var n=a.create(t,!0);return e._facet&&(e._facet.values=e.values(),t.facet=null),e._output=t,n.data[e._name]=1,n},t.push(i),this._pipeline=t,this._graph.connect(e._pipeline),this},d.listener=function(){var t=new o(this._graph).router(!0),e=this,n=this._revises?null:void 0;return t.evaluate=function(t){e._srcMap=e._srcMap||{};var i=e._srcMap,r=a.create(t);return r.add=t.add.map(function(t){return i[t._id]=s.derive(t,void 0!==t._prev?t._prev:n)}),r.mod=t.mod.map(function(t){return i[t._id]}),r.rem=t.rem.map(function(t){var e=i[t._id];return i[t._id]=null,e}),e._input=r},t.addListener(this._pipeline[0]),t},d.addListener=function(t){return t instanceof i?this._collector?this._collector.addListener(t.listener()):this._pipeline[0].addListener(t.listener()):this._pipeline[this._pipeline.length-1].addListener(t),this},d.removeListener=function(t){this._pipeline[this._pipeline.length-1].removeListener(t)},e.exports=i},{"../util/constants":65,"../util/index":66,"./Collector":7,"./Node":10,"./changeset":12,"./tuple":13}],9:[function(t,e,n){function i(){this._stamp=0,this._rank=0,this._data={},this._signals={},this.doNotPropagate={}}function r(t){var e=this;return u.isArray(t)?t.map(function(t){e._signals[t]}):this._signals[t]}function a(t,e){var n,i,r,a;for(r=0,a=t.length;a>r;++r)n=t[r],n.collector()&&(i=n),e(n,i,r)}var s=t("heap"),o=t("./Datasource"),l=t("./Signal"),u=(t("./changeset"),t("../util/index")),c=t("../util/constants"),d=i.prototype;d.data=function(t,e,n){return 1===arguments.length?this._data[t]:this._data[t]=new o(this,t,n).pipeline(e)},d.signal=function(t,e){return 1===arguments.length?r.call(this,t):this._signals[t]=new l(this,t,e)},d.signalValues=function(t){var e=this;return u.isArray(t)?t.reduce(function(t,n){return t[n]=e._signals[n].value(),t},{}):this._signals[t].value()},d.signalRef=function(t){u.isArray(t)||(t=u.field(t));var e=this.signal(t.shift()).value();if(t.length>0){var n=Function("s","return s["+t.map(u.str).join("][")+"]");e=n.call(null,e)}return e};var h=function(t,e){return t.rank==e.rank?t.pulse.reflow?1:-1:t.rank-e.rank};d.propagate=function(t,e){var n,i,r,a,o,l,c,d,f=new s(h);if(t.stamp)throw"Pulse already has a non-zero stamp";for(t.stamp=++this._stamp,f.push({node:e,pulse:t,rank:e.rank()});f.size()>0;)if(n=f.pop(),r=n.node,a=n.pulse,o=n.rank,i=r._listeners,d=a.reflow&&r.last()>=a.stamp,!d)if(o==r.rank()){if(a=this.evaluate(a,r),a!==this.doNotPropagate)for(l=0,c=i.length;c>l;l++)f.push({node:i[l],pulse:a,rank:i[l]._rank})}else u.debug(a,["Rank mismatch",o,r.rank()]),f.push({node:r,pulse:a,rank:r.rank()})},d.connect=function(t){u.debug({},["connecting"]);var e=this;return a(t,function(n,i,r){var a=n.dependency(c.DATA),s=n.dependency(c.SIGNALS);a.length>0&&a.forEach(function(t){e.data(t).revises(n.revises()).addListener(i)}),s.length>0&&s.forEach(function(t){e.signal(t).addListener(i)}),r>0&&t[r-1].addListener(t[r])}),t},d.disconnect=function(t){u.debug({},["disconnecting"]);var e=this;return a(t,function(t,n,i){var r=t.dependency(c.DATA),a=t.dependency(c.SIGNALS);r.length>0&&r.forEach(function(t){e.data(t).removeListener(n)}),a.length>0&&a.forEach(function(t){e.signal(t).removeListener(n)}),t.disconnect()}),t},d.reevaluate=function(t,e){var n=!t.reflow||t.reflow&&e.last()>=t.stamp,i=!!t.add.length||!!t.rem.length||e.router();return i=i||!n,i||e.reevaluate(t)},d.evaluate=function(t,e){return this.reevaluate(t,e)?(t=e.evaluate(t),e.last(t.stamp),t):t},e.exports=i},{"../util/constants":65,"../util/index":66,"./Datasource":8,"./Signal":11,"./changeset":12,heap:2}],10:[function(t,e,n){function i(t){return t&&this.init(t),this}var r=t("../util/index"),a=t("../util/constants"),s=[a.DATA,a.FIELDS,a.SCALES,a.SIGNALS],o=1,l=i.prototype;l.init=function(t){return this._id=o++,this._graph=t,this._rank=++t._rank,this._stamp=0,this._listeners=[],this._registered={},this._deps={data:[],fields:[],scales:[],signals:[]},this._isRouter=!1,this._isCollector=!1,this._revises=!1,this},l.clone=function(){var t=new i(this._graph);return t.evaluate=this.evaluate,t._deps=this._deps,t._isRouter=this._isRouter,t._isCollector=this._isCollector,t},l.rank=function(){return this._rank},l.last=function(t){return arguments.length?(this._stamp=t,this):this._stamp},l.dependency=function(t,e){var n=this._deps[t];if(1===arguments.length)return n;if(null===e)for(;n.length>0;)n.pop();else!r.isArray(e)&&n.indexOf(e)<0?n.push(e):n.push.apply(n,r.array(e));return this},l.router=function(t){return arguments.length?(this._isRouter=!!t,this):this._isRouter},l.collector=function(t){return arguments.length?(this._isCollector=!!t,this):this._isCollector},l.revises=function(t){return arguments.length?(this._revises=!!t,this):this._revises},l.listeners=function(){return this._listeners},l.addListener=function(t){if(!(t instanceof i))throw"Listener is not a Node";if(this._registered[t._id])return this;if(this._listeners.push(t),this._registered[t._id]=1,this._rank>t._rank)for(var e=[t];e.length;){var n=e.splice(0,1)[0];n._rank=++this._graph._rank,e.push.apply(e,n._listeners)}return this},l.removeListener=function(t){for(var e=!1,n=0,i=this._listeners.length;i>n&&!e;n++)this._listeners[n]===t&&(this._listeners.splice(n,1),this._registered[t._id]=null,e=!0);return e},l.disconnect=function(){this._listeners=[],this._registered={}},l.evaluate=function(t){return t},l.reevaluate=function(t){var e=this,n=!1;return s.some(function(i){return n=n||e._deps[i].some(function(e){return!!t[i][e]})})},e.exports=i},{"../util/constants":65,"../util/index":66}],11:[function(t,e,n){function i(t,e,n){return r.prototype.init.call(this,t),this._name=e,this._value=n,this}var r=t("./Node"),a=t("./changeset"),s=(t("../util/index"),i.prototype=new r);s.name=function(){return this._name},s.value=function(t){return arguments.length?(this._value=t,this):this._value},s.fire=function(t){t||(t=a.create(null,!0)),t.signals[this._name]=1,this._graph.propagate(t,this)},e.exports=i},{"../util/index":66,"./Node":10,"./changeset":12}],12:[function(t,e,n){function r(t,e){var n={};return o(t,n),n.add=[],n.mod=[],n.rem=[],n.reflow=e,n}function a(t){t._prev=void 0===t._prev?void 0:l.SENTINEL}function s(t){for(i=0,len=t.add.length;i<len;++i)a(t.add[i]);for(i=0,len=t.mod.length;i<len;++i)a(t.mod[i])}function o(t,e){e.stamp=t?t.stamp:0,e.sort=t?t.sort:null,e.facet=t?t.facet:null,e.trans=t?t.trans:null,u.forEach(function(n){e[n]=t?t[n]:{}})}var l=t("../util/constants"),u=[l.DATA,l.FIELDS,l.SCALES,l.SIGNALS];e.exports={create:r,copy:o,finalize:s}},{"../util/constants":65}],13:[function(t,e,n){function i(t,e){return t=l.isObject(t)?t:{data:t},t._id=c++,t._prev=void 0!==e?e||u.SENTINEL:void 0,t}function r(t,e){return i(Object.create(t),e)}function a(t,e,n){var i=t[e];i!==n&&(s(t,e),t[e]=n)}function s(t,e){void 0!==t._prev&&(t._prev=t._prev===u.SENTINEL?{}:t._prev,t._prev[e]=t[e])}function o(){c=1}var l=t("../util/index"),u=t("../util/constants"),c=1;e.exports={ingest:i,derive:r,set:a,prev:s,reset:o}},{"../util/constants":65,"../util/index":66}],14:[function(t,e,n){function i(t,e,n,i){(e||[]).forEach(function(e,s){n[s]=n[s]||a(t),r(e,s,n[s],i)})}function r(t,e,n,i){void 0!==t.scale&&n.scale(i.scale(t.scale)),n.orient(t.orient||l[t.type]),n.offset(t.offset||0),n.layer(t.layer||"front"),n.grid(t.grid||!1),n.title(t.title||null),n.titleOffset(null!=t.titleOffset?t.titleOffset:s.axis.titleOffset),n.tickValues(t.values||null),n.tickFormat(t.format||null),n.tickSubdivide(t.subdivide||0),n.tickPadding(t.tickPadding||s.axis.padding);var r=[];if(void 0!==t.tickSize)for(var a=0;3>a;++a)r.push(t.tickSize);else{var u=s.axis.tickSize;r=[u,u,u]}if(null!=t.tickSizeMajor&&(r[0]=t.tickSizeMajor),null!=t.tickSizeMinor&&(r[1]=t.tickSizeMinor),null!=t.tickSizeEnd&&(r[2]=t.tickSizeEnd),r.length&&n.tickSize.apply(n,r),null!=t.ticks){var c=o.isArray(t.ticks)?t.ticks:[t.ticks];n.ticks.apply(n,c)}else n.ticks(s.axis.ticks);var d=t.properties;d&&d.ticks?(n.majorTickProperties(d.majorTicks?o.extend({},d.ticks,d.majorTicks):d.ticks),n.minorTickProperties(d.minorTicks?o.extend({},d.ticks,d.minorTicks):d.ticks)):(n.majorTickProperties(d&&d.majorTicks||{}),n.minorTickProperties(d&&d.minorTicks||{})),n.tickLabelProperties(d&&d.labels||{}),n.titleProperties(d&&d.title||{}),n.gridLineProperties(d&&d.grid||{}),n.domainProperties(d&&d.axis||{})}var a=t("../scene/axis"),s=t("../util/config"),o=t("../util/index"),l={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};e.exports=i},{"../scene/axis":45,"../util/config":64,"../util/index":66}],15:[function(t,e,n){var i=t("./transforms"),r=t("./modify"),a=t("../util/index"),s=t("../util/load"),o=t("../util/read"),l=function(t,e,n){function i(e){return function(i,s){i?a.error("LOADING FAILED: "+e.url):t.data(e.name).values(o(s.toString(),e.format)),0===--r&&n()}}var r=0;return(e||[]).forEach(function(e){e.url&&(r+=1,s(e.url,i(e))),l.datasource(t,e)}),0===r&&setTimeout(n,1),e};l.datasource=function(t,e){var n=(e.transform||[]).map(function(e){return i(t,e)}),a=(e.modify||[]).map(function(n){return r(t,n,e)}),s=t.data(e.name,a.concat(n));return e.values?s.values(o(e.values,e.format)):e.source&&(s.source(e.source).revises(s.revises()).addListener(s),t.removeListener(s.pipeline()[0])),s},e.exports=l},{"../util/index":66,"../util/load":67,"../util/read":69,"./modify":21,"./transforms":28}],16:[function(t,e,n){function i(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function r(t,e,n,i,r,a){this.message=t,this.expected=e,this.found=n,this.offset=i,this.line=r,this.column=a,this.name="SyntaxError"}function a(t){function e(e){function n(e,n,i){var r,a;for(r=n;i>r;r++)a=t.charAt(r),"\n"===a?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}return Ft!==e&&(Ft>e&&(Ft=0,qt={line:1,column:1,seenCR:!1}),n(qt,Ft,e),Ft=e),qt}function n(t){Gt>jt||(jt>Gt&&(Gt=jt,Wt=[]),Wt.push(t))}function i(n,i,a){function s(t){var e=1;for(t.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}function o(t,e){function n(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+e(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+e(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+e(t)})}var i,r,a,s=new Array(t.length);for(a=0;a<t.length;a++)s[a]=t[a].description;return i=t.length>1?s.slice(0,-1).join(", ")+" or "+s[t.length-1]:s[0],r=e?'"'+n(e)+'"':"end of input","Expected "+i+" but "+r+" found."}var l=e(a),u=a<t.length?t.charAt(a):null;return null!==i&&s(i),new r(null!==n?n:o(i,u),i,u,a,l.line,l.column)}function a(){var t;return t=s()}function s(){var e,i,r,a,l,u;return e=jt,i=o(),i!==_?(r=g(),r!==_?(44===t.charCodeAt(jt)?(a=k,jt++):(a=_,0===Bt&&n(w)),a!==_?(l=g(),l!==_?(u=s(),u!==_?(Rt=e,i=A(i,u),e=i):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b),e===_&&(e=jt,i=o(),i!==_&&(Rt=e,i=E(i)),e=i),e}function o(){var e,i,r,a,s,u,c,d,h,f,p,m,v,y;return e=jt,91===t.charCodeAt(jt)?(i=L,jt++):(i=_,0===Bt&&n(M)),i!==_?(r=g(),r!==_?(a=l(),a!==_?(s=g(),s!==_?(44===t.charCodeAt(jt)?(u=k,jt++):(u=_,0===Bt&&n(w)),u!==_?(c=g(),c!==_?(d=l(),d!==_?(h=g(),h!==_?(93===t.charCodeAt(jt)?(f=S,jt++):(f=_,0===Bt&&n(T)),f!==_?(p=g(),p!==_?(62===t.charCodeAt(jt)?(m=N,jt++):(m=_,0===Bt&&n(C)),m!==_?(v=g(),v!==_?(y=o(),y!==_?(Rt=e,i=O(a,d,y),e=i):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b),e===_&&(e=l()),e}function l(){var t,e,n,i;if(t=jt,e=u(),e!==_){if(n=[],i=f(),i!==_)for(;i!==_;)n.push(i),i=f();else n=b;n!==_?(Rt=t,e=I(e,n),t=e):(jt=t,t=b)}else jt=t,t=b;return t===_&&(t=jt,e=u(),e!==_&&(Rt=t,e=D(e)),t=e),t}function u(){var e,i,r,a;if(e=jt,i=c(),i===_&&(i=d()),i===_&&(i=P),i!==_?(r=h(),r!==_?(Rt=e,i=z(i,r),e=i):(jt=e,e=b)):(jt=e,e=b),e===_){if(e=jt,i=[],j.test(t.charAt(jt))?(r=t.charAt(jt),jt++):(r=_,0===Bt&&n(R)),r!==_)for(;r!==_;)i.push(r),j.test(t.charAt(jt))?(r=t.charAt(jt),jt++):(r=_,0===Bt&&n(R));else i=b;i!==_&&(Rt=e,i=F(i)),e=i,e===_&&(e=jt,40===t.charCodeAt(jt)?(i=q,jt++):(i=_,0===Bt&&n(G)),i!==_?(r=s(),r!==_?(41===t.charCodeAt(jt)?(a=W,jt++):(a=_,0===Bt&&n(B)),a!==_?(Rt=e,i=U(r),e=i):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b))}return e}function c(){var e,i,r,a;return e=jt,46===t.charCodeAt(jt)?(i=V,jt++):(i=_,0===Bt&&n(X)),i!==_?(r=p(),r!==_?(58===t.charCodeAt(jt)?(a=J,jt++):(a=_,0===Bt&&n(H)),a!==_?(Rt=e,i=Q(r),e=i):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b),e}function d(){var e,i,r,a;return e=jt,35===t.charCodeAt(jt)?(i=Z,jt++):(i=_,0===Bt&&n(K)),i!==_?(r=p(),r!==_?(58===t.charCodeAt(jt)?(a=J,jt++):(a=_,0===Bt&&n(H)),a!==_?(Rt=e,i=$(r),e=i):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b),e}function h(){var e;return t.substr(jt,9)===Y?(e=Y,jt+=9):(e=_,0===Bt&&n(tt)),e===_&&(t.substr(jt,7)===et?(e=et,jt+=7):(e=_,0===Bt&&n(nt)),e===_&&(t.substr(jt,5)===it?(e=it,jt+=5):(e=_,0===Bt&&n(rt)),e===_&&(t.substr(jt,8)===at?(e=at,jt+=8):(e=_,0===Bt&&n(st)),e===_&&(t.substr(jt,5)===ot?(e=ot,jt+=5):(e=_,0===Bt&&n(lt)),e===_&&(t.substr(jt,7)===ut?(e=ut,jt+=7):(e=_,0===Bt&&n(ct)),e===_&&(t.substr(jt,8)===dt?(e=dt,jt+=8):(e=_,0===Bt&&n(ht)),e===_&&(t.substr(jt,5)===ft?(e=ft,jt+=5):(e=_,0===Bt&&n(pt)),e===_&&(t.substr(jt,10)===gt?(e=gt,jt+=10):(e=_,0===Bt&&n(mt)),e===_&&(t.substr(jt,9)===vt?(e=vt,jt+=9):(e=_,0===Bt&&n(_t)),e===_&&(t.substr(jt,8)===yt?(e=yt,jt+=8):(e=_,0===Bt&&n(xt)),e===_&&(t.substr(jt,9)===bt?(e=bt,jt+=9):(e=_,0===Bt&&n(kt)),e===_&&(t.substr(jt,10)===wt?(e=wt,jt+=10):(e=_,0===Bt&&n(At)),e===_&&(t.substr(jt,10)===Et?(e=Et,jt+=10):(e=_,0===Bt&&n(Lt)),e===_&&(t.substr(jt,9)===Mt?(e=Mt,jt+=9):(e=_,0===Bt&&n(St)),e===_&&(t.substr(jt,8)===Tt?(e=Tt,jt+=8):(e=_,0===Bt&&n(Nt))))))))))))))))),e}function f(){var e,i,r,a;return e=jt,91===t.charCodeAt(jt)?(i=L,jt++):(i=_,0===Bt&&n(M)),i!==_?(r=p(),r!==_?(93===t.charCodeAt(jt)?(a=S,jt++):(a=_,0===Bt&&n(T)),a!==_?(Rt=e,i=Ct(r),e=i):(jt=e,e=b)):(jt=e,e=b)):(jt=e,e=b),e}function p(){var e,i,r;if(e=jt,i=[],Ot.test(t.charAt(jt))?(r=t.charAt(jt),jt++):(r=_,0===Bt&&n(It)),r!==_)for(;r!==_;)i.push(r),Ot.test(t.charAt(jt))?(r=t.charAt(jt),jt++):(r=_,0===Bt&&n(It));else i=b;return i!==_&&(Rt=e,i=Dt(i)),e=i}function g(){var e,i;for(e=[],Pt.test(t.charAt(jt))?(i=t.charAt(jt),jt++):(i=_,0===Bt&&n(zt));i!==_;)e.push(i),Pt.test(t.charAt(jt))?(i=t.charAt(jt),jt++):(i=_,0===Bt&&n(zt));return e}var m,v=arguments.length>1?arguments[1]:{},_={},y={start:a},x=a,b=_,k=",",w={type:"literal",value:",",description:'","'},A=function(t,e){return[t].concat(e)},E=function(t){return[t]},L="[",M={type:"literal",value:"[",description:'"["'},S="]",T={type:"literal",value:"]",description:'"]"'},N=">",C={type:"literal",value:">",description:'">"'},O=function(t,e,n){return{start:t,end:e,middle:n}},I=function(t,e){return t.filters=e,t},D=function(t){return t},P=null,z=function(t,e){return{event:e,target:t}},j=/^[:a-zA-z0-9_\-]/,R={type:"class",value:"[:a-zA-z0-9_\\-]",description:"[:a-zA-z0-9_\\-]"},F=function(t){return{signal:t.join("")}},q="(",G={type:"literal",value:"(",description:'"("'},W=")",B={type:"literal",value:")",description:'")"'},U=function(t){return{stream:t}},V=".",X={type:"literal",value:".",description:'"."'},J=":",H={type:"literal",value:":",description:'":"'},Q=function(t){return{type:"class",value:t}},Z="#",K={type:"literal",value:"#",description:'"#"'},$=function(t){return{type:"id",value:t}},Y="mousedown",tt={type:"literal",value:"mousedown",description:'"mousedown"'},et="mouseup",nt={type:"literal",value:"mouseup",description:'"mouseup"'},it="click",rt={type:"literal",value:"click",description:'"click"'},at="dblclick",st={type:"literal",value:"dblclick",description:'"dblclick"'},ot="wheel",lt={type:"literal",value:"wheel",description:'"wheel"'},ut="keydown",ct={type:"literal",value:"keydown",description:'"keydown"'},dt="keypress",ht={type:"literal",value:"keypress",description:'"keypress"'},ft="keyup",pt={type:"literal",value:"keyup",description:'"keyup"'},gt="mousewheel",mt={type:"literal",value:"mousewheel",description:'"mousewheel"'},vt="mousemove",_t={type:"literal",value:"mousemove",description:'"mousemove"'},yt="mouseout",xt={type:"literal",value:"mouseout",description:'"mouseout"'},bt="mouseover",kt={type:"literal",value:"mouseover",description:'"mouseover"'},wt="mouseenter",At={type:"literal",value:"mouseenter",description:'"mouseenter"'},Et="touchstart",Lt={type:"literal",value:"touchstart",description:'"touchstart"'},Mt="touchmove",St={type:"literal",value:"touchmove",description:'"touchmove"'},Tt="touchend",Nt={type:"literal",value:"touchend",description:'"touchend"'},Ct=function(t){return t},Ot=/^['"a-zA-Z0-9_.><=! \t\-]/,It={type:"class",value:"['\"a-zA-Z0-9_.><=! \\t\\-]",description:"['\"a-zA-Z0-9_.><=! \\t\\-]"},Dt=function(t){return t.join("")},Pt=/^[ \t\r\n]/,zt={type:"class",value:"[ \\t\\r\\n]",description:"[ \\t\\r\\n]"},jt=0,Rt=0,Ft=0,qt={line:1,column:1,seenCR:!1},Gt=0,Wt=[],Bt=0;

if("startRule"in v){if(!(v.startRule in y))throw new Error("Can't start parsing from rule \""+v.startRule+'".');x=y[v.startRule]}if(m=x(),m!==_&&jt===t.length)return m;throw m!==_&&jt<t.length&&n({type:"end",description:"end of input"}),i(null,Wt,Gt)}i(r,Error),e.exports={SyntaxError:r,parse:a}},{}],17:[function(t,e,n){function i(t,e){var n,i,l,u,c,d,h,f=e.split(o),p={},g={};for(c=0,d=0,l=0,u=f.length;u>l;++l){var n=f[l];"'"!==n?'"'!==n?d||c||(a[n]&&(f[l]=a[n]),s[n]&&(i=f[l+1])&&"("===i[0]&&(f[l]=s[n]),":"==f[l+1]&&(h=n+":"+f[l+2],t.signal((h=r.field(h))[0])&&(p[h[0]]=1,i=r.field(f[l+2]),f[l]="sg['"+f[l],f[l+2]=f[l+2].replace(i[0],i[0]+"']"),l+=2)),t.signal((i=r.field(n))[0])&&(p[i[0]]=1,f[l]=f[l].replace(i[0],"sg["+r.str(i[0])+"]")),"d"==i[0]&&(i=i.splice(1),g[i[0]]=1,i.length>1&&(g[i.join(".")]=1))):c||(d=!d):d||(c=!c)}return{fn:Function("d","e","i","p","sg","return ("+f.join("")+");"),signals:r.keys(p),fields:r.keys(g)}}var r=t("../util/index"),a={E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},s={abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",date:"Date.parse"},o=/([\"\']|[\=\<\>\~\&\|\?\:\+\-\/\*\%\!\^\,\;\[\]\{\}\(\) ]+)/;i.eval=function(t,e,n,i,a,s,o){return o=t.signalValues(r.array(o)),e.call(null,n,i,a,s,o)},e.exports=i},{"../util/index":66}],18:[function(t,e,n){var i=t("../util/load"),r=t("../util/index"),a=t("../util/constants");e.exports=function(t,e,n){function s(t){return function(e,n){if(e)r.error("LOADING FAILED: "+t.url);else{var i=r.isObject(n)?n:JSON.parse(n);o(t.name,i)}0==--m&&l()}}function o(t,e){v={},_={},e.signals&&x.push.apply(x,d(t,e.signals)),e.predicates&&b.push.apply(b,h(t,e.predicates)),p(t,e.marks)}function l(){r.keys(y).length>0&&u(e.marks),e.signals=r.array(e.signals),e.predicates=r.array(e.predicates),e.signals.unshift.apply(e.signals,x),e.predicates.unshift.apply(e.predicates,b),n()}function u(t){var e,n,i,s;for(t=r.array(t),i=0,s=t.length;s>i;i++)e=t[i],(n=y[e.type])?(t[i]=r.duplicate(n),e.from&&(t[i].from=e.from),e.properties&&[a.ENTER,a.UPDATE,a.EXIT].forEach(function(a){t[i].properties[a]=r.extend(n.properties[a],e.properties[a])})):e.marks&&u(e.marks)}function c(t,e){return r.isString(e)?e+"_"+t:(r.keys(e).forEach(function(n){var i=new RegExp("\\b"+n+"\\b","g");t=t.replace(i,e[n])}),t)}function d(t,e){return e=r.array(e),e.forEach(function(e){e.name=v[e.name]=c(e.name,t)}),e.forEach(function(t){(t.streams||[]).forEach(function(t){t.type=c(t.type,v),t.expr=c(t.expr,v)})}),e}function h(t,e){return e=r.array(e),e.forEach(function(e){e.name=_[e.name]=c(e.name,t),[e.operands,e.range].forEach(function(t){(t||[]).forEach(function(t){t.signal?t.signal=c(t.signal,v):t.predicate&&f(t)})})}),e}function f(t){t.predicate=_[t.predicate],r.keys(t.input).forEach(function(e){var n=t.input[e];n.signal&&(n.signal=c(n.signal,v))})}function p(t,e){(e||[]).forEach(function(e){g(e.properties.enter),g(e.properties.update),g(e.properties.exit),y[c(e.name,t)]=e})}function g(t){r.keys(t).forEach(function(e){var n=t[e];n.signal?n.signal=c(n.signal,v):n.rule&&n.rule.forEach(function(t){t.signal&&(t.signal=c(t.signal,v)),t.predicate&&f(t)})})}var m=0,v={},_={},y={},x=[],b=[];return(e.interactors||[]).forEach(function(t){t.url&&(m+=1,i(t.url,s(t)))}),0===m&&setTimeout(l,1),e}},{"../util/constants":65,"../util/index":66,"../util/load":67}],19:[function(t,e,n){var i=t("../util/index"),r=t("./properties");e.exports=function a(t,e){var n=e.properties,s=e.marks;return i.keys(n).forEach(function(i){n[i]=r(t,e.type,n[i])}),e.delay&&(e.delay=r(t,e.type,{delay:e.delay})),s&&(e.marks=s.map(function(e){return a(t,e)})),e}},{"../util/index":66,"./properties":24}],20:[function(t,e,n){var i=t("./mark");e.exports=function(t,e,n,r){return{type:"group",width:n,height:r,scales:e.scales||[],axes:e.axes||[],marks:(e.marks||[]).map(function(e){return i(t,e)})}}},{"./mark":19}],21:[function(t,e,n){var i=t("../dataflow/Node"),r=t("../dataflow/tuple"),a=t("../util/index"),s=t("../util/constants"),o=function(t,e,n,i){for(var r=n.length-1;r>=0;--r)n[r][t]==e&&i.push.apply(i,n.splice(r,1))};e.exports=function(t,e,n){var l=t.graph,u=e.signal?a.field(e.signal):null,c=u?u[0]:null,d=e.predicate?t.predicate(e.predicate):null,h=null===d,f=new i(l);return f.evaluate=function(i){if(null!==d){var c={};(d.data||[]).forEach(function(e){c[e]=t.data(e).values()}),h=d({},c,l.signalValues(d.signals||[]),t._predicates)}if(a.debug(i,[e.type+"ing",h]),!h)return i;var f={},p=u?l.signalRef(e.signal):null,g=t.data(n.name),m=g.revises()?null:void 0,v=null;if(f[e.field]=p,e.type==s.ADD)v=r.ingest(f,m),i.add.push(v),g._data.push(v);else if(e.type==s.REMOVE)o(e.field,p,i.add,i.rem),o(e.field,p,i.mod,i.rem),g._data=g._data.filter(function(t){return t[e.field]!==p});else if(e.type==s.TOGGLE){var _=[],y=[];o(e.field,p,i.rem,_),o(e.field,p,i.add,y),o(e.field,p,i.mod,y),0==_.length&&0==y.length&&_.push(r.ingest(f)),i.add.push.apply(i.add,_),g._data.push.apply(g._data,_),i.rem.push.apply(i.rem,y),g._data=g._data.filter(function(t){return-1===y.indexOf(t)})}else e.type==s.CLEAR&&(i.rem.push.apply(i.rem,i.add),i.rem.push.apply(i.rem,i.mod),i.add=[],i.mod=[],g._data=[]);return i.fields[e.field]=1,i},c&&f.dependency(s.SIGNALS,c),d&&f.dependency(s.SIGNALS,d.signals),f}},{"../dataflow/Node":10,"../dataflow/tuple":13,"../util/constants":65,"../util/index":66}],22:[function(t,e,n){var i=t("../util/index");e.exports=function(t){if(null==t)return"auto";if(i.isString(t))return"strict"===t?"strict":"auto";if(i.isObject(t))return t;var e=i.isNumber(t)?t:20;return{top:e,left:e,right:e,bottom:e}}},{"../util/index":66}],23:[function(t,e,n){var i=t("../util/index");e.exports=function(t,e){function n(t,e){var n=i.field(t),r="signals["+n.map(i.str).join("][")+"]";return e[n.shift()]=1,r}function r(e){var r=[],a=[],s={},o={};return i.array(e).forEach(function(e,l){var u="o"+l,c="";if(void 0!==e.value)c=i.str(e.value);else if(e.arg)c="args["+i.str(e.arg)+"]";else if(e.signal)c=n(e.signal,s);else if(e.predicate){var d=t.predicate(e.predicate);d.signals.forEach(function(t){s[t]=1}),d.data.forEach(function(t){o[t]=1}),i.keys(e.input).forEach(function(t){var r=e.input[t];c+="args["+i.str(t)+"] = ",r.signal?c+=n(r.signal,s):r.arg&&(c+="args["+i.str(r.arg)+"]"),c+=", "}),c+="predicates["+i.str(e.predicate)+"](args, db, signals, predicates)"}r.push(u),a.push(u+"=("+c+")")}),{code:"var "+r.join(", ")+";\n"+a.join(";\n")+";\n",signals:i.keys(s),data:i.keys(o)}}function a(t){var e=r(t.operands);return"="==t.type&&(t.type="=="),{code:e.code+"return "+["o0","o1"].join(t.type)+";",signals:e.signals,data:e.data}}function s(t){for(var e=r(t.operands),n=[],i=0,a=t.operands.length;n.push("o"+i++)<a;);return"and"==t.type?t.type="&&":"or"==t.type&&(t.type="||"),{code:e.code+"return "+n.join(t.type)+";",signals:e.signals,data:e.data}}function o(t){var e=[t.item];t.range&&e.push.apply(e,t.range),t.scale&&e.push(t.scale);var n=r(e),a=n.code;if(t.data){var s=i.field(t.field).map(i.str);a+="var where = function(d) { return d["+s.join("][")+"] == o0 };\n",a+="return db["+i.str(t.data)+"].filter(where).length > 0;"}else t.range&&(t.scale&&(a+="o1 = o3(o1);\no2 = o3(o2);\n"),a+="return o1 < o2 ? o1 <= o0 && o0 <= o2 : o2 <= o0 && o0 <= o1");return{code:a,signals:n.signals,data:n.data.concat(t.data?[t.data]:[])}}var l={"=":a,"==":a,"!=":a,">":a,">=":a,"<":a,"<=":a,and:s,"&&":s,or:s,"||":s,"in":o};return(e||[]).forEach(function(e){var n=l[e.type](e),i=Function("args","db","signals","predicates",n.code);i.signals=n.signals,i.data=n.data,t.predicate(e.name,i)}),e}},{"../util/index":66}],24:[function(t,e,n){(function(n){function i(t,e,n){var i,o,d,h,f="",p=c.keys(n),g={},m={signals:{},scales:{},data:{}};for(f+="var o = trans ? {} : item;\n",i=0,o=p.length;o>i;++i)h=n[d=p[i]],f+=i>0?"\n  ":"  ",h.rule?(h=a(t,d,h.rule),f+="\n  "+h.code):(h=s(d,h),f+="this.tpl.set(o, "+c.str(d)+", "+h.val+");"),g[d]=!0,["signals","scales","data"].forEach(function(t){null!=h[t]&&c.array(h[t]).forEach(function(e){m[t][e]=1})});g.x2&&(g.x?(f+="\n  if (o.x > o.x2) { var t = o.x;this.tpl.set(o, 'x', o.x2);this.tpl.set(o, 'x2', t); };",f+="\n  this.tpl.set(o, 'width', (o.x2 - o.x));"):f+=g.width?"\n  this.tpl.set(o, 'x', (o.x2 - o.width));":"\n  this.tpl.set(o, 'x', o.x2);"),g.y2&&(g.y?(f+="\n  if (o.y > o.y2) { var t = o.y;this.tpl.set(o, 'y', o.y2);this.tpl.set(o, 'y2', t);};",f+="\n  this.tpl.set(o, 'height', (o.y2 - o.y));"):f+=g.height?"\n  this.tpl.set(o, 'y', (o.y2 - o.height));":"\n  this.tpl.set(o, 'y', o.y2);"),r(e,g)&&(f+="\n  item.touch();"),f+="\n  if (trans) trans.interpolate(item, o);";try{var v=Function("item","group","trans","db","signals","predicates",f);return v.tpl=u,v.util=c,v.d3=l,{encode:v,signals:c.keys(m.signals),scales:c.keys(m.scales),data:c.keys(m.data)}}catch(_){c.error(_),c.log(f)}}function r(t,e){return e.path||("area"===t||"line"===t)&&(e.x||e.x2||e.width||e.y||e.y2||e.height||e.tension||e.interpolate)}function a(t,e,n){var i=[],r=[],a=[],o=[],l="";return(n||[]).forEach(function(u,d){var h,f=u.predicate,p=t.predicate(f),g=[],m=e+"_arg"+d;c.keys(u.input).forEach(function(t){var e=s(d,u.input[t]);g.push(c.str(t)+": "+e.val),e.signals&&i.push.apply(i,c.array(e.signals)),e.scales&&r.push.apply(r,c.array(e.scales))}),h=s(e,u),h.signals&&i.push.apply(i,c.array(h.signals)),h.scales&&r.push.apply(r,c.array(h.scales)),f?(i.push.apply(i,p.signals),a.push.apply(a,p.data),o.push(m+" = {"+g.join(", ")+"}"),l+="if(predicates["+c.str(f)+"]("+m+", db, signals, predicates)) {\n    this.tpl.set(o, "+c.str(e)+", "+h.val+");\n",l+=n[d+1]?"  } else ":"  }"):l+="{\n    this.tpl.set(o, "+c.str(e)+", "+h.val+");\n  }"}),l="var "+o.join(",\n      ")+";\n  "+l,{code:l,signals:i,scales:r,data:a}}function s(t,e){if(null==e)return null;var n="fill"===t||"stroke"===t,i=[];if(n){if(e.c)return o("hcl",e.h,e.c,e.l);if(e.h||e.s)return o("hsl",e.h,e.s,e.l);if(e.l||e.a)return o("lab",e.l,e.a,e.b);if(e.r||e.g||e.b)return o("rgb",e.r,e.g,e.b)}var r=null,a=null;if(void 0!==e.value&&(r=c.str(e.value)),void 0!==e.signal&&(a=c.field(e.signal),r="signals["+a.map(c.str).join("][")+"]",i.push(a.shift())),null!=e.group){var s="group.datum";c.isString(e.group)&&(s=h[e.group]?"group."+e.group:"group.datum["+c.field(e.group).map(c.str).join("][")+"]")}if(null!=e.field?c.isString(e.field)?(r="item.datum["+c.field(e.field).map(c.str).join("][")+"]",null!=e.group&&(r="this.util.accessor("+r+")("+s+")")):e.field.signal?(a=c.field(e.field.signal),r="item.datum[signals["+a.map(c.str).join("][")+"]]",null!=e.group&&(r="this.util.accessor("+r+")("+s+")"),i.push(a.shift())):r="this.util.accessor(group.datum["+c.field(e.field.group).map(c.str).join("][")+"])(item.datum)":null!=e.group&&(r=s),null!=e.scale){var l=null;c.isString(e.scale)?l=c.str(e.scale):e.scale.signal?(a=c.field(e.scale.signal),l="signals["+a.map(c.str).join("][")+"]",i.push(a.shift())):l=(e.scale.group?"group":"item")+".datum["+c.str(e.scale.group||e.scale.field)+"]",l="group.scale("+l+")",e.invert&&(l+=".invert"),r=null!==r||e.band||e.mult||e.offset?l+(e.band?".rangeBand()":"("+(null!==r?r:"item.datum.data")+")"):l}return r="("+(e.mult?c.number(e.mult)+" * ":"")+r+")"+(e.offset?" + "+c.number(e.offset):""),{val:r,signals:i,scales:e.scale}}function o(t,e,n,i){var r=e?s("",e):d.color[t][0],a=n?s("",n):d.color[t][1],o=i?s("",i):d.color[t][2];return signals=[],scales=[],[r,a,o].forEach(function(t){t.signals&&signals.push.apply(signals,t.signals),t.scales&&scales.push(t.scales)}),{val:"(this.d3."+t+"("+[r.val,a.val,o.val].join(",")+') + "")',signals:signals,scales:scales}}var l="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,u=t("../dataflow/tuple"),c=t("../util/index"),d=t("../util/config"),h={width:1,height:1,"mark.group.width":1,"mark.group.height":1};e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":13,"../util/config":64,"../util/index":66}],25:[function(t,e,n){var i=t("./expr"),r=t("../util/constants");e.exports=function(t,e){var n=t.graph;return(e||[]).forEach(function(a){var s,o=n.signal(a.name,a.init);a.expr&&(s=i(n,a.expr),o.evaluate=function(r){var l=i.eval(n,s.fn,null,null,null,null,s.signals);return e.scale&&(l=t.scale(e,l)),o.value(l),r.signals[a.name]=1,r},o.dependency(r.SIGNALS,s.signals),s.signals.forEach(function(t){n.signal(t).addListener(o)}))}),e}},{"../util/constants":65,"./expr":17}],26:[function(t,e,n){var i=t("../core/Model"),r=t("../core/View"),a=t("../parse/padding"),s=t("../parse/marks"),o=t("../parse/signals"),l=t("../parse/predicates"),u=t("../parse/data"),c=t("../parse/interactors"),d=t("../util/index");e.exports=function(t,e,n){t=d.duplicate(t),n=n||r.factory;var h=t.width||500,f=t.height||500,p=t.viewport||null,g=new i;c(g,t,function(){g.defs({width:h,height:f,viewport:p,padding:a(t.padding),signals:o(g,t.signals),predicates:l(g,t.predicates),marks:s(g,t,h,f),data:u(g,t.data,function(){e(n(g))})})})}},{"../core/Model":5,"../core/View":6,"../parse/data":15,"../parse/interactors":18,"../parse/marks":20,"../parse/padding":22,"../parse/predicates":23,"../parse/signals":25,"../util/index":66}],27:[function(t,e,n){(function(n){var i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,r=t("../dataflow/Node"),a=t("../dataflow/changeset"),s=t("./events"),o=t("./expr"),l=t("../util/index"),u=t("../util/constants"),c="start",d="middle",h="end";e.exports=function(t){function e(t,e,n){n&&n.scale||(n=n&&n.mark?n.mark.group:m.scene().items[0]);var i=n.scale(t.scale.signal||t.scale);return i?t.invert?i.invert(e):i(e):e}function n(t,n,i,a){var s=new r(v),l=a.item?v.signal(a.item.signal):null;s.evaluate=function(r){if(!r.signals[n.signal])return v.doNotPropagate;var s=o.eval(v,i.fn,null,null,null,null,i.signals);return a.scale&&(s=e(a,s,l?l.value():null)),t.value(s),r.signals[t.name()]=1,r.reflow=!0,r},s.dependency(u.SIGNALS,n.signal),s.addListener(t),v.signal(n.signal).addListener(s)}function f(t,e,n,i){var a=e.filters||[],s=e.target;s&&a.push("i."+s.type+"=="+l.str(s.value)),y[e.event]=y[e.event]||[],y[e.event].push({signal:t,exp:n,filters:a.map(function(t){return o(v,t)}),spec:i}),x[e.event]=x[e.event]||new r(v),x[e.event].addListener(t)}function p(t,e,i,a){var s=t.name(),l=o(v,"true"),u={};u[c]=v.signal(s+c,!1),u[d]=v.signal(s+d,!1),u[h]=v.signal(s+h,!1);var p=new r(v);p.evaluate=function(e){return u[c].value()===!0&&u[h].value()===!1?e.signals[s+c]?v.doNotPropagate:(t.value(u[d].value()),e.signals[s]=1,e):(u[h].value()===!0&&(u[c].value(!1),u[h].value(!1)),v.doNotPropagate)},p.addListener(t),[c,d,h].forEach(function(t){var r=t==d?i:l,s=t==d?a:{};e[t].event?f(u[t],e[t],r,s):e[t].signal?n(u[t],e[t],r,s):e[t].stream&&g(u[t],e[t].stream,r,s),u[t].addListener(p)})}function g(t,e,i,r){e.forEach(function(e){e.event?f(t,e,i,r):e.signal?n(t,e,i,r):e.start?p(t,e,i,r):e.stream&&g(t,e.stream,i,r)})}var m=t.model(),v=m.graph,_=m.defs().signals,y={},x={};(_||[]).forEach(function(t){var e=v.signal(t.name);t.expr||(t.streams||[]).forEach(function(t){var n=s.parse(t.type),i=o(v,t.expr);g(e,n,i,t)})}),l.keys(y).forEach(function(n){var r=y[n],s=x[n];t.on(n,function(n,l){var u,c,d,h,f,p=a.create(null,!0),g=t.padding(),m=!1;n.preventDefault(),h=i.mouse((i.event=n,t._el)),l=l||{},f=l.datum||{};var _={x:h[0]-g.left,y:h[1]-g.top};for(d=0;d<r.length;d++)c=r[d],m=c.filters.some(function(t){return!o.eval(v,t.fn,f,n,l,_,t.signals)}),m||(u=o.eval(v,c.exp.fn,f,n,l,_,c.exp.signals),c.spec.scale&&(u=e(c.spec,u,l)),c.signal.value(u),p.signals[c.signal.name()]=1);v.propagate(p,s)})})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/Node":10,"../dataflow/changeset":12,"../util/constants":65,"../util/index":66,"./events":16,"./expr":17}],28:[function(t,e,n){var i=t("../util/index"),r=t("../transforms/index");e.exports=function a(t,e){var n=new r[e.type](t.graph);if("facet"==e.type){var s=(e.transform||[]).map(function(e){return a(t,e)});n.pipeline(s)}return e.output&&n.output(e.output),i.keys(e).forEach(function(t){"type"!==t&&"output"!==t&&("transform"!==t||"facet"!==e.type)&&n[t].set(n,e[t])}),n}},{"../transforms/index":60,"../util/index":66}],29:[function(t,e,n){(function(n){function i(t){var e=t.indexOf(".");return 0>e?t:t.slice(0,e)}var r="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,a=t("../../util/index"),s=t("./marks"),o=function(t,e){this._active=null,this._handlers={},t&&this.initialize(t),e&&this.model(e)},l=o.prototype;l.initialize=function(t,e,n){this._el=r.select(t).node(),this._canvas=r.select(t).select("canvas.marks").node(),this._padding=e,this._obj=n||null;var i=this._canvas,a=this;return u.forEach(function(t){i.addEventListener(t,function(e){l[t].call(a,e)})}),this},l.padding=function(t){return this._padding=t,this},l.model=function(t){return arguments.length?(this._model=t,this):this._model},l.handlers=function(){var t=this._handlers;return a.keys(t).reduce(function(e,n){return t[n].reduce(function(t,e){return t.push(e),t},e)},[])};var u=["mousedown","mouseup","click","dblclick","wheel","keydown","keypress","keyup","mousewheel","touchstart"];u.forEach(function(t){l[t]=function(e){this.fire(t,e)}}),u.push("mousemove"),u.push("mouseout"),u.push("touchmove"),u.push("touchend"),l.touchmove=l.mousemove=function(t){var e=this._padding,n=t.target.getBoundingClientRect(),i=t.clientX-n.left,r=t.clientY-n.top,a=this._active,s=this.pick(this._model.scene(),i,r,i-e.left,r-e.top);return s===a?(this.fire("mousemove",t),void("touchmove"==t.type&&this.fire("touchmove",t))):(a&&(this.fire("mouseout",t),"touchend"==t.type&&this.fire("touchend",t)),this._active=s,void(s&&(this.fire("mouseover",t),"touchstart"==t.type&&this.fire("touchstart",t))))},l.touchend=l.mouseout=function(t){this._active&&(this.fire("mouseout",t),this.fire("touchend",t)),this._active=null},l.DOMMouseScroll=function(t){this.fire("mousewheel",t)},l.fire=function(t,e){var n=this._active,i=this._handlers[t];if(i)for(var r=0,a=i.length;a>r;++r)i[r].handler.call(this._obj,e,n)},l.on=function(t,e){var n=i(t),r=this._handlers;return r=r[n]||(r[n]=[]),r.push({type:t,handler:e}),this},l.off=function(t,e){var n=i(t),r=this._handlers[n];if(r){for(var a=r.length;--a>=0;)r[a].type===t&&(e&&r[a].handler!==e||r.splice(a,1));return this}},l.context=function(){return this._canvas.getContext("2d")},l.pick=function(t,e,n,i,r){var a=this.context(),o=t.marktype,l=s.pick[o];return l.call(this,a,t,e,n,i,r)},e.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/index":66,"./marks":32}],30:[function(t,e,n){(function(n){function i(t,e){var n=window.devicePixelRatio||1,i=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,r=n/i;if(n!==i){var a=t.width,s=t.height;t.setAttribute("width",a*r),t.setAttribute("height",s*r),t.style.width=a+"px",t.style.height=s+"px"}return r}function r(t){if(!t.vgLineDash){var e=[];t.setLineDash?(t.vgLineDash=function(t){this.setLineDash(t||e)},t.vgLineDashOffset=function(t){this.lineDashOffset=t}):void 0!==t.webkitLineDash?(t.vgLineDash=function(t){this.webkitLineDash=t||e},t.vgLineDashOffset=function(t){this.webkitLineDashOffset=t}):void 0!==t.mozDash?(t.vgLineDash=function(t){this.mozDash=t},t.vgLineDashOffset=function(t){}):(t.vgLineDash=function(t){},t.vgLineDashOffset=function(t){})}}function a(t,e){for(var n=new u(e);null!=(t=t.mark.group);)n.translate(t.x||0,t.y||0);return n}function s(t){return t?util.array(t).reduce(function(t,e){return t.union(a(e,e.bounds)).union(a(e,e["bounds:prev"]))},new u):null}function o(t,e){var n=null;return e&&(n=new u(e).round(),t.beginPath(),t.rect(n.x1,n.y1,n.width(),n.height()),t.clip()),n}var l="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,u=t("../../core/Bounds"),c=(t("../../util/load"),t("../../util/config")),d=t("./marks"),h=function(){this._ctx=null,this._el=null,this._imgload=0},f=h.prototype;f.initialize=function(t,e,n,i){if(this._el=t,!t)return this;var r=l.select(t).selectAll("canvas.marks").data([1]);return r.enter().append("canvas").attr("class","marks"),r.exit().remove(),this.resize(e,n,i)},f.resize=function(t,e,n){if(this._width=t,this._height=e,this._padding=n,this._el){var a=l.select(this._el).select("canvas.marks");a.attr("width",t+n.left+n.right).attr("height",e+n.top+n.bottom);var s;this._ctx=a.node().getContext("2d"),this._ctx._ratio=s=i(a.node(),this._ctx)||1,this._ctx.setTransform(s,0,0,s,s*n.left,s*n.top)}return r(this._ctx),this},f.context=function(t){return t?(this._ctx=t,this):this._ctx},f.element=function(){return this._el},f.pendingImages=function(){return this._imgload},f.render=function(t,e){var n,i=this._ctx,r=this._padding,a=this._width+r.left+r.right,l=this._height+r.top+r.bottom,u=null;this._scene=t,i.save(),u=o(i,s(e)),i.clearRect(-r.left,-r.top,a,l),this.draw(i,t,u),e&&(i.restore(),i.save(),n=o(i,s(e)),u.encloses(n)||(i.clearRect(-r.left,-r.top,a,l),this.draw(i,t,n))),i.restore(),this._scene=null},f.draw=function(t,e,n){var i=e.marktype,r=d.draw[i];r.call(this,t,e,n)},f.renderAsync=function(t){var e=this;e._async_id&&clearTimeout(e._async_id),e._async_id=setTimeout(function(){e.render(t),delete e._async_id},50)},f.loadImage=function(t){var e,n=this,i=n._scene,r=null;return n._imgload+=1,c.isNode||(r=new Image,e=c.baseURL+t,r.onload=function(){util.log("LOAD IMAGE: "+e),r.loaded=!0,n._imgload-=1,n.renderAsync(i)},r.src=e),r},e.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../core/Bounds":4,"../../util/config":64,"../../util/load":67,"./marks":32}],31:[function(t,e,n){e.exports={Handler:t("./Handler"),Renderer:t("./Renderer")}},{"./Handler":29,"./Renderer":30}],32:[function(t,e,n){function i(t,e){var n=e.x||0,i=e.y||0,r=e.innerRadius||0,a=e.outerRadius||0,s=(e.startAngle||0)-Math.PI/2,o=(e.endAngle||0)-Math.PI/2;t.beginPath(),0===r?t.moveTo(n,i):t.arc(n,i,r,s,o,0),t.arc(n,i,a,o,s,1),t.closePath()}function r(t,e){var n=e[0],i=n.mark,r=i.pathCache||(i.pathCache=O(C.area(e)));I(t,r)}function a(t,e){var n=e[0],i=n.mark,r=i.pathCache||(i.pathCache=O(C.line(e)));I(t,r)}function s(t,e){if(null!=e.path){var n=e.pathCache||(e.pathCache=O(e.path));return I(t,n,e.x,e.y)}}function o(t,e){t.beginPath();var n,i,r,a,s=null!=e.size?e.size:100,o=e.x,l=e.y;if(null==e.shape||"circle"===e.shape)return n=Math.sqrt(s/Math.PI),t.arc(o,l,n,0,2*Math.PI,0),void t.closePath();switch(e.shape){case"cross":n=Math.sqrt(s/5)/2,i=3*n,t.moveTo(o-i,l-n),t.lineTo(o-n,l-n),t.lineTo(o-n,l-i),t.lineTo(o+n,l-i),t.lineTo(o+n,l-n),t.lineTo(o+i,l-n),t.lineTo(o+i,l+n),t.lineTo(o+n,l+n),t.lineTo(o+n,l+i),t.lineTo(o-n,l+i),t.lineTo(o-n,l+n),t.lineTo(o-i,l+n);break;case"diamond":a=Math.sqrt(s/(2*P)),r=a*P,t.moveTo(o,l-a),t.lineTo(o+r,l),t.lineTo(o,l+a),t.lineTo(o-r,l);break;case"square":i=Math.sqrt(s),n=i/2,t.rect(o-n,l-n,i,i);break;case"triangle-down":r=Math.sqrt(s/D),a=r*D/2,t.moveTo(o,l+a),t.lineTo(o+r,l-a),t.lineTo(o-r,l-a);break;case"triangle-up":r=Math.sqrt(s/D),a=r*D/2,t.moveTo(o,l-a),t.lineTo(o+r,l+a),t.lineTo(o-r,l+a)}t.closePath()}function l(t,e){var n=e[0],i=n.strokeWidth,r=n.strokeCap;t.lineWidth=null!=i?i:N.render.lineWidth,t.lineCap=null!=r?r:N.render.lineCap,a(t,e)}function u(t,e){var n=e.x||0,i=e.y||0,r=null!=e.x2?e.x2:n,a=null!=e.y2?e.y2:i,s=e.strokeWidth,o=e.strokeCap;t.lineWidth=null!=s?s:N.render.lineWidth,t.lineCap=null!=o?o:N.render.lineCap,t.beginPath(),t.moveTo(n,i),t.lineTo(r,a)}function c(t,e,n,i){var r,a,s,o=n.fill,l=n.stroke;t(e,i),r=null==n.opacity?1:n.opacity,0!=r&&(o||l)&&(o&&(e.globalAlpha=r*(null==n.fillOpacity?1:n.fillOpacity),e.fillStyle=y(e,n,o),e.fill()),l&&(s=null!=(s=n.strokeWidth)?s:N.render.lineWidth,s>0&&(e.globalAlpha=r*(null==n.strokeOpacity?1:n.strokeOpacity),e.strokeStyle=y(e,n,l),e.lineWidth=s,e.lineCap=null!=(a=n.strokeCap)?a:N.render.lineCap,e.vgLineDash(n.strokeDash||null),e.vgLineDashOffset(n.strokeDashOffset||0),e.stroke())))}function d(t,e,n,i){var r,a,s;for(r=0,a=n.items.length;a>r;++r)s=n.items[r],(!i||i.intersects(s.bounds))&&c(t,e,s,s)}function h(t,e,n){if(e.items.length)for(var i,r,a,s,o,l,u,c,d,h,f=e.items,p=0,g=f.length;g>p;++p)i=f[p],(!n||n.intersects(i.bounds))&&(u=i.x||0,c=i.y||0,d=i.width||0,h=i.height||0,s=null==i.opacity?1:i.opacity,0!=s&&((r=i.fill)&&(t.globalAlpha=s*(null==i.fillOpacity?1:i.fillOpacity),t.fillStyle=y(t,i,r),t.fillRect(u,c,d,h)),(a=i.stroke)&&(l=null!=(l=i.strokeWidth)?l:N.render.lineWidth,l>0&&(t.globalAlpha=s*(null==i.strokeOpacity?1:i.strokeOpacity),t.strokeStyle=y(t,i,a),t.lineWidth=l,t.lineCap=null!=(o=i.strokeCap)?o:N.render.lineCap,t.vgLineDash(i.strokeDash||null),t.vgLineDashOffset(i.strokeDashOffset||0),t.strokeRect(u,c,d,h)))))}function f(t,e,n){if(e.items.length)for(var i,r,a,s,o,l,u,c,d,h=e.items,f=0,p=h.length;p>f;++f)i=h[f],(!n||n.intersects(i.bounds))&&(l=i.x||0,u=i.y||0,c=null!=i.x2?i.x2:l,d=null!=i.y2?i.y2:u,a=null==i.opacity?1:i.opacity,0!=a&&(r=i.stroke)&&(o=null!=(o=i.strokeWidth)?o:N.render.lineWidth,o>0&&(t.globalAlpha=a*(null==i.strokeOpacity?1:i.strokeOpacity),t.strokeStyle=y(t,i,r),t.lineWidth=o,t.lineCap=null!=(s=i.strokeCap)?s:N.render.lineCap,t.vgLineDash(i.strokeDash||null),t.vgLineDashOffset(i.strokeDashOffset||0),t.beginPath(),t.moveTo(l,u),t.lineTo(c,d),t.stroke())))}function p(t,e,n){if(e.items.length)for(var i,r=this,a=e.items,s=0,o=a.length;o>s;++s)if(i=a[s],!n||n.intersects(i.bounds)){i.image&&i.image.url===i.url||(i.image=r.loadImage(i.url),i.image.url=i.url);var l,u,c,d,h;c=i.width||i.image&&i.image.width||0,d=i.height||i.image&&i.image.height||0,l=(i.x||0)-("center"===i.align?c/2:"right"===i.align?c:0),u=(i.y||0)-("middle"===i.baseline?d/2:"bottom"===i.baseline?d:0),i.image.loaded&&(t.globalAlpha=null!=(h=i.opacity)?h:1,t.drawImage(i.image,l,u,c,d))}}function g(t,e,n){if(e.items.length)for(var i,r,a,s,o,l,u,c,d,h=e.items,f=0,p=h.length;p>f;++f)i=h[f],(!n||n.intersects(i.bounds))&&(t.font=T.fontString(i),t.textAlign=i.align||"left",t.textBaseline=i.baseline||"alphabetic",s=null==i.opacity?1:i.opacity,0!=s&&(l=i.x||0,u=i.y||0,(c=i.radius)&&(d=(i.theta||0)-Math.PI/2,l+=c*Math.cos(d),u+=c*Math.sin(d)),i.angle?(t.save(),t.translate(l,u),t.rotate(i.angle*Math.PI/180),l=i.dx||0,u=i.dy||0):(l+=i.dx||0,u+=i.dy||0),(r=i.fill)&&(t.globalAlpha=s*(null==i.fillOpacity?1:i.fillOpacity),t.fillStyle=y(t,i,r),t.fillText(i.text,l,u)),(a=i.stroke)&&(o=null!=(o=i.strokeWidth)?o:1,o>0&&(t.globalAlpha=s*(null==i.strokeOpacity?1:i.strokeOpacity),t.strokeStyle=y(i,a),t.lineWidth=o,t.strokeText(i.text,l,u))),i.angle&&t.restore()))}function m(t){return function(e,n,i){d(t,e,n,i)}}function v(t){return function(e,n,i){n.items.length&&(!i||i.intersects(n.items[0].bounds))&&c(t,e,n.items[0],n.items)}}function _(t,e,n){if(e.items.length){var i,r,a,s,o,l,u,c,d,f=e.items,p=this;for(h(t,e,n),l=0,u=f.length;u>l;++l){for(i=f[l],r=i.axisItems||[],a=i.legendItems||[],s=i.x||0,o=i.y||0,t.save(),t.translate(s,o),i.clip&&(t.beginPath(),t.rect(0,0,i.width||0,i.height||0),t.clip()),n&&n.translate(-s,-o),c=0,d=r.length;d>c;++c)"back"===r[c].def.layer&&p.draw(t,r[c],n);for(c=0,d=i.items.length;d>c;++c)p.draw(t,i.items[c],n);for(c=0,d=r.length;d>c;++c)"back"!==r[c].def.layer&&p.draw(t,r[c],n);for(c=0,d=a.length;d>c;++c)p.draw(t,a[c],n);n&&n.translate(s,o),t.restore()}}}function y(t,e,n){return n.id?x(t,n,e.bounds):n}function x(t,e,n){var i,r,a=n.width(),s=n.height(),o=n.x1+e.x1*a,l=n.y1+e.y1*s,u=n.x1+e.x2*a,c=n.y1+e.y2*s,d=t.createLinearGradient(o,l,u,c),h=e.stops;for(i=0,r=h.length;r>i;++i)d.addColorStop(h[i].offset,h[i].color);return d}function b(t,e,n,i,r,a){if(0===e.items.length||e.bounds&&!e.bounds.contains(r,a))return!1;var s,o,l,u,c,d,h,f=e.items,p=this;for(d=f.length;--d>=0;){for(o=f[d],u=o.x||0,c=o.y||0,t.save(),t.translate(u,c),h=o.items.length;--h>=0;)if(s=o.items[h],s.interactive!==!1&&(l=p.pick(s,n,i,r-u,a-c)))return t.restore(),l;t.restore()}return e.interactive?k(j.group,t,e,n,i,r,a):!1}function k(t,e,n,i,r,a,s){if(!n.items.length)return!1;var o,l,u;for(1!==e._ratio&&(i*=e._ratio,r*=e._ratio),u=n.items.length;--u>=0;)if(o=n.items[u],l=o.bounds,(!l||l.contains(a,s))&&l&&t(e,o,i,r,a,s))return o;return!1}function w(t,e,n,i,r,a){if(!e.items.length)return!1;var s,o=e.items;return s=o[0].bounds,s&&!s.contains(r,a)?!1:(1!==t._ratio&&(n*=t._ratio,i*=t._ratio),j.area(t,o,n,i)?o[0]:!1)}function A(t,e,n,i,r,a){if(!e.items.length)return!1;var s,o=e.items;return s=o[0].bounds,s&&!s.contains(r,a)?!1:(1!==t._ratio&&(n*=t._ratio,i*=t._ratio),j.line(t,o,n,i)?o[0]:!1)}function E(t){return function(e,n,i,r,a,s){return k(t,e,n,i,r,a,s)}}function L(t,e,n,i,r,a){if(!e.fontSize)return!1;if(!e.angle)return!0;var s=S.text(e,z,!0),o=-e.angle*Math.PI/180,l=Math.cos(o),u=Math.sin(o),n=e.x,i=e.y,c=l*r-u*a+(n-n*l+i*u),d=u*r+l*a+(i-n*u-i*l);return s.contains(c,d)}var M=t("../../core/Bounds"),S=t("../../util/bounds"),T=t("../../util/index"),N=t("../../util/config"),C=t("./path"),O=C.parse,I=C.render,D=(Math.PI/2,Math.sqrt(3)),P=Math.tan(30*Math.PI/180),z=new M,j={text:L,rect:function(t,e,n,i){return!0},image:function(t,e,n,i){return!0},group:function(t,e,n,i){return e.fill||e.stroke},rule:function(t,e,n,i){return t.isPointInStroke?(u(t,e),t.isPointInStroke(n,i)):!1},line:function(t,e,n,i){return t.isPointInStroke?(l(t,e),t.isPointInStroke(n,i)):!1},arc:function(t,e,n,r){return i(t,e),t.isPointInPath(n,r)},area:function(t,e,n,i){return r(t,e),t.isPointInPath(n,i)},path:function(t,e,n,i){return s(t,e),t.isPointInPath(n,i)},symbol:function(t,e,n,i){return o(t,e),t.isPointInPath(n,i)}};e.exports={draw:{group:_,area:v(r),line:v(a),arc:m(i),path:m(s),symbol:m(o),rect:h,rule:f,text:g,image:p,drawOne:v,drawAll:m},pick:{group:b,area:w,line:A,arc:E(j.arc),path:E(j.path),symbol:E(j.symbol),rect:E(j.rect),rule:E(j.rule),text:E(j.text),image:E(j.image),pickAll:k}}},{"../../core/Bounds":4,"../../util/bounds":63,"../../util/config":64,"../../util/index":66,"./path":33}],33:[function(t,e,n){(function(n){function i(t){var e,n,i,r=[];t=t.slice().replace(m[0],"###$1").split(m[1]).slice(1);for(var a,s,o=0,l=t.length;l>o;o++){e=t[o],n=e.slice(1).trim().replace(m[2],"$1###-").split(m[3]),s=[e.charAt(0)];for(var a=0,u=n.length;u>a;a++)i=parseFloat(n[a]),isNaN(i)||s.push(i);var c=s[0].toLowerCase(),d=g[c];if(s.length-1>d)for(var h=1,f=s.length;f>h;h+=d)r.push([s[0]].concat(s.slice(h,h+d)));else r.push(s)}return r}function r(t,e,n,i,r,a,l){for(var u=i[0],c=i[1],d=i[2],h=i[3],f=i[4],p=i[5],g=i[6],m=s(p,g,u,c,h,f,d,e,n),v=0;v<m.length;v++){var _=o.apply(null,m[v]);t.bezierCurveTo.apply(t,_),r.add(_[0]-a,_[1]-l),r.add(_[2]-a,_[3]-l),r.add(_[4]-a,_[5]-l)}}function a(t,e,n,i){for(var r=n[0],a=n[1],l=n[2],u=n[3],c=n[4],d=n[5],h=n[6],f=s(d,h,r,a,u,c,l,t,e),p=0;p<f.length;p++){var g=o.apply(null,f[p]);i.add(g[0],g[1]),i.add(g[2],g[3]),i.add(g[4],g[5])}}function s(t,e,n,i,r,a,s,o,l){if(h=y.call(arguments),v[h])return v[h];var u=s*(Math.PI/180),c=Math.sin(u),d=Math.cos(u);n=Math.abs(n),i=Math.abs(i);var f=d*(o-t)*.5+c*(l-e)*.5,p=d*(l-e)*.5-c*(o-t)*.5,g=f*f/(n*n)+p*p/(i*i);g>1&&(g=Math.sqrt(g),n*=g,i*=g);var m=d/n,_=c/n,x=-c/i,b=d/i,k=m*o+_*l,w=x*o+b*l,A=m*t+_*e,E=x*t+b*e,L=(A-k)*(A-k)+(E-w)*(E-w),M=1/L-.25;0>M&&(M=0);var S=Math.sqrt(M);a==r&&(S=-S);var T=.5*(k+A)-S*(E-w),N=.5*(w+E)+S*(A-k),C=Math.atan2(w-N,k-T),O=Math.atan2(E-N,A-T),I=O-C;0>I&&1==a?I+=2*Math.PI:I>0&&0==a&&(I-=2*Math.PI);for(var D=Math.ceil(Math.abs(I/(.5*Math.PI+.001))),P=[],z=0;D>z;z++){var j=C+z*I/D,R=C+(z+1)*I/D;P[z]=[T,N,j,R,n,i,c,d]}return v[h]=P}function o(t,e,n,i,r,a,s,o){if(h=y.call(arguments),_[h])return _[h];var l=o*r,u=-s*a,c=s*r,d=o*a,f=Math.cos(n),p=Math.sin(n),g=Math.cos(i),m=Math.sin(i),v=.5*(i-n),x=Math.sin(.5*v),b=8/3*x*x/Math.sin(v),k=t+f-b*p,w=e+p+b*f,A=t+g,E=e+m,L=A+b*m,M=E-b*g;

return _[h]=[l*k+u*w,c*k+d*w,l*L+u*M,c*L+d*M,l*A+u*E,c*A+d*E]}function l(t,e,n,i){var a,s,o,l,u,c=null,d=0,h=0,f=0,g=0,m=new p;void 0==n&&(n=0),void 0==i&&(i=0),t.beginPath();for(var v=0,_=e.length;_>v;++v){switch(a=e[v],a[0]){case"l":d+=a[1],h+=a[2],t.lineTo(d+n,h+i),m.add(d,h);break;case"L":d=a[1],h=a[2],t.lineTo(d+n,h+i),m.add(d,h);break;case"h":d+=a[1],t.lineTo(d+n,h+i),m.add(d,h);break;case"H":d=a[1],t.lineTo(d+n,h+i),m.add(d,h);break;case"v":h+=a[1],t.lineTo(d+n,h+i),m.add(d,h);break;case"V":h=a[1],t.lineTo(d+n,h+i),m.add(d,h);break;case"m":d+=a[1],h+=a[2],t.moveTo(d+n,h+i),m.add(d,h);break;case"M":d=a[1],h=a[2],t.moveTo(d+n,h+i),m.add(d,h);break;case"c":s=d+a[5],o=h+a[6],f=d+a[3],g=h+a[4],t.bezierCurveTo(d+a[1]+n,h+a[2]+i,f+n,g+i,s+n,o+i),m.add(d+a[1],h+a[2]),m.add(f,g),m.add(s,o),d=s,h=o;break;case"C":d=a[5],h=a[6],f=a[3],g=a[4],t.bezierCurveTo(a[1]+n,a[2]+i,f+n,g+i,d+n,h+i),m.add(a[1],a[2]),m.add(f,g),m.add(d,h);break;case"s":s=d+a[3],o=h+a[4],f=2*d-f,g=2*h-g,t.bezierCurveTo(f+n,g+i,d+a[1]+n,h+a[2]+i,s+n,o+i),m.add(f,g),m.add(d+a[1],h+a[2]),m.add(s,o),f=d+a[1],g=h+a[2],d=s,h=o;break;case"S":s=a[3],o=a[4],f=2*d-f,g=2*h-g,t.bezierCurveTo(f+n,g+i,a[1]+n,a[2]+i,s+n,o+i),d=s,h=o,m.add(a[1],a[2]),m.add(f,g),m.add(s,o),f=a[1],g=a[2];break;case"q":s=d+a[3],o=h+a[4],f=d+a[1],g=h+a[2],t.quadraticCurveTo(f+n,g+i,s+n,o+i),d=s,h=o,m.add(f,g),m.add(s,o);break;case"Q":s=a[3],o=a[4],t.quadraticCurveTo(a[1]+n,a[2]+i,s+n,o+i),d=s,h=o,f=a[1],g=a[2],m.add(f,g),m.add(s,o);break;case"t":s=d+a[1],o=h+a[2],null===c[0].match(/[QqTt]/)?(f=d,g=h):"t"===c[0]?(f=2*d-l,g=2*h-u):"q"===c[0]&&(f=2*d-f,g=2*h-g),l=f,u=g,t.quadraticCurveTo(f+n,g+i,s+n,o+i),d=s,h=o,f=d+a[1],g=h+a[2],m.add(f,g),m.add(s,o);break;case"T":s=a[1],o=a[2],f=2*d-f,g=2*h-g,t.quadraticCurveTo(f+n,g+i,s+n,o+i),d=s,h=o,m.add(f,g),m.add(s,o);break;case"a":r(t,d+n,h+i,[a[1],a[2],a[3],a[4],a[5],a[6]+d+n,a[7]+h+i],m,n,i),d+=a[6],h+=a[7];break;case"A":r(t,d+n,h+i,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+i],m,n,i),d=a[6],h=a[7];break;case"z":case"Z":t.closePath()}c=a}return m.translate(n,i)}function u(t,e){for(var n,i,r,s,o,l=null,u=0,c=0,d=0,h=0,f=0,p=t.length;p>f;++f){switch(n=t[f],n[0]){case"l":u+=n[1],c+=n[2],e.add(u,c);break;case"L":u=n[1],c=n[2],e.add(u,c);break;case"h":u+=n[1],e.add(u,c);break;case"H":u=n[1],e.add(u,c);break;case"v":c+=n[1],e.add(u,c);break;case"V":c=n[1],e.add(u,c);break;case"m":u+=n[1],c+=n[2],e.add(u,c);break;case"M":u=n[1],c=n[2],e.add(u,c);break;case"c":i=u+n[5],r=c+n[6],d=u+n[3],h=c+n[4],e.add(u+n[1],c+n[2]),e.add(d,h),e.add(i,r),u=i,c=r;break;case"C":u=n[5],c=n[6],d=n[3],h=n[4],e.add(n[1],n[2]),e.add(d,h),e.add(u,c);break;case"s":i=u+n[3],r=c+n[4],d=2*u-d,h=2*c-h,e.add(d,h),e.add(u+n[1],c+n[2]),e.add(i,r),d=u+n[1],h=c+n[2],u=i,c=r;break;case"S":i=n[3],r=n[4],d=2*u-d,h=2*c-h,u=i,c=r,e.add(n[1],n[2]),e.add(d,h),e.add(i,r),d=n[1],h=n[2];break;case"q":i=u+n[3],r=c+n[4],d=u+n[1],h=c+n[2],u=i,c=r,e.add(d,h),e.add(i,r);break;case"Q":i=n[3],r=n[4],u=i,c=r,d=n[1],h=n[2],e.add(d,h),e.add(i,r);break;case"t":i=u+n[1],r=c+n[2],null===l[0].match(/[QqTt]/)?(d=u,h=c):"t"===l[0]?(d=2*u-s,h=2*c-o):"q"===l[0]&&(d=2*u-d,h=2*c-h),s=d,o=h,u=i,c=r,d=u+n[1],h=c+n[2],e.add(d,h),e.add(i,r);break;case"T":i=n[1],r=n[2],d=2*u-d,h=2*c-h,u=i,c=r,e.add(d,h),e.add(i,r);break;case"a":a(u,c,[n[1],n[2],n[3],n[4],n[5],n[6]+u,n[7]+c],e),u+=n[6],c+=n[7];break;case"A":a(u,c,[n[1],n[2],n[3],n[4],n[5],n[6],n[7]],e),u=n[6],c=n[7];break;case"z":case"Z":}l=n}return e}function c(t){var e=t[0],n=f.svg.area().x(function(t){return t.x}).y1(function(t){return t.y}).y0(function(t){return t.y+t.height});return e.interpolate&&n.interpolate(e.interpolate),null!=e.tension&&n.tension(e.tension),n(t)}function d(t){var e=t[0],n=f.svg.line().x(function(t){return t.x}).y(function(t){return t.y});return e.interpolate&&n.interpolate(e.interpolate),null!=e.tension&&n.tension(e.tension),n(t)}var h,f="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,p=t("../../core/Bounds"),g={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},m=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],v={},_={},y=Array.prototype.join;e.exports={parse:i,render:l,bounds:u,area:c,line:d}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../core/Bounds":4}],34:[function(t,e,n){function i(t){var e=this;return function(n){var i=n.target,r=i.__data__;r&&(r=r.mark?r:r[0]),t.call(e._obj,n,r)}}function r(t){var e=t.indexOf(".");return 0>e?t:t.slice(0,e)}var a=t("../../util/index"),s=function(t,e){this._active=null,this._handlers={},t&&this.initialize(t),e&&this.model(e)},o=s.prototype;o.initialize=function(t,e,n){return this._el=d3.select(t).node(),this._svg=d3.select(t).select("svg.marks").node(),this._padding=e,this._obj=n||null,this},o.padding=function(t){return this._padding=t,this},o.model=function(t){return arguments.length?(this._model=t,this):this._model},o.handlers=function(){var t=this._handlers;return a.keys(t).reduce(function(e,n){return t[n].reduce(function(t,e){return t.push(e),t},e)},[])},o.on=function(t,e){var n=r(t),a=this._handlers,s=d3.select(this._svg).node(),o={type:t,handler:e,svg:i.call(this,e)};return a=a[n]||(a[n]=[]),a.push(o),s.addEventListener(n,o.svg),this},o.off=function(t,e){var n=r(t),i=this._handlers[n],a=d3.select(this._svg).node();if(i){for(var s=i.length;--s>=0;)i[s].type===t&&(e&&i[s].handler!==e||(a.removeEventListener(n,i[s].svg),i.splice(s,1)));return this}},e.exports=s},{"../../util/index":66}],35:[function(t,e,n){var i=t("../../util/index"),r=t("./marks"),a=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},s=a.prototype;s.initialize=function(t,e,n,i){return this._el=t,d3.select(t).select("svg.marks").remove(),this._svg=d3.select(t).append("svg").attr("class","marks"),this._ctx=this._svg.append("g"),this.resize(e,n,i)},s.resize=function(t,e,n){return this._width=t,this._height=e,this._padding=n,this._svg.attr("width",t+n.left+n.right).attr("height",e+n.top+n.bottom),this._ctx.attr("transform","translate("+n.left+","+n.top+")"),this},s.context=function(){return this._ctx},s.element=function(){return this._el},s.updateDefs=function(){var t,e,n=this._svg,r=this._defs,a=i.keys(r.gradient),s=i.keys(r.clipping),o=n.select("defs");return 0===a.length&&0==s.length?void o.remove():(o.empty()&&(o=n.insert("defs",":first-child")),t=o.selectAll("linearGradient").data(a,i.identity),t.enter().append("linearGradient").attr("id",i.identity),t.exit().remove(),t.each(function(t){var e=r.gradient[t],n=d3.select(this);n.attr({x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2}),stop=n.selectAll("stop").data(e.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(t){return t.offset}).attr("stop-color",function(t){return t.color})}),e=o.selectAll("clipPath").data(s,i.identity),e.enter().append("clipPath").attr("id",i.identity),e.exit().remove(),void e.each(function(t){var e=r.clipping[t],n=d3.select(this).selectAll("rect").data([1]);n.enter().append("rect"),n.attr("x",0).attr("y",0).attr("width",e.width).attr("height",e.height)}))},s.render=function(t,e){r.current=this,e?this.renderItems(i.array(e)):this.draw(this._ctx,t,-1),this.updateDefs(),delete r.current},s.renderItems=function(t){var e,n,i,a,s;for(a=0,s=t.length;s>a;++a)e=t[a],n=e._svg,i=e.mark.marktype,e=r.nested[i]?e.mark.items:e,r.update[i].call(n,e),r.style.call(n,e)},s.draw=function(t,e,n){var i=e.marktype,a=r.draw[i];a.call(this,t,e,n)},e.exports=a},{"../../util/index":66,"./marks":37}],36:[function(t,e,n){arguments[4][31][0].apply(n,arguments)},{"./Handler":34,"./Renderer":35,dup:31}],37:[function(t,e,n){(function(n){function i(t){return t.x||0}function r(t){return t.y||0}function a(t){return t.y+t.height||0}function s(t){return null==t.size?100:t.size}function o(t){return t.shape||"circle"}function l(t){var e,n,i,r,a,s=t.mark?t:t.length?t[0]:null;if(null!==s)for(e=0,n=z.length;n>e;++e)i=z[e],r=P[i],a=s[i],null==a?"fill"===r?this.style.setProperty(r,"none",null):this.style.removeProperty(r):(a.id&&(j.current._defs.gradient[a.id]=a,a="url(#"+a.id+")"),this.style.setProperty(r,a+"",null))}function u(t){var e=t.x||0,n=t.y||0;this.setAttribute("transform","translate("+e+","+n+")"),this.setAttribute("d",S(t))}function c(t){if(t.length){var e=t[0];T.interpolate(e.interpolate||"linear").tension(null==e.tension?.7:e.tension),this.setAttribute("d",T(t))}}function d(t){if(t.length){var e=t[0];N.interpolate(e.interpolate||"linear").tension(null==e.tension?.7:e.tension),this.setAttribute("d",N(t))}}function h(t){var e=t.x||0,n=t.y||0;this.setAttribute("transform","translate("+e+","+n+")"),null!=t.path&&this.setAttribute("d",t.path)}function f(t){this.setAttribute("x",t.x||0),this.setAttribute("y",t.y||0),this.setAttribute("width",t.width||0),this.setAttribute("height",t.height||0)}function p(t){var e=t.x||0,n=t.y||0;this.setAttribute("x1",e),this.setAttribute("y1",n),this.setAttribute("x2",null!=t.x2?t.x2:e),this.setAttribute("y2",null!=t.y2?t.y2:n)}function g(t){var e=t.x||0,n=t.y||0;this.setAttribute("transform","translate("+e+","+n+")"),this.setAttribute("d",C(t))}function m(t){var e=t.width||t.image&&t.image.width||0,n=t.height||t.image&&t.image.height||0,i=t.x-("center"===t.align?e/2:"right"===t.align?e:0),r=t.y-("middle"===t.baseline?n/2:"bottom"===t.baseline?n:0),a=M.baseURL+t.url;this.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.setAttribute("x",i),this.setAttribute("y",r),this.setAttribute("width",e),this.setAttribute("height",n)}function v(t){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+(null!=t.fontSize?t.fontSize:M.render.fontSize)+"px "+(t.font||M.render.font)}function _(t){var e=t.x||0,n=t.y||0,i=t.dx||0,r=t.dy||0,a=t.angle||0,s=t.radius||0,o=D[t.align||"left"],l="top"===t.baseline?".9em":"middle"===t.baseline?".35em":0;if(s){var u=(t.theta||0)-Math.PI/2;e+=s*Math.cos(u),n+=s*Math.sin(u)}this.setAttribute("x",e+i),this.setAttribute("y",n+r),this.setAttribute("text-anchor",o),a?this.setAttribute("transform","rotate("+a+" "+e+","+n+")"):this.removeAttribute("transform"),l?this.setAttribute("dy",l):this.removeAttribute("dy"),this.textContent=t.text,this.style.setProperty("font",v(t),null)}function y(t){var e=t.x||0,n=t.y||0;if(this.setAttribute("transform","translate("+e+","+n+")"),t.clip){var i={width:t.width||0,height:t.height||0},r=t.clip_id||(t.clip_id="clip"+I++);j.current._defs.clipping[r]=i,this.setAttribute("clip-path","url(#"+r+")")}}function x(t){var e=t.width||0,n=t.height||0;this.setAttribute("width",e),this.setAttribute("height",n)}function b(t){var e="type-"+t.type;return t.name&&(e+=" "+t.name),e}function k(t,e,n){return function(i,r,a){w(i,r,a,"mark_",t,e,n)}}function w(t,e,n,i,r,a,s){var o=s?[e.items]:e.items,u=e.interactive===!1?"none":null,c=t.node().childNodes,d="g"!==r,h=(h=c[n+1])?E.select(h):t.append("g").attr("id","g"+ ++O).attr("class",b(e.def)),f=h.attr("id"),p="#"+f+" > "+r,g=h.selectAll(p).data(o),m=g.enter().append(r);return d?(h.style("pointer-events",u),m.each(function(t){t.mark?t._svg=this:t.length&&(t[0]._svg=this)})):m.append("rect").attr("class","background").style("pointer-events",u),g.exit().remove(),g.each(a),d?g.each(l):h.selectAll(p+" > rect.background").each(x).each(l),h}function A(t,e,n,i){var r,a,s,o=w(t,e,n,i||"group_","g",y),l=o.node().childNodes,u=l.length;for(r=0;u>r;++r){var c=l[r].__data__.items,d=l[r].__data__.legendItems||[],h=l[r].__data__.axisItems||[],f=E.select(l[r]),p=0;for(a=0,s=h.length;s>a;++a)"back"===h[a].def.layer&&A.call(this,f,h[a],p++,"axis_");for(a=0,s=c.length;s>a;++a)this.draw(f,c[a],p++);for(a=0,s=h.length;s>a;++a)"back"!==h[a].def.layer&&A.call(this,f,h[a],p++,"axis_");for(a=0,s=d.length;s>a;++a)A.call(this,f,d[a],p++,"legend_")}}var E="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,L=t("../../util/index"),M=t("../../util/config"),S=E.svg.arc(),T=E.svg.area().x(i).y1(r).y0(a),N=E.svg.line().x(i).y(r),C=E.svg.symbol().type(o).size(s),O=0,I=0,D={left:"start",center:"middle",right:"end"},P={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},z=L.keys(P),j=e.exports={update:{group:f,area:c,line:d,arc:u,path:h,symbol:g,rect:f,rule:p,text:_,image:m},nested:{area:!0,line:!0},style:l,draw:{group:A,area:k("path",c,!0),line:k("path",d,!0),arc:k("path",u),path:k("path",h),symbol:k("path",g),rect:k("rect",f),rule:k("line",p),text:k("text",_),image:k("image",m),draw:k},current:null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/config":64,"../../util/index":66}],38:[function(t,e,n){function i(t,e){return this._mark=e,r.prototype.init.call(this,t.graph).router(!0)}var r=t("../dataflow/Node"),a=t("../util/bounds"),s=t("../util/constants"),o=t("../util/index"),l=i.prototype=new r;l.evaluate=function(t){return o.debug(t,["bounds",this._mark.marktype]),a.mark(this._mark),this._mark.marktype===s.GROUP&&a.mark(this._mark,null,!1),t.reflow=!0,t},e.exports=i},{"../dataflow/Node":10,"../util/bounds":63,"../util/constants":65,"../util/index":66}],39:[function(t,e,n){function i(){return arguments.length?this.init.apply(this,arguments):this}function r(){var t,e,n,i,r=this._def.from,a=r.mark;a?(t=["vg",this._parent_id,a].join("_"),e={name:t,transform:r.transform,modify:r.modify}):(t=["vg",this._from,this._def.type,Date.now()].join("_"),e={name:t,source:this._from,transform:r.transform,modify:r.modify}),this._from=t,this._ds=p.datasource(this._model,e);var s=this._ds.revises();if(a)n=this.sibling(a).revises(s),n._isSuper?n.addListener(this._ds.listener()):n._bounder.addListener(this._ds.listener());else{var i=this._ds.source().revises(s).last();input=m.create(i),input.add=i.add,input.mod=i.mod,input.rem=i.rem,input.stamp=null,this._graph.propagate(input,this._ds.listener())}}function a(){var t=this._revises?null:void 0,e=g.ingest(new f(this._mark),t);return this._def.width&&g.set(e,"width",this._def.width),this._def.height&&g.set(e,"height",this._def.height),e}function s(t,e,n,i,r,s){var o,l,u,c,d,h;for(o=0,u=t.length;u>o;++o)d=t[o],c=e?this._map[l=e(d)]:r[o],h=c?!1:(c=a.call(this),!0),c.status=h?_.ENTER:_.UPDATE,c.datum=d,g.set(c,"key",l),this._map[l]=c,n.push(c),h?i.add.push(c):(!s||s&&s[d._id])&&i.mod.push(c)}function o(t,e,n){var i,r,a,o,l=m.create(t),c=u(this._def.key||"_id"),d=(t.add,t.mod),h=t.rem,f=[];for(i=0,a=h.length;a>i;++i)o=this._map[r=c(h[i])],o.status=_.EXIT,f.push(o),l.rem.push(o),this._map[r]=null;return s.call(this,e,c,f,l,null,v.tuple_ids(n?e:d)),this._mark.items=f,l}function l(t,e,n){var i,r,a,o=m.create(t),l=u(this._def.key),c=this._mark.items||[],d=[];for(i=0,r=c.length;r>i;++i)a=c[i],a.status=_.EXIT,l&&(this._map[a.key]=a);for(s.call(this,e,l,d,o,c,n?v.tuple_ids(e):null),i=0,r=c.length;r>i;++i)a=c[i],a.status===_.EXIT&&(g.set(a,"key",l?a.key:this._items.length),d.splice(0,0,a),o.rem.push(a));return this._mark.items=d,o}function u(t){if(null==t)return null;var e=v.array(t).map(v.accessor);return function(t){for(var n="",i=0,r=e.length;r>i;++i)i>0&&(n+="|"),n+=String(e[i](t));return n}}var c=t("../dataflow/Node"),d=t("./Encoder"),h=t("./Bounder"),f=t("./Item"),p=t("../parse/data"),g=t("../dataflow/tuple"),m=t("../dataflow/changeset"),v=t("../util/index"),_=t("../util/constants"),y=i.prototype=new c;y.init=function(t,e,n,i,a,s){return c.prototype.init.call(this,t.graph).router(!0).collector(!0),this._model=t,this._def=e,this._mark=n,this._from=(e.from?e.from.data:null)||s,this._ds=v.isString(this._from)?t.data(this._from):null,this._map={},this._revises=!1,n.def=e,n.marktype=e.type,n.interactive=!(e.interactive===!1),n.items=[],this._parent=i,this._parent_id=a,e.from&&(e.from.mark||e.from.transform||e.from.modify)&&r.call(this),this._isSuper=this._def.type!==_.GROUP,this._encoder=new d(this._model,this._mark),this._bounder=new h(this._model,this._mark),this._ds&&this._encoder.dependency(_.DATA,this._from),this.dependency(_.DATA,this._encoder.dependency(_.DATA)),this.dependency(_.SCALES,this._encoder.dependency(_.SCALES)),this.dependency(_.SIGNALS,this._encoder.dependency(_.SIGNALS)),this},y.revises=function(t){return arguments.length?(!this._revises&&t&&this._items.forEach(function(t){void 0===t._prev&&(t._prev=_.SENTINEL)}),this._revises=this._revises||t,this):this._revises},y.pipeline=function(){return[this]},y.connect=function(){var t=this;return this._model.graph.connect(this.pipeline()),this._encoder.dependency(_.SCALES).forEach(function(e){t._parent.scale(e).addListener(t)}),this._parent&&(this._isSuper?this.addListener(this._parent._collector):this._bounder.addListener(this._parent._collector)),this},y.disconnect=function(){var t=this;return this._listeners.length?(c.prototype.disconnect.call(this),this._model.graph.disconnect(this.pipeline()),this._encoder.dependency(_.SCALES).forEach(function(e){t._parent.scale(e).removeListener(t)}),this):this},y.sibling=function(t){return this._parent.child(t,this._parent_id)},y.evaluate=function(t){v.debug(t,["building",this._from,this._def.type]);var e,n,i,r;return this._ds?(e=m.create(t),r=v.duplicate(e.data),delete e.data[this._ds.name()],n=this._encoder.reevaluate(e),e.data=r,n&&(e.mod=this._mark.items.slice()),i=this._ds.last(),i?i.stamp>this._stamp&&(e=o.call(this,i,this._ds.values(),n)):e.reflow=!0):(n=this._encoder.reevaluate(t),r=v.isFunction(this._def.from)?this._def.from():[_.SENTINEL],e=l.call(this,t,r,n)),e=this._graph.evaluate(e,this._encoder),this._isSuper?this._graph.evaluate(e,this._bounder):e},e.exports=i},{"../dataflow/Node":10,"../dataflow/changeset":12,"../dataflow/tuple":13,"../parse/data":15,"../util/constants":65,"../util/index":66,"./Bounder":38,"./Encoder":40,"./Item":42}],40:[function(t,e,n){function i(t,e){var n=e.def.properties||{},i=n.update;return a.prototype.init.call(this,t.graph),this._model=t,this._mark=e,i&&(this.dependency(o.DATA,i.data),this.dependency(o.SCALES,i.scales),this.dependency(o.SIGNALS,i.signals)),this}function r(t,e,n,i){var r=this._model,a=t.encode,s=this._graph.signalValues(t.signals||[]),o=(t.data||[]).reduce(function(t,e){return t[e]=r.data(e).values(),t},{});a.call(a,e,e.mark.group||e,n,o,s,r.predicates())}var a=t("../dataflow/Node"),s=t("../util/index"),o=t("../util/constants"),l={},u=i.prototype=new a;u.evaluate=function(t){s.debug(t,["encoding",this._mark.def.type]);var e,n,i,a=(this._mark.items,this._mark.def.properties||{}),u=a.enter,c=a.update,d=a.exit;for(e=0,n=t.rem.length;n>e;++e)i=t.rem[e],c&&r.call(this,c,i,t.trans),d&&r.call(this,d,i,t.trans),t.trans&&!d?t.trans.interpolate(i,l):t.trans||i.remove();for(e=0,n=t.add.length;n>e;++e)i=t.add[e],u&&r.call(this,u,i,t.trans),c&&r.call(this,c,i,t.trans),i.status=o.UPDATE;if(c)for(e=0,n=t.mod.length;n>e;++e)i=t.mod[e],r.call(this,c,i,t.trans);return t},e.exports=i},{"../dataflow/Node":10,"../util/constants":65,"../util/index":66}],41:[function(t,e,n){function i(){return this._children={},this._scaler=null,this._recursor=null,this._scales={},this.scale=a.bind(this),arguments.length?this.init.apply(this,arguments):this}function r(t){var e,n,i,r,a,s=this,u=this._def.marks&&this._def.marks.length>0,d=this._def.axes&&this._def.axes.length>0,h=!1;for(e=0,n=t.add.length;n>e;++e)i=t.add[e],u&&o.call(this,t,i),d&&l.call(this,t,i);for(e=t.add.length-1;e>=0;--e)for(i=t.add[e],j=this._children[i._id].length-1;j>=0;--j)c=this._children[i._id][j],c.builder.connect(),r=c.builder.pipeline(),a=c.builder._def,h=a.type!==m.GROUP,h=h&&void 0!==this._model.data(c.from),h=h&&1==r[r.length-1].listeners().length,c.inline=h,h?c.builder.evaluate(t):this._recursor.addListener(c.builder);for(e=0,n=t.mod.length;n>e;++e)i=t.mod[e],u&&s._children[i._id].forEach(function(t){t.type!=m.MARK||t.inline||void 0===s._model.data(t.from)||s._recursor.removeListener(t.builder)}),d&&(p(s._model,s._def.axes,i.axes,i),i.axes.forEach(function(t,e){t.def()}));for(e=0,n=t.rem.length;n>e;++e)i=t.rem[e],s._children[i._id].forEach(function(t){s._recursor.removeListener(t.builder),t.builder.disconnect()}),delete s._children[i._id];return t}function a(t,e){var n=this;if(2===arguments.length)return n._scales[t]=e,e;for(;null==e&&(e=n._scales[t],n=n.mark?n.mark.group:n._parent););return e}function s(t,e){g.debug(t,["building group",e._id]),e._scales=e._scales||{},e.scale=a.bind(e),e.items=e.items||[],this._children[e._id]=this._children[e._id]||[],e.axes=e.axes||[],e.axisItems=e.axisItems||[]}function o(t,e){g.debug(t,["building marks",e._id]);var n,r,a,s,o,l,u=this._def.marks;for(s=0,o=u.length;o>s;++s)n=u[s],r=n.from||{},a="vg_"+e.datum._id,e.items[s]={group:e},l=n.type===m.GROUP?new i:new h,l.init(this._model,n,e.items[s],this,e._id,a),this._children[e._id].push({builder:l,from:r.data||(r.mark?"vg_"+e._id+"_"+r.mark:a),type:m.MARK})}function l(t,e){var n=e.axes,r=e.axisItems,a=this;p(this._model,this._def.axes,n,e),n.forEach(function(t,n){var s=a._def.axes[n].scale,o=t.def(),l=null;r[n]={group:e,axisDef:o},l=o.type===m.GROUP?new i:new h,l.init(a._model,o,r[n],a).dependency(m.SCALES,s),a._children[e._id].push({builder:l,type:m.AXIS,scale:s})})}var u=t("../dataflow/Node"),d=t("../dataflow/Collector"),h=t("./Builder"),f=t("./Scale"),p=t("../parse/axes"),g=t("../util/index"),m=t("../util/constants"),v=i.prototype=new h;v.init=function(t,e,n,i,a,s){var o=this;this._scaler=new u(t.graph),(e.scales||[]).forEach(function(e){e=o.scale(e.name,new f(t,e,o)),o._scaler.addListener(e)}),this._recursor=new u(t.graph),this._recursor.evaluate=r.bind(this);var l=(e.axes||[]).reduce(function(t,e){return t[e.scale]=1,t},{});return this._recursor.dependency(m.SCALES,g.keys(l)),this._collector=new d(t.graph),h.prototype.init.apply(this,arguments)},v.evaluate=function(t){var e=h.prototype.evaluate.apply(this,arguments),n=this;return e.add.forEach(function(t){s.call(n,e,t)}),e},v.pipeline=function(){return[this,this._scaler,this._recursor,this._collector,this._bounder]},v.disconnect=function(){var t=this;return g.keys(t._children).forEach(function(e){t._children[e].forEach(function(e){t._recursor.removeListener(e.builder),e.builder.disconnect()})}),t._children={},h.prototype.disconnect.call(this)},v.child=function(t,e){for(var n,i=this._children[e],r=0,a=i.length;a>r&&(n=i[r],n.type!=m.MARK||n.builder._def.name!=t);++r);return n.builder},e.exports=i},{"../dataflow/Collector":7,"../dataflow/Node":10,"../parse/axes":14,"../util/constants":65,"../util/index":66,"./Builder":39,"./Scale":43}],42:[function(t,e,n){function i(t){this.mark=t}var r=i.prototype;r.hasPropertySet=function(t){var e=this.mark.def.properties;return e&&null!=e[t]},r.cousin=function(t,e){if(0===t)return this;t=t||-1;var n=this.mark,i=n.group,r=null==e?n.items.indexOf(this):e,a=i.items.indexOf(n)+t;return i.items[a].items[r]},r.sibling=function(t){if(0===t)return this;t=t||-1;var e=this.mark,n=e.items.indexOf(this)+t;return e.items[n]},r.remove=function(){var t=this,e=t.mark.items,n=e.indexOf(t);return n>=0&&(n===e.length-1?e.pop():e.splice(n,1)),t},r.touch=function(){this.pathCache&&(this.pathCache=null),this.mark.pathCache&&(this.mark.pathCache=null)},e.exports=i},{}],43:[function(t,e,n){(function(n){function i(t,e,n){return this._model=t,this._def=e,this._parent=n,this._updated=!1,f.prototype.init.call(this,t.graph)}function r(t){var e=this._def.name,n=e+":prev",i=a.call(this,t.scale(e)),r=i.type===_.ORDINAL?s:o,l=d.call(this,t);return r.call(this,i,l,t),t.scale(e,i),t.scale(n,t.scale(n)||i),i}function a(t){var e=this._def.type||_.LINEAR;if(!t||e!==t.type){var n=v.scale[e]||h.scale[e];n||m.error("Unrecognized scale type: "+e),(t=n()).type=t.type||e,t.scaleName=this._def.name,t._prev={}}return t}function s(t,e,n){var i,r,a=this._def,s=t._prev,o=!1;m.isObject(a.range)&&!m.isArray(a.range)&&(o=!0,e=l.call(this,_.RANGE,a.range,t,n)),i=l.call(this,_.DOMAIN,a.domain,t,n),i&&!m.equal(s.domain,i)&&(t.domain(i),s.domain=i,this._updated=!0),m.equal(s.range,e)||(r="string"==typeof e[0],r||e.length>2||1===e.length||o?t.range(e):a.points?t.rangePoints(e,a.padding||0):a.round||void 0===a.round?t.rangeRoundBands(e,a.padding||0):t.rangeBands(e,a.padding||0),s.range=e,this._updated=!0)}function o(t,e,n){var i,r,a=this._def,s=t._prev;i=a.type===_.QUANTILE?l.call(this,_.DOMAIN,a.domain,t,n):c.call(this,t,n),i&&!m.equal(s.domain,i)&&(t.domain(i),s.domain=i,this._updated=!0),"height"===a.range&&(e=e.reverse()),m.equal(s.range,e)||(t[a.round&&t.rangeRound?"rangeRound":"range"](e),s.range=e,this._updated=!0,this._stamp>0||(a.exponent&&a.type===_.POWER&&t.exponent(a.exponent),a.clamp&&t.clamp(!0),a.nice&&(a.type===_.TIME?(r=h.time[a.nice],r||m.error("Unrecognized interval: "+r),t.nice(r)):t.nice())))}function l(t,e,n,i){if(m.isArray(e))return e.map(u.bind(this));var r,a,s,o,l,c,d,h,f,g,v=this,y=this._graph,x=e.fields||m.array(e),b=n.type===_.ORDINAL||n.type===_.QUANTILE,k="_"+t,w=n[k],A=e.sort;for(w||(w=n[k]=new p(y),d=[],b&&A?d.push(A.stat):b||d.push(_.MIN,_.MAX),w.measures.set(w,d)),r=0,a=x.length;a>r;++r)if(l=x[r],h=l.data||"vg_"+i.datum._id,f=y.data(h).revises(!0).last(),!(f.stamp<=this._stamp)){if(c=m.array(l.field).map(function(t){return t.group?m.accessor(t.group)(i.datum):t}),b)for(w.on.set(w,A?A.field:"_id"),s=0,o=c.length;o>s;++s)w.group_by.set(w,c[s]).evaluate(f);else for(s=0,o=c.length;o>s;++s)w.on.set(w,c[s]).evaluate(f);this.dependency(_.DATA,h),w.dependency(_.SIGNALS).forEach(function(t){v.dependency(_.SIGNALS,t)})}return f=w.data(),b?(g=m.keys(f).filter(function(t){return null!=f[t]}),A&&(A=A.order.signal?y.signalRef(A.order.signal):A.order,A=(A==_.DESC?"-":"+")+"tpl."+w.on.get(y).field,A=m.comparator(A),g=g.map(function(t){return{key:t,tpl:f[t].tpl}}).sort(A).map(function(t){return t.key})),g):(f=f[""],null==f?[]:[f.tpl.min,f.tpl.max])}function u(t){var e,n=t.signal;return n?(this.dependency(_.SIGNALS,(e=m.field(n))[0]),this._graph.signalRef(e)):t}function c(t,e){var n,i=this._def,r=[null,null];return void 0!==i.domain&&(r=m.isObject(i.domain)?l.call(this,_.DOMAIN,i.domain,t,e):r),n=r.length-1,void 0!==i.domainMin&&(r[0]=m.isObject(i.domainMin)?i.domainMin.signal?u.call(this,i.domainMin):l.call(this,_.DOMAIN+_.MIN,i.domainMin,t,e)[0]:i.domainMin),void 0!==i.domainMax&&(r[n]=m.isObject(i.domainMax)?i.domainMax.signal?u.call(this,i.domainMax):l.call(this,_.DOMAIN+_.MAX,i.domainMax,t,e)[1]:i.domainMax),i.type===_.LOG||i.type===_.TIME||!i.zero&&void 0!==i.zero||(r[0]=Math.min(0,r[0]),r[n]=Math.max(0,r[n])),r}function d(t){var e=this._def,n=[null,null];if(void 0!==e.range)if("string"==typeof e.range)if(y[e.range])n=[0,t[e.range]];else{if(!v.range[e.range])return m.error("Unrecogized range: "+e.range),n;n=v.range[e.range]}else if(m.isArray(e.range))n=e.range.map(u.bind(this));else{if(m.isObject(e.range))return null;n=[0,e.range]}if(void 0!==e.rangeMin&&(n[0]=e.rangeMin.signal?u.call(this,e.rangeMin):e.rangeMin),void 0!==e.rangeMax&&(n[n.length-1]=e.rangeMax.signal?u.call(this,e.rangeMax):e.rangeMax),void 0!==e.reverse){var i=e.reverse;m.isObject(i)&&(i=m.accessor(i.field)(t.datum)),i&&(n=n.reverse())}return n}var h="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,f=t("../dataflow/Node"),p=t("../transforms/Stats"),g=t("../dataflow/changeset"),m=t("../util/index"),v=t("../util/config"),_=t("../util/constants"),y={width:1,height:1},x=i.prototype=new f;x.evaluate=function(t){var e=this,n=function(t){r.call(e,t)};return this._updated=!1,t.add.forEach(n),t.mod.forEach(n),this._updated&&(t.scales[this._def.name]=1),g.create(t,!0)},x.dependency=function(t,e){if(2==arguments.length){e=m.array(e);for(var n=0,i=e.length;i>n;++n)this._graph[t==_.DATA?_.DATA:_.SIGNAL](e[n]).addListener(this._parent)}return f.prototype.dependency.call(this,t,e)},e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/Node":10,"../dataflow/changeset":12,"../transforms/Stats":56,"../util/config":64,"../util/constants":65,"../util/index":66}],44:[function(t,e,n){function i(t,e){this.duration=t||500,this.ease=e&&d3.ease(e)||d3.ease("cubic-in-out"),this.updates={next:null}}function r(t){for(var e,n,i,r,a,o,l=this.updates,u=l,c=u.next,d=this.duration,h=!0;null!=c;u=c,c=u.next)if(e=c.item,n=e.delay||0,i=(t-n)/d,0>i)h=!1;else{for(i>1&&(i=1),r=c.ease(i),a=0,o=c.length;o>a;++a)e[c[a].property]=c[a](r);e.touch(),s.item(e),1===i?(c.remove&&e.remove(),u.next=c.next,c=u):h=!1}return this.callback(),h}var a=t("../dataflow/tuple"),s=t("../util/bounds"),o=t("../util/constants"),l=i.prototype,u={text:1,url:1};l.interpolate=function(t,e,n){var i,r,s,l,c=null;for(i in e)r=t[i],s=e[i],r!==s&&(u[i]||void 0===r?a.set(t,i,s):"number"!=typeof r||isFinite(r)?(l=d3.interpolate(r,s),l.property=i,(c||(c=[])).push(l)):a.set(t,i,s));return null===c&&t.status===o.EXIT&&(c=[]),null!=c&&(c.item=t,c.ease=t.mark.ease||this.ease,c.next=this.updates.next,this.updates.next=c),this},l.start=function(t){for(var e=this,n=e.updates,i=n.next;null!=i;n=i,i=n.next)i.item.status===o.EXIT&&(i.remove=!0);e.callback=t,d3.timer(function(t){return r.call(e,t)})},e.exports=i},{"../dataflow/tuple":13,"../util/bounds":63,"../util/constants":65}],45:[function(t,e,n){function i(t){function e(){k.type=null}function n(e){var n,i,r;"ordinal"===e.type?(n={scale:e.scaleName,offset:.5+e.rangeBand()/2},i=n):(n={scale:e.scaleName,offset:.5},i={scale:e.scaleName+":prev",offset:.5}),r=s(e),G.gridLines||(G.gridLines=h()),G.majorTicks||(G.majorTicks=h()),G.minorTicks||(G.minorTicks=h()),G.tickLabels||(G.tickLabels=f()),G.domain||(G.domain=g()),G.title||(G.title=p()),G.gridLines.properties.enter.stroke={value:m.axis.gridColor},l(a,G.gridLines,i,n,1/0),l(a,G.majorTicks,i,n,L),l(a,G.minorTicks,i,n,M),o(a,G.tickLabels,i,n,L,T),c(a,G.domain,r,S),u(a,G.title,r,b),_.extend(G.gridLines.properties.update,P),_.extend(G.majorTicks.properties.update,j),_.extend(G.minorTicks.properties.update,R),_.extend(G.tickLabels.properties.update,z),_.extend(G.domain.properties.update,q),_.extend(G.title.properties.update,F);var v=[G.gridLines,G.majorTicks,G.minorTicks,G.tickLabels,G.domain,G.title];_.extend(k,{type:"group",interactive:!1,properties:{enter:{encode:d,scales:[e.scaleName],signals:[],data:[]},update:{encode:d,scales:[e.scaleName],signals:[],data:[]}}}),k.marks=v.map(function(e){return y(t,e)})}var i,a=m.axis.orient,v=0,b=m.axis.titleOffset,k={},w="front",A=!1,E=null,L=m.axis.tickSize,M=m.axis.tickSize,S=m.axis.tickSize,T=m.axis.padding,N=null,C=null,O=null,I=0,D=[m.axis.ticks],P={},z={},j={},R={},F={},q={},G={gridLines:null,majorTicks:null,minorTicks:null,tickLabels:null,domain:null,title:null},W={};return W.def=function(){k.type||n(i),O=C?"time"===i.type?d3.time.format(C):d3.format(C):null;var t=function(t){return{data:t}},e=null==N?i.ticks?i.ticks.apply(i,D):i.domain():N,s=r(i,e,I).map(t);e=e.map(t);var o=null==O?i.tickFormat?i.tickFormat.apply(i,D):String:O;e.forEach(function(t){t.label=o(t.data)});var l=E?[E].map(t):[];return k.marks[0].from=function(){return A?e:[]},k.marks[1].from=function(){return e},k.marks[2].from=function(){return s},k.marks[3].from=k.marks[1].from,k.marks[4].from=function(){return[1]},k.marks[5].from=function(){return l},k.offset=v,k.orient=a,k.layer=w,k},W.scale=function(t){return arguments.length?(i!==t&&(i=t,e()),W):i},W.orient=function(t){return arguments.length?(a!==t&&(a=t in x?t+"":m.axis.orient,e()),W):a},W.title=function(t){return arguments.length?(E!==t&&(E=t,e()),W):E},W.ticks=function(){return arguments.length?(D=arguments,W):D},W.tickValues=function(t){return arguments.length?(N=t,W):N},W.tickFormat=function(t){return arguments.length?(C!==t&&(C=t,e()),W):C},W.tickSize=function(t,n){if(!arguments.length)return L;var i=arguments.length-1,r=+t,a=i>1?+n:L,s=i>0?+arguments[i]:L;return(L!==r||M!==a||S!==s)&&e(),L=r,M=a,S=s,W},W.tickSubdivide=function(t){return arguments.length?(I=+t,W):I},W.offset=function(t){return arguments.length?(v=_.isObject(t)?t:+t,
W):v},W.tickPadding=function(t){return arguments.length?(T!==+t&&(T=+t,e()),W):T},W.titleOffset=function(t){return arguments.length?(b!==+t&&(b=+t,e()),W):b},W.layer=function(t){return arguments.length?(w!==t&&(w=t,e()),W):w},W.grid=function(t){return arguments.length?(A!==t&&(A=t,e()),W):A},W.gridLineProperties=function(t){return arguments.length?(P!==t&&(P=t),W):P},W.majorTickProperties=function(t){return arguments.length?(j!==t&&(j=t),W):j},W.minorTickProperties=function(t){return arguments.length?(R!==t&&(R=t),W):R},W.tickLabelProperties=function(t){return arguments.length?(z!==t&&(z=t),W):z},W.titleProperties=function(t){return arguments.length?(F!==t&&(F=t),W):F},W.domainProperties=function(t){return arguments.length?(q!==t&&(q=t),W):q},W.reset=function(){e()},W}function r(t,e,n){if(i=[],n&&e.length>1){for(var i,r,s,o=a(t.domain()),l=-1,u=e.length,c=(e[1]-e[0])/++n;++l<u;)for(r=n;--r>0;)(s=+e[l]-r*c)>=o[0]&&i.push(s);for(--l,r=0;++r<n&&(s=+e[l]+r*c)<o[1];)i.push(s)}return i}function a(t){var e=t[0],n=t[t.length-1];return n>e?[e,n]:[n,e]}function s(t){return t.rangeExtent?t.rangeExtent():a(t.range())}function o(t,e,n,i,r,a){r=Math.max(r,0)+a,("left"===t||"top"===t)&&(r*=-1),"top"===t||"bottom"===t?(_.extend(e.properties.enter,{x:n,y:{value:r}}),_.extend(e.properties.update,{x:i,y:{value:r},align:{value:"center"},baseline:{value:k[t]}})):(_.extend(e.properties.enter,{x:{value:r},y:n}),_.extend(e.properties.update,{x:{value:r},y:i,align:{value:b[t]},baseline:{value:"middle"}}))}function l(t,e,n,i,r){var a="left"===t||"top"===t?-1:1;r=r===1/0?"top"===t||"bottom"===t?{group:"mark.group.height",mult:-a}:{group:"mark.group.width",mult:-a}:{value:a*r},"top"===t||"bottom"===t?(_.extend(e.properties.enter,{x:n,y:{value:0},y2:r}),_.extend(e.properties.update,{x:i,y:{value:0},y2:r}),_.extend(e.properties.exit,{x:i})):(_.extend(e.properties.enter,{x:{value:0},x2:r,y:n}),_.extend(e.properties.update,{x:{value:0},x2:r,y:i}),_.extend(e.properties.exit,{y:i}))}function u(t,e,n,i){var r=~~((n[0]+n[1])/2),a="top"===t||"left"===t?-1:1;"bottom"===t||"top"===t?_.extend(e.properties.update,{x:{value:r},y:{value:a*i},angle:{value:0}}):_.extend(e.properties.update,{x:{value:a*i},y:{value:r},angle:{value:-90}})}function c(t,e,n,i){var r;("top"===t||"left"===t)&&(i=-1*i),r="bottom"===t||"top"===t?"M"+n[0]+","+i+"V0H"+n[1]+"V"+i:"M"+i+","+n[0]+"H0V"+n[1]+"H"+i,e.properties.update.path={value:r}}function d(t,e,n,i,r,a){var s=n?{}:t,o=t.mark.def.offset,l=t.mark.def.orient,u=e.width,c=e.height;switch(_.isObject(o)&&(o=-e.scale(o.scale)(o.value)),l){case"left":v.set(s,"x",-o),v.set(s,"y",0);break;case"right":v.set(s,"x",u+o),v.set(s,"y",0);break;case"bottom":v.set(s,"x",0),v.set(s,"y",c+o);break;case"top":v.set(s,"x",0),v.set(s,"y",-o);break;default:v.set(s,"x",0),v.set(s,"y",0)}n&&n.interpolate(t,s)}function h(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:m.axis.tickColor},strokeWidth:{value:m.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function f(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:m.axis.tickLabelColor},font:{value:m.axis.tickLabelFont},fontSize:{value:m.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function p(){return{type:"text",interactive:!0,properties:{enter:{font:{value:m.axis.titleFont},fontSize:{value:m.axis.titleFontSize},fontWeight:{value:m.axis.titleFontWeight},fill:{value:m.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function g(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:m.axis.axisColor},strokeWidth:{value:m.axis.axisWidth}},update:{}}}}var m=t("../util/config"),v=t("../dataflow/tuple"),_=t("../util/index"),y=t("../parse/mark"),x={top:1,right:1,bottom:1,left:1},b={bottom:"center",top:"center",left:"right",right:"left"},k={bottom:"top",top:"bottom",left:"middle",right:"middle"};e.exports=i},{"../dataflow/tuple":13,"../parse/mark":19,"../util/config":64,"../util/index":66}],46:[function(t,e,n){function i(t){return t&&this.init(t),this}var r=t("./Transform"),a=t("../dataflow/tuple"),s=t("../dataflow/changeset"),o=(t("../util/index"),t("../util/constants")),l=i.prototype=new r;l.init=function(t){return this._refs=[],this._cells={},r.prototype.init.call(this,t).router(!0).revises(!0)},l.data=function(){return this._cells},l._reset=function(t,e){var n,i;for(n in this._cells)(i=this._cells[n])&&e.rem.push(i.tpl);this._cells={}},l._keys=function(t){var e,n=this._refs.reduce(function(n,i){return void 0!==(e=i(t))?(n.push(e),n):n},[]),i=n.join("|");return n.length>0?{keys:n,key:i}:void 0},l._cell=function(t){var e=this._keys(t);return this._cells[e.key]||(this._cells[e.key]=this._new_cell(t,e))},l._new_cell=function(t,e){return{cnt:0,tpl:this._new_tuple(t,e),flg:o.ADD_CELL}},l._new_tuple=function(t,e){return a.derive(null,null)},l._add=function(t){var e=this._cell(t);return e.cnt+=1,e.flg|=o.MOD_CELL,e},l._rem=function(t){var e=this._cell(t);return e.cnt-=1,e.flg|=o.MOD_CELL,e},l._mod=function(t,e){return t._prev&&t._prev!==o.SENTINEL&&void 0!==this._keys(t._prev)?(this._rem(t._prev),this._add(t)):e?this._add(t):this._cell(t)},l.transform=function(t,e){var n,i,r,a,l=this,u=s.create(t);e&&this._reset(t,u),t.add.forEach(function(t){l._add(t)}),t.mod.forEach(function(t){l._mod(t,e)}),t.rem.forEach(function(t){l._rem(t._prev&&t._prev!==o.SENTINEL&&void 0!==l._keys(t._prev)?t._prev:t)});for(n in this._cells)i=this._cells[n],i&&(r=i.flg,a=i.tpl,0===i.cnt?(r===o.MOD_CELL&&u.rem.push(a),this._cells[n]=null):r&o.ADD_CELL?u.add.push(a):r&o.MOD_CELL&&u.mod.push(a),i.flg=0);return u},e.exports=i},{"../dataflow/changeset":12,"../dataflow/tuple":13,"../util/constants":65,"../util/index":66,"./Transform":57}],47:[function(t,e,n){function i(t){return r.prototype.init.call(this,t),r.addParameters(this,{on:{type:"field"},min:{type:"value"},max:{type:"value"},step:{type:"value"},maxbins:{type:"value","default":20}}),this._output={bin:"bin"},this}var r=t("./Transform"),a=(t("../util/index"),t("../util/bins")),s=t("../dataflow/tuple"),o=i.prototype=new r;o.transform=function(t){function e(e){var a=n.on.get().accessor(e);a=null==a?null:r.start+r.step*~~((a-r.start)/r.step),s.set(e,i,a,t.stamp)}var n=this,i=this._output.bin,r=a({min:this.min.get(),max:this.max.get(),step:this.step.get(),maxbins:this.maxbins.get()});return t.add.forEach(e),t.mod.forEach(e),t.rem.forEach(e),t},e.exports=i},{"../dataflow/tuple":13,"../util/bins":62,"../util/index":66,"./Transform":57}],48:[function(t,e,n){function i(t){return u.prototype.init.call(this,t),u.addParameters(this,{"with":{type:"data"},diagonal:{type:"value","default":"true"}}),this._output={left:"a",right:"b"},this._collector=new c(t),this._lastRem=null,this._lastWith=null,this._ids={},this._cache={},this.router(!0)}function r(t,e){var n=this._cache[t._id]=this._cache[t._id]||{c:[],s:this._stamp};n.c.push(e)}function a(t,e,n,i,a){for(var s,o,l,u=e?n:this._collector.data(),c=0,d=u.length,f=void 0!==a._prev?null:void 0;d>c;++c)o=u[c],l=e?a._id+"_"+o._id:o._id+"_"+a._id,this._ids[l]||(a._id!=o._id||i)&&(s=h.ingest({},f),s[this._output.left]=e?a:o,s[this._output.right]=e?o:a,t.add.push(s),r.call(this,a,s),r.call(this,o,s),this._ids[l]=1)}function s(t,e,n){var i=this,r=this._cache[n._id];this._lastRem>r.s&&(r.c=r.c.filter(function(t){var n=t[i._output[e?"right":"left"]];return null!==i._cache[n._id]}),r.s=this._lastRem),t.mod.push.apply(t.mod,r.c)}function o(t,e){t.rem.push.apply(t.rem,this._cache[e._id].c),this._cache[e._id]=null,this._lastRem=this._stamp}function l(t,e){(t.add.length||t.rem.length)&&(e.fields[this._output.left]=1,e.fields[this._output.right]=1)}var u=t("./Transform"),c=t("../dataflow/Collector"),d=t("../util/index"),h=t("../dataflow/tuple"),f=t("../dataflow/changeset"),p=i.prototype=new u;p.transform=function(t){d.debug(t,["crossing"]),this._collector.evaluate(t);var e=this["with"].get(this._graph),n=this.diagonal.get(this._graph),i=!e.name,r=this._collector.data(),u=i?t:e.source.last(),c=i?r:e.source.values(),h=f.create(t),p=o.bind(this,h);return t.rem.forEach(p),t.add.forEach(a.bind(this,h,!0,c,n)),!i&&u.stamp>this._lastWith&&(u.rem.forEach(p),u.add.forEach(a.bind(this,h,!1,r,n)),u.mod.forEach(s.bind(this,h,!1)),l.call(this,u,h),this._lastWith=u.stamp),t.mod.forEach(s.bind(this,h,!0)),l.call(this,t,h),h},e.exports=i},{"../dataflow/Collector":7,"../dataflow/changeset":12,"../dataflow/tuple":13,"../util/index":66,"./Transform":57}],49:[function(t,e,n){function i(t){return a.prototype.init.call(this,t),r.addParameters(this,{keys:{type:"array<field>"}}),this._pipeline=[],this}var r=t("./Transform"),a=t("./Aggregate"),s=t("../dataflow/tuple"),o=t("../dataflow/changeset"),l=t("../util/index"),u=t("../util/constants"),c=i.prototype=new a;c.pipeline=function(t){return arguments.length?(this._pipeline=t,this):this._pipeline},c._reset=function(t,e){var n,i;for(n in this._cells)i=this._cells[n],i&&(e.rem.push(i.tpl),i["delete"]());this._cells={}},c._new_tuple=function(t,e){return s.ingest(e,null)},c._new_cell=function(t,e){var n=a.prototype._new_cell.call(this,t,e),i=this._pipeline.map(function(t){return t.clone()}),r=this,s=n.tpl;return n.ds=this._graph.data("vg_"+s._id,i,s),n["delete"]=function(){l.debug({},["deleting cell",e.key]),r.removeListener(i[0]),r._graph.disconnect(i)},this.addListener(i[0]),n},c._add=function(t){var e=a.prototype._add.call(this,t);return e.ds._input.add.push(t),e},c._mod=function(t,e){var n=a.prototype._mod.call(this,t,e);return n.flg&u.ADD_CELL||n.ds._input.mod.push(t),n.flg|=u.MOD_CELL,n},c._rem=function(t){var e=a.prototype._rem.call(this,t);return e.ds._input.rem.push(t),e},c.transform=function(t,e){l.debug(t,["faceting"]),this._refs=this.keys.get(this._graph).accessors;var n,i,r=a.prototype.transform.call(this,t,e);for(n in this._cells)i=this._cells[n],null!=i&&(0===i.cnt?i["delete"]():o.copy(t,i.ds._input));return r},e.exports=i},{"../dataflow/changeset":12,"../dataflow/tuple":13,"../util/constants":65,"../util/index":66,"./Aggregate":46,"./Transform":57}],50:[function(t,e,n){function i(t){return a.prototype.init.call(this,t),a.addParameters(this,{test:{type:"expr"}}),this._skip={},this}function r(t){return o.eval(this._graph,this.test.get(this._graph),t,null,null,null,this.dependency(u.SIGNALS))}var a=t("./Transform"),s=t("../dataflow/changeset"),o=t("../parse/expr"),l=t("../util/index"),u=t("../util/constants"),c=i.prototype=new a;c.transform=function(t){l.debug(t,["filtering"]);var e=s.create(t),n=this._skip,i=this;return t.rem.forEach(function(t){1!==n[t._id]?e.rem.push(t):n[t._id]=0}),t.add.forEach(function(t){r.call(i,t)?e.add.push(t):n[t._id]=1}),t.mod.forEach(function(t){var a=r.call(i,t),s=1===n[t._id];a&&s?(n[t._id]=0,e.add.push(t)):a&&!s?e.mod.push(t):!a&&s||(e.rem.push(t),n[t._id]=1)}),e},e.exports=i},{"../dataflow/changeset":12,"../parse/expr":17,"../util/constants":65,"../util/index":66,"./Transform":57}],51:[function(t,e,n){function i(t){return o.prototype.init.call(this,t),o.addParameters(this,{on:{type:"array<field>"}}),this._output={key:"key",value:"value"},this._cache={},this.router(!0).revises(!0)}function r(t,e){for(var n in this._cache)e.rem.push.apply(e.rem,this._cache[n]);this._cache={}}function a(t,e,n){var i=this._cache[t._id]||(this._cache[t._id]=Array(n));return i[e]||(i[e]=u.derive(t,t._prev))}function s(t,e,n,i,r){for(var s,o,l,c=0,d=t.length,h=e.length;d>c;++c)for(o=t[c],s=0;h>s;++s)l=a.call(this,o,s,h),u.set(l,this._output.key,e[s]),u.set(l,this._output.value,n[s](o)),i.push(l)}var o=t("./Transform"),l=t("../util/index"),u=t("../dataflow/tuple"),c=t("../dataflow/changeset"),d=i.prototype=new o;d.transform=function(t,e){l.debug(t,["folding"]);var n=this,i=this.on.get(this._graph),a=i.fields,o=i.accessors,u=c.create(t);return e&&r.call(this,t,u),s.call(this,t.add,a,o,u.add,t.stamp),s.call(this,t.mod,a,o,e?u.add:u.mod,t.stamp),t.rem.forEach(function(t){u.rem.push.apply(u.rem,n._cache[t._id]),n._cache[t._id]=null}),(t.add.length||t.rem.length||a.some(function(e){return!!t.fields[e]}))&&(u.fields[this._output.key]=1,u.fields[this._output.value]=1),u},e.exports=i},{"../dataflow/changeset":12,"../dataflow/tuple":13,"../util/index":66,"./Transform":57}],52:[function(t,e,n){function i(t){return r.prototype.init.call(this,t),r.addParameters(this,{field:{type:"value"},expr:{type:"expr"}}),this}var r=t("./Transform"),a=t("../dataflow/tuple"),s=t("../parse/expr"),o=t("../util/index"),l=t("../util/constants"),u=i.prototype=new r;u.transform=function(t){function e(t){var e=s.eval(n,r,t,null,null,null,u);a.set(t,i,e)}o.debug(t,["formulating"]);var n=this._graph,i=this.field.get(n),r=this.expr.get(n),u=this.dependency(l.SIGNALS);return t.add.forEach(e),this.reevaluate(t)&&t.mod.forEach(e),t.fields[i]=1,t},e.exports=i},{"../dataflow/tuple":13,"../parse/expr":17,"../util/constants":65,"../util/index":66,"./Transform":57}],53:[function(t,e,n){function i(t,e){this._name=t,this._type=e,this._value=[],this._accessors=[],this._resolution=!1,this._signals={}}var r=t("../parse/expr"),a=t("../util/index"),s=t("../util/constants"),o=/array/i,l=/data/i,u=/field/i,c=/expr/i,d=i.prototype;d._get=function(){var t=o.test(this._type),e=l.test(this._type),n=u.test(this._type);return e?t?{names:this._value,sources:this._accessors}:{name:this._value[0],source:this._accessors[0]}:n?t?{fields:this._value,accessors:this._accessors}:{field:this._value[0],accessor:this._accessors[0]}:t?this._value:this._value[0]},d.get=function(t){var e,n,i,r=l.test(this._type),s=u.test(this._type);if(!this._resolution)return this._get();if(r)return this._accessors=this._value.map(function(e){return t.data(e)}),this._get();for(e in this._signals)n=this._signals[e],i=t.signalRef(e),s&&(this._accessors[n]=this._value[n]!=i?a.accessor(i):this._accessors[n]),this._value[n]=i;return this._get()},d.set=function(t,e){var n=this,i=c.test(this._type),o=l.test(this._type),d=u.test(this._type);return this._value=a.array(e).map(function(e,l){if(a.isString(e)){if(i){var u=r(t._graph,e);return t.dependency(s.FIELDS,u.fields),t.dependency(s.SIGNALS,u.signals),u.fn}return d?(n._accessors[l]=a.accessor(e),t.dependency(s.FIELDS,e)):o&&(n._resolution=!0,t.dependency(s.DATA,e)),e}return void 0!==e.value?e.value:void 0!==e.field?(n._accessors[l]=a.accessor(e.field),t.dependency(s.FIELDS,e.field),e.field):void 0!==e.signal?(n._resolution=!0,n._signals[e.signal]=l,t.dependency(s.SIGNALS,e.signal),e.signal):e}),t},e.exports=i},{"../parse/expr":17,"../util/constants":65,"../util/index":66}],54:[function(t,e,n){function i(t){return r.prototype.init.call(this,t),r.addParameters(this,{by:{type:"array<field>"}}),this.router(!0)}var r=t("./Transform"),a=(t("../parse/expr"),t("../util/index")),s=i.prototype=new r;s.transform=function(t){return a.debug(t,["sorting"]),(t.add.length||t.mod.length||t.rem.length)&&(t.sort=a.comparator(this.by.get(this._graph).fields)),t},e.exports=i},{"../parse/expr":17,"../util/index":66,"./Transform":57}],55:[function(t,e,n){function i(t){return a.prototype.init.call(this,t),a.addParameters(this,{groupby:{type:"array<field>"},sortby:{type:"array<field>"},value:{type:"field"},offset:{type:"value","default":"zero"}}),this._output={start:"y2",stop:"y",mid:"cy"},this._collector=new s(t),this}function r(t,e,n,i){var r,a,s,o,l,u,c,d=[];if(null==e)d.push(t.slice());else for(r={},a=0;a<t.length;++a)s=t[a],o=e.map(function(t){return t(s)}),l=r[o]||(d.push(r[o]=[]),r[o]),l.push(s);for(o=0,c=0;o<d.length;++o){for(l=d[o],a=0,u=0;a<l.length;++a)u+=i(l[a]);l.sum=u,u>c&&(c=u),null!=n&&l.sort(n)}return d.max=c,d}var a=t("./Transform"),s=t("../dataflow/Collector"),o=t("../util/index"),l=t("../dataflow/tuple"),u=(t("../dataflow/changeset"),i.prototype=new a);u.transform=function(t){this._collector.evaluate(t);for(var e=this._collector.data(),n=this._graph,i=this.groupby.get(n).accessors,a=o.comparator(this.sortby.get(n).fields),s=this.value.get(n).accessor,u=this.offset.get(n),c=this._output,d=r(e,i,a,s),h=0,f=d.max;h<d.length;++h){var h,p,g,m=d[h],v=m.sum,_="center"===u?(f-v)/2:0,y="normalize"===u?1/v:1,x=_,b=0;for(j=0;j<m.length;++j)p=m[j],g=x,b+=s(p),x=y*b+_,l.set(p,c.start,g),l.set(p,c.stop,x),l.set(p,c.mid,.5*(g+x))}return t.fields[c.start]=1,t.fields[c.stop]=1,t.fields[c.mid]=1,t},e.exports=i},{"../dataflow/Collector":7,"../dataflow/changeset":12,"../dataflow/tuple":13,"../util/index":66,"./Transform":57}],56:[function(t,e,n){function i(t){return a.prototype.init.call(this,t),r.addParameters(this,{group_by:{type:"array<field>"},on:{type:"field"}}),this._output={count:"count",avg:"avg",min:"min",max:"max",sum:"sum",mean:"mean","var":"var",stdev:"stdev",varp:"varp",stdevp:"stdevp",median:"median"},this._Measures=null,this.__facet=null,this}var r=t("./Transform"),a=t("./Aggregate"),s=t("../dataflow/tuple"),o=(t("../dataflow/changeset"),t("./measures")),l=t("../util/index"),u=t("../util/constants"),c=i.prototype=new a;c.measures={set:function(t,e){return e.indexOf(u.COUNT)<0&&e.push(u.COUNT),t._Measures=o.create(e.map(function(e){return o[e](t._output[e])})),t}},c._reset=function(t,e){var n,i;for(n in this._cells)(i=this._cells[n])&&(t.facet||e.rem.push(i.set()));this._cells={}},c._keys=function(t){return this.__facet?this.__facet:this._refs.length?a.prototype._keys.call(this,t):{keys:[],key:""}},c._new_cell=function(t,e){var n,i,r=this.group_by.get(this._graph),a=r.fields,o=r.accessors,l=this.__facet||{};if(!this.__facet){for(n=0,i=a.length;i>n;++n)l[a[n]]=o[n](t);l=s.ingest(l,null)}return new this._Measures(l)},c._add=function(t){var e=this.on.get(this._graph).accessor;this._cell(t).add(e(t))},c._rem=function(t){var e=this.on.get(this._graph).accessor;this._cell(t).rem(e(t))},c.transform=function(t,e){l.debug(t,["stats"]),t.facet?this.__facet=t.facet:this._refs=this.group_by.get(this._graph).accessors;var n,i,r=a.prototype.transform.call(this,t,e);if(t.facet)return this._cells[t.facet.key].set(),t;for(n in this._cells)i=this._cells[n],i&&i.set();return r},e.exports=i},{"../dataflow/changeset":12,"../dataflow/tuple":13,"../util/constants":65,"../util/index":66,"./Aggregate":46,"./Transform":57,"./measures":61}],57:[function(t,e,n){function i(t){return t&&r.prototype.init.call(this,t),this}var r=t("../dataflow/Node"),a=t("./Parameter"),s=(t("../util/index"),t("../util/constants"));i.addParameters=function(t,e){var n;for(var i in e)n=e[i],t[i]=new a(i,n.type),n["default"]&&t[i].set(t,n["default"]);t._parameters=e};var o=i.prototype=new r;o.clone=function(){var t=r.prototype.clone.call(this);t.transform=this.transform,t._parameters=this._parameters;for(var e in this)t[e]||(t[e]=this[e]);return t},o.transform=function(t,e){return t},o.evaluate=function(t){var e=this._stamp<t.stamp&&this.dependency(s.SIGNALS).some(function(e){return!!t.signals[e]});return this.transform(t,e)},o.output=function(t){for(var e in this._output)void 0!==t[e]&&(this._output[e]=t[e]);return this},e.exports=i},{"../dataflow/Node":10,"../util/constants":65,"../util/index":66,"./Parameter":53}],58:[function(t,e,n){function i(t){return a.prototype.init.call(this,t),r.addParameters(this,{on:{type:"field"},as:{type:"value"}}),this}var r=t("./Transform"),a=t("./Aggregate"),s=t("../dataflow/tuple"),o=t("../util/index"),l=i.prototype=new a;l._new_tuple=function(t){var e={},n=this.on.get(this._graph),i=this.as.get(this._graph);return e[i]=n.accessor(t),s.ingest(e,null)},l.transform=function(t,e){return o.debug(t,["uniques"]),this._refs=[this.on.get(this._graph).accessor],a.prototype.transform.call(this,t,e)},e.exports=i},{"../dataflow/tuple":13,"../util/index":66,"./Aggregate":46,"./Transform":57}],59:[function(t,e,n){function i(t){return a.prototype.init.call(this,t),a.addParameters(this,{"with":{type:"data"},as:{type:"value"},key:{type:"field","default":"data"},withKey:{type:"field","default":null},"default":{type:"value"}}),this._map={},this._collector=new s(t),this._lastJoin=0,this.revises(!0)}function r(t){return this._map[t]||(this._map[t]=[])}var a=t("./Transform"),s=t("../dataflow/Collector"),o=t("../util/index"),l=i.prototype=new a;l.transform=function(t){var e=this["with"].get(this._graph),n=e.source,i=n.last(),a=n.values(),s=this.key.get(this._graph),l=this.withKey.get(this._graph),u=this.as.get(this._graph),c=this["default"].get(this._graph),d=r.bind(this),h={};if(o.debug(t,["zipping",e.name]),l.field)i&&i.stamp>this._lastJoin&&(i.rem.forEach(function(t){var e=d(l.accessor(t));e[0]&&e[0].forEach(function(t){t[u]=c}),e[1]=null}),i.add.forEach(function(t){var e=d(l.accessor(t));e[0]&&e[0].forEach(function(e){e[u]=t}),e[1]=t}),i.fields[l.field]&&i.mod.forEach(function(t){var e;if(t._prev&&void 0!==(e=l.accessor(t._prev))){var n=d(e);n[0]&&n[0].forEach(function(t){t[u]=c}),n[1]=null;var i=d(l.accessor(t));i[0]&&i[0].forEach(function(e){e[u]=t}),i[1]=t}}),this._lastJoin=i.stamp),t.add.forEach(function(t){var e=d(s.accessor(t));t[u]=e[1]||c,(e[0]=e[0]||[]).push(t)}),t.rem.forEach(function(t){var e=s.accessor(t);(h[e]=h[e]||{})[t._id]=1}),t.fields[s.field]&&t.mod.forEach(function(t){var e;if(t._prev&&void 0!==(e=s.accessor(t._prev))){var n=d(s.accessor(t));t[u]=n[1]||c,(n[0]=n[0]||[]).push(t),(h[e]=h[e]||{})[t._id]=1}}),o.keys(h).forEach(function(t){var e=d(t);e[0]&&(e[0]=e[0].filter(function(e){return 1!==h[t][e._id]}))});else{if(0==t.add.length&&0==t.rem.length&&0==i.add.length&&0==i.rem.length)return t;this._collector.evaluate(t);var f,p=this._collector.data(),g=a.length;for(f=0;f<p.length;f++)p[f][u]=a[f%g]}return t.fields[u]=1,t},e.exports=i},{"../dataflow/Collector":7,"../util/index":66,"./Transform":57}],60:[function(t,e,n){e.exports={bin:t("./Bin"),cross:t("./Cross"),facet:t("./Facet"),filter:t("./Filter"),fold:t("./Fold"),formula:t("./Formula"),sort:t("./Sort"),stack:t("./Stack"),stats:t("./Stats"),unique:t("./Unique"),zip:t("./Zip")}},{"./Bin":47,"./Cross":48,"./Facet":49,"./Filter":50,"./Fold":51,"./Formula":52,"./Sort":54,"./Stack":55,"./Stats":56,"./Unique":58,"./Zip":59}],61:[function(t,e,n){function i(t){return function(e){var n=Object.create(t);return n.out=e||t.name,n.idx||(n.idx=0),n}}function r(t){function e(t,n){return(n.req||[]).forEach(function(n){t[n]||e(t,t[n]=d[n]())}),t}var n=t.reduce(e,t.reduce(function(t,e){return t[e.name]=e,t},{})),i=[];for(var r in n)i.push(n[r]);return i.sort(function(t,e){return t.idx-e.idx}),i}function a(t){var e=r(t),n="this.flg = this.ADD; this.tpl = t;",i="",a="",d="var t = this.tpl;";return e.forEach(function(t){n+=t.init,i+=t.add,a+=t.rem}),t.forEach(function(t){d+="this.tuple.set(t,'"+t.out+"',"+t.set+");"}),i+="this.flg |= this.MOD;",a+="this.flg |= this.MOD;",d+="return t;",n=Function("t",n),n.prototype.ADD=c.ADD_CELL,n.prototype.MOD=c.MOD_CELL,n.prototype.add=Function("v",i),n.prototype.rem=Function("v",a),n.prototype.set=Function("stamp",d),n.prototype.mod=s,n.prototype.keys=l.keys,n.prototype.sel=u,n.prototype.tuple=o,n}function s(t,e){void 0!==e&&e!==t&&(this.rem(e),this.add(t))}var o=t("../dataflow/tuple"),l=t("../util/index"),u=t("../util/quickselect"),c=t("../util/constants"),d={count:i({name:"count",init:"this.cnt = 0;",add:"this.cnt += 1;",rem:"this.cnt -= 1;",set:"this.cnt"}),_counts:i({name:"_counts",init:"this.cnts = {};",add:"this.cnts[v] = ++this.cnts[v] || 1;",rem:"this.cnts[v] = --this.cnts[v] < 0 ? 0 : this.cnts[v];",set:"",req:["count"]}),sum:i({name:"sum",init:"this.sum = 0;",add:"this.sum += v;",rem:"this.sum -= v;",set:"this.sum"}),avg:i({name:"avg",init:"this.avg = 0;",add:"var d = v - this.avg; this.avg += d / this.cnt;",rem:"var d = v - this.avg; this.avg -= d / this.cnt;",set:"this.avg",req:["count"],idx:1}),"var":i({name:"var",init:"this.dev = 0;",add:"this.dev += d * (v - this.avg);",rem:"this.dev -= d * (v - this.avg);",set:"this.dev / (this.cnt-1)",req:["avg"],idx:2}),varp:i({name:"varp",init:"",add:"",rem:"",set:"this.dev / this.cnt",req:["var"],idx:3}),stdev:i({name:"stdev",init:"",add:"",rem:"",set:"Math.sqrt(this.dev / (this.cnt-1))",req:["var"],idx:4}),stdevp:i({name:"stdevp",init:"",add:"",rem:"",set:"Math.sqrt(this.dev / this.cnt)",req:["var"],idx:5}),min:i({name:"min",init:"this.min = +Infinity;",add:"this.min = v < this.min ? v : this.min;",rem:"var self = this; this.min = v == this.min ? this.keys(this.cnts).reduce(function(m, v) {    return self.cnts[(v = +v)] > 0 && v < m ? v : m }, +Infinity) : this.min;",set:"this.min",req:["_counts"],idx:6}),max:i({name:"max",init:"this.max = -Infinity;",add:"this.max = v > this.max ? v : this.max;",rem:"var self = this; this.max = v == this.max ? this.keys(this.cnts).reduce(function(m, v) {    return self.cnts[(v = +v)] > 0 && v > m ? v : m }, -Infinity) : this.max;",set:"this.max",req:["_counts"],idx:7}),median:i({name:"median",init:"this.vals = []; ",add:"if(this.vals) this.vals.push(v); ",rem:"this.vals = null;",set:"this.cnt % 2 ? this.sel(~~(this.cnt/2), this.vals, this.cnts) : 0.5 * (this.sel(~~(this.cnt/2)-1, this.vals, this.cnts) + this.sel(~~(this.cnt/2), this.vals, this.cnts))",req:["_counts"],idx:8})};d.create=a,e.exports=d},{"../dataflow/tuple":13,"../util/constants":65,"../util/index":66,"../util/quickselect":68}],62:[function(t,e,n){function i(t,e){for(var n=0,i=t.length;i>n;){var r=n+i>>>1;t[r]<e?n=r+1:i=r}return n}function r(t){t=t||{};var e,n,r,a,s=t.maxbins||1024,o=t.base||10,l=t.div||[5,2],u=t.minstep||0,c=Math.log(o),d=Math.ceil(Math.log(s)/c),h=t.min,f=t.max,p=f-h,g=Math.max(u,Math.pow(o,Math.round(Math.log(p)/c)-d)),m=Math.ceil(p/g);if(null!=t.step)g=t.step;else if(t.steps)r=i(t.steps,p/s),r===t.steps.length&&--r,g=t.steps[r];else{do g*=o,m=Math.ceil(p/g);while(m>s);for(r=0;r<l.length;++r)n=g/l[r],n>=u&&s>=p/n&&(g=n,m=Math.ceil(p/g))}return n=Math.log(g),e=n>=0?0:~~(-n/c)+1,a=(0>h?-1:1)*Math.pow(o,-e-1),h=Math.min(h,Math.floor(h/g+a)*g),f=Math.ceil(f/g)*g,{start:h,stop:f,step:g,unit:e}}e.exports=r},{}],63:[function(t,e,n){(function(n){function i(){return T||(T=v.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node().getContext("2d"))}function r(t,e,n){return null==e?n.set(0,0,0,0):(w(e,n),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&n.expand(t.strokeWidth)),n}function a(t,e){var n=t.path?t.pathCache||(t.pathCache=k(t.path)):null;return r(t,n,e)}function s(t,e){var n=t.mark.items,t=n[0],i=t.pathCache||(t.pathCache=k(A(n)));return r(n[0],i,e)}function o(t,e){var n=t.mark.items,t=n[0],i=t.pathCache||(t.pathCache=k(E(n)));return r(n[0],i,e)}function l(t,e){var n=t.x||0,i=t.y||0,r=n+t.width||0,a=i+t.height||0;return e.set(n,i,r,a),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function u(t,e){var n=t.width||0,i=t.height||0,r=(t.x||0)-("center"===t.align?n/2:"right"===t.align?n:0),a=(t.y||0)-("middle"===t.baseline?i/2:"bottom"===t.baseline?i:0);return e.set(r,a,r+n,a+i)}function c(t,e){var n,i;return e.set(n=t.x||0,i=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:i),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function d(t,e){var n,i,r,a,s,o,l,u,c,d=t.x||0,h=t.y||0,f=t.innerRadius||0,p=t.outerRadius||0,g=(t.startAngle||0)-L,m=(t.endAngle||0)-L,v=1/0,_=-(1/0),y=1/0,x=-(1/0),b=[g,m],k=g-g%L;for(i=0;4>i&&m>k;++i,k+=L)b.push(k);for(i=0,r=b.length;r>i;++i)n=b[i],a=Math.cos(n),o=f*a,u=p*a,s=Math.sin(n),l=f*s,c=p*s,v=Math.min(v,o,u),_=Math.max(_,o,u),y=Math.min(y,l,c),x=Math.max(x,l,c);return e.set(d+v,h+y,d+_,h+x),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function h(t,e){var n,i,r,a,s=null!=t.size?t.size:100,o=t.x||0,l=t.y||0;switch(t.shape){case"cross":n=Math.sqrt(s/5)/2,i=3*n,e.set(o-i,l-n,o+i,l+n);break;case"diamond":a=Math.sqrt(s/(2*S)),r=a*S,e.set(o-r,l-a,o+r,l+a);break;case"square":i=Math.sqrt(s),n=i/2,e.set(o-n,l-n,o+n,l+n);break;case"triangle-down":r=Math.sqrt(s/M),a=r*M/2,e.set(o-r,l-a,o+r,l+a);break;case"triangle-up":r=Math.sqrt(s/M),a=r*M/2,e.set(o-r,l-a,o+r,l+a);break;default:n=Math.sqrt(s/Math.PI),e.set(o-n,l-n,o+n,l+n)}return t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function f(t,e,n){var r,a,s=(t.x||0)+(t.dx||0),o=(t.y||0)+(t.dy||0),l=t.fontSize||b.render.fontSize,u=t.align,c=t.baseline,d=t.radius||0,h=i();return h.font=x.fontString(t),h.textAlign=u||"left",h.textBaseline=c||"alphabetic",r=h.measureText(t.text||"").width,d&&(a=(t.theta||0)-Math.PI/2,s+=d*Math.cos(a),o+=d*Math.sin(a)),"center"===u?s-=r/2:"right"===u&&(s-=r),"top"===c?o+=l/5:"bottom"===c?o-=l:"middle"===c?o=o-l/2+l/10:o-=4*l/5,e.set(s,o,s+r,o+l),t.angle&&!n&&e.rotate(t.angle*Math.PI/180,t.x||0,t.y||0),e.expand(n?0:1)}function p(t,e,n){var i,r,a=t.axisItems||[],s=t.legendItems||[];for(i=0,r=a.length;r>i;++i)e.union(a[i].bounds);for(i=0,r=t.items.length;r>i;++i)e.union(t.items[i].bounds);if(n){for(i=0,r=s.length;r>i;++i)e.union(s[i].bounds);null!=t.width&&null!=t.height&&e.add(t.width,t.height),null!=t.x&&null!=t.y&&e.add(0,0)}return e.translate(t.x||0,t.y||0),e}function g(t,e,n){e=e||N[t.mark.marktype],t.bounds_prev||(t["bounds:prev"]=new _);var i=t.bounds,r=t["bounds:prev"];return i&&r.clear().union(i),t.bounds=e(t,i?i.clear():new _,n),i||r.clear().union(t.bounds),t.bounds}function m(t,e,n){e=e||t.bounds&&t.bounds.clear()||new _;var i,r,a=t.marktype,s=N[a],o=t.items;if("area"===a||"line"===a)o.length&&(o[0].bounds=s(o[0],e));else for(i=0,r=o.length;r>i;++i)e.union(g(o[i],s,n));t.bounds=e}var v="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,_=t("../core/Bounds"),y=t("../render/canvas/path"),x=t("./index"),b=t("./config"),k=y.parse,w=y.bounds,A=y.area,E=y.line,L=Math.PI/2,M=Math.sqrt(3),S=Math.tan(30*Math.PI/180),T=null,N={group:p,symbol:h,image:u,rect:l,rule:c,arc:d,text:f,path:a,area:s,line:o};e.exports={mark:m,item:g,text:f,group:p}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../core/Bounds":4,"../render/canvas/path":33,"./config":64,"./index":66}],64:[function(t,e,n){(function(t){var i="undefined"!=typeof window?window.d3:"undefined"!=typeof t?t.d3:null,r={};r.debug=!1,r.isNode="undefined"!=typeof n&&this.exports!==n,r.domainWhiteList=!1,r.safeMode=!1,r.baseURL="",r.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',r.autopadInset=5,r.scale={time:i.time.scale,utc:i.time.scale.utc},r.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},r.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},r.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},r.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},r.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],65:[function(t,e,n){e.exports={ADD_CELL:1,MOD_CELL:2,DATA:"data",FIELDS:"fields",SCALES:"scales",SIGNAL:"signal",SIGNALS:"signals",GROUP:"group",ENTER:"enter",UPDATE:"update",EXIT:"exit",SENTINEL:{sentinel:1},ADD:"add",REMOVE:"remove",TOGGLE:"toggle",CLEAR:"clear",
LINEAR:"linear",ORDINAL:"ordinal",LOG:"log",POWER:"pow",TIME:"time",QUANTILE:"quantile",DOMAIN:"domain",RANGE:"range",MARK:"mark",AXIS:"axis",COUNT:"count",MIN:"min",MAX:"max",ASC:"asc",DESC:"desc"}},{}],66:[function(t,e,n){function i(t){return t.replace(u,"$1\\'")}function r(t,e,n){var i=0,r=t.split(c);return t=n?(r=r.reverse()).filter(function(t){return i+=t.length,e>=i}).reverse():r.filter(function(t){return i+=t.length,e>=i}),t.length?t.join("").trim():r[0].slice(0,e)}function a(t){console.log(t)}var s=t("./config"),o={},l=Object.prototype.toString;o.isObject=function(t){return t===Object(t)},o.isFunction=function(t){return"[object Function]"==l.call(t)},o.isString=function(t){return"[object String]"==l.call(t)},o.isArray=Array.isArray||function(t){return"[object Array]"==l.call(t)},o.isNumber=function(t){return"[object Number]"==l.call(t)},o.isBoolean=function(t){return"[object Boolean]"==l.call(t)},o.isTree=function(t){return t&&t.__vgtree__},o.tree=function(t,e){var n=[t];return n.__vgtree__=!0,n.children=e||"children",n},o.number=function(t){return+t},o["boolean"]=function(t){return!!t},o.identity=function(t){return t},o["true"]=function(){return!0},o.extend=function(t){for(var e,n,i=1,r=arguments.length;r>i;++i){e=arguments[i];for(n in e)t[n]=e[n]}return t},o.duplicate=function(t){return JSON.parse(JSON.stringify(t))},o.equal=function(t,e){return JSON.stringify(t)==JSON.stringify(e)},o.field=function(t){return t.split("\\.").map(function(t){return t.split(".")}).reduce(function(t,e){return t.length&&(t[t.length-1]+="."+e.shift()),t.push.apply(t,e),t},[])},o.accessor=function(t){var e;return o.isFunction(t)||null==t?t:o.isString(t)&&(e=o.field(t)).length>1?function(t){return e.reduce(function(t,e){return t[e]},t)}:function(e){return e[t]}},o.comparator=function(t){var e=[];return void 0===t&&(t=[]),t=o.array(t).map(function(t){var n=1;return"-"===t[0]?(n=-1,t=t.slice(1)):"+"===t[0]&&(n=1,t=t.slice(1)),e.push(n),o.accessor(t)}),function(n,i){var r,a,s,o,l;for(r=0,a=t.length;a>r;++r){if(s=t[r],o=s(n),l=s(i),l>o)return-1*e[r];if(o>l)return e[r]}return 0}},o.cmp=function(t,e){return e>t?-1:t>e?1:0},o.numcmp=function(t,e){return t-e},o.array=function(t){return null!=t?o.isArray(t)?t:[t]:[]},o.values=function(t){return o.isObject(t)&&!o.isArray(t)&&t.values?o.isFunction(t.values)?t.values():t.values:t},o.tuple_ids=function(t){return t.reduce(function(t,e){return t[e._id]=1,t},{})},o.str=function(t){return o.isArray(t)?"["+t.map(o.str)+"]":o.isObject(t)?JSON.stringify(t):o.isString(t)?"'"+i(t)+"'":t};var u=/(^|[^\\])'/g;o.keys=function(t){var e=[];for(var n in t)e.push(n);return e},o.unique=function(t,e,n){if(!o.isArray(t)||0==t.length)return[];e=e||o.identity,n=n||[];for(var i,r=0,a=t.length;a>r;++r)i=e(t[r]),n.indexOf(i)<0&&n.push(i);return n},o.minIndex=function(t,e){if(!o.isArray(t)||0==t.length)return-1;e=e||o.identity;for(var n=0,i=e(t[0]),r=i,a=1,s=t.length;s>a;++a)r=e(t[a]),i>r&&(i=r,n=a);return n},o.maxIndex=function(t,e){if(!o.isArray(t)||0==t.length)return-1;e=e||o.identity;for(var n=0,i=e(t[0]),r=i,a=1,s=t.length;s>a;++a)r=e(t[a]),r>i&&(i=r,n=a);return n},o.truncate=function(t,e,n,i,a){var s=t.length;if(e>=s)return t;a=a||"...";var o=Math.max(0,e-a.length);switch(n){case"left":return a+(i?r(t,o,1):t.slice(s-o));case"middle":case"center":var l=Math.ceil(o/2),u=Math.floor(o/2);return(i?r(t,l):t.slice(0,l))+a+(i?r(t,u,1):t.slice(s-u));default:return(i?r(t,o):t.slice(0,o))+a}};var c=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;o.fontString=function(t){return(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+(null!=t.fontSize?t.fontSize:s.render.fontSize)+"px "+(t.font||s.render.font)},o.log=function(t){a("[Vega Log] "+t)},o.error=function(t){t="[Vega Err] "+t,a(t),"undefined"!=typeof alert&&alert(t)};var d;o.debug=function(t,e){if(s.debug){var n=Function.prototype.bind.call(console.log,console);e.unshift(t.stamp||-1),e.unshift(Date.now()-d),t.add&&e.push(t.add.length,t.mod.length,t.rem.length,!!t.reflow),n.apply(console,e),d=Date.now()}},o.Heap=t("heap"),e.exports=o},{"./config":64,heap:2}],67:[function(t,e,n){function i(t){return l.test(t)}function r(t,e){return s.log("LOAD: "+t),a(t)?void d3.xhr(t,function(t,n){n&&(n=n.responseText),e(t,n)}):void s.error("URL is not whitelisted: "+t)}function a(t){if(!o.domainWhiteList)return!0;var e=document.createElement("a");e.href=t;var n=e.hostname.toLowerCase();return o.domainWhiteList.some(function(t){return t===n||n.lastIndexOf("."+t)===n.length-t.length-1})}var s=t("./index"),o=t("./config"),l=/^[A-Za-z]+\:\/\//;e.exports=function(t,e){var n=i(t)?t:o.baseURL+t;r(n,e)}},{"./config":64,"./index":66}],68:[function(t,e,n){var i=t("./index");e.exports=function(t,e,n){function r(t,n){var i=e[t];e[t]=e[n],e[n]=i}null===e&&(e=[],i.keys(n).forEach(function(t){var i=0,r=n[t];for(t=+t||t;r>i;++i)e.push(t)}));for(var a,s,o,l=0,u=e.length-1;u>l;){for(o=e[t],r(t,u),s=a=l;u>s;++s)e[s]<o&&r(s,a++);if(r(u,a),a===t)break;t>a?l=a+1:u=a-1}return e[t]}},{"./index":66}],69:[function(t,e,n){function i(t,e){var n=e&&e.type||"json";return t=o[n](t,e),e&&e.parse&&r(t,e.parse),t}function r(t,e){var n=s.keys(e),i=n.map(function(t){return l[e[t]]}),r=s.isTree(t);a(r?[t]:t,n,i,r)}function a(t,e,n,i){var a,s,o,l,u;for(s=0,l=t.length;l>s;++s){for(a=t[s],o=0,u=e.length;u>o;++o)a[e[o]]=n[o](a[e[o]]);i&&a.values&&r(a,e,n,!0)}}var s=t("./index"),o={},l={number:s.number,"boolean":s["boolean"],date:Date.parse};o.json=function(t,e){var n=s.isObject(t)?t:JSON.parse(t);return e&&e.property&&(n=s.accessor(e.property)(n)),n},o.csv=function(t,e){var n=d3.csv.parse(t);return n},o.tsv=function(t,e){var n=d3.tsv.parse(t);return n},o.topojson=function(t,e){if(null==topojson)return s.error("TopoJSON library not loaded."),[];var n=s.isObject(t)?t:JSON.parse(t),i=[];return e&&e.feature?i=(i=n.objects[e.feature])?topojson.feature(n,i).features:(s.error("Invalid TopoJSON object: "+e.feature),[]):e&&e.mesh?i=(i=n.objects[e.mesh])?[topojson.mesh(n,n.objects[e.mesh])]:(s.error("Invalid TopoJSON object: "+e.mesh),[]):s.error("Missing TopoJSON feature or mesh parameter."),i},o.treejson=function(t,e){return t=s.isObject(t)?t:JSON.parse(t),s.tree(t,e.children)},i.formats=o,i.parse=r,e.exports=i},{"./index":66}]},{},[1])(1)});
//# sourceMappingURL=vega2.min.js.map