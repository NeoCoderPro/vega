!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.vg=t()}}(function(){var t;return function e(t,n,r){function i(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){e.exports={core:{View:t("./src/core/View")},dataflow:{changeset:t("./src/dataflow/changeset"),Datasource:t("./src/dataflow/Datasource"),Graph:t("./src/dataflow/Graph"),Node:t("./src/dataflow/Node")},parse:t("./src/parse/"),scene:{Builder:t("./src/scene/Builder"),GroupBuilder:t("./src/scene/GroupBuilder")},transforms:t("./src/transforms/"),config:t("./src/util/config"),util:t("datalib/src/util"),schema:t("./src/util/schema")}},{"./src/core/View":76,"./src/dataflow/Datasource":78,"./src/dataflow/Graph":79,"./src/dataflow/Node":80,"./src/dataflow/changeset":82,"./src/parse/":94,"./src/scene/Builder":108,"./src/scene/GroupBuilder":110,"./src/transforms/":136,"./src/util/config":137,"./src/util/schema":140,"datalib/src/util":21}],2:[function(t,e,n){},{}],3:[function(t,e,n){function r(){if(!o){o=!0;for(var t,e=s.length;e;){t=s,s=[];for(var n=-1;++n<e;)t[n]();e=s.length}o=!1}}function i(){}var a=e.exports={},s=[],o=!1;a.nextTick=function(t){s.push(t),o||setTimeout(r,0)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=i,a.addListener=i,a.once=i,a.off=i,a.removeListener=i,a.removeAllListeners=i,a.emit=i,a.binding=function(t){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],4:[function(t,e,n){function r(){this._cells={},this._aggr=[],this._stream=!1}function i(t){if(a.isArray(t))return t;if(null==t)return[];var e,n,r=[];for(e in t)n=a.array(t[e]),r.push({name:e,ops:n});return r}var a=t("../util"),s=t("./measures"),o=t("./collector"),l=r.Flags={ADD_CELL:1,MOD_CELL:2},u=r.prototype;u.stream=function(t){return null==t?this._stream:(this._stream=!!t,this._aggr=[],this)},u.key=function(t){return null==t?this._key:(this._key=a.$(t),this)},u.groupby=function(t){return this._dims=a.array(t).map(function(t,e){if(t=a.isString(t)?{name:t,get:a.$(t)}:a.isFunction(t)?{name:a.name(t)||t.name||"_"+e,get:t}:t.name&&a.isFunction(t.get)?t:null,null==t)throw"Invalid groupby argument: "+t;return t}),this.clear()},u.summarize=function(t){t=i(t),this._count=!0;var e,n,r,o,l,u,c,d=this._aggr=[];for(r=0;r<t.length;++r){for(o=0,e=[],n=t[r];o<n.ops.length;++o)l=n.ops[o],"count"!==l&&(this._count=!1),u=n.as&&n.as[o]||l+("*"===n.name?"":"_"+n.name),e.push(s[l](u));c=n.get&&a.$(n.get)||("*"===n.name?a.identity:a.$(n.name)),d.push({name:n.name,measures:s.create(e,this._stream,c,this._assign)})}return this.clear()},u.count=function(){return this.summarize({"*":"count"})},u._assign=function(t,e,n){t[e]=n},u.clear=function(){return this._cells={},this},u._cellkey=function(t){var e,n=this._dims,r=n.length,i=String(n[0].get(t));for(e=1;r>e;++e)i+="|"+n[e].get(t);return i},u._cell=function(t){var e=this._dims.length?this._cellkey(t):"";return this._cells[e]||(this._cells[e]=this._newcell(t))},u._newcell=function(t){var e,n={num:0,tuple:this._newtuple(t),flag:l.ADD_CELL,aggs:{}},r=this._aggr;for(e=0;e<r.length;++e)n.aggs[r[e].name]=new r[e].measures(n,n.tuple);return n.collect&&(n.data=new o(this._key)),n},u._newtuple=function(t){var e,n,r=this._dims,i={};for(e=0,n=r.length;n>e;++e)i[r[e].name]=r[e].get(t);return this._ingest(i)},u._ingest=a.identity,u._add=function(t){var e,n=this._cell(t),r=this._aggr;if(n.num+=1,!this._count)for(n.collect&&n.data.add(t),e=0;e<r.length;++e)n.aggs[r[e].name].add(t);n.flag|=l.MOD_CELL},u._rem=function(t){var e,n=this._cell(t),r=this._aggr;if(n.num-=1,!this._count)for(n.collect&&n.data.rem(t),e=0;e<r.length;++e)n.aggs[r[e].name].rem(t);n.flag|=l.MOD_CELL},u._mod=function(t,e){var n,r=this._cell(e),i=this._cell(t),s=this._aggr;for(r!==i?(r.num-=1,i.num+=1,r.collect&&r.data.rem(e),i.collect&&i.data.add(t)):r.collect&&!a.isObject(t)&&(r.data.rem(e),r.data.add(t)),n=0;n<s.length;++n)r.aggs[s[n].name].rem(e),i.aggs[s[n].name].add(t);r.flag|=l.MOD_CELL,i.flag|=l.MOD_CELL},u.result=function(){var t,e,n,r=[],i=this._aggr;for(n in this._cells){if(t=this._cells[n],t.num>0){for(t.collect&&t.data.values(),e=0;e<i.length;++e)t.aggs[i[e].name].set();r.push(t.tuple)}else delete this._cells[n];t.flag=0}return this._rems=!1,r},u.changes=function(){var t,e,n,r,i={add:[],rem:[],mod:[]},a=this._aggr;for(r in this._cells){for(t=this._cells[r],e=t.flag,t.collect&&t.data.values(),n=0;n<a.length;++n)t.aggs[a[n].name].set();t.num<=0?(i.rem.push(t.tuple),delete this._cells[r]):e&l.ADD_CELL?i.add.push(t.tuple):e&l.MOD_CELL&&i.mod.push(t.tuple),t.flag=0}return this._rems=!1,i},u.execute=function(t){return this.clear().insert(t).result()},u.insert=function(t){this._consolidate();for(var e=0;e<t.length;++e)this._add(t[e]);return this},u.remove=function(t){if(!this._stream)throw"Aggregator not configured for streaming removes. Call stream(true) prior to calling summarize.";for(var e=0;e<t.length;++e)this._rem(t[e]);return this._rems=!0,this},u._consolidate=function(){if(this._rems){for(var t in this._cells)this._cells[t].collect&&this._cells[t].data.values();this._rems=!1}},e.exports=r},{"../util":21,"./collector":5,"./measures":6}],5:[function(t,e,n){function r(t){this._add=[],this._rem=[],this._key=t||null,this._last=null}var i=t("../util"),a=t("../stats"),s="__dl_rem__",o=r.prototype;o.add=function(t){this._add.push(t)},o.rem=function(t){this._rem.push(t)},o.values=function(){if(this._get=null,0===this._rem.length)return this._add;var t,e,n,r,o=this._add,l=this._rem,u=this._key,c=Array(o.length-l.length);if(i.isObject(l[0]))if(u)for(r=i.toMap(l,u),t=0,e=0,n=o.length;n>t;++t)r.hasOwnProperty(u(o[t]))||(c[e++]=o[t]);else{for(t=0,n=l.length;n>t;++t)l[t][s]=1;for(t=0,e=0,n=o.length;n>t;++t)o[t][s]||(c[e++]=o[t]);for(t=0,n=l.length;n>t;++t)delete l[t][s]}else for(r=a.count.map(l),t=0,e=0,n=o.length;n>t;++t)r[o[t]]>0?r[o[t]]-=1:c[e++]=o[t];return this._rem=[],this._add=c},o.extent=function(t){if(this._get!==t||!this._ext){var e=this.values(),n=a.extent.index(e,t);this._ext=[e[n[0]],e[n[1]]],this._get=t}return this._ext},o.argmin=function(t){return this.extent(t)[0]},o.argmax=function(t){return this.extent(t)[1]},o.min=function(t){var e=this.extent(t)[0];return e?t(e):+(1/0)},o.max=function(t){var e=this.extent(t)[1];return e?t(e):-(1/0)},o.quartile=function(t){return this._get===t&&this._q||(this._q=a.quartile(this.values(),t),this._get=t),this._q},o.q1=function(t){return this.quartile(t)[0]},o.q2=function(t){return this.quartile(t)[1]},o.q3=function(t){return this.quartile(t)[2]},e.exports=r},{"../stats":18,"../util":21}],6:[function(t,e,n){function r(t){return function(e){var n=s.extend({init:"",add:"",rem:"",idx:0},t);return n.out=e||t.name,n}}function i(t,e){function n(t,r){function i(e){t[e]||n(t,t[e]=o[e]())}return r.req&&r.req.forEach(i),e&&r.str&&r.str.forEach(i),t}var r=t.reduce(n,t.reduce(function(t,e){return t[e.name]=e,t},{}));return s.vals(r).sort(function(t,e){return t.idx-e.idx})}function a(e,n,r,a){var o=i(e,n),l="this.cell = cell; this.tuple = t; this.valid = 0; this.missing = 0;",u="if (v==null) this.missing++; if (!this.isValid(v)) return; ++this.valid;",c="if (v==null) this.missing--; if (!this.isValid(v)) return; --this.valid;",d="var t = this.tuple; var cell = this.cell;";return o.forEach(function(t){t.idx<0?(l=t.init+l,u=t.add+u,c=t.rem+c):(l+=t.init,u+=t.add,c+=t.rem)}),e.slice().sort(function(t,e){return t.idx-e.idx}).forEach(function(t){d+="this.assign(t,'"+t.out+"',"+t.set+");"}),d+="return t;",l=Function("cell","t",l),l.prototype.assign=a,l.prototype.add=Function("t","var v = this.get(t);"+u),l.prototype.rem=Function("t","var v = this.get(t);"+c),l.prototype.set=Function(d),l.prototype.get=r,l.prototype.distinct=t("../stats").count.distinct,l.prototype.isValid=s.isValid,l}var s=t("../util"),o={values:r({name:"values",init:"cell.collect = true;",set:"cell.data.values()",idx:-1}),count:r({name:"count",set:"cell.num"}),missing:r({name:"missing",set:"this.missing"}),valid:r({name:"valid",set:"this.valid"}),sum:r({name:"sum",init:"this.sum = 0;",add:"this.sum += v;",rem:"this.sum -= v;",set:"this.sum"}),mean:r({name:"mean",init:"this.mean = 0;",add:"var d = v - this.mean; this.mean += d / this.valid;",rem:"var d = v - this.mean; this.mean -= this.valid ? d / this.valid : this.mean;",set:"this.mean"}),average:r({name:"average",set:"this.mean",req:["mean"],idx:1}),variance:r({name:"variance",init:"this.dev = 0;",add:"this.dev += d * (v - this.mean);",rem:"this.dev -= d * (v - this.mean);",set:"this.valid > 1 ? this.dev / (this.valid-1) : 0",req:["mean"],idx:1}),variancep:r({name:"variancep",set:"this.valid > 1 ? this.dev / this.valid : 0",req:["variance"],idx:2}),stdev:r({name:"stdev",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid-1)) : 0",req:["variance"],idx:2}),stdevp:r({name:"stdevp",set:"this.valid > 1 ? Math.sqrt(this.dev / this.valid) : 0",req:["variance"],idx:2}),median:r({name:"median",set:"cell.data.q2(this.get)",req:["values"],idx:3}),q1:r({name:"q1",set:"cell.data.q1(this.get)",req:["values"],idx:3}),q3:r({name:"q3",set:"cell.data.q3(this.get)",req:["values"],idx:3}),distinct:r({name:"distinct",set:"this.distinct(cell.data.values(), this.get)",req:["values"],idx:3}),argmin:r({name:"argmin",add:"if (v < this.min) this.argmin = t;",rem:"if (v <= this.min) this.argmin = null;",set:"this.argmin = this.argmin || cell.data.argmin(this.get)",req:["min"],str:["values"],idx:3}),argmax:r({name:"argmax",add:"if (v > this.max) this.argmax = t;",rem:"if (v >= this.max) this.argmax = null;",set:"this.argmax = this.argmax || cell.data.argmax(this.get)",req:["max"],str:["values"],idx:3}),min:r({name:"min",init:"this.min = +Infinity;",add:"if (v < this.min) this.min = v;",rem:"if (v <= this.min) this.min = NaN;",set:"this.min = (isNaN(this.min) ? cell.data.min(this.get) : this.min)",str:["values"],idx:4}),max:r({name:"max",init:"this.max = -Infinity;",add:"if (v > this.max) this.max = v;",rem:"if (v >= this.max) this.max = NaN;",set:"this.max = (isNaN(this.max) ? cell.data.max(this.get) : this.max)",str:["values"],idx:4}),modeskew:r({name:"modeskew",set:"this.dev===0 ? 0 : (this.mean - cell.data.q2(this.get)) / Math.sqrt(this.dev/(this.valid-1))",req:["mean","stdev","median"],idx:5})};o.create=a,e.exports=o},{"../stats":18,"../util":21}],7:[function(t,e,n){function r(t){if(!t)throw Error("Missing binning options.");var e,n,r,o,l,u,c,d=t.maxbins||15,h=t.base||10,f=Math.log(h),p=t.div||[5,2],g=t.min,m=t.max,v=m-g;if(t.step)e=t.step;else if(t.steps)e=t.steps[Math.min(t.steps.length-1,i(t.steps,v/d,0,t.steps.length))];else{n=Math.ceil(Math.log(d)/f),r=t.minstep||0,e=Math.max(r,Math.pow(h,Math.round(Math.log(v)/f)-n));do e*=h;while(Math.ceil(v/e)>d);for(u=0;u<p.length;++u)l=e/p[u],l>=r&&d>=v/l&&(e=l)}return l=Math.log(e),o=l>=0?0:~~(-l/f)+1,c=Math.pow(h,-o-1),g=Math.min(g,Math.floor(g/e+c)*e),m=Math.ceil(m/e)*e,{start:g,stop:m,step:e,unit:{precision:o},value:a,index:s}}function i(t,e,n,r){for(;r>n;){var i=n+r>>>1;u.cmp(t[i],e)<0?n=i+1:r=i}return n}function a(t){return this.step*Math.floor(t/this.step+d)}function s(t){return Math.floor((t-this.start)/this.step+d)}function o(t){return this.unit.date(a.call(this,t))}function l(t){return s.call(this,this.unit.unit(t))}var u=t("../util"),c=t("../time-units"),d=1e-15;r.date=function(t){if(!t)throw Error("Missing date binning options.");var e=t.min,n=t.max,i=t.maxbins||20,a=t.minbins||4,s=+n-+e,u=t.unit?c[t.unit]:c.find(s,a,i),d=r({min:null!=u.min?u.min:u.unit(e),max:null!=u.max?u.max:u.unit(n),maxbins:i,minstep:u.minstep,steps:u.step});return d.unit=u,d.index=l,t.raw||(d.value=o),d},e.exports=r},{"../time-units":20,"../util":21}],8:[function(t,e,n){var r=e.exports={};r.repeat=function(t,e){var n,r=Array(e);for(n=0;e>n;++n)r[n]=t;return r},r.zeros=function(t){return r.repeat(0,t)},r.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n==1/0)throw new Error("Infinite range");var r,i=[],a=-1;if(0>n)for(;(r=t+n*++a)>e;)i.push(r);else for(;(r=t+n*++a)<e;)i.push(r);return i},r.random={},r.random.uniform=function(t,e){void 0===e&&(e=void 0===t?1:t,t=0);var n=e-t,i=function(){return t+n*Math.random()};return i.samples=function(t){return r.zeros(t).map(i)},i},r.random.integer=function(t,e){void 0===e&&(e=t,t=0);var n=e-t,i=function(){return t+Math.floor(n*Math.random())};return i.samples=function(t){return r.zeros(t).map(i)},i},r.random.normal=function(t,e){t=t||0,e=e||1;var n,i=function(){var r,i,a=0,s=0;if(void 0!==n)return a=n,n=void 0,a;do a=2*Math.random()-1,s=2*Math.random()-1,r=a*a+s*s;while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),n=t+s*i*e,t+a*i*e};return i.samples=function(t){return r.zeros(t).map(i)},i}},{}],9:[function(t,e,n){(function(n){function r(t,e){if(t){var n=e.header;t=(n?n.join(e.delimiter)+"\n":"")+t}return a.dsv(e.delimiter).parse(t)}var i=t("../../util"),a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null;r.delimiter=function(t){var e={delimiter:t};return function(t,n){return r(t,n?i.extend(n,e):e)}},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util":21}],10:[function(t,e,n){var r=t("./dsv");e.exports={json:t("./json"),topojson:t("./topojson"),treejson:t("./treejson"),dsv:r,csv:r.delimiter(","),tsv:r.delimiter("	")}},{"./dsv":9,"./json":11,"./topojson":12,"./treejson":13}],11:[function(t,e,n){var r=t("../../util");e.exports=function(t,e){var n=r.isObject(t)&&!r.isBuffer(t)?t:JSON.parse(t);return e&&e.property&&(n=r.accessor(e.property)(n)),n}},{"../../util":21}],12:[function(t,e,n){(function(n){var r=t("./json"),i=function(t,e){var n=i.topojson;if(null==n)throw Error("TopoJSON library not loaded.");var a,s=r(t,e);if(e&&e.feature){if(a=s.objects[e.feature])return n.feature(s,a).features;throw Error("Invalid TopoJSON object: "+e.feature)}if(e&&e.mesh){if(a=s.objects[e.mesh])return[n.mesh(s,s.objects[e.mesh])];throw Error("Invalid TopoJSON object: "+e.mesh)}throw Error("Missing TopoJSON feature or mesh parameter.")};i.topojson="undefined"!=typeof window?window.topojson:"undefined"!=typeof n?n.topojson:null,e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./json":11}],13:[function(t,e,n){function r(t,e){function n(t){r.push(t);var i=t[e];if(i)for(var a=0;a<i.length;++a)n(i[a],t)}e=e||"children";var r=[];return n(t,null),r.root=t,r}var i=t("./json");e.exports=function(t,e){return t=i(t,e),r(t,e&&e.children)}},{"./json":11}],14:[function(t,e,n){function r(e){var n=e.url;if(!n&&e.file)return d+e.file;if(e.baseURL&&!c.test(n)&&(u.startsWith(n,"/")||"/"===e.baseURL[e.baseURL.length-1]||(n="/"+n),n=e.baseURL+n),u.isNode&&u.startsWith(n,"//")&&(n=(e.defaultProtocol||"http")+":"+n),e.domainWhiteList){var r,i;if(u.isNode){var a=t("url").parse(n);r=a.hostname,i=null}else{var s=document.createElement("a");s.href=n,""===s.host&&(s.href=s.href),r=s.hostname.toLowerCase(),i=window.location.hostname}if(i!==r){var o=e.domainWhiteList.some(function(t){var e=r.length-t.length;return t===r||e>1&&"."===r[e-1]&&r.lastIndexOf(t)===e});if(!o)throw"URL is not whitelisted: "+n}}return n}function i(t,e){var n,r=e||function(t){throw t};try{n=i.sanitizeUrl(t)}catch(a){return void r(a)}return n?u.isNode?u.startsWith(n,d)?o(n.slice(d.length),e):n.indexOf("://")<0?o(n,e):l(n,e):s(n,e):void r("Invalid URL: "+t.url)}function a(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function s(t,e){function n(){var t=i.status;!t&&a(i)||t>=200&&300>t||304===t?e(null,i.responseText):e(i,null)}var r=!!e,i=new XMLHttpRequest;return!this.XDomainRequest||"withCredentials"in i||!/^(http(s)?:)?\/\//.test(t)||(i=new XDomainRequest),r&&("onload"in i?i.onload=i.onerror=n:i.onreadystatechange=function(){i.readyState>3&&n()}),i.open("GET",t,r),i.send(),!r&&a(i)?i.responseText:void 0}function o(e,n){var r=t("fs");return n?void t("fs").readFile(e,n):r.readFileSync(e,"utf8")}function l(e,n){return n?void t("request")(e,function(t,e,r){t||200!==e.statusCode?(t=t||"Load failed with response code "+e.statusCode+".",n(t,null)):n(null,r)}):t("sync-request")("GET",e).getBody()}var u=t("../util"),c=/^([A-Za-z]+:)?\/\//,d="file://";i.sanitizeUrl=r,e.exports=i},{"../util":21,fs:2,request:2,"sync-request":2,url:2}],15:[function(t,e,n){function r(t,e){var n=e&&e.type||"json";return t=o[n](t,e),e&&e.parse&&i(t,e.parse),t}function i(t,e){var n,r,i,o,l,u,c=t.length;for(e="auto"===e?s.inferAll(t):a.duplicate(e),n=a.keys(e),r=n.map(function(t){return s.parsers[e[t]]}),o=0,u=n.length;c>o;++o)for(i=t[o],l=0;u>l;++l)i[n[l]]=r[l](i[n[l]]);s.annotation(t,e)}var a=t("../util"),s=t("./type"),o=t("./formats");r.formats=o,e.exports=r},{"../util":21,"./formats":10,"./type":17}],16:[function(t,e,n){var r=t("../util"),i=t("./load"),a=t("./read");e.exports=r.keys(a.formats).reduce(function(t,e){return t[e]=function(t,n,s){r.isString(t)&&(t={url:t}),2===arguments.length&&r.isFunction(n)&&(s=n,n=void 0),n=r.extend({parse:"auto"},n),n.type=e;var o=i(t,s?function(t,e){if(t)return void s(t,null);try{e=a(e,n)}catch(r){s(r,null)}s(null,e)}:void 0);return o?a(o,n):void 0},t},{})},{"../util":21,"./load":14,"./read":15}],17:[function(t,e,n){function r(t,e){return e?void(t[u]=e):t&&t[u]||null}function i(t,e){e=l.$(e);var n,r,i;if(t[u]&&(n=e(t[u]),l.isString(n)))return n;for(r=0,i=t.length;!l.isValid(n)&&i>r;++r)n=e?e(t[r]):t[r];return l.isDate(n)?"date":l.isNumber(n)?"number":l.isBoolean(n)?"boolean":l.isString(n)?"string":null}function a(t,e){return t.length?(e=e||l.keys(t[0]),e.reduce(function(e,n){return e[n]=i(t,n),e},{})):void 0}function s(t,e){e=l.$(e);var n,r,i,a=["boolean","integer","number","date"];for(n=0;n<t.length;++n){for(i=e?e(t[n]):t[n],r=0;r<a.length;++r)l.isValid(i)&&!d[a[r]](i)&&(a.splice(r,1),r-=1);if(0===a.length)return"string"}return a[0]}function o(t,e){return e=e||l.keys(t[0]),e.reduce(function(e,n){return e[n]=s(t,n),e},{})}var l=t("../util"),u="__types__",c={"boolean":l["boolean"],integer:l.number,number:l.number,date:l.date,string:function(t){return""===t?null:t}},d={"boolean":function(t){return"true"===t||"false"===t||l.isBoolean(t)},integer:function(t){return d.number(t)&&(t=+t)===~~t},number:function(t){return!isNaN(+t)&&!l.isDate(t)},date:function(t){return!isNaN(Date.parse(t))}};i.annotation=r,i.all=a,i.infer=s,i.inferAll=o,i.parsers=c,e.exports=i},{"../util":21}],18:[function(t,e,n){var r=t("./util"),i=t("./import/type"),a=t("./generate"),s={};s.unique=function(t,e,n){e=r.$(e),n=n||[];var i,a,s,o={};for(a=0,s=t.length;s>a;++a)i=e?e(t[a]):t[a],i in o||(o[i]=1,n.push(i));return n},s.count=function(t){return t&&t.length||0},s.count.valid=function(t,e){e=r.$(e);var n,i,a,s=0;for(i=0,a=t.length;a>i;++i)n=e?e(t[i]):t[i],r.isValid(n)&&(s+=1);return s},s.count.missing=function(t,e){e=r.$(e);var n,i,a,s=0;for(i=0,a=t.length;a>i;++i)n=e?e(t[i]):t[i],null==n&&(s+=1);return s},s.count.distinct=function(t,e){e=r.$(e);var n,i,a,s={},o=0;for(i=0,a=t.length;a>i;++i)n=e?e(t[i]):t[i],n in s||(s[n]=1,o+=1);return o},s.count.map=function(t,e){e=r.$(e);var n,i,a,s={};for(i=0,a=t.length;a>i;++i)n=e?e(t[i]):t[i],s[n]=n in s?s[n]+1:1;return s},s.median=function(t,e){return e&&(t=t.map(r.$(e))),t=t.filter(r.isValid).sort(r.cmp),s.quantile(t,.5)},s.quartile=function(t,e){e&&(t=t.map(r.$(e))),t=t.filter(r.isValid).sort(r.cmp);var n=s.quantile;return[n(t,.25),n(t,.5),n(t,.75)]},s.quantile=function(t,e,n){void 0===n&&(n=e,e=r.identity),e=r.$(e);var i=(t.length-1)*n+1,a=Math.floor(i),s=+e(t[a-1]),o=i-a;return o?s+o*(e(t[a])-s):s},s.sum=function(t,e){e=r.$(e);for(var n,i=0,a=0,s=t.length;s>a;++a)n=e?e(t[a]):t[a],r.isValid(n)&&(i+=n);return i},s.mean=function(t,e){e=r.$(e);var n,i,a,s,o,l=0;for(i=0,s=0,a=t.length;a>i;++i)o=e?e(t[i]):t[i],r.isValid(o)&&(n=o-l,l+=n/++s);return l},s.variance=function(t,e){if(e=r.$(e),!r.isArray(t)||t.length<2)return 0;var n,i,a,s,o=0,l=0;for(i=0,a=0;i<t.length;++i)s=e?e(t[i]):t[i],r.isValid(s)&&(n=s-o,o+=n/++a,l+=n*(s-o));return l/=a-1},s.stdev=function(t,e){return Math.sqrt(s.variance(t,e))},s.modeskew=function(t,e){var n=s.mean(t,e),r=s.median(t,e),i=s.stdev(t,e);return 0===i?0:(n-r)/i},s.min=function(t,e){return s.extent(t,e)[0]},s.max=function(t,e){return s.extent(t,e)[1]},s.extent=function(t,e){e=r.$(e);var n,i,a,s,o=t.length;for(s=0;o>s;++s)if(a=e?e(t[s]):t[s],r.isValid(a)){n=i=a;break}for(;o>s;++s)a=e?e(t[s]):t[s],r.isValid(a)&&(n>a&&(n=a),a>i&&(i=a));return[n,i]},s.extent.index=function(t,e){e=r.$(e);var n,i,a,s,o=-1,l=-1,u=t.length;for(s=0;u>s;++s)if(a=e?e(t[s]):t[s],r.isValid(a)){n=i=a,o=l=s;break}for(;u>s;++s)a=e?e(t[s]):t[s],r.isValid(a)&&(n>a&&(n=a,o=s),a>i&&(i=a,l=s));return[o,l]},s.dot=function(t,e,n){var i,a,s=0;if(n)for(e=r.$(e),n=r.$(n),i=0;i<t.length;++i)a=e(t[i])*n(t[i]),a===a&&(s+=a);else{if(t.length!==e.length)throw Error("Array lengths must match.");for(i=0;i<t.length;++i)a=t[i]*e[i],a===a&&(s+=a)}return s},s.rank=function(t,e){e=r.$(e)||r.identity;var n,i,a,s=t.map(function(t,n){return{idx:n,val:e(t)}}).sort(r.comparator("val")),o=t.length,l=Array(o),u=-1,c={};for(n=0;o>n;++n){if(i=s[n].val,0>u&&c===i)u=n-1;else if(u>-1&&c!==i){for(a=1+(n-1+u)/2;n>u;++u)l[s[u].idx]=a;u=-1}l[s[n].idx]=n+1,c=i}if(u>-1)for(a=1+(o-1+u)/2;o>u;++u)l[s[u].idx]=a;return l},s.cor=function(t,e,n){var i=n;n=i?t.map(r.$(n)):e,e=i?t.map(r.$(e)):t;var a=s.dot(e,n),o=s.mean(e),l=s.mean(n),u=s.stdev(e),c=s.stdev(n),d=t.length;return(a-d*o*l)/((d-1)*u*c)},s.cor.rank=function(t,e,n){var i,a,o,l=n?s.rank(t,r.$(e)):s.rank(t),u=n?s.rank(t,r.$(n)):s.rank(e),c=t.length;for(i=0,a=0;c>i;++i)o=l[i]-u[i],a+=o*o;return 1-6*a/(c*(c*c-1))},s.cor.dist=function(t,e,n){var i,a,o,l,u=n?t.map(r.$(e)):t,c=n?t.map(r.$(n)):e,d=s.dist.mat(u),h=s.dist.mat(c),f=d.length;for(i=0,a=0,o=0,l=0;f>i;++i)a+=d[i]*d[i],o+=h[i]*h[i],l+=d[i]*h[i];return Math.sqrt(l/Math.sqrt(a*o))},s.dist=function(t,e,n,i){var a,s,o=r.isFunction(n)||r.isString(n),l=t,u=o?t:e,c=o?i:n,d=2===c||null==c,h=t.length,f=0;for(o&&(e=r.$(e),n=r.$(n)),s=0;h>s;++s)a=o?e(l[s])-n(u[s]):l[s]-u[s],f+=d?a*a:Math.pow(Math.abs(a),c);return d?Math.sqrt(f):Math.pow(f,1/c)},s.dist.mat=function(t){var e,n,r,i=t.length,s=i*i,o=Array(s),l=a.zeros(i),u=0;for(n=0;i>n;++n)for(o[n*i+n]=0,r=n+1;i>r;++r)o[n*i+r]=e=Math.abs(t[n]-t[r]),o[r*i+n]=e,l[n]+=e,l[r]+=e;for(n=0;i>n;++n)u+=l[n],l[n]/=i;for(u/=s,n=0;i>n;++n)for(r=n;i>r;++r)o[n*i+r]+=u-l[n]-l[r],o[r*i+n]=o[n*i+r];return o},s.entropy=function(t,e){e=r.$(e);var n,i,a=0,s=0,o=t.length;for(n=0;o>n;++n)a+=e?e(t[n]):t[n];if(0===a)return 0;for(n=0;o>n;++n)i=(e?e(t[n]):t[n])/a,i&&(s+=i*Math.log(i));return-s/Math.LN2},s.mutual=function(t,e,n,i){var a,s,o,l=i?t.map(r.$(e)):t,u=i?t.map(r.$(n)):e,c=i?t.map(r.$(i)):n,d={},h={},f=c.length,p=0,g=0,m=0;for(o=0;f>o;++o)d[l[o]]=0,h[u[o]]=0;for(o=0;f>o;++o)d[l[o]]+=c[o],h[u[o]]+=c[o],p+=c[o];for(s=1/(p*Math.LN2),o=0;f>o;++o)0!==c[o]&&(a=p*c[o]/(d[l[o]]*h[u[o]]),g+=c[o]*s*Math.log(a),m+=c[o]*s*Math.log(c[o]/p));return[g,1+g/m]},s.mutual.info=function(t,e,n,r){return s.mutual(t,e,n,r)[0]},s.mutual.dist=function(t,e,n,r){return s.mutual(t,e,n,r)[1]},s.profile=function(t,e){var n,a,o,l,u,c=0,d=0,h=0,f=0,p=null,g=null,m=0,v=[],y={};for(o=0;o<t.length;++o)l=e?e(t[o]):t[o],y[l]=l in y?y[l]+1:(f+=1,1),null==l?++h:r.isValid(l)&&(u="string"==typeof l?l.length:l,(null===p||p>u)&&(p=u),(null===g||u>g)&&(g=u),n=u-c,c+=n/++d,m+=n*(u-c),v.push(u));return m/=d-1,a=Math.sqrt(m),v.sort(r.cmp),{type:i(t,e),unique:y,count:t.length,valid:d,missing:h,distinct:f,min:p,max:g,mean:c,stdev:a,median:l=s.quantile(v,.5),q1:s.quantile(v,.25),q3:s.quantile(v,.75),modeskew:0===a?0:(c-l)/a}},s.summary=function(t,e){e=e||r.keys(t[0]);var n=e.map(function(e){var n=s.profile(t,r.$(e));return n.field=e,n});return n.__summary__=!0,n},e.exports=s},{"./generate":8,"./import/type":17,"./util":21}],19:[function(t,e,n){(function(n){function r(t){var e=i(t,"d");return e="var __t; return "+e+";",new Function("d",e).bind(c)}function i(t,e,n){e=e||"obj";var r=0,i="'",o=d;return t.replace(o,function(o,l,u){return i+=t.slice(r,u).replace(f,s),r=u+o.length,l&&(i+="'\n+((__t=("+a(l,e,n)+"))==null?'':__t)+\n'"),o}),i+"'"}function a(t,e,n){function i(t){return t=t||"",d?(d=!1,h="String("+h+")"+t):h+=t,h}function a(){return"(typeof "+h+'==="number"?new Date('+h+"):"+h+")"}var s=t.split("|"),c=s.shift().trim(),d=!0;n&&(n[c]=1);for(var h=r.property(e,c),f=0;f<s.length;++f){var p,g,m,v=s[f],y=null;switch((p=v.indexOf(":"))>0&&(v=v.slice(0,p),y=s[f].slice(p+1).split(",").map(function(t){return t.trim()})),v=v.trim()){case"length":i(".length");break;case"lower":i(".toLowerCase()");break;case"upper":i(".toUpperCase()");break;case"lower-locale":i(".toLocaleLowerCase()");break;case"upper-locale":i(".toLocaleUpperCase()");break;case"trim":i(".trim()");break;case"left":g=l.number(y[0]),i(".slice(0,"+g+")");break;case"right":g=l.number(y[0]),i(".slice(-"+g+")");break;case"mid":g=l.number(y[0]),m=g+l.number(y[1]),i(".slice(+"+g+","+m+")");break;case"slice":g=l.number(y[0]),i(".slice("+g+(y.length>1?","+l.number(y[1]):"")+")");break;case"truncate":g=l.number(y[0]),m=y[1],m="left"!==m&&"middle"!==m&&"center"!==m?"right":m,h="this.truncate("+i()+","+g+",'"+m+"')";break;case"pad":g=l.number(y[0]),m=y[1],m="left"!==m&&"middle"!==m&&"center"!==m?"right":m,h="this.pad("+i()+","+g+",'"+m+"')";break;case"number":g=o(y[0],u.format),d=!1,h="this.formats["+g+"]("+h+")";break;case"time":g=o(y[0],u.time.format),d=!1,h="this.formats["+g+"]("+a()+")";break;default:throw Error("Unrecognized template filter: "+v)}}return h}function s(t){return"\\"+h[t]}function o(t,e){if(!("'"===t[0]&&"'"===t[t.length-1]||'"'===t[0]&&'"'===t[t.length-1]))throw Error("Format pattern must be quoted: "+t);if(t=t.slice(1,-1),!c.format_map[t]){var n=e(t),r=c.formats.length;c.formats.push(n),c.format_map[t]=r}return c.format_map[t]}var l=t("./util"),u="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,c={formats:[],format_map:{},truncate:l.truncate,pad:l.pad};r.source=i,r.context=c,e.exports=r,r.clearFormatCache=function(){c.formats=[],c.format_map={}},r.property=function(t,e){var n=l.field(e).map(l.str).join("][");return t+"["+n+"]"};var d=/\{\{(.+?)\}\}|$/g,h={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},f=/\\|'|\r|\n|\u2028|\u2029/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./util":21}],20:[function(t,e,n){function r(t){return"number"==typeof t}var i=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]],a=[{type:"second",minstep:1,format:"%Y %b %-d %H:%M:%S.%L",date:function(t){return new Date(1e3*t)},unit:function(t){return+t/1e3}},{type:"minute",minstep:1,format:"%Y %b %-d %H:%M",date:function(t){return new Date(6e4*t)},unit:function(t){return~~(+t/6e4)}},{type:"hour",minstep:1,format:"%Y %b %-d %H:00",date:function(t){return new Date(36e5*t)},unit:function(t){return~~(+t/36e5)}},{type:"day",minstep:1,step:[1,7],format:"%Y %b %-d",date:function(t){return new Date(864e5*t)},unit:function(t){return~~(+t/864e5)}},{type:"month",minstep:1,step:[1,3,6],format:"%b %Y",date:function(t){return new Date(Date.UTC(~~(t/12),t%12,1))},unit:function(t){return r(t)&&(t=new Date(t)),12*t.getUTCFullYear()+t.getUTCMonth()}},{type:"year",minstep:1,format:"%Y",date:function(t){return new Date(Date.UTC(t,0,1))},unit:function(t){return(r(t)?new Date(t):t).getUTCFullYear()}}],s={type:"minuteOfHour",min:0,max:59,minstep:1,format:"%M",date:function(t){return new Date(Date.UTC(1970,0,1,0,t))},unit:function(t){return(r(t)?new Date(t):t).getUTCMinutes()}},o={type:"hourOfDay",min:0,max:23,minstep:1,format:"%H",date:function(t){return new Date(Date.UTC(1970,0,1,t))},unit:function(t){return(r(t)?new Date(t):t).getUTCHours()}},l={type:"dayOfWeek",min:0,max:6,step:[1],format:"%a",date:function(t){return new Date(Date.UTC(1970,0,4+t))},unit:function(t){return(r(t)?new Date(t):t).getUTCDay()}},u={type:"dayOfMonth",min:1,max:31,step:[1],format:"%-d",date:function(t){return new Date(Date.UTC(1970,0,t))},unit:function(t){return(r(t)?new Date(t):t).getUTCDate()}},c={type:"monthOfYear",min:0,max:11,step:[1],format:"%b",date:function(t){return new Date(Date.UTC(1970,t%12,1))},unit:function(t){return(r(t)?new Date(t):t).getUTCMonth()}},d={second:a[0],minute:a[1],hour:a[2],day:a[3],month:a[4],year:a[5],minuteOfHour:s,hourOfDay:o,dayOfWeek:l,dayOfMonth:u,monthOfYear:c,timesteps:a};d.find=function(t,e,n){var r,s,o,l=i[0];for(r=1,s=i.length;s>r;++r)if(l=i[r],t>l[0]){if(o=t/l[0],o>n)return a[i[r-1][1]];if(o>=e)return a[l[1]]}return a[i[i.length-1][1]]},e.exports=d},{}],21:[function(t,e,n){(function(n){function r(t){return t.replace(d,"$1\\'")}function i(t,e){var n,r="";for(n=0;t>n;++n)r+=e;return r}function a(t,e,n){var r=0,i=t.split(h);return t=n?(i=i.reverse()).filter(function(t){return r+=t.length,e>=r}).reverse():i.filter(function(t){return r+=t.length,e>=r}),t.length?t.join("").trim():i[0].slice(0,e)}var s=t("buffer"),o=t("./time-units"),l=e.exports={};l.isNode="undefined"!=typeof n&&"undefined"!=typeof n.stderr;var u="__name__";l.namedfunc=function(t,e){return e[u]=t,e},l.name=function(t){return null==t?null:t[u]},l.identity=function(t){return t},l["true"]=l.namedfunc("true",function(){return!0}),l["false"]=l.namedfunc("false",function(){return!1}),l.duplicate=function(t){return JSON.parse(JSON.stringify(t))},l.equal=function(t,e){return JSON.stringify(t)===JSON.stringify(e)},l.extend=function(t){for(var e,n,r=1,i=arguments.length;i>r;++r){e=arguments[r];for(n in e)t[n]=e[n]}return t},l.length=function(t){return null!=t&&null!=t.length?t.length:null},l.keys=function(t){var e,n=[];for(e in t)n.push(e);return n},l.vals=function(t){var e,n=[];for(e in t)n.push(t[e]);return n},l.toMap=function(t,e){return(e=l.$(e))?t.reduce(function(t,n){return t[e(n)]=1,t},{}):t.reduce(function(t,e){return t[e]=1,t},{})},l.keystr=function(t){var e=t.length;if(!e)return"";for(var n=String(t[0]),r=1;e>r;++r)n+="|"+String(t[r]);return n};var c=Object.prototype.toString;l.isObject=function(t){return t===Object(t)},l.isFunction=function(t){return"[object Function]"===c.call(t)},l.isString=function(t){return"string"==typeof value||"[object String]"===c.call(t)},l.isArray=Array.isArray||function(t){return"[object Array]"===c.call(t)},l.isNumber=function(t){return"number"==typeof t||"[object Number]"===c.call(t)},l.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"==c.call(t)},l.isDate=function(t){return"[object Date]"===c.call(t)},l.isValid=function(t){return null!=t&&t===t},l.isBuffer=s.Buffer&&s.Buffer.isBuffer||l["false"],l.number=function(t){return null==t||""===t?null:+t},l["boolean"]=function(t){return null==t||""===t?null:"false"===t?!1:!!t},l.date=function(t){return null==t||""===t?null:Date.parse(t)},l.array=function(t){return null!=t?l.isArray(t)?t:[t]:[]},l.str=function(t){return l.isArray(t)?"["+t.map(l.str)+"]":l.isObject(t)?JSON.stringify(t):l.isString(t)?"'"+r(t)+"'":t};var d=/(^|[^\\])'/g;l.field=function(t){return String(t).split("\\.").map(function(t){return t.split(".")}).reduce(function(t,e){return t.length&&(t[t.length-1]+="."+e.shift()),t.push.apply(t,e),t},[])},l.accessor=function(t){var e;return null==t||l.isFunction(t)?t:l.namedfunc(t,(e=l.field(t)).length>1?function(t){
return e.reduce(function(t,e){return t[e]},t)}:function(e){return e[t]})},l.$=l.accessor,l.mutator=function(t){var e;return l.isString(t)&&(e=l.field(t)).length>1?function(t,n){for(var r=0;r<e.length-1;++r)t=t[e[r]];t[e[r]]=n}:function(e,n){e[t]=n}},l.$func=function(t,e){return function(n){n=l.$(n)||l.identity;var r=t+(l.name(n)?"_"+l.name(n):"");return l.namedfunc(r,function(t){return e(n(t))})}},l.$valid=l.$func("valid",l.isValid),l.$length=l.$func("length",l.length),l.$year=l.$func("year",o.year.unit),l.$month=l.$func("month",o.monthOfYear.unit),l.$date=l.$func("date",o.dayOfMonth.unit),l.$day=l.$func("day",o.dayOfWeek.unit),l.$hour=l.$func("hour",o.hourOfDay.unit),l.$minute=l.$func("minute",o.minuteOfHour.unit),l.$in=function(t,e){t=l.$(t);var n=l.isArray(e)?l.toMap(e):e;return function(e){return!!n[t(e)]}},l.comparator=function(t){var e=[];return void 0===t&&(t=[]),t=l.array(t).map(function(t){var n=1;return"-"===t[0]?(n=-1,t=t.slice(1)):"+"===t[0]&&(n=1,t=t.slice(1)),e.push(n),l.accessor(t)}),function(n,r){var i,a,s,o,l;for(i=0,a=t.length;a>i;++i){if(s=t[i],o=s(n),l=s(r),l>o)return-1*e[i];if(o>l)return e[i]}return 0}},l.cmp=function(t,e){return e>t?-1:t>e?1:t>=e?0:null===t?-1:null===e?1:0/0},l.numcmp=function(t,e){return t-e},l.stablesort=function(t,e,n){var r=t.reduce(function(t,e,r){return t[n(e)]=r,t},{});return t.sort(function(t,i){var a=e(t),s=e(i);return s>a?-1:a>s?1:r[n(t)]-r[n(i)]}),t},l.startsWith=String.prototype.startsWith?function(t,e){return null==t?!1:t.startsWith(e)}:function(t,e){return null==t?!1:0===t.lastIndexOf(e,0)},l.pad=function(t,e,n,r){r=r||" ";var a=e-t.length;if(0>=a)return t;switch(n){case"left":return i(a,r)+t;case"middle":case"center":return i(Math.floor(a/2),r)+t+i(Math.ceil(a/2),r);default:return t+i(a,r)}},l.truncate=function(t,e,n,r,i){var s=t.length;if(e>=s)return t;i=void 0!==i?String(i):"…";var o=Math.max(0,e-i.length);switch(n){case"left":return i+(r?a(t,o,1):t.slice(s-o));case"middle":case"center":var l=Math.ceil(o/2),u=Math.floor(o/2);return(r?a(t,l):t.slice(0,l))+i+(r?a(t,u,1):t.slice(s-u));default:return(r?a(t,o):t.slice(0,o))+i}};var h=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,t("_process"))},{"./time-units":20,_process:3,buffer:2}],22:[function(t,e,n){e.exports=t("./lib/heap")},{"./lib/heap":23}],23:[function(e,n,r){(function(){var e,i,a,s,o,l,u,c,d,h,f,p,g,m,v;a=Math.floor,h=Math.min,i=function(t,e){return e>t?-1:t>e?1:0},d=function(t,e,n,r,s){var o;if(null==n&&(n=0),null==s&&(s=i),0>n)throw new Error("lo must be non-negative");for(null==r&&(r=t.length);r>n;)o=a((n+r)/2),s(e,t[o])<0?r=o:n=o+1;return[].splice.apply(t,[n,n-n].concat(e)),e},l=function(t,e,n){return null==n&&(n=i),t.push(e),m(t,0,t.length-1,n)},o=function(t,e){var n,r;return null==e&&(e=i),n=t.pop(),t.length?(r=t[0],t[0]=n,v(t,0,e)):r=n,r},c=function(t,e,n){var r;return null==n&&(n=i),r=t[0],t[0]=e,v(t,0,n),r},u=function(t,e,n){var r;return null==n&&(n=i),t.length&&n(t[0],e)<0&&(r=[t[0],e],e=r[0],t[0]=r[1],v(t,0,n)),e},s=function(t,e){var n,r,s,o,l,u;for(null==e&&(e=i),o=function(){u=[];for(var e=0,n=a(t.length/2);n>=0?n>e:e>n;n>=0?e++:e--)u.push(e);return u}.apply(this).reverse(),l=[],r=0,s=o.length;s>r;r++)n=o[r],l.push(v(t,n,e));return l},g=function(t,e,n){var r;return null==n&&(n=i),r=t.indexOf(e),-1!==r?(m(t,0,r,n),v(t,r,n)):void 0},f=function(t,e,n){var r,a,o,l,c;if(null==n&&(n=i),a=t.slice(0,e),!a.length)return a;for(s(a,n),c=t.slice(e),o=0,l=c.length;l>o;o++)r=c[o],u(a,r,n);return a.sort(n).reverse()},p=function(t,e,n){var r,a,l,u,c,f,p,g,m,v;if(null==n&&(n=i),10*e<=t.length){if(u=t.slice(0,e).sort(n),!u.length)return u;for(l=u[u.length-1],g=t.slice(e),c=0,p=g.length;p>c;c++)r=g[c],n(r,l)<0&&(d(u,r,0,null,n),u.pop(),l=u[u.length-1]);return u}for(s(t,n),v=[],a=f=0,m=h(e,t.length);m>=0?m>f:f>m;a=m>=0?++f:--f)v.push(o(t,n));return v},m=function(t,e,n,r){var a,s,o;for(null==r&&(r=i),a=t[n];n>e&&(o=n-1>>1,s=t[o],r(a,s)<0);)t[n]=s,n=o;return t[n]=a},v=function(t,e,n){var r,a,s,o,l;for(null==n&&(n=i),a=t.length,l=e,s=t[e],r=2*e+1;a>r;)o=r+1,a>o&&!(n(t[r],t[o])<0)&&(r=o),t[e]=t[r],e=r,r=2*e+1;return t[e]=s,m(t,l,e,n)},e=function(){function t(t){this.cmp=null!=t?t:i,this.nodes=[]}return t.push=l,t.pop=o,t.replace=c,t.pushpop=u,t.heapify=s,t.updateItem=g,t.nlargest=f,t.nsmallest=p,t.prototype.push=function(t){return l(this.nodes,t,this.cmp)},t.prototype.pop=function(){return o(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},t.prototype.replace=function(t){return c(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return u(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return s(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return g(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var e;return e=new t,e.nodes=this.nodes.slice(0),e},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),function(e,i){return"function"==typeof t&&t.amd?t([],i):"object"==typeof r?n.exports=i():e.Heap=i()}(this,function(){return e})}).call(this)},{}],24:[function(t,e,n){function r(t,e,n,r,i,s,l,u,c){var d=o.call(arguments);if(a[d])return a[d];var h=l*(Math.PI/180),f=Math.sin(h),p=Math.cos(h);n=Math.abs(n),r=Math.abs(r);var g=p*(u-t)*.5+f*(c-e)*.5,m=p*(c-e)*.5-f*(u-t)*.5,v=g*g/(n*n)+m*m/(r*r);v>1&&(v=Math.sqrt(v),n*=v,r*=v);var y=p/n,_=f/n,x=-f/r,b=p/r,w=y*u+_*c,k=x*u+b*c,E=y*t+_*e,L=x*t+b*e,A=(E-w)*(E-w)+(L-k)*(L-k),S=1/A-.25;0>S&&(S=0);var M=Math.sqrt(S);s==i&&(M=-M);var T=.5*(w+E)-M*(L-k),C=.5*(k+L)+M*(E-w),N=Math.atan2(k-C,w-T),I=Math.atan2(L-C,E-T),P=I-N;0>P&&1===s?P+=2*Math.PI:P>0&&0===s&&(P-=2*Math.PI);for(var O=Math.ceil(Math.abs(P/(.5*Math.PI+.001))),D=[],z=0;O>z;++z){var U=N+z*P/O,j=N+(z+1)*P/O;D[z]=[T,C,U,j,n,r,f,p]}return a[d]=D}function i(t){var e=o.call(t);if(s[e])return s[e];var n=t[0],r=t[1],i=t[2],a=t[3],l=t[4],u=t[5],c=t[6],d=t[7],h=d*l,f=-c*u,p=c*l,g=d*u,m=Math.cos(i),v=Math.sin(i),y=Math.cos(a),_=Math.sin(a),x=.5*(a-i),b=Math.sin(.5*x),w=8/3*b*b/Math.sin(x),k=n+m-w*v,E=r+v+w*m,L=n+y,A=r+_,S=L+w*_,M=A-w*y;return s[e]=[h*k+f*E,p*k+g*E,h*S+f*M,p*S+g*M,h*L+f*A,p*L+g*A]}var a={},s={},o=[].join;e.exports={segments:r,bezier:i,cache:{segments:a,bezier:s}}},{}],25:[function(t,e,n){var r=t("../util/svg").path;e.exports=function(t){var e=t[0];return("horizontal"===e.orient?r.areah:r.areav).interpolate(e.interpolate||"linear").tension(e.tension||.7)(t)}},{"../util/svg":73}],26:[function(t,e,n){function r(t,e,n,r){for(var a=i.segments(n[5],n[6],n[0],n[1],n[3],n[4],n[2],t,e),s=0;s<a.length;++s){var o=i.bezier(a[s]);r.add(o[0],o[1]),r.add(o[2],o[3]),r.add(o[4],o[5])}}var i=t("./arc");e.exports=function(t,e){var n,i,a,s,o,l,u,c=null,d=0,h=0,f=0,p=0;for(l=0,u=t.length;u>l;++l){switch(n=t[l],n[0]){case"l":d+=n[1],h+=n[2],e.add(d,h);break;case"L":d=n[1],h=n[2],e.add(d,h);break;case"h":d+=n[1],e.add(d,h);break;case"H":d=n[1],e.add(d,h);break;case"v":h+=n[1],e.add(d,h);break;case"V":h=n[1],e.add(d,h);break;case"m":d+=n[1],h+=n[2],e.add(d,h);break;case"M":d=n[1],h=n[2],e.add(d,h);break;case"c":i=d+n[5],a=h+n[6],f=d+n[3],p=h+n[4],e.add(d+n[1],h+n[2]),e.add(f,p),e.add(i,a),d=i,h=a;break;case"C":d=n[5],h=n[6],f=n[3],p=n[4],e.add(n[1],n[2]),e.add(f,p),e.add(d,h);break;case"s":i=d+n[3],a=h+n[4],f=2*d-f,p=2*h-p,e.add(f,p),e.add(d+n[1],h+n[2]),e.add(i,a),f=d+n[1],p=h+n[2],d=i,h=a;break;case"S":i=n[3],a=n[4],f=2*d-f,p=2*h-p,d=i,h=a,e.add(n[1],n[2]),e.add(f,p),e.add(i,a),f=n[1],p=n[2];break;case"q":i=d+n[3],a=h+n[4],f=d+n[1],p=h+n[2],d=i,h=a,e.add(f,p),e.add(i,a);break;case"Q":i=n[3],a=n[4],d=i,h=a,f=n[1],p=n[2],e.add(f,p),e.add(i,a);break;case"t":i=d+n[1],a=h+n[2],null===c[0].match(/[QqTt]/)?(f=d,p=h):"t"===c[0]?(f=2*d-s,p=2*h-o):"q"===c[0]&&(f=2*d-f,p=2*h-p),s=f,o=p,d=i,h=a,f=d+n[1],p=h+n[2],e.add(f,p),e.add(i,a);break;case"T":i=n[1],a=n[2],f=2*d-f,p=2*h-p,d=i,h=a,e.add(f,p),e.add(i,a);break;case"a":r(d,h,[n[1],n[2],n[3],n[4],n[5],n[6]+d,n[7]+h],e),d+=n[6],h+=n[7];break;case"A":r(d,h,[n[1],n[2],n[3],n[4],n[5],n[6],n[7]],e),d=n[6],h=n[7];break;case"z":case"Z":}c=n}return e}},{"./arc":24}],27:[function(t,e,n){e.exports={parse:t("./parse"),render:t("./render"),bounds:t("./bounds"),area:t("./area"),line:t("./line")}},{"./area":25,"./bounds":26,"./line":28,"./parse":29,"./render":30}],28:[function(t,e,n){var r=t("../util/svg").path.line;e.exports=function(t){var e=t[0];return r.interpolate(e.interpolate||"linear").tension(e.tension||.7)(t)}},{"../util/svg":73}],29:[function(t,e,n){var r={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},i=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/];e.exports=function(t){var e,n,a,s,o,l,u,c,d,h,f,p=[];for(e=t.slice().replace(i[0],"###$1").split(i[1]).slice(1),c=0,h=e.length;h>c;++c){for(n=e[c],a=n.slice(1).trim().replace(i[2],"$1###-").split(i[3]),l=n.charAt(0),s=[l],d=0,f=a.length;f>d;++d)(o=+a[d])===o&&s.push(o);if(u=r[l.toLowerCase()],s.length-1>u)for(d=1,f=s.length;f>d;d+=u)p.push([l].concat(s.slice(d,d+u)));else p.push(s)}return p}},{}],30:[function(t,e,n){function r(t,e,n,r){for(var a=i.segments(r[5],r[6],r[0],r[1],r[3],r[4],r[2],e,n),s=0;s<a.length;++s){var o=i.bezier(a[s]);t.bezierCurveTo.apply(t,o)}}var i=t("./arc");e.exports=function(t,e,n,i){var a,s,o,l,u,c=null,d=0,h=0,f=0,p=0;null==n&&(n=0),null==i&&(i=0),t.beginPath();for(var g=0,m=e.length;m>g;++g){switch(a=e[g],a[0]){case"l":d+=a[1],h+=a[2],t.lineTo(d+n,h+i);break;case"L":d=a[1],h=a[2],t.lineTo(d+n,h+i);break;case"h":d+=a[1],t.lineTo(d+n,h+i);break;case"H":d=a[1],t.lineTo(d+n,h+i);break;case"v":h+=a[1],t.lineTo(d+n,h+i);break;case"V":h=a[1],t.lineTo(d+n,h+i);break;case"m":d+=a[1],h+=a[2],t.moveTo(d+n,h+i);break;case"M":d=a[1],h=a[2],t.moveTo(d+n,h+i);break;case"c":s=d+a[5],o=h+a[6],f=d+a[3],p=h+a[4],t.bezierCurveTo(d+a[1]+n,h+a[2]+i,f+n,p+i,s+n,o+i),d=s,h=o;break;case"C":d=a[5],h=a[6],f=a[3],p=a[4],t.bezierCurveTo(a[1]+n,a[2]+i,f+n,p+i,d+n,h+i);break;case"s":s=d+a[3],o=h+a[4],f=2*d-f,p=2*h-p,t.bezierCurveTo(f+n,p+i,d+a[1]+n,h+a[2]+i,s+n,o+i),f=d+a[1],p=h+a[2],d=s,h=o;break;case"S":s=a[3],o=a[4],f=2*d-f,p=2*h-p,t.bezierCurveTo(f+n,p+i,a[1]+n,a[2]+i,s+n,o+i),d=s,h=o,f=a[1],p=a[2];break;case"q":s=d+a[3],o=h+a[4],f=d+a[1],p=h+a[2],t.quadraticCurveTo(f+n,p+i,s+n,o+i),d=s,h=o;break;case"Q":s=a[3],o=a[4],t.quadraticCurveTo(a[1]+n,a[2]+i,s+n,o+i),d=s,h=o,f=a[1],p=a[2];break;case"t":s=d+a[1],o=h+a[2],null===c[0].match(/[QqTt]/)?(f=d,p=h):"t"===c[0]?(f=2*d-l,p=2*h-u):"q"===c[0]&&(f=2*d-f,p=2*h-p),l=f,u=p,t.quadraticCurveTo(f+n,p+i,s+n,o+i),d=s,h=o,f=d+a[1],p=h+a[2];break;case"T":s=a[1],o=a[2],f=2*d-f,p=2*h-p,t.quadraticCurveTo(f+n,p+i,s+n,o+i),d=s,h=o;break;case"a":r(t,d+n,h+i,[a[1],a[2],a[3],a[4],a[5],a[6]+d+n,a[7]+h+i]),d+=a[6],h+=a[7];break;case"A":r(t,d+n,h+i,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+i]),d=a[6],h=a[7];break;case"z":case"Z":t.closePath()}c=a}}},{"./arc":24}],31:[function(t,e,n){function r(){this._active=null,this._handlers={}}var i=r.prototype;i.initialize=function(t,e,n){return this._el=t,this._obj=n||null,this.padding(e)},i.element=function(){return this._el},i.padding=function(t){return this._padding=t||{top:0,left:0,bottom:0,right:0},this},i.on=function(){},i.off=function(){},i.handlers=function(){var t,e=this._handlers,n=[];for(t in e)n.push.apply(n,e[t]);return n},i.eventName=function(t){var e=t.indexOf(".");return 0>e?t:t.slice(0,e)},e.exports=r},{}],32:[function(t,e,n){function r(){this._el=null,this._bgcolor=null}var i=r.prototype;i.initialize=function(t,e,n,r){return this._el=t,this.resize(e,n,r)},i.element=function(){return this._el},i.background=function(t){return 0===arguments.length?this._bgcolor:(this._bgcolor=t,this)},i.resize=function(t,e,n){return this._width=t,this._height=e,this._padding=n||{top:0,left:0,bottom:0,right:0},this},i.render=function(){return this},e.exports=r},{}],33:[function(t,e,n){function r(){a.call(this),this._down=null}var i=t("../../util/dom"),a=t("../Handler"),s=t("./marks"),o=a.prototype,l=r.prototype=Object.create(o);l.constructor=r,l.initialize=function(t,e,n){var r=this._canvas=i.find(t,"canvas"),a=this;return this.events.forEach(function(t){r.addEventListener(t,function(e){l[t]?l[t].call(a,e):a.fire(t,e)})}),o.initialize.call(this,t,e,n)},l.canvas=function(){return this._canvas},l.scene=function(t){return arguments.length?(this._scene=t,this):this._scene},l.events=["keydown","keypress","keyup","mousedown","mouseup","mousemove","mouseout","click","dblclick","wheel","mousewheel","touchstart","touchmove","touchend"],l.mousemove=function(t){var e=this._padding,n=t.target.getBoundingClientRect(),r=t.clientX-n.left,i=t.clientY-n.top,a=this._active,s=this.pick(this._scene,r,i,r-e.left,i-e.top);return s===a?(this.fire("mousemove",t),void("touchmove"===t.type&&this.fire("touchmove",t))):(a&&(this.fire("mouseout",t),"touchend"===t.type&&this.fire("touchend",t)),this._active=s,void(s&&(this.fire("mouseover",t),"touchstart"===t.type&&this.fire("touchstart",t))))},l.mouseout=function(t){this._active&&(this.fire("mouseout",t),this.fire("touchend",t)),this._active=null},l.mousedown=function(t){this._down=this._active,this.fire("mousedown",t)},l.click=function(t){this._down===this._active&&(this.fire("click",t),this._down=null)},l.DOMMouseScroll=function(t){this.fire("mousewheel",t)},l.touchmove=l.mousemove,l.touchend=l.mouseout,l.fire=function(t,e){var n,r,i=this._active,a=this._handlers[t];if(a)for(n=0,r=a.length;r>n;++n)a[n].handler.call(this._obj,e,i)},l.on=function(t,e){var n=this.eventName(t),r=this._handlers;return(r[n]||(r[n]=[])).push({type:t,handler:e}),this},l.off=function(t,e){var n,r=this.eventName(t),i=this._handlers[r];if(i){for(n=i.length;--n>=0;)i[n].type===t&&(e&&i[n].handler!==e||i.splice(n,1));return this}},l.context=function(){return this._canvas.getContext("2d")},l.pick=function(t,e,n,r,i){var a=this.context(),o=s[t.marktype];return o.pick.call(this,a,t,e,n,r,i)},e.exports=r},{"../../util/dom":71,"../Handler":31,"./marks":40}],34:[function(t,e,n){function r(t){c.call(this),this._loader=new l(t)}function i(t,e){if(!e)return null;var n,r,i,s,l=new o;for(n=0,r=e.length;r>n;++n)s=e[n],i=s.mark,s=d[i.marktype].nested?i.items[0]:s,l.union(a(s.bounds,s)).union(a(s["bounds:prev"],s));return l.round(),t.beginPath(),t.rect(l.x1,l.y1,l.width(),l.height()),t.clip(),l}function a(t,e){for(var n=t.clone();null!=(e=e.mark.group);)n.translate(e.x||0,e.y||0);return n}var s=t("../../util/dom"),o=t("../../util/Bounds"),l=t("../../util/ImageLoader"),u=t("../../util/canvas"),c=t("../Renderer"),d=t("./marks"),h=c.prototype,f=r.prototype=Object.create(h);f.constructor=r,f.initialize=function(t,e,n,r){return this._canvas=u.instance(e,n),t&&(s.clear(t,0).appendChild(this._canvas),this._canvas.setAttribute("class","marks")),h.initialize.call(this,t,e,n,r)},f.resize=function(t,e,n){return h.resize.call(this,t,e,n),u.resize(this._canvas,this._width,this._height,this._padding),this},f.canvas=function(){return this._canvas},f.context=function(){return this._canvas?this._canvas.getContext("2d"):null},f.pendingImages=function(){return this._loader.pending()},f.render=function(t,e){var n,r=this.context(),a=this._padding,s=this._width+a.left+a.right,o=this._height+a.top+a.bottom;return this._scene=t,r.save(),n=i(r,e),this.clear(-a.left,-a.top,s,o),this.draw(r,t,n),r.restore(),this._scene=null,this},f.draw=function(t,e,n){var r=d[e.marktype];r.draw.call(this,t,e,n)},f.clear=function(t,e,n,r){var i=this.context();i.clearRect(t,e,n,r),null!=this._bgcolor&&(i.fillStyle=this._bgcolor,i.fillRect(t,e,n,r))},f.loadImage=function(t){var e=this,n=this._scene;return this._loader.loadImage(t,function(){e.renderAsync(n)})},f.renderAsync=function(t){var e=this;e._async_id&&clearTimeout(e._async_id),e._async_id=setTimeout(function(){e.render(t),delete e._async_id},10)},e.exports=r},{"../../util/Bounds":65,"../../util/ImageLoader":67,"../../util/canvas":70,"../../util/dom":71,"../Renderer":32,"./marks":40}],35:[function(t,e,n){e.exports={Handler:t("./CanvasHandler"),Renderer:t("./CanvasRenderer")}},{"./CanvasHandler":33,"./CanvasRenderer":34}],36:[function(t,e,n){function r(t,e){var n=e.x||0,r=e.y||0,i=e.innerRadius||0,a=e.outerRadius||0,o=(e.startAngle||0)-s,l=(e.endAngle||0)-s;t.beginPath(),0===i?t.moveTo(n,r):t.arc(n,r,i,o,l,0),t.arc(n,r,a,l,o,1),t.closePath()}function i(t,e,n,i){return r(t,e),t.isPointInPath(n,i)}var a=t("./util"),s=Math.PI/2;e.exports={draw:a.drawAll(r),pick:a.pick(i)}},{"./util":47}],37:[function(t,e,n){function r(t,e){var n=e[0],r=n.pathCache||(n.pathCache=o(u(e)));l(t,r)}function i(t,e,n,r,i,s){if(!e.items||!e.items.length)return!1;var o=e.items,l=o[0].bounds;return l&&!l.contains(i,s)?!1:(null!=t.pixelratio&&1!==t.pixelratio&&(n*=t.pixelratio,r*=t.pixelratio),a(t,o,n,r)?o[0]:!1)}function a(t,e,n,i){return r(t,e),t.isPointInPath(n,i)}var s=t("./util"),o=t("../../../path/parse"),l=t("../../../path/render"),u=t("../../../path/area");e.exports={draw:s.drawOne(r),pick:i,nested:!0}},{"../../../path/area":25,"../../../path/parse":29,"../../../path/render":30,"./util":47}],38:[function(t,e,n){function r(t,e,n){if(e.items&&e.items.length){var r,i,a,s,l,u,c,d,h,f,p=e.items,g=this;for(o.draw.call(g,t,e,n),c=0,d=p.length;d>c;++c){for(r=p[c],a=r.axisItems||[],i=r.items||[],s=r.legendItems||[],l=r.x||0,u=r.y||0,t.save(),t.translate(l,u),r.clip&&(t.beginPath(),t.rect(0,0,r.width||0,r.height||0),t.clip()),n&&n.translate(-l,-u),h=0,f=a.length;f>h;++h)"back"===a[h].layer&&g.draw(t,a[h],n);for(h=0,f=i.length;f>h;++h)g.draw(t,i[h],n);for(h=0,f=a.length;f>h;++h)"back"!==a[h].layer&&g.draw(t,a[h],n);for(h=0,f=s.length;f>h;++h)g.draw(t,s[h],n);n&&n.translate(l,u),t.restore()}}}function i(t,e){return e.fill||e.stroke}function a(t,e,n,r,i,a){if(e.bounds&&!e.bounds.contains(i,a))return!1;var s,o,u,c,d,h,f,p=e.items||[];for(h=p.length;--h>=0;){for(o=p[h],c=o.x||0,d=o.y||0,t.save(),t.translate(c,d),f=o.items.length;--f>=0;)if(s=o.items[f],s.interactive!==!1&&(u=this.pick(s,n,r,i-c,a-d)))return t.restore(),u;t.restore()}return e.interactive!==!1?l(t,e,n,r,i,a):!1}var s=t("./util"),o=t("./rect"),l=s.pick(i);e.exports={draw:r,pick:a}},{"./rect":43,"./util":47}],39:[function(t,e,n){function r(t,e,n){if(e.items&&e.items.length)for(var r,i=this,a=e.items,s=0,o=a.length;o>s;++s)if(r=a[s],!n||n.intersects(r.bounds)){r.image&&r.image.url===r.url||(r.image=i.loadImage(r.url),r.image.url=r.url);var l,u=r.x||0,c=r.y||0,d=r.width||r.image&&r.image.width||0,h=r.height||r.image&&r.image.height||0;u-="center"===r.align?d/2:"right"===r.align?d:0,c-="middle"===r.baseline?h/2:"bottom"===r.baseline?h:0,r.image.loaded&&(t.globalAlpha=null!=(l=r.opacity)?l:1,t.drawImage(r.image,u,c,d,h))}}var i=t("./util");e.exports={draw:r,pick:i.pick()}},{"./util":47}],40:[function(t,e,n){e.exports={arc:t("./arc"),area:t("./area"),group:t("./group"),image:t("./image"),line:t("./line"),path:t("./path"),rect:t("./rect"),rule:t("./rule"),symbol:t("./symbol"),text:t("./text")}},{"./arc":36,"./area":37,"./group":38,"./image":39,"./line":41,"./path":42,"./rect":43,"./rule":44,"./symbol":45,"./text":46}],41:[function(t,e,n){function r(t,e){var n=e[0],r=n.pathCache||(n.pathCache=l(c(e)));u(t,r)}function i(t,e){var n=e[0],i=n.strokeWidth,a=n.strokeCap;t.lineWidth=null!=i?i:1,t.lineCap=null!=a?a:"butt",r(t,e)}function a(t,e,n,r,i,a){if(!e.items||!e.items.length)return!1;var o=e.items,l=o[0].bounds;return l&&!l.contains(i,a)?!1:(null!=t.pixelratio&&1!==t.pixelratio&&(n*=t.pixelratio,r*=t.pixelratio),s(t,o,n,r)?o[0]:!1)}function s(t,e,n,r){return t.isPointInStroke?(i(t,e),t.isPointInStroke(n,r)):!1}var o=t("./util"),l=t("../../../path/parse"),u=t("../../../path/render"),c=t("../../../path/line");e.exports={draw:o.drawOne(r),pick:a,nested:!0}},{"../../../path/line":28,"../../../path/parse":29,"../../../path/render":30,"./util":47}],42:[function(t,e,n){function r(t,e){if(null==e.path)return!0;var n=e.pathCache||(e.pathCache=s(e.path));o(t,n,e.x,e.y)}function i(t,e,n,i){return r(t,e)?!1:t.isPointInPath(n,i)}var a=t("./util"),s=t("../../../path/parse"),o=t("../../../path/render");e.exports={draw:a.drawAll(r),pick:a.pick(i)}},{"../../../path/parse":29,"../../../path/render":30,"./util":47}],43:[function(t,e,n){function r(t,e,n){if(e.items&&e.items.length)for(var r,a,s,o,l,u,c,d,h,f,p=e.items,g=0,m=p.length;m>g;++g)r=p[g],(!n||n.intersects(r.bounds))&&(c=r.x||0,d=r.y||0,h=r.width||0,f=r.height||0,o=null==r.opacity?1:r.opacity,0!==o&&((a=r.fill)&&(t.globalAlpha=o*(null==r.fillOpacity?1:r.fillOpacity),t.fillStyle=i.color(t,r,a),t.fillRect(c,d,h,f)),(s=r.stroke)&&(u=null!=(u=r.strokeWidth)?u:1,u>0&&(t.globalAlpha=o*(null==r.strokeOpacity?1:r.strokeOpacity),t.strokeStyle=i.color(t,r,s),t.lineWidth=u,t.lineCap=null!=(l=r.strokeCap)?l:"butt",t.vgLineDash(r.strokeDash||null),t.vgLineDashOffset(r.strokeDashOffset||0),t.strokeRect(c,d,h,f)))))}var i=t("./util");e.exports={draw:r,pick:i.pick()}},{"./util":47}],44:[function(t,e,n){function r(t,e,n){if(e.items&&e.items.length)for(var r,i,a,o,l,u,c,d,h,f=e.items,p=0,g=f.length;g>p;++p)r=f[p],(!n||n.intersects(r.bounds))&&(u=r.x||0,c=r.y||0,d=null!=r.x2?r.x2:u,h=null!=r.y2?r.y2:c,a=null==r.opacity?1:r.opacity,0!==a&&(i=r.stroke)&&(l=null!=(l=r.strokeWidth)?l:1,l>0&&(t.globalAlpha=a*(null==r.strokeOpacity?1:r.strokeOpacity),t.strokeStyle=s.color(t,r,i),t.lineWidth=l,t.lineCap=null!=(o=r.strokeCap)?o:"butt",t.vgLineDash(r.strokeDash||null),t.vgLineDashOffset(r.strokeDashOffset||0),t.beginPath(),t.moveTo(u,c),t.lineTo(d,h),t.stroke())))}function i(t,e){var n=e.x||0,r=e.y||0,i=null!=e.x2?e.x2:n,a=null!=e.y2?e.y2:r,s=e.strokeWidth,o=e.strokeCap;t.lineWidth=null!=s?s:1,t.lineCap=null!=o?o:"butt",t.beginPath(),t.moveTo(n,r),t.lineTo(i,a)}function a(t,e,n,r){return t.isPointInStroke?(i(t,e),t.isPointInStroke(n,r)):!1}var s=t("./util");e.exports={draw:r,pick:s.pick(a)}},{"./util":47}],45:[function(t,e,n){function r(t,e){var n,r,i,a,l=null!=e.size?e.size:100,u=e.x,c=e.y;if(t.beginPath(),null==e.shape||"circle"===e.shape)return n=Math.sqrt(l/Math.PI),t.arc(u,c,n,0,2*Math.PI,0),void t.closePath();switch(e.shape){case"cross":n=Math.sqrt(l/5)/2,r=3*n,t.moveTo(u-r,c-n),t.lineTo(u-n,c-n),t.lineTo(u-n,c-r),t.lineTo(u+n,c-r),t.lineTo(u+n,c-n),t.lineTo(u+r,c-n),t.lineTo(u+r,c+n),t.lineTo(u+n,c+n),t.lineTo(u+n,c+r),t.lineTo(u-n,c+r),t.lineTo(u-n,c+n),t.lineTo(u-r,c+n);break;case"diamond":a=Math.sqrt(l/(2*o)),i=a*o,t.moveTo(u,c-a),t.lineTo(u+i,c),t.lineTo(u,c+a),t.lineTo(u-i,c);break;case"square":r=Math.sqrt(l),n=r/2,t.rect(u-n,c-n,r,r);break;case"triangle-down":i=Math.sqrt(l/s),a=i*s/2,t.moveTo(u,c+a),t.lineTo(u+i,c-a),t.lineTo(u-i,c-a);break;case"triangle-up":i=Math.sqrt(l/s),a=i*s/2,t.moveTo(u,c-a),t.lineTo(u+i,c+a),t.lineTo(u-i,c+a)}t.closePath()}function i(t,e,n,i){return r(t,e),t.isPointInPath(n,i)}var a=t("./util"),s=Math.sqrt(3),o=Math.tan(30*Math.PI/180);e.exports={draw:a.drawAll(r),pick:a.pick(i)}},{"./util":47}],46:[function(t,e,n){function r(t,e,n){if(e.items&&e.items.length)for(var r,i,a,s,u,c,d,h,f,p=e.items,g=0,m=p.length;m>g;++g)r=p[g],(!n||n.intersects(r.bounds))&&(t.font=o.string(r),t.textAlign=r.align||"left",s=null==r.opacity?1:r.opacity,0!==s&&(c=r.x||0,d=r.y||0,(h=r.radius)&&(f=(r.theta||0)-Math.PI/2,c+=h*Math.cos(f),d+=h*Math.sin(f)),r.angle?(t.save(),t.translate(c,d),t.rotate(r.angle*Math.PI/180),c=r.dx||0,d=r.dy||0+o.offset(r)):(c+=r.dx||0,d+=(r.dy||0)+o.offset(r)),(i=r.fill)&&(t.globalAlpha=s*(null==r.fillOpacity?1:r.fillOpacity),t.fillStyle=l.color(t,r,i),t.fillText(r.text,c,d)),(a=r.stroke)&&(u=null!=(u=r.strokeWidth)?u:1,u>0&&(t.globalAlpha=s*(null==r.strokeOpacity?1:r.strokeOpacity),t.strokeStyle=l.color(t,r,a),t.lineWidth=u,t.strokeText(r.text,c,d))),r.angle&&t.restore()))}function i(t,e,n,r,i,a){if(e.fontSize<=0)return!1;if(!e.angle)return!0;var o=s(e,u,!0),l=-e.angle*Math.PI/180,c=Math.cos(l),d=Math.sin(l),h=e.x,f=e.y,p=c*i-d*a+(h-h*c+f*d),g=d*i+c*a+(f-h*d-f*c);return o.contains(p,g)}var a=t("../../../util/Bounds"),s=t("../../../util/bound").text,o=t("../../../util/font"),l=t("./util"),u=new a;e.exports={draw:r,pick:l.pick(i)}},{"../../../util/Bounds":65,"../../../util/bound":69,"../../../util/font":72,"./util":47}],47:[function(t,e,n){function r(t,e,n,r){var i,a,s,o=n.fill,u=n.stroke;t(e,r)||(i=null==n.opacity?1:n.opacity,0!==i&&(o||u)&&(o&&(e.globalAlpha=i*(null==n.fillOpacity?1:n.fillOpacity),e.fillStyle=l(e,n,o),e.fill()),u&&(s=null!=(s=n.strokeWidth)?s:1,s>0&&(e.globalAlpha=i*(null==n.strokeOpacity?1:n.strokeOpacity),e.strokeStyle=l(e,n,u),e.lineWidth=s,e.lineCap=null!=(a=n.strokeCap)?a:"butt",e.vgLineDash(n.strokeDash||null),e.vgLineDashOffset(n.strokeDashOffset||0),e.stroke()))))}function i(t,e,n,i){var a,s,o;for(a=0,s=n.items.length;s>a;++a)o=n.items[a],(!i||i.intersects(o.bounds))&&r(t,e,o,o)}function a(t){return function(e,n,r){i(t,e,n,r)}}function s(t){return function(e,n,i){n.items.length&&(!i||i.intersects(n.items[0].bounds))&&r(t,e,n.items[0],n.items)}}function o(t){return t||(t=function(){return!0}),function(e,n,r,i,a,s){if(!n.items.length)return!1;var o,l,u;for(null!=e.pixelratio&&1!==e.pixelratio&&(r*=e.pixelratio,i*=e.pixelratio),u=n.items.length;--u>=0;)if(o=n.items[u],l=o.bounds,(!l||l.contains(a,s))&&l&&t(e,o,r,i,a,s))return o;return!1}}function l(t,e,n){return n.id?u(t,n,e.bounds):n}function u(t,e,n){var r,i,a=n.width(),s=n.height(),o=n.x1+e.x1*a,l=n.y1+e.y1*s,u=n.x1+e.x2*a,c=n.y1+e.y2*s,d=t.createLinearGradient(o,l,u,c),h=e.stops;for(r=0,i=h.length;i>r;++r)d.addColorStop(h[r].offset,h[r].color);return d}e.exports={drawOne:s,drawAll:a,pick:o,color:l,gradient:u}},{}],48:[function(t,e,n){function r(t){v.call(this),this._loader=new y(t),this._text={head:"",root:"",foot:"",defs:"",body:""},this._defs={clip_id:1,gradient:{},clipping:{}}}function i(t,e,n,r){var i,a,s,o,l,u=Array.isArray(t)?t[0]:t;if(null==u)return"";var c="";for("bgrect"===n&&e.interactive===!1&&(c+="pointer-events: none;"),"text"===n&&(c+="font: "+w.string(u)+";"),i=0,a=_.styleProperties.length;a>i;++i)s=_.styleProperties[i],o=_.styles[s],l=u[s],null==l?"fill"===o&&(c+=(c.length?" ":"")+"fill: none;"):(l.id&&(r.gradient[l.id]=l,l="url(#"+l.id+")"),c+=(c.length?" ":"")+o+": "+l+";");return c?'style="'+c+'"':null}function a(t){return t=null==t?"":String(t),t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(t,e){return E("rect",{"class":"background",width:t.width||0,height:t.height||0},e)+L("rect")}function o(t,e){var n,r,i=t.x||0,a=t.y||0,s={transform:"translate("+i+","+a+")"};return t.clip&&(n=t.clip_id||(t.clip_id="clip"+e._defs.clip_id++),r={width:t.width||0,height:t.height||0},e._defs.clipping[n]=r,s["clip-path"]="url(#"+n+")"),s}function l(t){return{transform:"translate("+(t.x||0)+","+(t.y||0)+")",d:_.path.arc(t)}}function u(t){return t.length?{d:x(t)}:null}function c(t){return t.length?{d:b(t)}:null}function d(t){return{transform:"translate("+(t.x||0)+","+(t.y||0)+")",d:t.path}}function h(t){return{x:t.x||0,y:t.y||0,width:t.width||0,height:t.height||0}}function f(t){var e=t.x||0,n=t.y||0;return{x1:e,y1:n,x2:null!=t.x2?t.x2:e,y2:null!=t.y2?t.y2:n}}function p(t){return{transform:"translate("+(t.x||0)+","+(t.y||0)+")",d:_.path.symbol(t)}}function g(t,e){var n=t.x||0,r=t.y||0,i=t.width||0,a=t.height||0,s=e._loader.imageURL(t.url);return n-="center"===t.align?i/2:"right"===t.align?i:0,r-="middle"===t.baseline?a/2:"bottom"===t.baseline?a:0,{"xlink:href":s,x:n,y:r,width:i,height:a}}function m(t){var e=t.x||0,n=t.y||0,r=t.angle||0,i=t.radius||0,a=_.textAlign[t.align]||"start";if(i){var s=(t.theta||0)-Math.PI/2;e+=i*Math.cos(s),n+=i*Math.sin(s)}return{x:e+(t.dx||0),y:n+(t.dy||0)+w.offset(t),"text-anchor":a,transform:r?"rotate("+r+" "+e+","+n+")":null}}var v=t("../Renderer"),y=t("../../util/ImageLoader"),_=t("../../util/svg"),x=t("../../path/area"),b=t("../../path/line"),w=t("../../util/font"),k=t("../../util/dom"),E=k.openTag,L=k.closeTag,A=v.prototype,S=r.prototype=Object.create(A);S.constructor=r,S.resize=function(t,e,n){A.resize.call(this,t,e,n);var r=this._padding,i=this._text,a={"class":"marks",width:this._width+r.left+r.right,height:this._height+r.top+r.bottom};for(var s in _.metadata)a[s]=_.metadata[s];return i.head=E("svg",a),i.root=E("g",{transform:"translate("+r.left+","+r.top+")"}),i.foot=L("g")+L("svg"),this},S.svg=function(){var t=this._text;return t.head+t.defs+t.root+t.body+t.foot},S.render=function(t){return this._text.body=this.mark(t),this._text.defs=this.buildDefs(),this},S.reset=function(){return this._defs.clip_id=0,this},S.buildDefs=function(){var t,e,n,r,i=this._defs,a="";for(e in i.gradient){for(n=i.gradient[e],r=n.stops,a+=E("linearGradient",{id:e,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),t=0;t<r.length;++t)a+=E("stop",{offset:r[t].offset,"stop-color":r[t].color})+L("stop");a+=L("linearGradient")}for(e in i.clipping)n=i.clipping[e],a+=E("clipPath",{id:e}),a+=E("rect",{x:0,y:0,width:n.width,height:n.height})+L("rect"),a+=L("clipPath");return a.length>0?E("defs")+a+L("defs"):""},S.mark=function(t){var e=M[t.marktype];if(!e)return null;var n,r,o=e[0],l=e[1],u=e[2]||!1,c=u?[t.items]:t.items||[],d=this._defs,h="";for("g"!==o&&t.interactive===!1&&(n='style="pointer-events: none;"'),h+=E("g",{"class":k.cssClass(t)},n),r=0;r<c.length;++r)n="g"===o?null:i(c[r],t,o,d),h+=E(o,l(c[r],this),n),"text"===o?h+=a(c[r].text):"g"===o&&(h+=s(c[r],i(c[r],t,"bgrect",d)),h+=this.markGroup(c[r])),h+=L(o);return h+L("g")},S.markGroup=function(t){var e,n,r="",i=t.axisItems||[],a=t.items||[],s=t.legendItems||[];for(e=0,n=i.length;n>e;++e)"back"===i[e].layer&&(r+=this.mark(i[e]));for(e=0,n=a.length;n>e;++e)r+=this.mark(a[e]);for(e=0,n=i.length;n>e;++e)"back"!==i[e].layer&&(r+=this.mark(i[e]));for(e=0,n=s.length;n>e;++e)r+=this.mark(s[e]);return r};var M={group:["g",o],area:["path",u,!0],line:["path",c,!0],arc:["path",l],path:["path",d],symbol:["path",p],rect:["rect",h],rule:["line",f],text:["text",m],image:["image",g]};e.exports=r},{"../../path/area":25,"../../path/line":28,"../../util/ImageLoader":67,"../../util/dom":71,"../../util/font":72,"../../util/svg":73,"../Renderer":32}],49:[function(t,e,n){e.exports={Renderer:t("./SVGStringRenderer")}},{"./SVGStringRenderer":48}],50:[function(t,e,n){function r(){a.call(this)}var i=t("../../util/dom"),a=t("../Handler"),s=a.prototype,o=r.prototype=Object.create(s);o.constructor=r,o.initialize=function(t,e,n){return this._svg=i.find(t,"svg"),s.initialize.call(this,t,e,n)},o.svg=function(){return this._svg},o.listener=function(t){var e=this;return function(n){var r=n.target,i=r.__data__;i=Array.isArray(i)?i[0]:i,t.call(e._obj,n,i)}},o.on=function(t,e){var n=this.eventName(t),r=this._svg,i=this._handlers,a={type:t,handler:e,listener:this.listener(e)};return(i[n]||(i[n]=[])).push(a),r.addEventListener(n,a.listener),this},o.off=function(t,e){var n,r=this.eventName(t),i=this._svg,a=this._handlers[r];if(a){for(n=a.length;--n>=0;)(a[n].type===t&&!e||a[n].handler===e)&&(i.removeEventListener(r,a[n].listener),a.splice(n,1));return this}},e.exports=r},{"../../util/dom":71,"../Handler":31}],51:[function(t,e,n){function r(t){h.call(this),this._loader=new l(t)}function i(t,e,n){var r,i,a;for(e.el||(e.el=s.child(t,n,"linearGradient",u),e.el.setAttribute("id",e.id)),e.el.setAttribute("x1",e.x1),e.el.setAttribute("x2",e.x2),e.el.setAttribute("y1",e.y1),e.el.setAttribute("y2",e.y2),r=0,i=e.stops.length;i>r;++r)a=s.child(e.el,r,"stop",u),a.setAttribute("offset",e.stops[r].offset),a.setAttribute("stop-color",e.stops[r].color);s.clear(e.el,r)}function a(t,e,n){var r;e.el||(e.el=s.child(t,n,"clipPath",u),e.el.setAttribute("id",e.id),r=s.child(e.el,0,"rect",u),r.setAttribute("x",0),r.setAttribute("y",0)),r=r||e.el.childNodes[0],r.setAttribute("width",e.width),r.setAttribute("height",e.height)}var s=t("../../util/dom"),o=t("../../util/svg"),l=t("../../util/ImageLoader"),u=o.metadata.xmlns,c=t("./marks"),d=t("./marks/util").bind,h=t("../Renderer"),f="undefined"!=typeof window?window.location.href:"",p=h.prototype,g=r.prototype=Object.create(p);

g.constructor=r,g.initialize=function(t,e,n,r){return t&&(this._svg=s.child(t,0,"svg",u,"marks"),s.clear(t,1),this._root=s.child(this._svg,0,"g",u),s.clear(this._svg,1)),this._defs={clip_id:1,gradient:{},clipping:{}},this.background(this._bgcolor),p.initialize.call(this,t,e,n,r)},g.background=function(t){return arguments.length&&this._svg&&this._svg.style.setProperty("background-color",t),p.background.apply(this,arguments)},g.resize=function(t,e,n){if(p.resize.call(this,t,e,n),this._svg){var r=this._width,i=this._height,a=this._padding;this._svg.setAttribute("width",r+a.left+a.right),this._svg.setAttribute("height",i+a.top+a.bottom),this._root.setAttribute("transform","translate("+a.left+","+a.top+")")}return this},g.svg=function(){if(!this._svg)return null;var t={"class":"marks",width:this._width+this._padding.left+this._padding.right,height:this._height+this._padding.top+this._padding.bottom};for(var e in o.metadata)t[e]=o.metadata[e];return s.openTag("svg",t)+this._svg.innerHTML+s.closeTag("svg")},g.updateDefs=function(){var t,e=this._svg,n=this._defs,r=n.el,o=0;for(t in n.gradient)r||(r=n.el=s.child(e,0,"defs",u)),i(r,n.gradient[t],o++);for(t in n.clipping)r||(r=n.el=s.child(e,0,"defs",u)),a(r,n.clipping[t],o++);r&&(0===o?(e.removeChild(r),n.el=null):s.clear(r,o))},g.render=function(t,e){return e?this.update(e):(this._defs.gradient={},this.draw(this._root,t,-1),s.clear(this._root,1)),this.updateDefs(),this},g.update=function(t){var e,n,r,i,a,s;for(a=0,s=t.length;s>a;++a){if(e=t[a],n=c[e.mark.marktype],e=n.nested?e.mark.items:e,i=(n.nested?e[0]:e)._svg,r=e.mark,!i)for(;r;){if(r._svg){n=c[r.marktype],i=d(r._svg,n,e,r.items.length);break}if(e=r.group,e._svg)return void this.draw(e._svg,r,e.items.length);r=e.mark}n.update.call(this,i,e),this.style(i,e),n.recurse&&n.recurse.call(this,i,e)}},g.draw=function(t,e,n){var r=c[e.marktype];r.draw.call(this,t,e,n)},g.style=function(t,e){var n,r,i,a,s,l=Array.isArray(e)?e[0]:e;if(null!=l)for("group"===l.mark.marktype&&(t=t.childNodes[0],s=l.mark.interactive===!1?"none":null,t.style.setProperty("pointer-events",s)),n=0,r=o.styleProperties.length;r>n;++n)i=o.styleProperties[n],a=o.styles[i],s=l[i],null==s?"fill"===a?t.style.setProperty(a,"none",null):t.style.removeProperty(a):(s.id&&(this._defs.gradient[s.id]=s,s="url("+f+"#"+s.id+")"),t.style.setProperty(a,s+"",null))},e.exports=r},{"../../util/ImageLoader":67,"../../util/dom":71,"../../util/svg":73,"../Renderer":32,"./marks":57,"./marks/util":64}],52:[function(t,e,n){e.exports={Handler:t("./SVGHandler"),Renderer:t("./SVGRenderer")}},{"./SVGHandler":50,"./SVGRenderer":51}],53:[function(t,e,n){var r=t("../../../util/svg").path.arc;e.exports={tag:"path",update:function(t,e){var n=e.x||0,i=e.y||0;t.setAttribute("transform","translate("+n+","+i+")"),t.setAttribute("d",r(e))}}},{"../../../util/svg":73}],54:[function(t,e,n){var r=t("../../../path/area");e.exports={tag:"path",nested:!0,update:function(t,e){e.length&&t.setAttribute("d",r(e))}}},{"../../../path/area":25}],55:[function(t,e,n){function r(t,e,n){for(var r=o.call(this,t,e,n,l),a=0,s=e.items.length;s>a;++a)i.call(this,r.childNodes[a],e.items[a])}function i(t,e){var n,i,a=e.items||[],o=e.legendItems||[],l=e.axisItems||[],u=0;for(n=0,i=l.length;i>n;++n)"back"===l[n].layer&&r.call(this,t,l[n],u++);for(n=0,i=a.length;i>n;++n)this.draw(t,a[n],u++);for(n=0,i=l.length;i>n;++n)"back"!==l[n].layer&&r.call(this,t,l[n],u++);for(n=0,i=o.length;i>n;++n)r.call(this,t,o[n],u++);s.clear(t,1+u)}function a(t,e){var n,r,i,a=e.width||0,s=e.height||0,o="clip-path";t.setAttribute("transform","translate("+(e.x||0)+","+(e.y||0)+")"),e.clip?(n=e.clip_id||(e.clip_id="clip"+this._defs.clip_id++),r=this._defs.clipping[n]||(this._defs.clipping[n]={id:n}),r.width=a,r.height=s,t.setAttribute(o,"url(#"+n+")")):t.hasAttribute(o)&&(n=t.getAttribute(o).slice(5,-1),delete this._defs.clipping[n],t.removeAttribute(o)),i=t.childNodes[0],i.setAttribute("width",a),i.setAttribute("height",s)}var s=t("../../../util/dom"),o=t("./util").draw,l=e.exports={tag:"g",recurse:i,update:a,draw:r}},{"../../../util/dom":71,"./util":64}],56:[function(t,e,n){e.exports={tag:"image",update:function(t,e){var n=e.x||0,r=e.y||0,i=e.width||0,a=e.height||0,s=this._loader.imageURL(e.url);n-="center"===e.align?i/2:"right"===e.align?i:0,r-="middle"===e.baseline?a/2:"bottom"===e.baseline?a:0,s&&t.setAttributeNS("http://www.w3.org/1999/xlink","href",s),t.setAttribute("x",n),t.setAttribute("y",r),t.setAttribute("width",i),t.setAttribute("height",a)}}},{}],57:[function(t,e,n){function r(t){return t.draw=function(e,n,r){i.call(this,e,n,r,t)},t}var i=t("./util").draw;e.exports={arc:r(t("./arc")),area:r(t("./area")),group:t("./group"),image:r(t("./image")),line:r(t("./line")),path:r(t("./path")),rect:r(t("./rect")),rule:r(t("./rule")),symbol:r(t("./symbol")),text:r(t("./text"))}},{"./arc":53,"./area":54,"./group":55,"./image":56,"./line":58,"./path":59,"./rect":60,"./rule":61,"./symbol":62,"./text":63,"./util":64}],58:[function(t,e,n){var r=t("../../../path/line");e.exports={tag:"path",nested:!0,update:function(t,e){e.length&&t.setAttribute("d",r(e))}}},{"../../../path/line":28}],59:[function(t,e,n){e.exports={tag:"path",update:function(t,e){var n=e.x||0,r=e.y||0;t.setAttribute("transform","translate("+n+","+r+")"),null!=e.path&&t.setAttribute("d",e.path)}}},{}],60:[function(t,e,n){e.exports={tag:"rect",update:function(t,e){t.setAttribute("x",e.x||0),t.setAttribute("y",e.y||0),t.setAttribute("width",e.width||0),t.setAttribute("height",e.height||0)}}},{}],61:[function(t,e,n){e.exports={tag:"line",update:function(t,e){var n=e.x||0,r=e.y||0;t.setAttribute("x1",n),t.setAttribute("y1",r),t.setAttribute("x2",null!=e.x2?e.x2:n),t.setAttribute("y2",null!=e.y2?e.y2:r)}}},{}],62:[function(t,e,n){var r=t("../../../util/svg").path.symbol;e.exports={tag:"path",update:function(t,e){var n=e.x||0,i=e.y||0;t.setAttribute("transform","translate("+n+","+i+")"),t.setAttribute("d",r(e))}}},{"../../../util/svg":73}],63:[function(t,e,n){function r(t,e){var n=e.x||0,r=e.y||0,s=e.angle||0,o=e.radius||0,l=i[e.align]||"start",u=a.offset(e);if(o){var c=(e.theta||0)-Math.PI/2;n+=o*Math.cos(c),r+=o*Math.sin(c)}t.setAttribute("x",n+(e.dx||0)),t.setAttribute("y",r+(e.dy||0)+u),t.setAttribute("text-anchor",l),s?t.setAttribute("transform","rotate("+s+" "+n+","+r+")"):t.removeAttribute("transform"),t.textContent=e.text,t.style.setProperty("font",a.string(e),null)}var i=t("../../../util/svg").textAlign,a=t("../../../util/font");e.exports={tag:"text",update:r}},{"../../../util/font":72,"../../../util/svg":73}],64:[function(t,e,n){function r(t,e,n,r){var o,l,u,c,d,h=r.nested?[e.items]:e.items||[],f=e.interactive===!1?"none":null,p="g"===r.tag,g=s.cssClass(e);for(o=s.child(t,n+1,"g",a,g),o.setAttribute("class",g),e._svg=o,e.index=n,!p&&f&&o.style.setProperty("pointer-events",f),l=0,u=h.length;u>l;++l)d=h[l],c=o.childNodes[l]||i(o,r,d,l),r.update.call(this,c,d),this.style(c,d);return s.clear(o,l),o}function i(t,e,n,r){var i=s.child(t,r,e.tag,a);return i.__data__=n,"g"===e.tag&&s.child(i,0,"rect",a,"background"),(n=Array.isArray(n)?n[0]:n)&&(n._svg=i),i}var a=t("../../../util/svg").metadata.xmlns,s=t("../../../util/dom");e.exports={draw:r,bind:i}},{"../../../util/dom":71,"../../../util/svg":73}],65:[function(t,e,n){function r(t){this.clear(),t&&this.union(t)}var i=r.prototype;i.clone=function(){return new r(this)},i.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},i.set=function(t,e,n,r){return this.x1=t,this.y1=e,this.x2=n,this.y2=r,this},i.add=function(t,e){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this},i.expand=function(t){return this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t,this},i.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},i.translate=function(t,e){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this},i.rotate=function(t,e,n){var r=Math.cos(t),i=Math.sin(t),a=e-e*r+n*i,s=n-e*i-n*r,o=this.x1,l=this.x2,u=this.y1,c=this.y2;return this.clear().add(r*o-i*u+a,i*o+r*u+s).add(r*o-i*c+a,i*o+r*c+s).add(r*l-i*u+a,i*l+r*u+s).add(r*l-i*c+a,i*l+r*c+s)},i.union=function(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this},i.encloses=function(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},i.intersects=function(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},i.contains=function(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},i.width=function(){return this.x2-this.x1},i.height=function(){return this.y2-this.y1},e.exports=r},{}],66:[function(t,e,n){function r(t){this.id="gradient_"+i++,this.type=t||"linear",this.stops=[],this.x1=0,this.x2=1,this.y1=0,this.y2=0}var i=0,a=r.prototype;a.stop=function(t,e){return this.stops.push({offset:t,color:e}),this},e.exports=r},{}],67:[function(t,e,n){function r(t){this._pending=0,this._config=t||r.Config}function i(t,e){var n=s.load.sanitizeUrl(this.params(t));if(!n)return e&&e(t,null),null;var r=this,i=new Image;return r._pending+=1,i.onload=function(){r._pending-=1,i.loaded=!0,e&&e(null,i)},i.src=n,i}function a(t,e){var n=this,r=new window.canvas.Image;return n._pending+=1,s.load(this.params(t),function(t,i){return n._pending-=1,t?(e&&e(t,null),null):(r.src=i,r.loaded=!0,void(e&&e(null,r)))}),r}var s=window.dl;r.Config=null;var o=r.prototype;o.pending=function(){return this._pending},o.params=function(t){return s.extend({url:t},this._config)},o.imageURL=function(t){return s.load.sanitizeUrl(this.params(t))},o.loadImage=function(t,e){return s.isNode?a.call(this,t,e):i.call(this,t,e)},e.exports=r},{}],68:[function(t,e,n){function r(t){this.mark=t}var i=r.prototype;i.hasPropertySet=function(t){var e=this.mark.def.properties;return e&&null!=e[t]},i.cousin=function(t,e){if(0===t)return this;t=t||-1;var n=this.mark,r=n.group,i=null==e?n.items.indexOf(this):e,a=r.items.indexOf(n)+t;return r.items[a].items[i]},i.sibling=function(t){if(0===t)return this;t=t||-1;var e=this.mark,n=e.items.indexOf(this)+t;return e.items[n]},i.remove=function(){var t=this,e=t.mark.items,n=e.indexOf(t);return n>=0&&(n===e.length-1?e.pop():e.splice(n,1)),t},i.touch=function(){this.pathCache&&(this.pathCache=null)},e.exports=r},{}],69:[function(t,e,n){function r(){return M||(M=y.instance(1,1).getContext("2d"))}function i(t,e,n){return null==e?n.set(0,0,0,0):(w(e,n),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&n.expand(t.strokeWidth)),n}function a(t,e){var n=t.path?t.pathCache||(t.pathCache=b(t.path)):null;return i(t,n,e).translate(t.x||0,t.y||0)}function s(t,e){var n=t.mark.items;t=n[0];var r=t.pathCache||(t.pathCache=b(k(n)));return i(n[0],r,e)}function o(t,e){var n=t.mark.items;t=n[0];var r=t.pathCache||(t.pathCache=b(E(n)));return i(n[0],r,e)}function l(t,e){var n=t.x||0,r=t.y||0,i=n+t.width||0,a=r+t.height||0;return e.set(n,r,i,a),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function u(t,e){var n=t.x||0,r=t.y||0,i=t.width||0,a=t.height||0;return n-="center"===t.align?i/2:"right"===t.align?i:0,r-="middle"===t.baseline?a/2:"bottom"===t.baseline?a:0,e.set(n,r,n+i,r+a)}function c(t,e){var n,r;return e.set(n=t.x||0,r=t.y||0,null!=t.x2?t.x2:n,null!=t.y2?t.y2:r),t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function d(t,e){var n,r,i,a,s,o,l,u,c,d=t.x||0,h=t.y||0,f=t.innerRadius||0,p=t.outerRadius||0,g=(t.startAngle||0)-L,m=(t.endAngle||0)-L,v=1/0,y=-(1/0),_=1/0,x=-(1/0),b=[g,m],w=g-g%L;for(r=0;4>r&&m>w;++r,w+=L)b.push(w);for(r=0,i=b.length;i>r;++r)n=b[r],a=Math.cos(n),o=f*a,u=p*a,s=Math.sin(n),l=f*s,c=p*s,v=Math.min(v,o,u),y=Math.max(y,o,u),_=Math.min(_,l,c),x=Math.max(x,l,c);return e.set(d+v,h+_,d+y,h+x),t.stroke&&0!==t.opacity&&0!==t.strokeWidth&&e.expand(t.strokeWidth||1),e}function h(t,e){var n,r,i,a,s=null!=t.size?t.size:100,o=t.x||0,l=t.y||0;switch(t.shape){case"cross":n=Math.sqrt(s/5)/2,r=3*n,e.set(o-r,l-n,o+r,l+n);break;case"diamond":a=Math.sqrt(s/(2*S)),i=a*S,e.set(o-i,l-a,o+i,l+a);break;case"square":r=Math.sqrt(s),n=r/2,e.set(o-n,l-n,o+n,l+n);break;case"triangle-down":i=Math.sqrt(s/A),a=i*A/2,e.set(o-i,l-a,o+i,l+a);break;case"triangle-up":i=Math.sqrt(s/A),a=i*A/2,e.set(o-i,l-a,o+i,l+a);break;default:n=Math.sqrt(s/Math.PI),e.set(o-n,l-n,o+n,l+n)}return t.stroke&&0!==t.opacity&&t.strokeWidth>0&&e.expand(t.strokeWidth),e}function f(t,e,n){var i,a,s=(t.x||0)+(t.dx||0),o=(t.y||0)+(t.dy||0),l=_.size(t),u=t.align,c=t.radius||0,d=r();return d.font=_.string(t),i=d.measureText(t.text||"").width,c&&(a=(t.theta||0)-Math.PI/2,s+=c*Math.cos(a),o+=c*Math.sin(a)),"center"===u?s-=i/2:"right"===u&&(s-=i),o+=_.offset(t)-Math.round(.8*l),e.set(s,o,s+i,o+l),t.angle&&!n&&e.rotate(t.angle*Math.PI/180,t.x||0,t.y||0),e.expand(n?0:1)}function p(t,e,n){var r,i,a=t.axisItems||[],s=t.items||[],o=t.legendItems||[];for(r=0,i=a.length;i>r;++r)e.union(a[r].bounds);for(r=0,i=s.length;i>r;++r)e.union(s[r].bounds);if(n)for(r=0,i=o.length;i>r;++r)e.union(o[r].bounds);return null!=t.width&&null!=t.height&&e.add(t.width,t.height),null!=t.x&&null!=t.y&&e.add(0,0),e.translate(t.x||0,t.y||0)}function g(t,e,n){e=e||T[t.mark.marktype];var r=t.bounds,i=t["bounds:prev"]||(t["bounds:prev"]=new v);return r?(i.clear().union(r),r.clear()):t.bounds=new v,e(t,t.bounds,n),r||i.clear().union(t.bounds),t.bounds}function m(t,e,n){e=e||t.bounds&&t.bounds.clear()||new v;var r,i,a=t.marktype,s=T[a],o=t.items;if("area"!==a&&"line"!==a||!o.length){if(o)for(r=0,i=o.length;i>r;++r)e.union(g(o[r],s,n))}else e.union(g(o[0],s,n));return t.bounds=e}var v=t("../util/Bounds"),y=t("../util/canvas"),_=t("./font"),x=t("../path"),b=x.parse,w=x.bounds,k=x.area,E=x.line,L=Math.PI/2,A=Math.sqrt(3),S=Math.tan(30*Math.PI/180),M=null,T={group:p,symbol:h,image:u,rect:l,rule:c,arc:d,text:f,path:a,area:s,line:o};e.exports={mark:m,item:g,text:f,group:p}},{"../path":27,"../util/Bounds":65,"../util/canvas":70,"./font":72}],70:[function(t,e,n){function r(t,e){t=t||1,e=e||1;var n;if("undefined"!=typeof document&&document.createElement)n=document.createElement("canvas"),n.width=t,n.height=e;else{var r=window.canvas;if(!r.prototype)return null;n=new r(t,e)}return s(n)}function i(t,e,n,r){var i=this._ctx=t.getContext("2d"),s=1;return t.width=e+r.left+r.right,t.height=n+r.top+r.bottom,"undefined"!=typeof HTMLElement&&t instanceof HTMLElement&&(i.pixelratio=s=a(t)||1),i.setTransform(s,0,0,s,s*r.left,s*r.top),t}function a(t){var e=t.getContext("2d"),n=window&&window.devicePixelRatio||1,r=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1,i=n/r;if(n!==r){var a=t.width,s=t.height;t.width=a*i,t.height=s*i,t.style.width=a+"px",t.style.height=s+"px"}return i}function s(t){var e=t.getContext("2d");if(!e.vgLineDash){var n=function(){},r=[];return e.setLineDash?(e.vgLineDash=function(t){this.setLineDash(t||r)},e.vgLineDashOffset=function(t){this.lineDashOffset=t}):void 0!==e.webkitLineDash?(e.vgLineDash=function(t){this.webkitLineDash=t||r},e.vgLineDashOffset=function(t){this.webkitLineDashOffset=t}):void 0!==e.mozDash?(e.vgLineDash=function(t){this.mozDash=t},e.vgLineDashOffset=n):(e.vgLineDash=n,e.vgLineDashOffset=n),t}}e.exports={instance:r,resize:i,pixelRatio:a,lineDash:s}},{}],71:[function(t,e,n){function r(t,e,n){return n?t.createElementNS(n,e):t.createElement(e)}e.exports={find:function(t,e){for(var n=0,r=t.childNodes.length;r>n;++n)if(t.childNodes[n].tagName.toLowerCase()===e)return t.childNodes[n]},child:function(t,e,n,i,a){var s,o;return s=o=t.childNodes[e],(!s||s.tagName.toLowerCase()!==n||a&&s.getAttribute("class")!=a)&&(s=r(t.ownerDocument,n,i),t.insertBefore(s,o),a&&s.setAttribute("class",a)),s},clear:function(t,e){for(var n=t.childNodes.length;n>e;)t.removeChild(t.childNodes[--n]);return t},cssClass:function(t){return"mark-"+t.marktype+(t.name?" "+t.name:"")},openTag:function(t,e,n){var r,i,a="<"+t;if(e)for(r in e)i=e[r],null!=i&&(a+=" "+r+'="'+i+'"');return n&&(a+=" "+n),a+">"},closeTag:function(t){return"</"+t+">"}}},{}],72:[function(t,e,n){function r(t){return null!=t.fontSize?t.fontSize:11}e.exports={size:r,string:function(t,e){var n=t.font;return e&&n&&(n=String(n).replace(/\"/g,"'")),""+(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+r(t)+"px "+(n||"sans-serif")},offset:function(t){var e=t.baseline,n=r(t);return Math.round("top"===e?.93*n:"middle"===e?.3*n:"bottom"===e?-.21*n:0)}}},{}],73:[function(t,e,n){function r(t){return t.x||0}function i(t){return t.y||0}function a(t){return(t.x||0)+(t.width||0)}function s(t){return(t.y||0)+(t.height||0)}function o(t){return null==t.size?100:t.size}function l(t){return t.shape||"circle"}var u=window.d3.svg;e.exports={metadata:{version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"},path:{arc:u.arc(),areav:u.area().x(r).y1(i).y0(s),areah:u.area().y(i).x1(r).x0(a),line:u.line().x(r).y(i),symbol:u.symbol().type(l).size(o)},textAlign:{left:"start",center:"middle",right:"end"},textBaseline:{top:"before-edge",bottom:"after-edge",middle:"central"},styles:{fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},styleProperties:["fill","fillOpacity","stroke","strokeWidth","strokeOpacity","strokeCap","strokeDash","strokeDashOffset","opacity"]}},{}],74:[function(t,e,n){var r=(t("datalib/src/util"),t("vega-scenegraph/src/render/canvas")),i=t("vega-scenegraph/src/render/svg-string"),a=t("./View"),s=(t("../util/log"),function(t,e,n){a.call(null,t,e,n),this._type="canvas",this._renderers={canvas:r,svg:i}}),o=s.prototype=new a;o.renderer=function(t){return t&&(this._type=t),a.prototype.renderer.apply(this,arguments)},o.canvas=function(){return"canvas"===this._type?this._renderer.canvas():null},o.canvasAsync=function(t){function e(){0===n.pendingImages()?(r.render(),t(r._canvas)):setTimeout(e,10)}var n=this._renderer,r=this;return"canvas"!==this._type?null:void(n.pendingImages()>0?e():t(this.canvas()))},o.svg=function(){return"svg"===this._type?this._renderer.svg():null},o.initialize=function(){var t=this._width,e=this._height,n=this._padding,r=this._bgcolor;return this._viewport&&(t=this._viewport[0]-(n?n.left+n.right:0),e=this._viewport[1]-(n?n.top+n.bottom:0)),this._renderer=(this._renderer||new this._io.Renderer).initialize(null,t,e,n).background(r),this},e.exports=s},{"../util/log":139,"./View":76,"datalib/src/util":21,"vega-scenegraph/src/render/canvas":35,"vega-scenegraph/src/render/svg-string":49}],75:[function(t,e,n){function r(){this._defs={},this._predicates={},this._scene=null,this._node=null,this._builder=null,this._reset={axes:!1,legends:!1},s.prototype.init.call(this)}function i(t){var e=this,n={};return a.isArray(t)?(t.forEach(function(t){n[t]=e._predicates[t]}),n):this._predicates[t]}var a=t("datalib/src/util"),s=t("../dataflow/Graph"),o=t("../dataflow/Node"),l=t("../scene/GroupBuilder"),u=t("../dataflow/changeset"),c=t("../scene/visit"),d=r.prototype=new s;d.defs=function(t){return arguments.length?(this._defs=t,this):this._defs},d.width=function(t){return this._defs&&(this._defs.width=t),this._defs&&this._defs.marks&&(this._defs.marks.width=t),this._scene&&(this._scene.items[0].width=t),this._reset.axes=!0,this},d.height=function(t){return this._defs&&(this._defs.height=t),this._defs&&this._defs.marks&&(this._defs.marks.height=t),this._scene&&(this._scene.items[0].height=t),this._reset.axes=!0,this},d.node=function(){return this._node||(this._node=new o(this))},d.data=function(){var t=s.prototype.data.apply(this,arguments);return arguments.length>1&&this.node().addListener(t.pipeline()[0]),t},d.predicate=function(t,e){return 1===arguments.length?i.call(this,t):this._predicates[t]=e},d.predicates=function(){return this._predicates},d.scene=function(t){if(!arguments.length)return this._scene;this._builder&&this.node().removeListener(this._builder.disconnect()),this._builder=new l(this,this._defs.marks,this._scene={}),this.node().addListener(this._builder.connect());var e=this._builder.pipeline();return e[e.length-1].addListener(t),this},d.reset=function(){return this._scene&&this._reset.axes&&(c(this._scene,function(t){t.axes&&t.axes.forEach(function(t){t.reset()})}),this._reset.axes=!1),this._scene&&this._reset.legends&&(c(this._scene,function(t){t.legends&&t.legends.forEach(function(t){t.reset()})}),this._reset.legends=!1),this},d.addListener=function(t){this.node().addListener(t)},d.removeListener=function(t){this.node().removeListener(t)},d.fire=function(t){t||(t=u.create()),this.propagate(t,this.node())},e.exports=r},{"../dataflow/Graph":79,"../dataflow/Node":80,"../dataflow/changeset":82,"../scene/GroupBuilder":110,"../scene/visit":115,"datalib/src/util":21}],76:[function(t,e,n){function r(t){var e=this,n=this._model.data(t),r=n.name(),i=n.pipeline()[0],a=this._streamer,o=this._changeset,l={};if(s.keys(o.signals).length>0)throw"New signal values are not reflected in the visualization. Please call view.update() before updating data values.";return this._api[t]?this._api[t]:(l.insert=function(t){return n.insert(s.duplicate(t)),a.addListener(i),e._changeset.data[r]=1,l},l.update=function(){return a.addListener(i),e._changeset.data[r]=1,n.update.apply(n,arguments),l},l.remove=function(){return a.addListener(i),e._changeset.data[r]=1,n.remove.apply(n,arguments),l},l.values=function(){return n.values()},this._api[t]=l)}function i(){var t=this;return t._renderNode=new u(t._model).router(!0),t._renderNode.evaluate=function(e){p.debug(e,["rendering"]);var n,r,i=t._model.scene(),a=t._handler;a&&a.scene&&a.scene(i),e.trans?e.trans.start(function(e){t._renderer.render(i,e)}):t._repaint?(t._renderer.render(i),t._repaint=!1):e.dirty.length&&t._renderer.render(i,e.dirty),e.dirty.length&&e.dirty.forEach(function(t){t._dirty=!1});for(r in e.data)n=t._model.data(r),n.revises()&&g.finalize(n.last());return e},t._model.scene(t._renderNode),!0}var a=window.d3,s=t("datalib/src/util"),o=t("vega-scenegraph/src/render/canvas"),l=t("vega-scenegraph/src/render/svg"),u=t("../dataflow/Node"),c=t("../parse/streams"),d=t("../scene/Encoder"),h=t("../scene/Transition"),f=t("../util/config"),p=t("../util/log"),g=t("../dataflow/changeset"),m=function(t,e,n,r){this._el=null,this._model=null,this._width=this.__width=e||500,this._height=this.__height=n||300,this._bgcolor=null,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._streamer=null,this._changeset=null,this._repaint=!0,this._renderers={canvas:o,svg:l},this._io=o,this._api={}},v=m.prototype;v.model=function(t){return arguments.length?(this._model!==t&&(this._model=t,this._streamer=new u(t),this._changeset=g.create(),this._handler&&this._handler.model(t)),this):this._model},v.data=function(t){var e=this;return arguments.length?s.isString(t)?r.call(e,t):(s.isObject(t)&&s.keys(t).forEach(function(n){var i=r.call(e,n);t[n](i)}),this):e._model.dataValues()},v.signal=function(t,e){var n=this._model,r=this._changeset,i=this._streamer,a=t;if(!arguments.length)return n.signalValues();if(1==arguments.length&&s.isString(t))return n.signalValues(t);if(s.keys(r.data).length>0)throw"New data values are not reflected in the visualization. Please call view.update() before updating signal values.";return 2==arguments.length&&(a={},a[t]=e),s.keys(a).forEach(function(t){i.addListener(n.signal(t).value(a[t])),r.signals[t]=1,r.reflow=!0}),this},v.width=function(t){return arguments.length?(this.__width!==t&&(this._width=this.__width=t,this.initialize(),this._strict&&(this._autopad=1)),this):this.__width},v.height=function(t){return arguments.length?(this.__height!==t&&(this._height=this.__height=t,this.initialize(),this._strict&&(this._autopad=1)),this):this.__height},v.background=function(t){return arguments.length?(this._bgcolor!==t&&(this._bgcolor=t,this.initialize()),this):this._bgcolor},v.padding=function(t){return arguments.length?(this._padding!==t&&(s.isString(t)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===t):(this._autopad=0,this._padding=t,this._strict=!1),this._renderer&&this._renderer.resize(this._width,this._height,t),this._handler&&this._handler.padding(t)),this._repaint=!0,this):this._padding},v.autopad=function(t){if(this._autopad<1)return this;this._autopad=0;var e=this._padding,n=this.model().scene().bounds,r=f.autopadInset,i=n.x1<0?Math.ceil(-n.x1)+r:0,a=n.y1<0?Math.ceil(-n.y1)+r:0,s=n.x2>this._width?Math.ceil(+n.x2-this._width)+r:0,n=n.y2>this._height?Math.ceil(+n.y2-this._height)+r:0;return e={left:i,top:a,right:s,bottom:n},this._strict?(this._autopad=0,this._padding=e,this._width=Math.max(0,this.__width-(i+s)),this._height=Math.max(0,this.__height-(a+n)),this._model.width(this._width).height(this._height).reset(),this.initialize().update({props:"enter"}).update({props:"update"})):this.padding(e).update(t),this},v.viewport=function(t){return arguments.length?(this._viewport!==t&&(this._viewport=t,this.initialize()),this):this._viewport},v.renderer=function(t){if(!arguments.length)return this._renderer;if(this._renderers[t])t=this._renderers[t];else{if(s.isString(t))throw new Error("Unknown renderer: "+t);if(!t)throw new Error("No renderer specified")}return this._io!==t&&(this._io=t,this._renderer=null,this.initialize(),this._build&&this.render()),this},v.initialize=function(t){var e,n=this,r=n._width,i=n._height,s=n._padding,o=n._bgcolor;return arguments.length&&null!==t||(t=this._el?this._el.parentNode:null)?(a.select(t).select("div.vega").remove(),this._el=t=a.select(t).append("div").attr("class","vega").style("position","relative").node(),n._viewport&&a.select(t).style("width",(n._viewport[0]||r)+"px").style("height",(n._viewport[1]||i)+"px").style("overflow","auto"),n._renderer=(n._renderer||new this._io.Renderer).initialize(t,r,i,s).background(o),e=n._handler,n._handler=(new this._io.Handler).initialize(t,s,n),e?e.handlers().forEach(function(t){n._handler.on(t.type,t.handler)}):c(this),this._repaint=!0,this):this},v.update=function(t){t=t||{};var e=this,n=t.duration?new h(t.duration,t.ease):null,r=e._changeset;if(n&&(r.trans=n),void 0!==t.props){if(s.keys(r.data).length>0)throw"New data values are not reflected in the visualization. Please call view.update() before updating a specified property set.";r.reflow=!0,r.request=t.props}var a=e._build;return e._build=e._build||i.call(this),t.items&&a?(d.update(this._model,t.trans,t.props,t.items,r.dirty),e._renderNode.evaluate(r)):e._streamer.listeners().length&&a?(e._model.propagate(r,e._streamer),e._streamer.disconnect()):e._model.fire(r),e._changeset=g.create(),e.autopad(t)},v.render=function(t){return this._renderer.render(this._model.scene(),t),this},v.on=function(){return this._handler.on.apply(this._handler,arguments),this},v.onSignal=function(t,e){return this._model.signal(t).on(e),this},v.off=function(){return this._handler.off.apply(this._handler,arguments),this},v.offSignal=function(t,e){return this._model.signal(t).off(e),this},m.factory=function(e){var n=t("./HeadlessView");return function(t){t=t||{};var r=e.defs(),i=(t.el?new m:new n).model(e).renderer(t.renderer||"canvas").width(r.width).height(r.height).background(r.background).padding(r.padding).viewport(r.viewport).initialize(t.el);return t.data&&i.data(t.data),t.hover!==!1&&t.el&&i.on("mouseover",function(t,e){e&&e.hasPropertySet("hover")&&this.update({props:"hover",items:e})}).on("mouseout",function(t,e){e&&e.hasPropertySet("hover")&&this.update({props:"update",items:e})}),i}},e.exports=m},{"../dataflow/Node":80,"../dataflow/changeset":82,"../parse/streams":105,"../scene/Encoder":109,"../scene/Transition":112,"../util/config":137,"../util/log":139,"./HeadlessView":74,"datalib/src/util":21,"vega-scenegraph/src/render/canvas":35,"vega-scenegraph/src/render/svg":52}],77:[function(t,e,n){function r(t){return i.prototype.init.call(this,t),this._data=[],this.router(!0).collector(!0)}var i=t("./Node"),a=t("./changeset"),s=t("../util/log"),o=(t("../util/constants"),r.prototype=new i);o.data=function(){return this._data},o.evaluate=function(t){if(s.debug(t,["collecting"]),t.reflow)return t=a.create(t),t.mod=this._data.slice(),t;if(t.rem.length){var e=t.rem.reduce(function(t,e){return t[e._id]=1,t},{});this._data=this._data.filter(function(t){return 1!==e[t._id]})}return t.add.length&&(this._data=this._data.length?this._data.concat(t.add):t.add),t.sort&&this._data.sort(t.sort),t},e.exports=r},{"../util/constants":138,"../util/log":139,"./Node":80,"./changeset":82}],78:[function(t,e,n){function r(t,e,n){this._graph=t,this._name=e,this._data=[],this._source=null,this._facet=n,this._input=s.create(),this._output=null,this._pipeline=null,this._collector=null,this._revises=!1}function i(t){void 0===t._prev&&(t._prev=d.SENTINEL)}var a=t("datalib/src/util"),s=t("./changeset"),o=t("./tuple"),l=t("./Node"),u=t("./Collector"),c=t("../util/log"),d=t("../util/constants"),h=r.prototype;h.name=function(t){return arguments.length?(this._name=t,this):this._name},h.source=function(t){return arguments.length?this._source=this._graph.data(t):this._source},h.insert=function(t){var e=this._revises?null:void 0;return this._input.add=this._input.add.concat(a.array(t).map(function(t){return o.ingest(t,e)})),this},h.remove=function(t){var e=this._data.filter(t);return this._input.rem=this._input.rem.concat(e),this},h.update=function(t,e,n){{var r=this._input.mod,i=o.idMap(r);this._revises?null:void 0}return this._input.fields[e]=1,this._data.filter(t).forEach(function(t){var a=t[e],s=n(t);a!==s&&(o.set(t,e,s),1!==i[t._id]&&(r.push(t),i[t._id]=1))}),this},h.values=function(t){return arguments.length?(this._input.rem=this._data.slice(),t&&this.insert(t),this):this._collector?this._collector.data():this._data},h.revises=function(t){return arguments.length?(!this._revises&&t&&(this._data.forEach(i),this._input.add.forEach(i)),this._revises=this._revises||t,this):this._revises},h.last=function(){return this._output},h.fire=function(t){return t&&(this._input=t),this._graph.propagate(this._input,this._pipeline[0]),this},h.pipeline=function(t){function e(){return n._data}var n=this;if(!arguments.length)return this._pipeline;t.length&&(n._collector=new u(this._graph),t.push(n._collector),n._revises=t.some(function(t){return t.revises()}));var r=new l(this._graph).router(!0).collector(!0);r.data=e,r.evaluate=function(t){c.debug(t,["input",n._name]);var e,r=n._input,i=s.create(t);return a.keys(r.fields).forEach(function(t){i.fields[t]=1}),t.reflow?i.mod=n._data.slice():(r.rem.length&&(e=o.idMap(r.rem),n._data=n._data.filter(function(t){return 1!==e[t._id]})),r.add.length&&(n._data=n._data.concat(r.add)),n._input=s.create(),i.add=r.add,i.mod=r.mod,i.rem=r.rem),i.facet=n._facet,i},t.unshift(r);var i=new l(this._graph).router(!0).collector(!0);return i.data=n._collector?n._collector.data.bind(n._collector):e,i.evaluate=function(t){c.debug(t,["output",n._name]);var e=s.create(t,!0);return n._facet&&(n._facet.values=n.values(),t.facet=null),n._output=t,e.data[n._name]=1,e},t.push(i),this._pipeline=t,this._graph.connect(n._pipeline),this},h.listener=function(){var t=new l(this._graph).router(!0),e=this,n=this._revises?null:void 0;return t.evaluate=function(t){e._srcMap=e._srcMap||{};var r=e._srcMap,i=s.create(t);return i.add=t.add.map(function(t){return r[t._id]=o.derive(t,void 0!==t._prev?t._prev:n)}),i.mod=t.mod.map(function(t){return r[t._id]}),i.rem=t.rem.map(function(t){var e=r[t._id];return r[t._id]=null,e}),e._input=i},t.addListener(this._pipeline[0]),t},h.addListener=function(t){return t instanceof r?this._collector?this._collector.addListener(t.listener()):this._pipeline[0].addListener(t.listener()):this._pipeline[this._pipeline.length-1].addListener(t),
this},h.removeListener=function(t){this._pipeline[this._pipeline.length-1].removeListener(t)},h.listeners=function(t){return t?this._collector?this._collector.listeners():this._pipeline[0].listeners():this._pipeline[this._pipeline.length-1].listeners()},e.exports=r},{"../util/constants":138,"../util/log":139,"./Collector":77,"./Node":80,"./changeset":82,"./tuple":83,"datalib/src/util":21}],79:[function(t,e,n){function r(){}function i(t){var e=this;return s.isArray(t)?t.map(function(t){e._signals[t]}):this._signals[t]}function a(t,e){var n,r,i,a;for(a=0;a<t.length;++a)n=t[a],n instanceof d&&!n.data&&(i?t.splice(a,0,n=new c(this)):n.data=r.data.bind(r)),n.collector()&&(r=n),i=n.router()&&!n.collector(),e(n,r,a)}var s=t("datalib/src/util"),o=t("heap"),l=t("./Datasource"),u=t("./Signal"),c=t("./Collector"),d=t("../transforms/BatchTransform"),h=(t("./changeset"),t("../util/log")),f=t("../util/constants"),p=r.prototype;p.init=function(){this._stamp=0,this._rank=0,this._data={},this._signals={},this.doNotPropagate={}},p.data=function(t,e,n){var r=this._data;return arguments.length?1===arguments.length?r[t]:r[t]=new l(this,t,n).pipeline(e):s.keys(r).map(function(t){return r[t]})},p.dataValues=function(t){var e=this;return arguments.length||(t=s.keys(this._data)),s.isArray(t)?t.reduce(function(t,n){return t[n]=e._data[n].values(),t},{}):this._data[t].values()},p.signal=function(t,e){return 1===arguments.length?i.call(this,t):this._signals[t]=new u(this,t,e)},p.signalValues=function(t){var e=this;return arguments.length||(t=s.keys(this._signals)),s.isArray(t)?t.reduce(function(t,n){return t[n]=e._signals[n].value(),t},{}):this._signals[t].value()},p.signalRef=function(t){s.isArray(t)||(t=s.field(t));var e=this.signal(t.shift()).value();if(t.length>0){var n=Function("s","return s["+t.map(s.str).join("][")+"]");e=n.call(null,e)}return e};var g=function(t,e){return t.rank==e.rank?t.pulse.reflow?1:-1:t.rank-e.rank};p.propagate=function(t,e){var n,r,i,a,s,l,u,c,d=new o(g);if(t.stamp)throw"Pulse already has a non-zero stamp";for(t.stamp=++this._stamp,d.push({node:e,pulse:t,rank:e.rank()});d.size()>0;)if(n=d.pop(),i=n.node,a=n.pulse,s=n.rank,r=i._listeners,c=a.reflow&&i.last()>=a.stamp,!c)if(s==i.rank()){if(a=this.evaluate(a,i),a!==this.doNotPropagate)for(l=0,u=r.length;u>l;l++)d.push({node:r[l],pulse:a,rank:r[l]._rank})}else h.debug(a,["Rank mismatch",s,i.rank()]),d.push({node:i,pulse:a,rank:i.rank()})},p.connect=function(t){h.debug({},["connecting"]);var e=this;return a.call(this,t,function(n,r,i){var a=n.dependency(f.DATA),s=n.dependency(f.SIGNALS);a.length>0&&a.forEach(function(t){e.data(t).revises(n.revises()).addListener(r)}),s.length>0&&s.forEach(function(t){e.signal(t).addListener(r)}),i>0&&t[i-1].addListener(t[i])}),t},p.disconnect=function(t){h.debug({},["disconnecting"]);var e=this;return a.call(this,t,function(t,n,r){var i=t.dependency(f.DATA),a=t.dependency(f.SIGNALS);i.length>0&&i.forEach(function(t){e.data(t).removeListener(n)}),a.length>0&&a.forEach(function(t){e.signal(t).removeListener(n)}),t.disconnect()}),t},p.reevaluate=function(t,e){var n=!t.reflow||t.reflow&&e.last()>=t.stamp,r=!!t.add.length||!!t.rem.length||e.router();return r=r||!n,r||e.reevaluate(t)},p.evaluate=function(t,e){return this.reevaluate(t,e)?(t=e.evaluate(t),e.last(t.stamp),t):t},e.exports=r},{"../transforms/BatchTransform":117,"../util/constants":138,"../util/log":139,"./Collector":77,"./Datasource":78,"./Signal":81,"./changeset":82,"datalib/src/util":21,heap:22}],80:[function(t,e,n){function r(t){return t&&this.init(t),this}var i=t("datalib/src/util"),a=t("../util/constants"),s=[a.DATA,a.FIELDS,a.SCALES,a.SIGNALS],o=1,l=r.prototype;l.init=function(t){return this._id=o++,this._graph=t,this._rank=++t._rank,this._stamp=0,this._listeners=[],this._registered={},this._deps={data:[],fields:[],scales:[],signals:[]},this._isRouter=!1,this._isCollector=!1,this._revises=!1,this},l.rank=function(){return this._rank},l.last=function(t){return arguments.length?(this._stamp=t,this):this._stamp},l.dependency=function(t,e){var n=this._deps[t];if(1===arguments.length)return n;if(null===e)for(;n.length>0;)n.pop();else!i.isArray(e)&&n.indexOf(e)<0?n.push(e):n.push.apply(n,i.array(e));return this},l.router=function(t){return arguments.length?(this._isRouter=!!t,this):this._isRouter},l.collector=function(t){return arguments.length?(this._isCollector=!!t,this):this._isCollector},l.revises=function(t){return arguments.length?(this._revises=!!t,this):this._revises},l.listeners=function(){return this._listeners},l.addListener=function(t){if(!(t instanceof r))throw"Listener is not a Node";if(this._registered[t._id])return this;if(this._listeners.push(t),this._registered[t._id]=1,this._rank>t._rank)for(var e=[t];e.length;){var n=e.splice(0,1)[0];n._rank=++this._graph._rank,e.push.apply(e,n._listeners)}return this},l.removeListener=function(t){for(var e=!1,n=0,r=this._listeners.length;r>n&&!e;n++)this._listeners[n]===t&&(this._listeners.splice(n,1),this._registered[t._id]=null,e=!0);return e},l.disconnect=function(){this._listeners=[],this._registered={}},l.evaluate=function(t){return t},l.reevaluate=function(t){var e=this,n=!1;return s.some(function(r){return n=n||e._deps[r].some(function(e){return!!t[r][e]})})},e.exports=r},{"../util/constants":138,"datalib/src/util":21}],81:[function(t,e,n){function r(t,e,n){return i.prototype.init.call(this,t),this._name=e,this._value=n,this._verbose=!1,this._handlers=[],this}var i=t("./Node"),a=t("./changeset"),s=r.prototype=new i;s.name=function(){return this._name},s.value=function(t){return arguments.length?(this._value=t,this):this._value},s.verbose=function(t){return arguments.length?(this._verbose=!!t,this):this._verbose},s.evaluate=function(t){return t.signals[this._name]?t:this._graph.doNotPropagate},s.fire=function(t){t||(t=a.create(null,!0)),t.signals[this._name]=1,this._graph.propagate(t,this)},s.on=function(t){var e=this,n=new i(this._graph);return n.evaluate=function(n){return t(e.name(),e.value()),n},this._handlers.push({handler:t,node:n}),this.addListener(n)},s.off=function(t){for(var e=this,n=this._handlers,r=n.length;--r>=0;)t&&n[r].handler!==t||e.removeListener(n.splice(r,1)[0].node);return this},e.exports=r},{"./Node":80,"./changeset":82}],82:[function(t,e,n){function r(t,e){var n={};return o(t,n),n.add=[],n.mod=[],n.rem=[],n.reflow=e,n}function a(t){t._prev=void 0===t._prev?void 0:l.SENTINEL}function s(t){for(i=0,len=t.add.length;i<len;++i)a(t.add[i]);for(i=0,len=t.mod.length;i<len;++i)a(t.mod[i])}function o(t,e){e.stamp=t?t.stamp:0,e.sort=t?t.sort:null,e.facet=t?t.facet:null,e.trans=t?t.trans:null,e.dirty=t?t.dirty:[],e.request=t?t.request:null,u.forEach(function(n){e[n]=t?t[n]:{}})}var l=t("../util/constants"),u=[l.DATA,l.FIELDS,l.SCALES,l.SIGNALS];e.exports={create:r,copy:o,finalize:s}},{"../util/constants":138}],83:[function(t,e,n){function r(t,e){return t=c.isObject(t)?t:{data:t},t._id=h++,t._prev=void 0!==e?e||d.SENTINEL:void 0,t}function i(t,e){return r(Object.create(t),e)}function a(t,e,n){var r=t[e];return r===n?!1:(s(t,e),t[e]=n,!0)}function s(t,e){void 0!==t._prev&&(t._prev=t._prev===d.SENTINEL?{}:t._prev,t._prev[e]=t[e])}function o(t){return t._prev&&t._prev!==d.SENTINEL}function l(){h=1}function u(t){return t.reduce(function(t,e){return t[e._id]=1,t},{})}var c=t("datalib/src/util"),d=t("../util/constants"),h=1;e.exports={ingest:r,derive:i,set:a,set_prev:s,has_prev:o,reset:l,idMap:u}},{"../util/constants":138,"datalib/src/util":21}],84:[function(t,e,n){var r=t("datalib/src/util");e.exports=function(e){function n(t){var e={fn:i(t),signals:r.keys(h),fields:r.keys(f)};return h={},f={},e}function i(t){if(t instanceof String)return t;var e=p[t.type];if(null==e)throw new Error("Unsupported type: "+t.type);return e(t)}e=e||{};var a=e.constants||t("./constants"),s=(e.functions||t("./functions"))(i),o=e.idWhiteList?r.toMap(e.idWhiteList):null,l=e.idBlackList?r.toMap(e.idBlackList):null,u=0,c="datum",d="signals.",h={},f={},p={Literal:function(t){return t.raw},Identifier:function(t){var e=t.name;if(u>0)return e;if(a.hasOwnProperty(e))return a[e];if(o)return o.hasOwnProperty(e)?e:(h[e]=1,d+e);if(l&&l.hasOwnProperty(e))throw new Error("Illegal identifier: "+e);return e},Program:function(t){return t.body.map(i).join("\n")},MemberExpression:function(t){var e=!t.computed,n=i(t.object);e&&(u+=1);var r=i(t.property);return n===c&&(f[r]=1),e&&(u-=1),n+(e?"."+r:"["+r+"]")},CallExpression:function(t){if("Identifier"!==t.callee.type)throw new Error("Illegal callee type: "+t.callee.type);var e=t.callee.name,n=t.arguments,r=s.hasOwnProperty(e)&&s[e];if(!r)throw new Error("Unrecognized function: "+e);return r instanceof Function?r(n):r+"("+n.map(i).join(",")+")"},ArrayExpression:function(t){return"["+t.elements.map(i).join(",")+"]"},BinaryExpression:function(t){return"("+i(t.left)+t.operator+i(t.right)+")"},UnaryExpression:function(t){return"("+t.operator+i(t.argument)+")"},UpdateExpression:function(t){return"("+(prefix?t.operator+i(t.argument):i(t.argument)+t.operator)+")"},ConditionalExpression:function(t){return"("+i(t.test)+"?"+i(t.consequent)+":"+i(t.alternate)+")"},LogicalExpression:function(t){return"("+i(t.left)+t.operator+i(t.right)+")"},ObjectExpression:function(t){return"{"+t.properties.map(i).join(",")+"}"},Property:function(t){u+=1;var e=i(t.key);return u-=1,e+":"+i(t.value)},ExpressionStatement:function(t){return i(t.expression)}};return n}},{"./constants":85,"./functions":86,"datalib/src/util":21}],85:[function(t,e,n){e.exports={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"}},{}],86:[function(t,e,n){var r=t("datalib/src/util");e.exports=function(t){function e(e,n,i,a){var s=t(n[0]);return i&&(s=i+"("+s+")",r.startsWith(i,"new ")&&(s="("+s+")")),s+"."+e+(0>a?"":0===a?"()":"("+n.slice(1).map(t).join(",")+")")}var n="new Date",i="String",a="RegExp";return{isNaN:"isNaN",isFinite:"isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",now:"Date.now",datetime:"new Date",date:function(t){return e("getDate",t,n,0)},day:function(t){return e("getDay",t,n,0)},year:function(t){return e("getFullYear",t,n,0)},month:function(t){return e("getMonth",t,n,0)},hours:function(t){return e("getHours",t,n,0)},minutes:function(t){return e("getMinutes",t,n,0)},seconds:function(t){return e("getSeconds",t,n,0)},milliseconds:function(t){return e("getMilliseconds",t,n,0)},time:function(t){return e("getTime",t,n,0)},timezoneoffset:function(t){return e("getTimezoneOffset",t,n,0)},utcdate:function(t){return e("getUTCDate",t,n,0)},utcday:function(t){return e("getUTCDay",t,n,0)},utcyear:function(t){return e("getUTCFullYear",t,n,0)},utcmonth:function(t){return e("getUTCMonth",t,n,0)},utchours:function(t){return e("getUTCHours",t,n,0)},utcminutes:function(t){return e("getUTCMinutes",t,n,0)},utcseconds:function(t){return e("getUTCSeconds",t,n,0)},utcmilliseconds:function(t){return e("getUTCMilliseconds",t,n,0)},length:function(t){return e("length",t,null,-1)},indexof:function(t){return e("indexOf",t,null)},lastindexof:function(t){return e("lastIndexOf",t,null)},parseFloat:"parseFloat",parseInt:"parseInt",upper:function(t){return e("toUpperCase",t,i,0)},lower:function(t){return e("toLowerCase",t,i,0)},slice:function(t){return e("slice",t,i)},substring:function(t){return e("substring",t,i)},test:function(t){return e("test",t,a)},"if":function(e){if(e.length<3)throw new Error("Missing arguments to if function.");if(e.length>3)throw new Error("Too many arguments to if function.");var n=e.map(t);return n[0]+"?"+n[1]+":"+n[2]}}}},{"datalib/src/util":21}],87:[function(t,e,n){var r=t("./parser"),i=t("./codegen");e.exports={parse:function(t,e){return r.parse("("+t+")",e)},code:function(t){return i(t)}}},{"./codegen":84,"./parser":88}],88:[function(t,e,n){e.exports=function(){"use strict";function t(t,e){if(!t)throw new Error("ASSERT: "+e)}function e(t){return t>=48&&57>=t}function n(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function r(t){return"01234567".indexOf(t)>=0}function i(t){return 32===t||9===t||11===t||12===t||160===t||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function a(t){return 10===t||13===t||8232===t||8233===t}function s(t){return 36===t||95===t||t>=65&&90>=t||t>=97&&122>=t||92===t||t>=128&&Et.NonAsciiIdentifierStart.test(String.fromCharCode(t))}function o(t){return 36===t||95===t||t>=65&&90>=t||t>=97&&122>=t||t>=48&&57>=t||92===t||t>=128&&Et.NonAsciiIdentifierPart.test(String.fromCharCode(t))}function l(t){switch(t){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}function u(t){switch(t){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function c(t){if(At&&u(t))return!0;switch(t.length){case 2:return"if"===t||"in"===t||"do"===t;case 3:return"var"===t||"for"===t||"new"===t||"try"===t||"let"===t;case 4:return"this"===t||"else"===t||"case"===t||"void"===t||"with"===t||"enum"===t;case 5:return"while"===t||"break"===t||"catch"===t||"throw"===t||"const"===t||"yield"===t||"class"===t||"super"===t;case 6:return"return"===t||"typeof"===t||"delete"===t||"switch"===t||"export"===t||"import"===t;case 7:return"default"===t||"finally"===t||"extends"===t;case 8:return"function"===t||"continue"===t||"debugger"===t;case 10:return"instanceof"===t;default:return!1}}function d(){var t,e;for(e=0===St;Ct>St;)if(t=Lt.charCodeAt(St),i(t))++St;else{if(!a(t))break;++St,13===t&&10===Lt.charCodeAt(St)&&++St,++Mt,Tt=St,e=!0}}function h(t){var e,r,i,a=0;for(r="u"===t?4:2,e=0;r>e;++e){if(!(Ct>St&&n(Lt[St])))return"";i=Lt[St++],a=16*a+"0123456789abcdef".indexOf(i.toLowerCase())}return String.fromCharCode(a)}function f(){var t,e,r,i;for(t=Lt[St],e=0,"}"===t&&R({},kt.UnexpectedToken,"ILLEGAL");Ct>St&&(t=Lt[St++],n(t));)e=16*e+"0123456789abcdef".indexOf(t.toLowerCase());return(e>1114111||"}"!==t)&&R({},kt.UnexpectedToken,"ILLEGAL"),65535>=e?String.fromCharCode(e):(r=(e-65536>>10)+55296,i=(e-65536&1023)+56320,String.fromCharCode(r,i))}function p(){var t,e;for(t=Lt.charCodeAt(St++),e=String.fromCharCode(t),92===t&&(117!==Lt.charCodeAt(St)&&R({},kt.UnexpectedToken,"ILLEGAL"),++St,t=h("u"),t&&"\\"!==t&&s(t.charCodeAt(0))||R({},kt.UnexpectedToken,"ILLEGAL"),e=t);Ct>St&&(t=Lt.charCodeAt(St),o(t));)++St,e+=String.fromCharCode(t),92===t&&(e=e.substr(0,e.length-1),117!==Lt.charCodeAt(St)&&R({},kt.UnexpectedToken,"ILLEGAL"),++St,t=h("u"),t&&"\\"!==t&&o(t.charCodeAt(0))||R({},kt.UnexpectedToken,"ILLEGAL"),e+=t);return e}function g(){var t,e;for(t=St++;Ct>St;){if(e=Lt.charCodeAt(St),92===e)return St=t,p();if(!o(e))break;++St}return Lt.slice(t,St)}function m(){var t,e,n;return t=St,e=92===Lt.charCodeAt(St)?p():g(),n=1===e.length?_t.Identifier:c(e)?_t.Keyword:"null"===e?_t.NullLiteral:"true"===e||"false"===e?_t.BooleanLiteral:_t.Identifier,{type:n,value:e,lineNumber:Mt,lineStart:Tt,start:t,end:St}}function v(){var t,e,n,r,i=St,a=Lt.charCodeAt(St),s=Lt[St];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++St,Pt.tokenize&&(40===a?Pt.openParenToken=Pt.tokens.length:123===a&&(Pt.openCurlyToken=Pt.tokens.length)),{type:_t.Punctuator,value:String.fromCharCode(a),lineNumber:Mt,lineStart:Tt,start:i,end:St};default:if(t=Lt.charCodeAt(St+1),61===t)switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return St+=2,{type:_t.Punctuator,value:String.fromCharCode(a)+String.fromCharCode(t),lineNumber:Mt,lineStart:Tt,start:i,end:St};case 33:case 61:return St+=2,61===Lt.charCodeAt(St)&&++St,{type:_t.Punctuator,value:Lt.slice(i,St),lineNumber:Mt,lineStart:Tt,start:i,end:St}}}return r=Lt.substr(St,4),">>>="===r?(St+=4,{type:_t.Punctuator,value:r,lineNumber:Mt,lineStart:Tt,start:i,end:St}):(n=r.substr(0,3),">>>"===n||"<<="===n||">>="===n?(St+=3,{type:_t.Punctuator,value:n,lineNumber:Mt,lineStart:Tt,start:i,end:St}):(e=n.substr(0,2),s===e[1]&&"+-<>&|".indexOf(s)>=0||"=>"===e?(St+=2,{type:_t.Punctuator,value:e,lineNumber:Mt,lineStart:Tt,start:i,end:St}):"<>=!+-*%&|^/".indexOf(s)>=0?(++St,{type:_t.Punctuator,value:s,lineNumber:Mt,lineStart:Tt,start:i,end:St}):void R({},kt.UnexpectedToken,"ILLEGAL")))}function y(t){for(var e="";Ct>St&&n(Lt[St]);)e+=Lt[St++];return 0===e.length&&R({},kt.UnexpectedToken,"ILLEGAL"),s(Lt.charCodeAt(St))&&R({},kt.UnexpectedToken,"ILLEGAL"),{type:_t.NumericLiteral,value:parseInt("0x"+e,16),lineNumber:Mt,lineStart:Tt,start:t,end:St}}function _(t){for(var n="0"+Lt[St++];Ct>St&&r(Lt[St]);)n+=Lt[St++];return(s(Lt.charCodeAt(St))||e(Lt.charCodeAt(St)))&&R({},kt.UnexpectedToken,"ILLEGAL"),{type:_t.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:Mt,lineStart:Tt,start:t,end:St}}function x(){var n,i,a;if(a=Lt[St],t(e(a.charCodeAt(0))||"."===a,"Numeric literal must start with a decimal digit or a decimal point"),i=St,n="","."!==a){if(n=Lt[St++],a=Lt[St],"0"===n){if("x"===a||"X"===a)return++St,y(i);if(r(a))return _(i);a&&e(a.charCodeAt(0))&&R({},kt.UnexpectedToken,"ILLEGAL")}for(;e(Lt.charCodeAt(St));)n+=Lt[St++];a=Lt[St]}if("."===a){for(n+=Lt[St++];e(Lt.charCodeAt(St));)n+=Lt[St++];a=Lt[St]}if("e"===a||"E"===a)if(n+=Lt[St++],a=Lt[St],("+"===a||"-"===a)&&(n+=Lt[St++]),e(Lt.charCodeAt(St)))for(;e(Lt.charCodeAt(St));)n+=Lt[St++];else R({},kt.UnexpectedToken,"ILLEGAL");return s(Lt.charCodeAt(St))&&R({},kt.UnexpectedToken,"ILLEGAL"),{type:_t.NumericLiteral,value:parseFloat(n),lineNumber:Mt,lineStart:Tt,start:i,end:St}}function b(){var e,n,i,s,o,l,u,c,d="",p=!1;for(u=Mt,c=Tt,e=Lt[St],t("'"===e||'"'===e,"String literal must starts with a quote"),n=St,++St;Ct>St;){if(i=Lt[St++],i===e){e="";break}if("\\"===i)if(i=Lt[St++],i&&a(i.charCodeAt(0)))++Mt,"\r"===i&&"\n"===Lt[St]&&++St,Tt=St;else switch(i){case"u":case"x":"{"===Lt[St]?(++St,d+=f()):(l=St,o=h(i),o?d+=o:(St=l,d+=i));break;case"n":d+="\n";break;case"r":d+="\r";break;case"t":d+="	";break;case"b":d+="\b";break;case"f":d+="\f";break;case"v":d+="";break;default:r(i)?(s="01234567".indexOf(i),0!==s&&(p=!0),Ct>St&&r(Lt[St])&&(p=!0,s=8*s+"01234567".indexOf(Lt[St++]),"0123".indexOf(i)>=0&&Ct>St&&r(Lt[St])&&(s=8*s+"01234567".indexOf(Lt[St++]))),d+=String.fromCharCode(s)):d+=i}else{if(a(i.charCodeAt(0)))break;d+=i}}return""!==e&&R({},kt.UnexpectedToken,"ILLEGAL"),{type:_t.StringLiteral,value:d,octal:p,startLineNumber:u,startLineStart:c,lineNumber:Mt,lineStart:Tt,start:n,end:St}}function w(t,e){var n,r=t;e.indexOf("u")>=0&&(r=r.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(t,e){return parseInt(e,16)<=1114111?"x":void R({},kt.InvalidRegExp)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{n=new RegExp(r)}catch(i){R({},kt.InvalidRegExp)}try{return new RegExp(t,e)}catch(a){return null}}function k(){var e,n,r,i,s;for(e=Lt[St],t("/"===e,"Regular expression literal must start with a slash"),n=Lt[St++],r=!1,i=!1;Ct>St;)if(e=Lt[St++],n+=e,"\\"===e)e=Lt[St++],a(e.charCodeAt(0))&&R({},kt.UnterminatedRegExp),n+=e;else if(a(e.charCodeAt(0)))R({},kt.UnterminatedRegExp);else if(r)"]"===e&&(r=!1);else{if("/"===e){i=!0;break}"["===e&&(r=!0)}return i||R({},kt.UnterminatedRegExp),s=n.substr(1,n.length-2),{value:s,literal:n}}function E(){var t,e,n,r;for(e="",n="";Ct>St&&(t=Lt[St],o(t.charCodeAt(0)));)if(++St,"\\"===t&&Ct>St)if(t=Lt[St],"u"===t){if(++St,r=St,t=h("u"))for(n+=t,e+="\\u";St>r;++r)e+=Lt[r];else St=r,n+="u",e+="\\u";F({},kt.UnexpectedToken,"ILLEGAL")}else e+="\\",F({},kt.UnexpectedToken,"ILLEGAL");else n+=t,e+=t;return{value:n,literal:e}}function L(){var t,e,n,r;return Nt=null,d(),t=St,e=k(),n=E(),r=w(e.value,n.value),Pt.tokenize?{type:_t.RegularExpression,value:r,regex:{pattern:e.value,flags:n.value},lineNumber:Mt,lineStart:Tt,start:t,end:St}:{literal:e.literal+n.literal,value:r,regex:{pattern:e.value,flags:n.value},start:t,end:St}}function A(){var t,e,n,r;return d(),t=St,e={start:{line:Mt,column:St-Tt}},n=L(),e.end={line:Mt,column:St-Tt},Pt.tokenize||(Pt.tokens.length>0&&(r=Pt.tokens[Pt.tokens.length-1],r.range[0]===t&&"Punctuator"===r.type&&("/"===r.value||"/="===r.value)&&Pt.tokens.pop()),Pt.tokens.push({type:"RegularExpression",value:n.literal,regex:n.regex,range:[t,St],loc:e})),n}function S(t){return t.type===_t.Identifier||t.type===_t.Keyword||t.type===_t.BooleanLiteral||t.type===_t.NullLiteral}function M(){var t,e;if(t=Pt.tokens[Pt.tokens.length-1],!t)return A();if("Punctuator"===t.type){if("]"===t.value)return v();if(")"===t.value)return e=Pt.tokens[Pt.openParenToken-1],!e||"Keyword"!==e.type||"if"!==e.value&&"while"!==e.value&&"for"!==e.value&&"with"!==e.value?v():A();if("}"===t.value){if(Pt.tokens[Pt.openCurlyToken-3]&&"Keyword"===Pt.tokens[Pt.openCurlyToken-3].type){if(e=Pt.tokens[Pt.openCurlyToken-4],!e)return v()}else{if(!Pt.tokens[Pt.openCurlyToken-4]||"Keyword"!==Pt.tokens[Pt.openCurlyToken-4].type)return v();if(e=Pt.tokens[Pt.openCurlyToken-5],!e)return A()}return v()}return A()}return"Keyword"===t.type&&"this"!==t.value?A():v()}function T(){var t;return d(),St>=Ct?{type:_t.EOF,lineNumber:Mt,lineStart:Tt,start:St,end:St}:(t=Lt.charCodeAt(St),s(t)?m():40===t||41===t||59===t?v():39===t||34===t?b():46===t?e(Lt.charCodeAt(St+1))?x():v():e(t)?x():Pt.tokenize&&47===t?M():v())}function C(){var t,e,n,r;return d(),t={start:{line:Mt,column:St-Tt}},e=T(),t.end={line:Mt,column:St-Tt},e.type!==_t.EOF&&(n=Lt.slice(e.start,e.end),r={type:xt[e.type],value:n,range:[e.start,e.end],loc:t},e.regex&&(r.regex={pattern:e.regex.pattern,flags:e.regex.flags}),Pt.tokens.push(r)),e}function N(){var t;return t=Nt,St=t.end,Mt=t.lineNumber,Tt=t.lineStart,Nt="undefined"!=typeof Pt.tokens?C():T(),St=t.end,Mt=t.lineNumber,Tt=t.lineStart,t}function I(){var t,e,n;t=St,e=Mt,n=Tt,Nt="undefined"!=typeof Pt.tokens?C():T(),St=t,Mt=e,Tt=n}function P(){this.line=Mt,this.column=St-Tt}function O(){this.start=new P,this.end=null}function D(t){this.start=t.type===_t.StringLiteral?{line:t.startLineNumber,column:t.start-t.startLineStart}:{line:t.lineNumber,column:t.start-t.lineStart},this.end=null}function z(){St=Nt.start,Nt.type===_t.StringLiteral?(Mt=Nt.startLineNumber,Tt=Nt.startLineStart):(Mt=Nt.lineNumber,Tt=Nt.lineStart),Pt.range&&(this.range=[St,0]),Pt.loc&&(this.loc=new O)}function U(t){Pt.range&&(this.range=[t.start,0]),Pt.loc&&(this.loc=new D(t))}function j(){var t,e,n,r;return t=St,e=Mt,n=Tt,d(),r=Mt!==e,St=t,Mt=e,Tt=n,r}function R(e,n){var r,i=Array.prototype.slice.call(arguments,2),a=n.replace(/%(\d)/g,function(e,n){return t(n<i.length,"Message reference must be in range"),i[n]});throw"number"==typeof e.lineNumber?(r=new Error("Line "+e.lineNumber+": "+a),r.index=e.start,r.lineNumber=e.lineNumber,r.column=e.start-Tt+1):(r=new Error("Line "+Mt+": "+a),r.index=St,r.lineNumber=Mt,r.column=St-Tt+1),r.description=a,r}function F(){try{R.apply(null,arguments)}catch(t){if(!Pt.errors)throw t;Pt.errors.push(t)}}function q(t){if(t.type===_t.EOF&&R(t,kt.UnexpectedEOS),t.type===_t.NumericLiteral&&R(t,kt.UnexpectedNumber),t.type===_t.StringLiteral&&R(t,kt.UnexpectedString),t.type===_t.Identifier&&R(t,kt.UnexpectedIdentifier),t.type===_t.Keyword){if(l(t.value))R(t,kt.UnexpectedReserved);else if(At&&u(t.value))return void F(t,kt.StrictReservedWord);R(t,kt.UnexpectedToken,t.value)}R(t,kt.UnexpectedToken,t.value)}function G(t){var e=N();(e.type!==_t.Punctuator||e.value!==t)&&q(e)}function V(t){if(Pt.errors){var e=Nt;e.type!==_t.Punctuator&&e.value!==t?F(e,kt.UnexpectedToken,e.value):N()}else G(t)}function B(t){return Nt.type===_t.Punctuator&&Nt.value===t}function W(t){return Nt.type===_t.Keyword&&Nt.value===t}function $(){var t;return 59===Lt.charCodeAt(St)||B(";")?void N():(t=Mt,d(),void(Mt===t&&(Nt.type===_t.EOF||B("}")||q(Nt))))}function H(){var t=[],e=new z;for(G("[");!B("]");)B(",")?(N(),t.push(null)):(t.push(ut()),B("]")||G(","));return N(),e.finishArrayExpression(t)}function Y(){var t,e=new z;return t=N(),t.type===_t.StringLiteral||t.type===_t.NumericLiteral?(At&&t.octal&&F(t,kt.StrictOctalLiteral),e.finishLiteral(t)):e.finishIdentifier(t.value)}function X(){var t,e,n,r,i=new z;return t=Nt,t.type===_t.Identifier?(n=Y(),G(":"),r=ut(),i.finishProperty("init",n,r)):t.type!==_t.EOF&&t.type!==_t.Punctuator?(e=Y(),G(":"),r=ut(),i.finishProperty("init",e,r)):void q(t)}function K(){var t,e,n,r,i=[],a={},s=String,o=new z;for(G("{");!B("}");)t=X(),e=t.key.type===bt.Identifier?t.key.name:s(t.key.value),r="init"===t.kind?wt.Data:"get"===t.kind?wt.Get:wt.Set,n="$"+e,Object.prototype.hasOwnProperty.call(a,n)?(a[n]===wt.Data?At&&r===wt.Data?F({},kt.StrictDuplicateProperty):r!==wt.Data&&F({},kt.AccessorDataProperty):r===wt.Data?F({},kt.AccessorDataProperty):a[n]&r&&F({},kt.AccessorGetSet),a[n]|=r):a[n]=r,i.push(t),B("}")||V(",");return G("}"),o.finishObjectExpression(i)}function Z(){var t;return G("("),++It.parenthesisCount,t=ct(),G(")"),t}function J(){var t,e,n,r;if(B("("))return Z();if(B("["))return H();if(B("{"))return K();if(t=Nt.type,r=new z,t===_t.Identifier||Ot[Nt.value])n=r.finishIdentifier(N().value);else if(t===_t.StringLiteral||t===_t.NumericLiteral)At&&Nt.octal&&F(Nt,kt.StrictOctalLiteral),n=r.finishLiteral(N());else{if(t===_t.Keyword)throw new Error("Disabled.");t===_t.BooleanLiteral?(e=N(),e.value="true"===e.value,n=r.finishLiteral(e)):t===_t.NullLiteral?(e=N(),e.value=null,n=r.finishLiteral(e)):B("/")||B("/=")?(n=r.finishLiteral("undefined"!=typeof Pt.tokens?A():L()),I()):q(N())}return n}function Q(){var t=[];if(G("("),!B(")"))for(;Ct>St&&(t.push(ut()),!B(")"));)V(",");return G(")"),t}function tt(){var t,e=new z;return t=N(),S(t)||q(t),e.finishIdentifier(t.value)}function et(){return G("."),tt()}function nt(){var t;return G("["),t=ct(),G("]"),t}function rt(){var t,e,n,r,i=It.allowIn;for(r=Nt,It.allowIn=!0,t=J();;)if(B("."))n=et(),t=new U(r).finishMemberExpression(".",t,n);else if(B("("))e=Q(),t=new U(r).finishCallExpression(t,e);else{if(!B("["))break;n=nt(),t=new U(r).finishMemberExpression("[",t,n)}return It.allowIn=i,t}function it(){var t;if(t=rt(),Nt.type===_t.Punctuator&&(B("++")||B("--"))&&!j())throw new Error("Disabled.");return t}function at(){var t,e,n;if(Nt.type!==_t.Punctuator&&Nt.type!==_t.Keyword)e=it();else{if(B("++")||B("--"))throw new Error("Disabled.");if(B("+")||B("-")||B("~")||B("!"))n=Nt,t=N(),e=at(),e=new U(n).finishUnaryExpression(t.value,e);else{if(W("delete")||W("void")||W("typeof"))throw new Error("Disabled.");e=it()}}return e}function st(t,e){var n=0;if(t.type!==_t.Punctuator&&t.type!==_t.Keyword)return 0;switch(t.value){case"||":n=1;break;case"&&":n=2;break;case"|":n=3;break;case"^":n=4;break;case"&":n=5;break;case"==":case"!=":case"===":case"!==":n=6;break;case"<":case">":case"<=":case">=":case"instanceof":n=7;break;case"in":n=e?7:0;break;case"<<":case">>":case">>>":n=8;break;case"+":case"-":n=9;break;case"*":case"/":case"%":n=11}return n}function ot(){var t,e,n,r,i,a,s,o,l,u;if(t=Nt,l=at(),r=Nt,i=st(r,It.allowIn),0===i)return l;for(r.prec=i,N(),e=[t,Nt],s=at(),a=[l,r,s];(i=st(Nt,It.allowIn))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)s=a.pop(),o=a.pop().value,l=a.pop(),e.pop(),n=new U(e[e.length-1]).finishBinaryExpression(o,l,s),a.push(n);r=N(),r.prec=i,a.push(r),e.push(Nt),n=at(),a.push(n)}for(u=a.length-1,n=a[u],e.pop();u>1;)n=new U(e.pop()).finishBinaryExpression(a[u-1].value,a[u-2],n),u-=2;return n}function lt(){var t,e,n,r,i;return i=Nt,t=ot(),B("?")&&(N(),e=It.allowIn,It.allowIn=!0,n=ut(),It.allowIn=e,G(":"),r=ut(),t=new U(i).finishConditionalExpression(t,n,r)),t}function ut(){var t,e,n,r;return t=It.parenthesisCount,r=Nt,e=Nt,n=lt()}function ct(){var t;if(t=ut(),B(","))throw new Error("Disabled.");return t}function dt(t){var e=ct();return $(),t.finishExpressionStatement(e)}function ht(){var t,e,n=Nt.type;if(n===_t.EOF&&q(Nt),n===_t.Punctuator&&"{"===Nt.value)throw new Error("Disabled.");if(e=new z,n===_t.Punctuator)switch(Nt.value){case";":throw new Error("Disabled.");case"(":return dt(e)}else if(n===_t.Keyword)throw new Error("Disabled.");return t=ct(),$(),e.finishExpressionStatement(t)}function ft(){if(Nt.type===_t.Keyword)switch(Nt.value){case"const":case"let":throw new Error("Disabled.");case"function":throw new Error("Disabled.");default:return ht()}return Nt.type!==_t.EOF?ht():void 0}function pt(){for(var t,e,n,r,i=[];Ct>St&&(e=Nt,e.type===_t.StringLiteral)&&(t=ft(),i.push(t),t.expression.type===bt.Literal);)n=Lt.slice(e.start+1,e.end-1),"use strict"===n?(At=!0,r&&F(r,kt.StrictOctalLiteral)):!r&&e.octal&&(r=e);for(;Ct>St&&(t=ft(),"undefined"!=typeof t);)i.push(t);return i}function gt(){var t,e;return d(),I(),e=new z,At=!0,t=pt(),e.finishProgram(t)}function mt(){var t,e,n,r=[];for(t=0;t<Pt.tokens.length;++t)e=Pt.tokens[t],n={type:e.type,value:e.value},e.regex&&(n.regex={pattern:e.regex.pattern,flags:e.regex.flags}),Pt.range&&(n.range=e.range),Pt.loc&&(n.loc=e.loc),r.push(n);Pt.tokens=r}function vt(t,e){var n,r;n=String,"string"==typeof t||t instanceof String||(t=n(t)),Lt=t,St=0,Mt=Lt.length>0?1:0,Tt=0,Ct=Lt.length,Nt=null,It={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Pt={},e=e||{},e.tokens=!0,Pt.tokens=[],Pt.tokenize=!0,Pt.openParenToken=-1,Pt.openCurlyToken=-1,Pt.range="boolean"==typeof e.range&&e.range,Pt.loc="boolean"==typeof e.loc&&e.loc,"boolean"==typeof e.tolerant&&e.tolerant&&(Pt.errors=[]);try{if(I(),Nt.type===_t.EOF)return Pt.tokens;for(N();Nt.type!==_t.EOF;)try{N()}catch(i){if(Pt.errors){Pt.errors.push(i);break}throw i}mt(),r=Pt.tokens,"undefined"!=typeof Pt.errors&&(r.errors=Pt.errors)}catch(a){throw a}finally{Pt={}}return r}function yt(t,e){var n,r;r=String,"string"==typeof t||t instanceof String||(t=r(t)),Lt=t,St=0,Mt=Lt.length>0?1:0,Tt=0,Ct=Lt.length,Nt=null,It={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Pt={},"undefined"!=typeof e&&(Pt.range="boolean"==typeof e.range&&e.range,Pt.loc="boolean"==typeof e.loc&&e.loc,Pt.loc&&null!==e.source&&void 0!==e.source&&(Pt.source=r(e.source)),"boolean"==typeof e.tokens&&e.tokens&&(Pt.tokens=[]),"boolean"==typeof e.tolerant&&e.tolerant&&(Pt.errors=[]));try{n=gt(),"undefined"!=typeof Pt.tokens&&(mt(),n.tokens=Pt.tokens),"undefined"!=typeof Pt.errors&&(n.errors=Pt.errors)}catch(i){throw i}finally{Pt={}}return n}var _t,xt,bt,wt,kt,Et,Lt,At,St,Mt,Tt,Ct,Nt,It,Pt;_t={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},xt={},xt[_t.BooleanLiteral]="Boolean",xt[_t.EOF]="<end>",xt[_t.Identifier]="Identifier",xt[_t.Keyword]="Keyword",xt[_t.NullLiteral]="Null",xt[_t.NumericLiteral]="Numeric",xt[_t.Punctuator]="Punctuator",xt[_t.StringLiteral]="String",xt[_t.RegularExpression]="RegularExpression",bt={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ExpressionStatement:"ExpressionStatement",Identifier:"Identifier",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression"},wt={Data:1,Get:2,Set:4},kt={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",
NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},Et={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԯԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠ-ࢲࣤ-ॣ०-९ॱ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧ᪰-᪽ᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶ᳸᳹ᴀ-᷵᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚝꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꧠ-ꧾꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︭︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},U.prototype=z.prototype={finish:function(){Pt.range&&(this.range[1]=St),Pt.loc&&(this.loc.end=new P,Pt.source&&(this.loc.source=Pt.source))},finishArrayExpression:function(t){return this.type=bt.ArrayExpression,this.elements=t,this.finish(),this},finishAssignmentExpression:function(t,e,n){return this.type=bt.AssignmentExpression,this.operator=t,this.left=e,this.right=n,this.finish(),this},finishBinaryExpression:function(t,e,n){return this.type="||"===t||"&&"===t?bt.LogicalExpression:bt.BinaryExpression,this.operator=t,this.left=e,this.right=n,this.finish(),this},finishCallExpression:function(t,e){return this.type=bt.CallExpression,this.callee=t,this.arguments=e,this.finish(),this},finishConditionalExpression:function(t,e,n){return this.type=bt.ConditionalExpression,this.test=t,this.consequent=e,this.alternate=n,this.finish(),this},finishExpressionStatement:function(t){return this.type=bt.ExpressionStatement,this.expression=t,this.finish(),this},finishIdentifier:function(t){return this.type=bt.Identifier,this.name=t,this.finish(),this},finishLiteral:function(t){return this.type=bt.Literal,this.value=t.value,this.raw=Lt.slice(t.start,t.end),t.regex&&("//"==this.raw&&(this.raw="/(?:)/"),this.regex=t.regex),this.finish(),this},finishMemberExpression:function(t,e,n){return this.type=bt.MemberExpression,this.computed="["===t,this.object=e,this.property=n,this.finish(),this},finishObjectExpression:function(t){return this.type=bt.ObjectExpression,this.properties=t,this.finish(),this},finishProgram:function(t){return this.type=bt.Program,this.body=t,this.finish(),this},finishProperty:function(t,e,n){return this.type=bt.Property,this.key=e,this.value=n,this.kind=t,this.finish(),this},finishUnaryExpression:function(t,e){return this.type="++"===t||"--"===t?bt.UpdateExpression:bt.UnaryExpression,this.operator=t,this.argument=e,this.prefix=!0,this.finish(),this}};var Ot={"if":1,"this":1};return{tokenize:vt,parse:yt}}()},{}],89:[function(t,e,n){function r(t,e,n,r){(e||[]).forEach(function(e,a){n[a]=n[a]||s(t),i(e,a,n[a],r)})}function i(t,e,n,r){void 0!==t.scale&&n.scale(r.scale(t.scale)),n.orient(t.orient||l[t.type]),n.offset(t.offset||0),n.layer(t.layer||"front"),n.grid(t.grid||!1),n.title(t.title||null),n.titleOffset(null!=t.titleOffset?t.titleOffset:o.axis.titleOffset),n.tickValues(t.values||null),n.tickFormat(t.format||null),n.tickSubdivide(t.subdivide||0),n.tickPadding(t.tickPadding||o.axis.padding);var i=[];if(void 0!==t.tickSize)for(var s=0;3>s;++s)i.push(t.tickSize);else{var u=o.axis.tickSize;i=[u,u,u]}null!=t.tickSizeMajor&&(i[0]=t.tickSizeMajor),null!=t.tickSizeMinor&&(i[1]=t.tickSizeMinor),null!=t.tickSizeEnd&&(i[2]=t.tickSizeEnd),i.length&&n.tickSize.apply(n,i),n.tickCount(t.ticks||o.axis.ticks);var c=t.properties;c&&c.ticks?(n.majorTickProperties(c.majorTicks?a.extend({},c.ticks,c.majorTicks):c.ticks),n.minorTickProperties(c.minorTicks?a.extend({},c.ticks,c.minorTicks):c.ticks)):(n.majorTickProperties(c&&c.majorTicks||{}),n.minorTickProperties(c&&c.minorTicks||{})),n.tickLabelProperties(c&&c.labels||{}),n.titleProperties(c&&c.title||{}),n.gridLineProperties(c&&c.grid||{}),n.domainProperties(c&&c.axis||{})}var a=t("datalib/src/util"),s=t("../scene/axis"),o=t("../util/config"),l={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};e.exports=r},{"../scene/axis":113,"../util/config":137,"datalib/src/util":21}],90:[function(t,e,n){function r(t){return null==t?null:i.rgb(t)+""}var i=window.d3;e.exports=r},{}],91:[function(t,e,n){function r(t,e,n){function u(e){return function(r,i){r?l.error("LOADING FAILED: "+e.url+" "+r):t.data(e.name).values(a(i,e.format)),0===--c&&n()}}var c=0;return(e||[]).forEach(function(e){e.url&&(c+=1,i(s.extend({url:e.url},o.load),u(e))),r.datasource(t,e)}),0===c&&setTimeout(n,1),e}var i=t("datalib/src/import/load"),a=t("datalib/src/import/read"),s=t("datalib/src/util"),o=t("../util/config"),l=t("../util/log"),u=t("./transforms"),c=t("./modify");r.datasource=function(t,e){var n=(e.transform||[]).map(function(e){return u(t,e)}),r=(e.modify||[]).map(function(n){return c(t,n,e)}),i=t.data(e.name,r.concat(n));return e.values?i.values(a(e.values,e.format)):e.source&&(i.source(e.source).revises(i.revises()).addListener(i),t.removeListener(i.pipeline()[0])),i};e.exports=r},{"../util/config":137,"../util/log":139,"./modify":99,"./transforms":106,"datalib/src/import/load":14,"datalib/src/import/read":15,"datalib/src/util":21}],92:[function(t,e,n){e.exports=function(){function t(t,e){function n(){this.constructor=t}n.prototype=e.prototype,t.prototype=new n}function e(t,e,n,r,i,a){this.message=t,this.expected=e,this.found=n,this.offset=r,this.line=i,this.column=a,this.name="SyntaxError"}function n(t){function n(e){function n(e,n,r){var i,a;for(i=n;r>i;i++)a=t.charAt(i),"\n"===a?(e.seenCR||e.line++,e.column=1,e.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(e.line++,e.column=1,e.seenCR=!0):(e.column++,e.seenCR=!1)}return le!==e&&(le>e&&(le=0,ue={line:1,column:1,seenCR:!1}),n(ue,le,e),le=e),ue}function r(t){ce>se||(se>ce&&(ce=se,de=[]),de.push(t))}function i(r,i,a){function s(t){var e=1;for(t.sort(function(t,e){return t.description<e.description?-1:t.description>e.description?1:0});e<t.length;)t[e-1]===t[e]?t.splice(e,1):e++}function o(t,e){function n(t){function e(t){return t.charCodeAt(0).toString(16).toUpperCase()}return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(t){return"\\x0"+e(t)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(t){return"\\x"+e(t)}).replace(/[\u0180-\u0FFF]/g,function(t){return"\\u0"+e(t)}).replace(/[\u1080-\uFFFF]/g,function(t){return"\\u"+e(t)})}var r,i,a,s=new Array(t.length);for(a=0;a<t.length;a++)s[a]=t[a].description;return r=t.length>1?s.slice(0,-1).join(", ")+" or "+s[t.length-1]:s[0],i=e?'"'+n(e)+'"':"end of input","Expected "+r+" but "+i+" found."}var l=n(a),u=a<t.length?t.charAt(a):null;return null!==i&&s(i),new e(null!==r?r:o(i,u),i,u,a,l.line,l.column)}function a(){var t;return t=s()}function s(){var e,n,i,a,l,u;return e=se,n=o(),n!==_?(i=m(),i!==_?(44===t.charCodeAt(se)?(a=k,se++):(a=_,0===he&&r(E)),a!==_?(l=m(),l!==_?(u=s(),u!==_?(oe=e,n=L(n,u),e=n):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w),e===_&&(e=se,n=o(),n!==_&&(oe=e,n=A(n)),e=n),e}function o(){var e,n,i,a,s,u,c,d,h,f,p,g,v,y;return e=se,91===t.charCodeAt(se)?(n=S,se++):(n=_,0===he&&r(M)),n!==_?(i=m(),i!==_?(a=l(),a!==_?(s=m(),s!==_?(44===t.charCodeAt(se)?(u=k,se++):(u=_,0===he&&r(E)),u!==_?(c=m(),c!==_?(d=l(),d!==_?(h=m(),h!==_?(93===t.charCodeAt(se)?(f=T,se++):(f=_,0===he&&r(C)),f!==_?(p=m(),p!==_?(62===t.charCodeAt(se)?(g=N,se++):(g=_,0===he&&r(I)),g!==_?(v=m(),v!==_?(y=o(),y!==_?(oe=e,n=P(a,d,y),e=n):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w),e===_&&(e=l()),e}function l(){var t,e,n,r;if(t=se,e=u(),e!==_){if(n=[],r=h(),r!==_)for(;r!==_;)n.push(r),r=h();else n=w;n!==_?(oe=t,e=O(e,n),t=e):(se=t,t=w)}else se=t,t=w;return t===_&&(t=se,e=u(),e!==_&&(oe=t,e=D(e)),t=e),t}function u(){var e,n,i,a,o;return e=se,40===t.charCodeAt(se)?(n=z,se++):(n=_,0===he&&r(U)),n!==_?(i=s(),i!==_?(41===t.charCodeAt(se)?(a=j,se++):(a=_,0===he&&r(R)),a!==_?(oe=e,n=F(i),e=n):(se=e,e=w)):(se=e,e=w)):(se=e,e=w),e===_&&(e=se,64===t.charCodeAt(se)?(n=q,se++):(n=_,0===he&&r(G)),n!==_?(i=f(),i!==_?(58===t.charCodeAt(se)?(a=V,se++):(a=_,0===he&&r(B)),a!==_?(o=d(),o!==_?(oe=e,n=W(i,o),e=n):(se=e,e=w)):(se=e,e=w)):(se=e,e=w)):(se=e,e=w),e===_&&(e=se,n=c(),n!==_?(58===t.charCodeAt(se)?(i=V,se++):(i=_,0===he&&r(B)),i!==_?(a=d(),a!==_?(oe=e,n=$(n,a),e=n):(se=e,e=w)):(se=e,e=w)):(se=e,e=w),e===_&&(e=se,n=p(),n!==_?(58===t.charCodeAt(se)?(i=V,se++):(i=_,0===he&&r(B)),i!==_?(a=d(),a!==_?(oe=e,n=H(n,a),e=n):(se=e,e=w)):(se=e,e=w)):(se=e,e=w),e===_&&(e=se,n=d(),n!==_&&(oe=e,n=Y(n)),e=n,e===_&&(e=se,n=f(),n!==_&&(oe=e,n=X(n)),e=n))))),e}function c(){var e;return t.substr(se,4)===K?(e=K,se+=4):(e=_,0===he&&r(Z)),e===_&&(t.substr(se,6)===J?(e=J,se+=6):(e=_,0===he&&r(Q)),e===_&&(t.substr(se,4)===tt?(e=tt,se+=4):(e=_,0===he&&r(et)),e===_&&(t.substr(se,3)===nt?(e=nt,se+=3):(e=_,0===he&&r(rt)),e===_&&(t.substr(se,4)===it?(e=it,se+=4):(e=_,0===he&&r(at)),e===_&&(t.substr(se,4)===st?(e=st,se+=4):(e=_,0===he&&r(ot)),e===_&&(t.substr(se,4)===lt?(e=lt,se+=4):(e=_,0===he&&r(ut)),e===_&&(t.substr(se,5)===ct?(e=ct,se+=5):(e=_,0===he&&r(dt)),e===_&&(t.substr(se,4)===ht?(e=ht,se+=4):(e=_,0===he&&r(ft)),e===_&&(t.substr(se,5)===pt?(e=pt,se+=5):(e=_,0===he&&r(gt))))))))))),e}function d(){var e;return t.substr(se,9)===mt?(e=mt,se+=9):(e=_,0===he&&r(vt)),e===_&&(t.substr(se,7)===yt?(e=yt,se+=7):(e=_,0===he&&r(_t)),e===_&&(t.substr(se,5)===xt?(e=xt,se+=5):(e=_,0===he&&r(bt)),e===_&&(t.substr(se,8)===wt?(e=wt,se+=8):(e=_,0===he&&r(kt)),e===_&&(t.substr(se,5)===Et?(e=Et,se+=5):(e=_,0===he&&r(Lt)),e===_&&(t.substr(se,7)===At?(e=At,se+=7):(e=_,0===he&&r(St)),e===_&&(t.substr(se,8)===Mt?(e=Mt,se+=8):(e=_,0===he&&r(Tt)),e===_&&(t.substr(se,5)===Ct?(e=Ct,se+=5):(e=_,0===he&&r(Nt)),e===_&&(t.substr(se,10)===It?(e=It,se+=10):(e=_,0===he&&r(Pt)),e===_&&(t.substr(se,9)===Ot?(e=Ot,se+=9):(e=_,0===he&&r(Dt)),e===_&&(t.substr(se,8)===zt?(e=zt,se+=8):(e=_,0===he&&r(Ut)),e===_&&(t.substr(se,9)===jt?(e=jt,se+=9):(e=_,0===he&&r(Rt)),e===_&&(t.substr(se,10)===Ft?(e=Ft,se+=10):(e=_,0===he&&r(qt)),e===_&&(t.substr(se,10)===Gt?(e=Gt,se+=10):(e=_,0===he&&r(Vt)),e===_&&(t.substr(se,9)===Bt?(e=Bt,se+=9):(e=_,0===he&&r(Wt)),e===_&&(t.substr(se,8)===$t?(e=$t,se+=8):(e=_,0===he&&r(Ht))))))))))))))))),e}function h(){var e,n,i,a;return e=se,91===t.charCodeAt(se)?(n=S,se++):(n=_,0===he&&r(M)),n!==_?(i=g(),i!==_?(93===t.charCodeAt(se)?(a=T,se++):(a=_,0===he&&r(C)),a!==_?(oe=e,n=Yt(i),e=n):(se=e,e=w)):(se=e,e=w)):(se=e,e=w),e}function f(){var e,n,i;if(e=se,n=[],Xt.test(t.charAt(se))?(i=t.charAt(se),se++):(i=_,0===he&&r(Kt)),i!==_)for(;i!==_;)n.push(i),Xt.test(t.charAt(se))?(i=t.charAt(se),se++):(i=_,0===he&&r(Kt));else n=w;return n!==_&&(oe=e,n=Zt(n)),e=n}function p(){var e,n,i;if(e=se,n=[],Jt.test(t.charAt(se))?(i=t.charAt(se),se++):(i=_,0===he&&r(Qt)),i!==_)for(;i!==_;)n.push(i),Jt.test(t.charAt(se))?(i=t.charAt(se),se++):(i=_,0===he&&r(Qt));else n=w;return n!==_&&(oe=e,n=te(n)),e=n}function g(){var e,n,i;if(e=se,n=[],ee.test(t.charAt(se))?(i=t.charAt(se),se++):(i=_,0===he&&r(ne)),i!==_)for(;i!==_;)n.push(i),ee.test(t.charAt(se))?(i=t.charAt(se),se++):(i=_,0===he&&r(ne));else n=w;return n!==_&&(oe=e,n=re(n)),e=n}function m(){var e,n;for(e=[],ie.test(t.charAt(se))?(n=t.charAt(se),se++):(n=_,0===he&&r(ae));n!==_;)e.push(n),ie.test(t.charAt(se))?(n=t.charAt(se),se++):(n=_,0===he&&r(ae));return e}var v,y=arguments.length>1?arguments[1]:{},_={},x={start:a},b=a,w=_,k=",",E={type:"literal",value:",",description:'","'},L=function(t,e){return[t].concat(e)},A=function(t){return[t]},S="[",M={type:"literal",value:"[",description:'"["'},T="]",C={type:"literal",value:"]",description:'"]"'},N=">",I={type:"literal",value:">",description:'">"'},P=function(t,e,n){return{start:t,end:e,middle:n}},O=function(t,e){return t.filters=e,t},D=function(t){return t},z="(",U={type:"literal",value:"(",description:'"("'},j=")",R={type:"literal",value:")",description:'")"'},F=function(t){return{stream:t}},q="@",G={type:"literal",value:"@",description:'"@"'},V=":",B={type:"literal",value:":",description:'":"'},W=function(t,e){return{event:e,name:t}},$=function(t,e){return{event:e,mark:t}},H=function(t,e){return{event:e,target:t}},Y=function(t){return{event:t}},X=function(t){return{signal:t}},K="rect",Z={type:"literal",value:"rect",description:'"rect"'},J="symbol",Q={type:"literal",value:"symbol",description:'"symbol"'},tt="path",et={type:"literal",value:"path",description:'"path"'},nt="arc",rt={type:"literal",value:"arc",description:'"arc"'},it="area",at={type:"literal",value:"area",description:'"area"'},st="line",ot={type:"literal",value:"line",description:'"line"'},lt="rule",ut={type:"literal",value:"rule",description:'"rule"'},ct="image",dt={type:"literal",value:"image",description:'"image"'},ht="text",ft={type:"literal",value:"text",description:'"text"'},pt="group",gt={type:"literal",value:"group",description:'"group"'},mt="mousedown",vt={type:"literal",value:"mousedown",description:'"mousedown"'},yt="mouseup",_t={type:"literal",value:"mouseup",description:'"mouseup"'},xt="click",bt={type:"literal",value:"click",description:'"click"'},wt="dblclick",kt={type:"literal",value:"dblclick",description:'"dblclick"'},Et="wheel",Lt={type:"literal",value:"wheel",description:'"wheel"'},At="keydown",St={type:"literal",value:"keydown",description:'"keydown"'},Mt="keypress",Tt={type:"literal",value:"keypress",description:'"keypress"'},Ct="keyup",Nt={type:"literal",value:"keyup",description:'"keyup"'},It="mousewheel",Pt={type:"literal",value:"mousewheel",description:'"mousewheel"'},Ot="mousemove",Dt={type:"literal",value:"mousemove",description:'"mousemove"'},zt="mouseout",Ut={type:"literal",value:"mouseout",description:'"mouseout"'},jt="mouseover",Rt={type:"literal",value:"mouseover",description:'"mouseover"'},Ft="mouseenter",qt={type:"literal",value:"mouseenter",description:'"mouseenter"'},Gt="touchstart",Vt={type:"literal",value:"touchstart",description:'"touchstart"'},Bt="touchmove",Wt={type:"literal",value:"touchmove",description:'"touchmove"'},$t="touchend",Ht={type:"literal",value:"touchend",description:'"touchend"'},Yt=function(t){return t},Xt=/^[a-zA-Z0-9_\-]/,Kt={type:"class",value:"[a-zA-Z0-9_\\-]",description:"[a-zA-Z0-9_\\-]"},Zt=function(t){return t.join("")},Jt=/^[a-zA-Z0-9\-_  #.>+~[\]=|\^$*]/,Qt={type:"class",value:"[a-zA-Z0-9\\-_  #.>+~[\\]=|\\^$*]",description:"[a-zA-Z0-9\\-_  #.>+~[\\]=|\\^$*]"},te=function(t){return t.join("")},ee=/^['"a-zA-Z0-9_.><=! \t-&|~]/,ne={type:"class",value:"['\"a-zA-Z0-9_.><=! \\t-&|~]",description:"['\"a-zA-Z0-9_.><=! \\t-&|~]"},re=function(t){return t.join("")},ie=/^[ \t\r\n]/,ae={type:"class",value:"[ \\t\\r\\n]",description:"[ \\t\\r\\n]"},se=0,oe=0,le=0,ue={line:1,column:1,seenCR:!1},ce=0,de=[],he=0;if("startRule"in y){if(!(y.startRule in x))throw new Error("Can't start parsing from rule \""+y.startRule+'".');b=x[y.startRule]}if(v=b(),v!==_&&se===t.length)return v;throw v!==_&&se<t.length&&r({type:"end",description:"end of input"}),i(null,de,ce)}return t(e,Error),{SyntaxError:e,parse:n}}()},{}],93:[function(t,e,n){var r=t("datalib/src/util"),i=t("../expression"),a=function(){var t=i.parse,e=i.code({idWhiteList:["datum","event","signals"]});return function(n){var r=e(t(n));return r.fn=Function("datum","event","signals",'"use strict"; return ('+r.fn+");"),r}}();a.eval=function(t,e,n){return n.signals=t.signalValues(r.array(n.signals)),e.call(e,n.datum,n.event,n.signals)},e.exports=a},{"../expression":87,"datalib/src/util":21}],94:[function(t,e,n){e.exports={axes:t("./axes"),background:t("./background"),data:t("./data"),events:t("./events"),expr:t("./expr"),interactors:t("./interactors"),legends:t("./legends"),mark:t("./mark"),marks:t("./marks"),modify:t("./modify"),padding:t("./padding"),predicates:t("./predicates"),properties:t("./properties"),signals:t("./signals"),spec:t("./spec"),streams:t("./streams"),transforms:t("./transforms")}},{"./axes":89,"./background":90,"./data":91,"./events":92,"./expr":93,"./interactors":95,"./legends":96,"./mark":97,"./marks":98,"./modify":99,"./padding":100,"./predicates":101,"./properties":102,"./signals":103,"./spec":104,"./streams":105,"./transforms":106}],95:[function(t,e,n){function r(t,e,n){function r(t){return function(e,n){if(e)o.error("LOADING FAILED: "+t.url);else{var r=a.isObject(n)&&!a.isBuffer(n)?n:JSON.parse(n);u(t.name,r)}0==--y&&c()}}function u(t,e){_={},x={},e.signals&&w.push.apply(w,f(t,e.signals)),e.predicates&&k.push.apply(k,p(t,e.predicates)),m(t,e.marks)}function c(){a.keys(b).length>0&&d(e.marks),e.signals=a.array(e.signals),e.predicates=a.array(e.predicates),e.signals.unshift.apply(e.signals,w),e.predicates.unshift.apply(e.predicates,k),n()}function d(t){var e,n,r,i;for(t=a.array(t),r=0,i=t.length;i>r;r++)e=t[r],(n=b[e.name])?(t[r]=a.duplicate(n),e.from&&(t[r].from=e.from),e.properties&&[l.ENTER,l.UPDATE,l.EXIT].forEach(function(i){t[r].properties[i]=a.extend(n.properties[i],e.properties[i])})):e.marks&&d(e.marks)}function h(t,e){return a.isString(e)?e+"_"+t:(a.keys(e).forEach(function(n){var r=new RegExp("\\b"+n+"\\b","g");t=t.replace(r,e[n])}),t)}function f(t,e){return e=a.array(e),e.forEach(function(e){e.name=_[e.name]=h(e.name,t)}),e.forEach(function(t){(t.streams||[]).forEach(function(t){t.type=h(t.type,_),t.expr=h(t.expr,_)})}),e}function p(t,e){return e=a.array(e),e.forEach(function(e){e.name=x[e.name]=h(e.name,t),[e.operands,e.range].forEach(function(t){(t||[]).forEach(function(t){t.signal?t.signal=h(t.signal,_):t.predicate&&g(t)})})}),e}function g(t){t.predicate=x[t.predicate],a.keys(t.input).forEach(function(e){var n=t.input[e];n.signal&&(n.signal=h(n.signal,_))})}function m(t,e){(e||[]).forEach(function(e){v(e.properties.enter),v(e.properties.update),v(e.properties.exit),b[h(e.name,t)]=e})}function v(t){a.keys(t).forEach(function(e){var n=t[e];n.signal?n.signal=h(n.signal,_):n.rule&&n.rule.forEach(function(t){t.signal&&(t.signal=h(t.signal,_)),t.predicate&&g(t)})})}var y=0,_={},x={},b={},w=[],k=[];return(e.interactors||[]).forEach(function(t){t.url&&(y+=1,i(a.extend({url:t.url},s.load),r(t)))}),0===y&&setTimeout(c,1),e}var i=t("datalib/src/import/load"),a=t("datalib/src/util"),s=t("../util/config"),o=t("../util/log"),l=t("../util/constants");e.exports=r},{"../util/config":137,"../util/constants":138,"../util/log":139,"datalib/src/import/load":14,"datalib/src/util":21}],96:[function(t,e,n){function r(t,e,n,r){(e||[]).forEach(function(e,s){n[s]=n[s]||a(t),i(e,s,n[s],r)})}function i(t,e,n,r){n.size(t.size?r.scale(t.size):null),n.shape(t.shape?r.scale(t.shape):null),n.fill(t.fill?r.scale(t.fill):null),n.stroke(t.stroke?r.scale(t.stroke):null),t.orient&&n.orient(t.orient),null!=t.offset&&n.offset(t.offset),n.title(t.title||null),n.values(t.values||null),n.format(void 0!==t.format?t.format:null);var i=t.properties;n.titleProperties(i&&i.title||{}),n.labelProperties(i&&i.labels||{}),n.legendProperties(i&&i.legend||{}),n.symbolProperties(i&&i.symbols||{}),n.gradientProperties(i&&i.gradient||{})}{var a=t("../scene/legend");t("../util/config")}e.exports=r},{"../scene/legend":114,"../util/config":137}],97:[function(t,e,n){function r(t,e){var n=e.properties,s=e.marks;return i.keys(n).forEach(function(r){n[r]=a(t,e.type,n[r])}),e.delay&&(e.delay=a(t,e.type,{delay:e.delay})),s&&(e.marks=s.map(function(e){return r(t,e)})),e}var i=t("datalib/src/util"),a=t("./properties");e.exports=r},{"./properties":102,"datalib/src/util":21}],98:[function(t,e,n){function r(t,e,n,r){return{type:"group",width:n,height:r,scales:e.scales||[],axes:e.axes||[],legends:e.legends||[],marks:(e.marks||[]).map(function(e){return i(t,e)})}}var i=t("./mark");e.exports=r},{"./mark":97}],99:[function(t,e,n){function r(t,e,n){var r=e.signal?i.field(e.signal):null,c=r?r[0]:null,d=e.predicate?t.predicate(e.predicate.name||e.predicate):null,h=null===d,f=new a(t).router(e.type===l.CLEAR);return f.evaluate=function(i){if(null!==d){var a=t.dataValues(d.data||[]);h=d.call(d,{},a,t.signalValues(d.signals||[]),t._predicates)}if(o.debug(i,[e.type+"ing",h]),!h)return i;var c={},f=r?t.signalRef(e.signal):null,p=t.data(n.name),g=p.revises()?null:void 0,m=null;if(c[e.field]=f,e.type===l.ADD)m=s.ingest(c,g),i.add.push(m),p._data.push(m);else if(e.type===l.REMOVE)u(e.field,f,i.add,i.rem),u(e.field,f,i.mod,i.rem),p._data=p._data.filter(function(t){return t[e.field]!==f});else if(e.type===l.TOGGLE){var v=[],y=[];u(e.field,f,i.rem,v),u(e.field,f,i.add,y),u(e.field,f,i.mod,y),0==v.length&&0==y.length&&v.push(s.ingest(c)),i.add.push.apply(i.add,v),p._data.push.apply(p._data,v),i.rem.push.apply(i.rem,y),p._data=p._data.filter(function(t){return-1===y.indexOf(t)})}else e.type===l.CLEAR&&(i.rem.push.apply(i.rem,i.add),i.rem.push.apply(i.rem,i.mod),i.add=[],i.mod=[],p._data=[]);return i.fields[e.field]=1,i},c&&f.dependency(l.SIGNALS,c),d&&f.dependency(l.SIGNALS,d.signals),f}var i=t("datalib/src/util"),a=t("../dataflow/Node"),s=t("../dataflow/tuple"),o=t("../util/log"),l=t("../util/constants"),u=function(t,e,n,r){for(var i=n.length-1;i>=0;--i)n[i][t]==e&&r.push.apply(r,n.splice(i,1))};e.exports=r},{"../dataflow/Node":80,"../dataflow/tuple":83,"../util/constants":138,"../util/log":139,"datalib/src/util":21}],100:[function(t,e,n){function r(t){if(null==t)return"auto";if(i.isString(t))return"strict"===t?"strict":"auto";if(i.isObject(t))return t;var e=i.isNumber(t)?t:20;return{top:e,left:e,right:e,bottom:e}}var i=t("datalib/src/util");e.exports=r},{"datalib/src/util":21}],101:[function(t,e,n){function r(t,e){return(e||[]).forEach(function(e){var n=d[e.type](t,e),r=Function("args","db","signals","predicates",n.code);r.root=function(){return t.scene().items[0]},r.isFunction=c.isFunction,r.signals=n.signals,r.data=n.data,t.predicate(e.name,r)}),e}function i(t,e){var n=c.field(t),r="signals["+n.map(c.str).join("][")+"]";return e[n.shift()]=1,r}function a(t,e){var n=[],r=[],a={},s={};return c.array(e).forEach(function(e,o){var l="o"+o,u="";if(void 0!==e.value)u=c.str(e.value);else if(e.arg)u="args["+c.str(e.arg)+"]";else if(e.signal)u=i(e.signal,a);else if(e.predicate){var d=e.predicate,h=d&&(d.name||d),f=t.predicate(h),p="predicates["+c.str(h)+"]";f.signals.forEach(function(t){a[t]=1}),f.data.forEach(function(t){s[t]=1}),c.isObject(d)&&c.keys(d).forEach(function(t){if("name"!==t){var e=d[t];u+="args["+c.str(t)+"] = ",e.signal?u+=i(e.signal,a):e.arg&&(u+="args["+c.str(e.arg)+"]"),u+=", "}}),u+=p+".call("+p+", args, db, signals, predicates)"}n.push(l),r.push(l+"=("+u+")")}),{code:"var "+n.join(", ")+";\n"+r.join(";\n")+";\n",signals:c.keys(a),data:c.keys(s)}}function s(t,e){var n=a(t,e.operands);return"="==e.type&&(e.type="=="),{code:n.code+"return "+["o0","o1"].join(e.type)+";",signals:n.signals,data:n.data}}function o(t,e){for(var n=a(t,e.operands),r=[],i=0,s=e.operands.length;r.push("o"+i++)<s;);return"and"==e.type?e.type="&&":"or"==e.type&&(e.type="||"),{code:n.code+"return "+r.join(e.type)+";",signals:n.signals,data:n.data}}function l(t,e){var n=[e.item],r="";e.range&&n.push.apply(n,e.range),e.scale&&(r=u(e.scale,n));var i=a(t,n);if(r=i.code+r,e.data){var s=c.field(e.field).map(c.str);r+="var where = function(d) { return d["+s.join("][")+"] == o0 };\n",r+="return db["+c.str(e.data)+"].filter(where).length > 0;"}else e.range&&(e.scale&&(r+="o1 = scale(o1);\no2 = scale(o2);\n"),r+="return o1 < o2 ? o1 <= o0 && o0 <= o2 : o2 <= o0 && o0 <= o1");return{code:r,signals:i.signals,data:i.data.concat(e.data?[e.data]:[])}}function u(t,e){var n="var scale = ",r=e.length;return c.isString(t)?(e.push({value:t}),n+="this.root().scale(o"+r+")"):t.arg?(e.push(t),n+="o"+r):t.name&&(e.push(c.isString(t.name)?{value:t.name}:t.name),n+="(this.isFunction(o"+r+") ? o"+r+" : ",t.scope?(e.push(t.scope),n+="(o"+(r+1)+".scale || this.root().scale)(o"+r+")"):n+="this.root().scale(o"+r+")",n+=")"),t.invert===!0&&(n+=".invert"),n+";\n"}var c=t("datalib/src/util"),d={"=":s,"==":s,"!=":s,">":s,">=":s,"<":s,"<=":s,and:o,"&&":o,or:o,"||":o,"in":l};e.exports=r},{"datalib/src/util":21}],102:[function(t,e,n){function r(t,e,n){var r,o,l,u,p="",v=h.keys(n),y={},_={signals:{},scales:{},data:{},fields:{},reflow:!1};for(p+="var o = trans ? {} : item,\n    dirty = false;\n",r=0,o=v.length;o>r;++r)u=n[l=v[r]],p+=r>0?"\n  ":"  ",u.rule?(u=a(t,l,u.rule),p+="\n  "+u.code):(u=s(l,u),p+="dirty = this.tpl.set(o, "+h.str(l)+", "+u.val+") || dirty;"),y[l]=!0,m.forEach(function(t){null!=u[t]&&h.array(u[t]).forEach(function(e){_[t][e]=1})}),_.reflow=_.reflow||u.reflow;y.x2&&(y.x?(p+="\n  if (o.x > o.x2) { \n    var t = o.x;\n    dirty = this.tpl.set(o, 'x', o.x2) || dirty;\n    dirty = this.tpl.set(o, 'x2', t) || dirty; \n  };",p+="\n  dirty = this.tpl.set(o, 'width', (o.x2 - o.x)) || dirty;"):p+=y.width?"\n  dirty = this.tpl.set(o, 'x', (o.x2 - o.width)) || dirty;":"\n  dirty = this.tpl.set(o, 'x', o.x2) || dirty;"),y.xc&&(p+=y.width?"\n  dirty = this.tpl.set(o, 'x', (o.xc - o.width/2)) || dirty;":"\n  dirty = this.tpl.set(o, 'x', o.xc) || dirty;"),y.y2&&(y.y?(p+="\n  if (o.y > o.y2) { \n    var t = o.y;\n    dirty = this.tpl.set(o, 'y', o.y2) || dirty;\n    dirty = this.tpl.set(o, 'y2', t) || dirty;\n  };",p+="\n  dirty = this.tpl.set(o, 'height', (o.y2 - o.y)) || dirty;"):p+=y.height?"\n  dirty = this.tpl.set(o, 'y', (o.y2 - o.height)) || dirty;":"\n  dirty = this.tpl.set(o, 'y', o.y2) || dirty;"),y.yc&&(p+=y.height?"\n  dirty = this.tpl.set(o, 'y', (o.yc - o.height/2)) || dirty;":"\n  dirty = this.tpl.set(o, 'y', o.yc) || dirty;"),i(e,y)&&(p+="\n  dirty = (item.touch(), true);"),p+="\n  if (trans) trans.interpolate(item, o);",p+="\n  return dirty;";try{var x=Function("item","group","trans","db","signals","predicates",p);return x.tpl=f,x.util=h,x.d3=c,h.extend(x,d.context),{encode:x,signals:h.keys(_.signals),scales:h.keys(_.scales),data:h.keys(_.data),fields:h.keys(_.fields),reflow:_.reflow}}catch(b){g.error(b),g.log(p)}}function i(t,e){return e.path||("area"===t||"line"===t)&&(e.x||e.x2||e.width||e.y||e.y2||e.height||e.tension||e.interpolate)}function a(t,e,n){var r=[],i=[],a=[],o=[],l="";return(n||[]).forEach(function(u,c){var d,f=u.predicate,p=f&&(f.name||f),g=t.predicate(p),m="predicates["+h.str(p)+"]",v=[],y=e+"_arg"+c;h.isObject(f)&&h.keys(f).forEach(function(t){if("name"!==t){var e=s(c,f[t]);v.push(h.str(t)+": "+e.val),e.signals&&r.push.apply(r,h.array(e.signals)),e.scales&&i.push.apply(i,h.array(e.scales))}}),d=s(e,u),d.signals&&r.push.apply(r,h.array(d.signals)),d.scales&&i.push.apply(i,h.array(d.scales)),p?(r.push.apply(r,g.signals),a.push.apply(a,g.data),o.push(y+" = {\n    "+v.join(",\n    ")+"\n  }"),l+="if("+m+".call("+m+","+y+", db, signals, predicates)) {\n    dirty = this.tpl.set(o, "+h.str(e)+", "+d.val+") || dirty;",l+=n[c+1]?"\n  } else ":"  }"):l+="{\n    dirty = this.tpl.set(o, "+h.str(e)+", "+d.val+") || dirty;\n  }\n"}),l="var "+o.join(",\n      ")+";\n  "+l,{code:l,signals:r,scales:i,data:a}}function s(t,e){if(null==e)return null;if("fill"===t||"stroke"===t){if(e.c)return o("hcl",e.h,e.c,e.l);if(e.h||e.s)return o("hsl",e.h,e.s,e.l);if(e.l||e.a)return o("lab",e.l,e.a,e.b);if(e.r||e.g||e.b)return o("rgb",e.r,e.g,e.b)}var n=null,r=null,i={},a={},s={},c=[],f=[],p=!1;return void 0!==e.template&&(n=d.source(e.template,"signals")),void 0!==e.value&&(n=h.str(e.value)),void 0!==e.signal&&(i=h.field(e.signal),n="signals["+i.map(h.str).join("][")+"]",c.push(i.shift())),void 0!==e.field&&(e.field=h.isString(e.field)?{datum:e.field}:e.field,a=l(e.field),n=a.val),void 0!==e.scale&&(s=u(e.scale),r=s.val,n=null!==n||e.band||e.mult||e.offset?r+(e.band?".rangeBand()":"("+(null!==n?n:"item.datum.data")+")"):r),n="("+(e.mult?h.number(e.mult)+" * ":"")+n+")"+(e.offset?" + "+h.number(e.offset):""),{val:n,signals:c.concat(h.array(a.signals)).concat(h.array(s.signals)),fields:f.concat(h.array(a.fields)).concat(h.array(s.fields)),scales:e.scale?e.scale.name||e.scale:null,reflow:p||a.reflow||s.reflow}}function o(t,e,n,r){var i=e?s("",e):p.color[t][0],a=n?s("",n):p.color[t][1],o=r?s("",r):p.color[t][2];return signals=[],scales=[],[i,a,o].forEach(function(t){t.signals&&signals.push.apply(signals,t.signals),t.scales&&scales.push(t.scales)}),{val:"(this.d3."+t+"("+[i.val,a.val,o.val].join(",")+') + "")',signals:signals,scales:scales}}function l(t){if(h.isString(t))return{val:h.field(t).map(h.str).join("][")};var e=t.level,n=(t.group||t.parent)&&e,r=n?Array(e).join("group.mark."):"",i=l(t.datum||t.group||t.parent||t.signal),a=i.val,s=i.fields||[],o=i.signals||[],u=i.reflow||!1;return t.datum?(a="item.datum["+a+"]",s.push(t.datum)):t.group?(a=r+"group["+a+"]",u=!0):t.parent?(a=r+"group.datum["+a+"]",u=!0):t.signal&&(a="signals["+a+"]",o.push(h.field(t.signal)[0]),u=!0),{val:a,fields:s,signals:o,reflow:u}}function u(t){var e=null,n=null;return e=h.isString(t)?h.str(t):t.name?h.isString(t.name)?h.str(t.name):(n=l(t.name)).val:(n=l(t)).val,e="group.scale("+e+")",t.invert&&(e+=".invert"),n?(n.val=e,n):{val:e}}var c=window.d3,d=t("datalib/src/template"),h=t("datalib/src/util"),f=t("../dataflow/tuple"),p=t("../util/config"),g=t("../util/log"),m=["signals","scales","data","fields"];

e.exports=r},{"../dataflow/tuple":83,"../util/config":137,"../util/log":139,"datalib/src/template":19,"datalib/src/util":21}],103:[function(t,e,n){function r(t,e){return(e||[]).forEach(function(e){var n=t.signal(e.name,e.init).verbose(e.verbose);e.init&&e.init.expr&&(e.init.expr=a(e.init.expr),n.value(i(t,e.init))),e.expr&&(e.expr=a(e.expr),n.evaluate=function(r){var a=i(t,e,n.value());return a!==n.value()||n.verbose()?(n.value(a),r.signals[e.name]=1,r):t.doNotPropagate},n.dependency(s.SIGNALS,e.expr.signals),e.expr.signals.forEach(function(e){t.signal(e).addListener(n)}))}),e}function i(t,e,n){var i=e.expr,s=a.eval(t,i.fn,{signals:i.signals});return e.scale?r.scale(t,e,s):s}var a=(t("datalib/src/util"),t("./expr")),s=(t("../expression/functions")(),t("../util/constants"));r.scale=function o(t,e,n){var r=e.scale,i=r.name||r.signal||r,a=r.scope?t.signalRef(r.scope.signal):null;a&&a.scale||(a=a&&a.mark?a.mark.group:t.scene().items[0]);var o=a.scale(i);return o?r.invert?o.invert(n):o(n):n},e.exports=r},{"../expression/functions":86,"../util/constants":138,"./expr":93,"datalib/src/util":21}],104:[function(t,e,n){function r(t,e,n){t=i.duplicate(t),n=n||s.factory;var r=t.width||500,p=t.height||500,g=t.viewport||null,m=new a;f(m,t,function(){m.defs({width:r,height:p,viewport:g,background:o(t.background),padding:l(t.padding),signals:c(m,t.signals),predicates:d(m,t.predicates),marks:u(m,t,r,p),data:h(m,t.data,function(){e(n(m))})})})}var i=t("datalib/src/util"),a=t("../core/Model"),s=t("../core/View"),o=t("../parse/background"),l=t("../parse/padding"),u=t("../parse/marks"),c=t("../parse/signals"),d=t("../parse/predicates"),h=t("../parse/data"),f=t("../parse/interactors");e.exports=r},{"../core/Model":75,"../core/View":76,"../parse/background":90,"../parse/data":91,"../parse/interactors":95,"../parse/marks":98,"../parse/padding":100,"../parse/predicates":101,"../parse/signals":103,"datalib/src/util":21}],105:[function(t,e,n){function r(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}function i(t){function e(t,e,n,r){var i,a,s,o,c=t.handlers[e],h=t.nodes[e],f=u.create(null,!0),p=!1;for(a=0,s=c.length;s>a;a++)o=c[a],p=o.filters.some(function(t){return!d.eval(_,t.fn,{datum:n,event:r,signals:t.signals})}),p||(i=d.eval(_,o.exp.fn,{datum:n,event:r,signals:o.exp.signals}),o.spec.scale&&(i=l.scale(_,o.spec,i)),(i!==o.signal.value()||o.signal.verbose())&&(o.signal.value(i),f.signals[o.signal.name()]=1));_.propagate(f,h)}function n(t,e,r,a){e.forEach(function(e){e.event?i(t,e,r,a):e.signal?m(t,e,r,a):e.start?v(t,e,r,a):e.stream&&n(t,e.stream,r,a)})}function i(t,e,n,r){var i=e.event,a=e.name,l=e.mark,u=e.target,c=e.filters||[],h=u?k:w,f=u?u+":"+i:i,p=h.nodes[f]||(h.nodes[f]=new o(_));handlers=h.handlers[f]||(h.handlers[f]=[]),a?c.push("event.vgItem.mark && event.vgItem.mark.def.name==="+s.str(a)):l&&c.push("event.vgItem.mark && event.vgItem.mark.marktype==="+s.str(l)),handlers.push({signal:t,exp:n,spec:r,filters:c.map(function(t){return d(t)})}),p.addListener(t)}function m(t,e,n,r){var i=new o(_);i.evaluate=function(i){if(!i.signals[e.signal])return _.doNotPropagate;var a=d.eval(_,n.fn,{signals:n.signals});return r.scale&&(a=l.scale(_,r,a)),a!==t.value()&&(t.value(a),i.signals[t.name()]=1,i.reflow=!0),i},i.dependency(h.SIGNALS,e.signal),i.addListener(t),_.signal(e.signal).addListener(i)}function v(t,e,r,a){var s=t.name(),l=d("true"),u={};u[f]=_.signal(s+f,!1),u[p]=_.signal(s+p,!1),u[g]=_.signal(s+g,!1);var c=new o(_);c.evaluate=function(e){return u[f].value()===!0&&u[g].value()===!1?e.signals[s+f]?_.doNotPropagate:(u[p].value()!==t.value()&&(t.value(u[p].value()),e.signals[s]=1),e):(u[g].value()===!0&&(u[f].value(!1),u[g].value(!1)),_.doNotPropagate)},c.addListener(t),[f,p,g].forEach(function(t){var s=t==p?r:l,o=t==p?a:{};e[t].event?i(u[t],e[t],s,o):e[t].signal?m(u[t],e[t],s,o):e[t].stream&&n(u[t],e[t].stream,s,o),u[t].addListener(c)})}function y(t){if(t.vgItem.mark)for(var e,n,i=t.vgItem.mark.group;i;)(e=r(i.mark.def.name))&&(t[(n="vg"+e)+"Item"]=i,i.x&&(t[n+"X"]=t.vgX-i.x),i.y&&(t[n+"Y"]=t.vgY-i.y)),i=i.mark.group}var _=t.model(),x=_.defs().signals,b={handlers:{},nodes:{}},w=s.duplicate(b),k=s.duplicate(b);(x||[]).forEach(function(t){var e=_.signal(t.name);t.expr||(t.streams||[]).forEach(function(t){var r=c.parse(t.type),i=d(t.expr);n(e,r,i,t)})}),s.keys(w.handlers).forEach(function(n){t.on(n,function(i,s){var o,l,u,c=t.padding();i.preventDefault(),o=a.mouse((a.event=i,t._el)),l=s&&s.datum||{},i.vgItem=s||{},i.vgX=o[0]-c.left,i.vgY=o[1]-c.top,y(i),s&&(u=s.mark.def.name)&&(i["vg"+r(u)+"Item"]=s),e(w,n,l,i)})}),s.keys(k.handlers).forEach(function(t){var n=t.split(":");a.selectAll(n[0]).on(n[1],function(n,r){e(k,t,n,a.event)})})}var a=window.d3,s=t("datalib/src/util"),o=t("../dataflow/Node"),l=t("./signals"),u=t("../dataflow/changeset"),c=t("./events"),d=t("./expr"),h=t("../util/constants"),f="start",p="middle",g="end";e.exports=i},{"../dataflow/Node":80,"../dataflow/changeset":82,"../util/constants":138,"./events":92,"./expr":93,"./signals":103,"datalib/src/util":21}],106:[function(t,e,n){function r(t,e){var n=new a[e.type](t);return e.output&&n.output(e.output),i.keys(e).forEach(function(t){"type"!==t&&"output"!==t&&("transform"!==t||"facet"!==e.type)&&n.param(t,e[t])}),n}var i=t("datalib/src/util"),a=t("../transforms/index");e.exports=r},{"../transforms/index":136,"datalib/src/util":21}],107:[function(t,e,n){function r(t,e){return this._mark=e,s.prototype.init.call(this,t).router(!0)}var i=t("datalib/src/util"),a=t("vega-scenegraph/src/util/bound"),s=t("../dataflow/Node"),o=t("./Encoder"),l=t("../util/constants"),u=t("../util/log"),c=r.prototype=new s;c.evaluate=function(t){u.debug(t,["bounds",this._mark.marktype]);var e,n,r,s,c,d,h=this._mark.marktype,f=h===l.GROUP,p=this._mark.items,g=i.array(this._mark.def.legends).length>0;if(t.add.length||t.rem.length||!p.length||h===l.AREA||h===l.LINE?a.mark(this._mark,null,f&&!g):t.mod.forEach(function(t){a.item(t)}),f&&g){for(e=0,n=p.length;n>e;++e)for(c=p[e],c._legendPositions=null,r=0,s=c.legendItems.length;s>r;++r)d=c.legendItems[r],o.update(this._graph,t.trans,"vg_legendPosition",d.items),a.mark(d,null,!0);a.mark(this._mark,null,!0)}return t.reflow=!0,t},e.exports=r},{"../dataflow/Node":80,"../util/constants":138,"../util/log":139,"./Encoder":109,"datalib/src/util":21,"vega-scenegraph/src/util/bound":69}],108:[function(t,e,n){function r(){return arguments.length?this.init.apply(this,arguments):this}function i(){var t,e,n,r,i,a=this._def.from,s=a.mark;s?(e=["vg",this._parent_id,s].join("_"),n={name:e,transform:a.transform,modify:a.modify}):(t=this._graph.data(this._from),e=["vg",this._from,this._def.type,t.listeners(!0).length].join("_"),n={name:e,source:this._from,transform:a.transform,modify:a.modify}),this._from=e,this._ds=g.datasource(this._graph,n);var o=this._ds.revises();if(s)r=this.sibling(s).revises(o),r._isSuper?r.addListener(this._ds.listener()):r._bounder.addListener(this._ds.listener());else{var i=this._ds.source().revises(o).last();input=v.create(i),input.add=i.add,input.mod=i.mod,input.rem=i.rem,input.stamp=null,this._graph.propagate(input,this._ds.listener())}}function a(){var t=this._revises?null:void 0,e=m.ingest(new d(this._mark),t);return this._def.width&&m.set(e,"width",this._def.width),this._def.height&&m.set(e,"height",this._def.height),e}function s(t,e,n,r,i,s){var o,l,u,c,d,h;for(o=0,u=t.length;u>o;++o)d=t[o],c=e?this._map[l=e(d)]:i[o],h=c?!1:(c=a.call(this),!0),c.status=h?_.ENTER:_.UPDATE,c.datum=d,m.set(c,"key",l),this._map[l]=c,n.push(c),h?r.add.push(c):(!s||s&&s[d._id])&&r.mod.push(c)}function o(t,e,n){var r,i,a,o,l=v.create(t),c=u(this._def.key||"_id"),d=(t.add,t.mod),h=t.rem,f=[];for(r=0,a=h.length;a>r;++r)o=this._map[i=c(h[r])],o.status=_.EXIT,o._dirty=!0,t.dirty.push(o),f.push(o),l.rem.push(o),this._map[i]=null;return s.call(this,e,c,f,l,null,m.idMap(n?e:d)),this._mark.items=f,l}function l(t,e,n){var r,i,a,o=v.create(t),l=u(this._def.key),c=this._mark.items||[],d=[];for(r=0,i=c.length;i>r;++r)a=c[r],a.status=_.EXIT,l&&(this._map[a.key]=a);for(s.call(this,e,l,d,o,c,n?m.idMap(e):null),r=0,i=c.length;i>r;++r)a=c[r],a.status===_.EXIT&&(m.set(a,"key",l?a.key:this._items.length),a._dirty=!0,t.dirty.push(a),d.splice(0,0,a),o.rem.push(a));return this._mark.items=d,o}function u(t){if(null==t)return null;var e=c.array(t).map(c.accessor);return function(t){for(var n="",r=0,i=e.length;i>r;++r)r>0&&(n+="|"),n+=String(e[r](t));return n}}var c=t("datalib/src/util"),d=t("vega-scenegraph/src/util/Item"),h=t("../dataflow/Node"),f=t("./Encoder"),p=t("./Bounder"),g=t("../parse/data"),m=t("../dataflow/tuple"),v=t("../dataflow/changeset"),y=t("../util/log"),_=t("../util/constants"),x=r.prototype=new h;x.init=function(t,e,n,r,a,s){return h.prototype.init.call(this,t).router(!0).collector(!0),this._def=e,this._mark=n,this._from=(e.from?e.from.data:null)||s,this._ds=c.isString(this._from)?t.data(this._from):null,this._map={},this._revises=!1,n.def=e,n.marktype=e.type,n.interactive=!(e.interactive===!1),n.items=[],this._parent=r,this._parent_id=a,e.from&&(e.from.mark||e.from.transform||e.from.modify)&&i.call(this),this._isSuper=this._def.type!==_.GROUP,this._encoder=new f(this._graph,this._mark),this._bounder=new p(this._graph,this._mark),this._ds&&this._encoder.dependency(_.DATA,this._from),this.dependency(_.DATA,this._encoder.dependency(_.DATA)),this.dependency(_.SCALES,this._encoder.dependency(_.SCALES)),this.dependency(_.SIGNALS,this._encoder.dependency(_.SIGNALS)),this},x.revises=function(t){return arguments.length?(!this._revises&&t&&this._items.forEach(function(t){void 0===t._prev&&(t._prev=_.SENTINEL)}),this._revises=this._revises||t,this):this._revises},x.pipeline=function(){return[this]},x.connect=function(){var t=this;return this._graph.connect(this.pipeline()),this._encoder._scales.forEach(function(e){(e=t._parent.scale(e))&&e.addListener(t)}),this._parent&&(this._isSuper?this.addListener(this._parent._collector):this._bounder.addListener(this._parent._collector)),this},x.disconnect=function(){var t=this;return this._listeners.length?(h.prototype.disconnect.call(this),this._graph.disconnect(this.pipeline()),this._encoder._scales.forEach(function(e){(e=t._parent.scale(e))&&e.removeListener(t)}),this):this},x.sibling=function(t){return this._parent.child(t,this._parent_id)},x.evaluate=function(t){y.debug(t,["building",this._from,this._def.type]);var e,n,r,i,a;return this._ds?(e=v.create(t),i=e.data[a=this._ds.name()],delete e.data[a],n=this._encoder.reevaluate(e),e.data[a]=i,n&&(e.mod=this._mark.items.slice()),r=this._ds.last(),r?r.stamp>this._stamp&&(e=o.call(this,r,this._ds.values(),n)):e.reflow=!0):(n=this._encoder.reevaluate(t),i=c.isFunction(this._def.from)?this._def.from():[_.SENTINEL],e=l.call(this,t,i,n)),e=this._graph.evaluate(e,this._encoder),this._isSuper&&(e.mod=e.mod.filter(function(t){return t._dirty}),e=this._graph.evaluate(e,this._bounder)),e},e.exports=r},{"../dataflow/Node":80,"../dataflow/changeset":82,"../dataflow/tuple":83,"../parse/data":91,"../util/constants":138,"../util/log":139,"./Bounder":107,"./Encoder":109,"datalib/src/util":21,"vega-scenegraph/src/util/Item":68}],109:[function(t,e,n){function r(t,e){var n=e.def.properties||{},r=n.enter,i=n.update,a=n.exit;o.prototype.init.call(this,t),this._mark=e;var s=this._scales=[];return r&&s.push.apply(s,r.scales),i&&(this.dependency(l.DATA,i.data),this.dependency(l.SIGNALS,i.signals),this.dependency(l.FIELDS,i.fields),this.dependency(l.SCALES,i.scales),s.push.apply(s,i.scales)),a&&s.push.apply(s,a.scales),this}function i(t,e,n,r,i,a,s){var o=t.encode,l=e._dirty,u=o.call(o,e,e.mark.group||e,n,r,i,a);e._dirty=u||l,u&&!l&&s.push(e)}var a=t("datalib/src/util"),s=t("vega-scenegraph/src/util/bound"),o=t("../dataflow/Node"),l=t("../util/constants"),u=t("../util/log"),c={},d=r.prototype=new o;d.evaluate=function(t){u.debug(t,["encoding",this._mark.def.type]);var e,n,r,a,s=this._graph,o=(this._mark.items,this._mark.def.properties||{}),d=o.enter,h=o.update,f=o.exit,p=t.dirty,g=this._graph.predicates(),m=s.signalValues(),v=s.dataValues(),y=t.request;if(y){if(a=o[y])for(e=0,n=t.mod.length;n>e;++e)r=t.mod[e],i.call(this,a,r,t.trans,v,m,g,p);return t}for(e=0,n=t.rem.length;n>e;++e)r=t.rem[e],f&&i.call(this,f,r,t.trans,v,m,g,p),t.trans&&!f?t.trans.interpolate(r,c):t.trans||r.remove();for(e=0,n=t.add.length;n>e;++e)r=t.add[e],d&&i.call(this,d,r,t.trans,v,m,g,p),h&&i.call(this,h,r,t.trans,v,m,g,p),r.status=l.UPDATE;if(h)for(e=0,n=t.mod.length;n>e;++e)r=t.mod[e],i.call(this,h,r,t.trans,v,m,g,p);return t},d.reevaluate=function(t){var e=this._mark.def.properties||{},n=e.update;return t.request||o.prototype.reevaluate.call(this,t)||(n?n.reflow:!1)},r.update=function(t,e,n,r,o){r=a.array(r);var l,u,c,d,h,f=t.predicates(),p=t.dataValues(),g=t.signalValues();for(l=0,u=r.length;u>l;++l)c=r[l],d=c.mark.def.properties,h=d&&d[n],h&&(i.call(null,h,c,e,p,g,f,o),s.item(c))},e.exports=r},{"../dataflow/Node":80,"../util/constants":138,"../util/log":139,"datalib/src/util":21,"vega-scenegraph/src/util/bound":69}],110:[function(t,e,n){function r(){return this._children={},this._scaler=null,this._recursor=null,this._scales={},this.scale=a.bind(this),arguments.length?this.init.apply(this,arguments):this}function i(t){var e,n,r,i,a,s=this,h=d.array(this._def.marks).length>0,f=d.array(this._def.axes).length>0,p=d.array(this._def.legends).length>0,g=!1;for(e=0,n=t.add.length;n>e;++e)r=t.add[e],h&&o.call(this,t,r),f&&l.call(this,t,r),p&&u.call(this,t,r);for(e=t.add.length-1;e>=0;--e)for(r=t.add[e],j=this._children[r._id].length-1;j>=0;--j)c=this._children[r._id][j],c.builder.connect(),i=c.builder.pipeline(),a=c.builder._def,g=a.type!==_.GROUP,g=g&&void 0!==this._graph.data(c.from),g=g&&1==i[i.length-1].listeners().length,c.inline=g,g?this._graph.evaluate(t,c.builder):this._recursor.addListener(c.builder);for(e=0,n=t.mod.length;n>e;++e)r=t.mod[e],h&&s._children[r._id].forEach(function(t){t.type!=_.MARK||t.inline||void 0===s._graph.data(t.from)||s._recursor.removeListener(t.builder)}),f&&r.axes.forEach(function(e,n){var r=e.scale();t.scales[r.scaleName]&&e.reset().def()}),p&&r.legends.forEach(function(e,n){var r=e.size()||e.shape()||e.fill()||e.stroke();t.scales[r.scaleName]&&e.reset().def()});for(e=0,n=t.rem.length;n>e;++e)r=t.rem[e],s._children[r._id].forEach(function(t){s._recursor.removeListener(t.builder),t.builder.disconnect()}),delete s._children[r._id];return t}function a(t,e){var n=this;if(2===arguments.length)return n._scales[t]=e,e;for(;null==e&&(e=n._scales[t],n=n.mark?n.mark.group:n._parent););return e}function s(t,e){y.debug(t,["building group",e._id]),e._scales=e._scales||{},e.scale=a.bind(e),e.items=e.items||[],this._children[e._id]=this._children[e._id]||[],e.axes=e.axes||[],e.axisItems=e.axisItems||[],e.legends=e.legends||[],e.legendItems=e.legendItems||[]}function o(t,e){y.debug(t,["building children marks #"+e._id]);var n,i,a,s,o,l,u=this._def.marks;for(s=0,o=u.length;o>s;++s)n=u[s],i=n.from||{},a=e.datum._facetID,e.items[s]={group:e},l=n.type===_.GROUP?new r:new p,l.init(this._graph,n,e.items[s],this,e._id,a),this._children[e._id].push({builder:l,from:i.data||(i.mark?"vg_"+e._id+"_"+i.mark:a),type:_.MARK})}function l(t,e){var n=e.axes,i=e.axisItems,a=this;m(this._graph,this._def.axes,n,e),n.forEach(function(t,n){var s=a._def.axes[n].scale,o=t.def(),l=null;i[n]={group:e,axisDef:o,layer:o.layer},l=o.type===_.GROUP?new r:new p,l.init(a._graph,o,i[n],a).dependency(_.SCALES,s),a._children[e._id].push({builder:l,type:_.AXIS,scale:s})})}function u(t,e){var n=e.legends,i=e.legendItems,a=this;v(this._graph,this._def.legends,n,e),n.forEach(function(t,n){var s=t.size()||t.shape()||t.fill()||t.stroke(),o=t.def(),l=null;i[n]={group:e,legendDef:o},l=o.type===_.GROUP?new r:new p,l.init(a._graph,o,i[n],a).dependency(_.SCALES,s),a._children[e._id].push({builder:l,type:_.LEGEND,scale:s})})}var d=t("datalib/src/util"),h=t("../dataflow/Node"),f=t("../dataflow/Collector"),p=t("./Builder"),g=t("./Scale"),m=t("../parse/axes"),v=t("../parse/legends"),y=t("../util/log"),_=t("../util/constants"),x=r.prototype=new p;x.init=function(t,e,n,r,a,s){var o,l=this;this._scaler=new h(t),(e.scales||[]).forEach(function(e){e=l.scale(o=e.name,new g(t,e,l)),l.scale(o+":prev",e),l._scaler.addListener(e)}),this._recursor=new h(t),this._recursor.evaluate=i.bind(this);var u=(e.axes||[]).reduce(function(t,e){return t[e.scale]=1,t},{});return u=(e.legends||[]).reduce(function(t,e){return t[e.size||e.shape||e.fill||e.stroke],t},u),this._recursor.dependency(_.SCALES,d.keys(u)),this._collector=new f(t),p.prototype.init.apply(this,arguments)},x.evaluate=function(t){var e=p.prototype.evaluate.apply(this,arguments),n=this;return e.add.forEach(function(t){s.call(n,e,t)}),e},x.pipeline=function(){return[this,this._scaler,this._recursor,this._collector,this._bounder]},x.disconnect=function(){var t=this;return d.keys(t._children).forEach(function(e){t._children[e].forEach(function(e){t._recursor.removeListener(e.builder),e.builder.disconnect()})}),t._children={},p.prototype.disconnect.call(this)},x.child=function(t,e){for(var n,r=this._children[e],i=0,a=r.length;a>i&&(n=r[i],n.type!=_.MARK||n.builder._def.name!=t);++i);return n.builder},e.exports=r},{"../dataflow/Collector":77,"../dataflow/Node":80,"../parse/axes":89,"../parse/legends":96,"../util/constants":138,"../util/log":139,"./Builder":108,"./Scale":111,"datalib/src/util":21}],111:[function(t,e,n){function r(t,e,n){return this._def=e,this._parent=n,this._updated=!1,_.prototype.init.call(this,t)}function i(t){var e=this._def.name,n=e+":prev",r=a.call(this,t.scale(e)),i=r.type===E.ORDINAL?s:o,l=m.call(this,t);return i.call(this,r,l,t),t.scale(e,r),t.scale(n,t.scale(n)||r),r}function a(t){var e=this._def.type||E.LINEAR;if(!t||e!==t.type){var n=k.scale[e]||v.scale[e];n||y.error("Unrecognized scale type: "+e),(t=n()).type=t.type||e,t.scaleName=this._def.name,t._prev={}}return t}function s(t,e,n){var r,i,a=this._def,s=t._prev,o=!1,l=p.call(this,a.padding)||0,u=null==a.outerPadding?l:p.call(this,a.outerPadding),c=a.points&&p.call(this,a.points),d=p.call(this,a.round)||null==a.round;if(y.isObject(a.range)&&!y.isArray(a.range)&&(o=!0,e=f.call(this,E.RANGE,a.range,t,n)),r=f.call(this,E.DOMAIN,a.domain,t,n),r&&!y.equal(s.domain,r)&&(t.domain(r),s.domain=r,this._updated=!0),!y.equal(s.range,e)){if(a.bandWidth){var h=p.call(this,a.bandWidth),g=r.length,m=e[0]||0,v=c?l*h:l*h*(g-1)+2*u;e=[m,m+(h*g+v)]}i="string"==typeof e[0],i||e.length>2||1===e.length||o?t.range(e):c&&d?t.rangeRoundPoints(e,l):c?t.rangePoints(e,l):d?t.rangeRoundBands(e,l,u):t.rangeBands(e,l,u),s.range=e,this._updated=!0}}function o(t,e,n){var r,i,a=this._def,s=t._prev,o=p.call(this,a.round),l=p.call(this,a.exponent),u=p.call(this,a.clamp),c=p.call(this,a.nice);r=a.type===E.QUANTILE?f.call(this,E.DOMAIN,a.domain,t,n):g.call(this,t,n),r&&!y.equal(s.domain,r)&&(t.domain(r),s.domain=r,this._updated=!0),"height"===p.call(this,a.range)&&(e=e.reverse()),y.equal(s.range,e)||(t[o&&t.rangeRound?"rangeRound":"range"](e),s.range=e,this._updated=!0,this._stamp>0||(l&&a.type===E.POWER&&t.exponent(l),u&&t.clamp(!0),c&&(a.type===E.TIME?(i=v.time[c],i||w.error("Unrecognized interval: "+i),t.nice(i)):t.nice())))}function l(t){return t.type===E.ORDINAL||t.type===E.QUANTILE}function u(t){return t.fields||y.array(t)}function c(t,e){return y.array(t.field).map(function(t){return t.parent?y.accessor(t.parent)(e.datum):t})}function d(t,e){var n=u(t);return 1==n.length&&1==y.array(n[0].field).length?x.TYPES.TUPLE:l(e)&&t.sort?x.TYPES.MULTI:x.TYPES.VALUE}function h(t,e,n,r){var i,a=u(e),s=d(e,n),o=l(n),h=e.sort,f="_"+t,p=c(a[0],r);if(n[f])return n[f];var g,m,v=n[f]=new x(this._graph).type(s);return o?s===x.TYPES.VALUE?(g=[{name:E.GROUPBY,get:y.identity}],m={"*":E.COUNT}):s===x.TYPES.TUPLE?(g=[{name:E.GROUPBY,get:y.$(p[0])}],m=h?[{name:E.VALUE,get:y.$(i.sort||h.field),ops:[h.stat]}]:{"*":E.COUNT}):(g=E.GROUPBY,m=[{name:E.VALUE,ops:[h.stat]}]):(g=[],m=[{name:E.VALUE,get:s==x.TYPES.TUPLE?y.$(p[0]):y.identity,ops:[E.MIN,E.MAX],as:[E.MIN,E.MAX]}]),v.param("groupby",g).param("summarize",m),v}function f(t,e,n,r){if(null==e)return[];if(y.isArray(e))return e.map(p.bind(this));var i,a,s,o,f,g,m,v,_=this,b=this._graph,w=u(e),k=d(e,n),L=h.apply(this,arguments),A=e.sort,S=l(n);for(i=0,a=w.length;a>i;++i)if(f=w[i],from=f.data||r.datum._facetID,v=b.data(from).revises(!0).last(),!(v.stamp<=this._stamp)){for(g=c(f,r),s=0,o=g.length;o>s;++s)m=g[s],k===x.TYPES.VALUE?L.accessors(null,m):k===x.TYPES.MULTI&&L.accessors(m,f.sort||A.field),L.evaluate(v);this.dependency(E.DATA,from),L.dependency(E.SIGNALS).forEach(function(t){_.dependency(E.SIGNALS,t)})}return v=L.aggr().result(),S?(A&&(A=A.order.signal?b.signalRef(A.order.signal):A.order,A=(A==E.DESC?"-":"+")+E.VALUE,A=y.comparator(A),v=v.sort(A)),v.map(function(t){return t[E.GROUPBY]})):(v=v[0],y.isValid(v)?[v[E.MIN],v[E.MAX]]:[])}function p(t){if(!t||!t.signal)return t;var e,n=t.signal;return this.dependency(E.SIGNALS,(e=y.field(n))[0]),this._graph.signalRef(e)}function g(t,e){var n,r=this._def,i=[null,null];return void 0!==r.domain&&(i=y.isObject(r.domain)?f.call(this,E.DOMAIN,r.domain,t,e):i),n=i.length-1,void 0!==r.domainMin&&(i[0]=y.isObject(r.domainMin)?r.domainMin.signal?p.call(this,r.domainMin):f.call(this,E.DOMAIN+E.MIN,r.domainMin,t,e)[0]:r.domainMin),void 0!==r.domainMax&&(i[n]=y.isObject(r.domainMax)?r.domainMax.signal?p.call(this,r.domainMax):f.call(this,E.DOMAIN+E.MAX,r.domainMax,t,e)[1]:r.domainMax),r.type===E.LOG||r.type===E.TIME||!r.zero&&void 0!==r.zero||(i[0]=Math.min(0,i[0]),i[n]=Math.max(0,i[n])),i}function m(t){var e=this._def,n=p.call(this,e.range),r=[null,null];if(void 0!==n)if("string"==typeof n)if(L[n])r=[0,t[n]];else{if(!k.range[n])return w.error("Unrecogized range: "+n),r;r=k.range[n]}else if(y.isArray(n))r=y.duplicate(n).map(p.bind(this));else{if(y.isObject(n))return null;r=[0,n]}if(void 0!==e.rangeMin&&(r[0]=e.rangeMin.signal?p.call(this,e.rangeMin):e.rangeMin),void 0!==e.rangeMax&&(r[r.length-1]=e.rangeMax.signal?p.call(this,e.rangeMax):e.rangeMax),void 0!==e.reverse){var i=p.call(this,e.reverse);y.isObject(i)&&(i=y.accessor(i.field)(t.datum)),i&&(r=r.reverse())}return r}var v=window.d3,y=t("datalib/src/util"),_=t("../dataflow/Node"),x=t("../transforms/Aggregate"),b=t("../dataflow/changeset"),w=t("../util/log"),k=t("../util/config"),E=t("../util/constants"),L={width:1,height:1},A=r.prototype=new _;A.evaluate=function(t){var e=this,n=function(t){i.call(e,t)};return this._updated=!1,t.add.forEach(n),t.mod.forEach(n),this._updated&&(t.scales[this._def.name]=1),b.create(t,!0)},A.dependency=function(t,e){if(2==arguments.length){e=y.array(e);for(var n=0,r=e.length;r>n;++n)this._graph[t==E.DATA?E.DATA:E.SIGNAL](e[n]).addListener(this._parent)}return _.prototype.dependency.call(this,t,e)};({type:"object",field:{type:"string"},stat:{"enum":t("../transforms/Aggregate").VALID_OPS},order:{"enum":[E.ASC,E.DESC]}});e.exports=r},{"../dataflow/Node":80,"../dataflow/changeset":82,"../transforms/Aggregate":116,"../util/config":137,"../util/constants":138,"../util/log":139,"datalib/src/util":21}],112:[function(t,e,n){function r(t,e){this.duration=t||500,this.ease=e&&d3.ease(e)||d3.ease("cubic-in-out"),this.updates={next:null}}function i(t){for(var e,n,r,i,s,l,u=this.updates,c=u,d=c.next,h=this.duration,f=!0;null!=d;c=d,d=c.next)if(e=d.item,n=e.delay||0,r=(t-n)/h,0>r)f=!1;else{for(r>1&&(r=1),i=d.ease(r),s=0,l=d.length;l>s;++s)e[d[s].property]=d[s](i);e.touch(),a.item(e),1===r?(d.remove&&(e.status=o.EXIT,e.remove()),c.next=d.next,d=c):f=!1}return this.callback(),f}var a=t("vega-scenegraph/src/util/bound"),s=t("../dataflow/tuple"),o=t("../util/constants"),l=r.prototype,u={text:1,url:1};l.interpolate=function(t,e){var n,r,i,a,l=null;for(n in e)r=t[n],i=e[n],r!==i&&(u[n]||void 0===r?s.set(t,n,i):"number"!=typeof r||isFinite(r)?(a=d3.interpolate(r,i),a.property=n,(l||(l=[])).push(a)):s.set(t,n,i));return null===l&&t.status===o.EXIT&&(l=[]),null!=l&&(l.item=t,l.ease=t.mark.ease||this.ease,l.next=this.updates.next,this.updates.next=l),this},l.start=function(t){for(var e=this,n=e.updates,r=n.next;null!=r;n=r,r=n.next)r.item.status===o.EXIT&&(r.item.status=o.UPDATE,r.remove=!0);e.callback=t,d3.timer(function(t){return i.call(e,t)})},e.exports=r},{"../dataflow/tuple":83,"../util/constants":138,"vega-scenegraph/src/util/bound":69}],113:[function(t,e,n){function r(t){function e(){S.type=null}function n(t){return{data:t}}function r(){return z||("log"===k.type?".1s":null)}function a(){var t=r();return k.tickFormat?k.tickFormat(j,t):t?"time"===k.type?m.time.format(t):m.format(t):String}function _(t){var e={major:D,minor:null};return null==e.major&&(e.major=k.ticks?k.ticks(j):k.domain()),e.minor=i(k,e.major,U).map(n),e.major=e.major.map(function(e){return e=n(e),e.label=t(e.data),e}),e}function w(e){var n,r,i;"ordinal"===e.type?(n={scale:e.scaleName,offset:.5+e.rangeBand()/2},r=n):(n={scale:e.scaleName,offset:.5},r={scale:e.scaleName+":prev",offset:.5}),i=s(e),v.extend(W.gridLines,h()),v.extend(W.majorTicks,h()),v.extend(W.minorTicks,h()),v.extend(W.tickLabels,f()),v.extend(W.domain,g()),v.extend(W.title,p()),W.gridLines.properties.enter.stroke={value:y.axis.gridColor},l(E,W.gridLines,r,n,1/0),l(E,W.majorTicks,r,n,N),l(E,W.minorTicks,r,n,I),o(E,W.tickLabels,r,n,N,O),c(E,W.domain,i,P),u(E,W.title,i,A),v.extend(W.gridLines.properties.update,R),v.extend(W.majorTicks.properties.update,q),v.extend(W.minorTicks.properties.update,G),v.extend(W.tickLabels.properties.update,F),v.extend(W.domain.properties.update,B),v.extend(W.title.properties.update,V);var a=[W.gridLines,W.majorTicks,W.minorTicks,W.tickLabels,W.domain,W.title];v.extend(S,{type:"group",interactive:!1,properties:{enter:{encode:d,scales:[e.scaleName],signals:[],data:[]},update:{encode:d,scales:[e.scaleName],signals:[],data:[]}}}),S.marks=a.map(function(e){return x(t,e)})}var k,E=y.axis.orient,L=0,A=y.axis.titleOffset,S={},M="front",T=!1,C=null,N=y.axis.tickSize,I=y.axis.tickSize,P=y.axis.tickSize,O=y.axis.padding,D=null,z=null,U=0,j=y.axis.ticks,R={},F={},q={},G={},V={},B={},W={gridLines:{},majorTicks:{},minorTicks:{},tickLabels:{},domain:{},title:{}},$={};return $.def=function(){S.type||w(k);var t=a(),e=_(t),r=C?[C].map(n):[];return S.marks[0].from=function(){return T?e.major:[]},S.marks[1].from=function(){return e.major},S.marks[2].from=function(){return e.minor},S.marks[3].from=S.marks[1].from,S.marks[4].from=function(){return[1]},S.marks[5].from=function(){return r},S.offset=L,S.orient=E,S.layer=M,S},$.scale=function(t){return arguments.length?(k!==t&&(k=t,e()),$):k},$.orient=function(t){return arguments.length?(E!==t&&(E=t in b?t+"":y.axis.orient,e()),$):E},$.title=function(t){return arguments.length?(C!==t&&(C=t,e()),$):C},$.tickCount=function(t){return arguments.length?(j=t,$):j},$.tickValues=function(t){return arguments.length?(D=t,$):D},$.tickFormat=function(t){return arguments.length?(z!==t&&(z=t,e()),$):z},$.tickSize=function(t,n){if(!arguments.length)return N;var r=arguments.length-1,i=+t,a=r>1?+n:N,s=r>0?+arguments[r]:N;return(N!==i||I!==a||P!==s)&&e(),N=i,I=a,P=s,$},$.tickSubdivide=function(t){return arguments.length?(U=+t,$):U},$.offset=function(t){return arguments.length?(L=v.isObject(t)?t:+t,$):L},$.tickPadding=function(t){return arguments.length?(O!==+t&&(O=+t,e()),$):O},$.titleOffset=function(t){return arguments.length?(A!==+t&&(A=+t,e()),$):A},$.layer=function(t){return arguments.length?(M!==t&&(M=t,e()),$):M},$.grid=function(t){return arguments.length?(T!==t&&(T=t,e()),$):T},$.gridLineProperties=function(t){return arguments.length?(R!==t&&(R=t),$):R},$.majorTickProperties=function(t){return arguments.length?(q!==t&&(q=t),$):q},$.minorTickProperties=function(t){return arguments.length?(G!==t&&(G=t),$):G},$.tickLabelProperties=function(t){return arguments.length?(F!==t&&(F=t),$):F},$.titleProperties=function(t){return arguments.length?(V!==t&&(V=t),$):V},$.domainProperties=function(t){return arguments.length?(B!==t&&(B=t),$):B},$.reset=function(){return e(),$},$}function i(t,e,n){if(r=[],n&&e.length>1){for(var r,i,s,o=a(t.domain()),l=-1,u=e.length,c=(e[1]-e[0])/++n;++l<u;)for(i=n;--i>0;)(s=+e[l]-i*c)>=o[0]&&r.push(s);for(--l,i=0;++i<n&&(s=+e[l]+i*c)<o[1];)r.push(s)}return r}function a(t){var e=t[0],n=t[t.length-1];return n>e?[e,n]:[n,e]}function s(t){return t.rangeExtent?t.rangeExtent():a(t.range())}function o(t,e,n,r,i,a){i=Math.max(i,0)+a,("left"===t||"top"===t)&&(i*=-1),"top"===t||"bottom"===t?(v.extend(e.properties.enter,{x:n,y:{value:i}}),v.extend(e.properties.update,{x:r,y:{value:i},align:{value:"center"},baseline:{value:k[t]}})):(v.extend(e.properties.enter,{x:{value:i},y:n}),v.extend(e.properties.update,{x:{value:i},y:r,align:{value:w[t]},baseline:{value:"middle"}}))}function l(t,e,n,r,i){var a="left"===t||"top"===t?-1:1;i=i===1/0?"top"===t||"bottom"===t?{field:{group:"height",level:2},mult:-a}:{field:{group:"width",level:2},mult:-a}:{value:a*i},"top"===t||"bottom"===t?(v.extend(e.properties.enter,{x:n,y:{value:0},y2:i}),v.extend(e.properties.update,{x:r,y:{value:0},y2:i}),v.extend(e.properties.exit,{x:r})):(v.extend(e.properties.enter,{x:{value:0},x2:i,y:n}),v.extend(e.properties.update,{x:{value:0},x2:i,y:r}),v.extend(e.properties.exit,{y:r}))}function u(t,e,n,r){var i=~~((n[0]+n[1])/2),a="top"===t||"left"===t?-1:1;"bottom"===t||"top"===t?v.extend(e.properties.update,{x:{value:i},y:{value:a*r},angle:{value:0}}):v.extend(e.properties.update,{x:{value:a*r},y:{value:i},angle:{value:-90}})}function c(t,e,n,r){var i;("top"===t||"left"===t)&&(r=-1*r),i="bottom"===t||"top"===t?"M"+n[0]+","+r+"V0H"+n[1]+"V"+r:"M"+r+","+n[0]+"H0V"+n[1]+"H"+r,e.properties.update.path={value:i}}function d(t,e,n,r,i,a){var s=n?{}:t,o=t.mark.def.offset,l=t.mark.def.orient,u=e.width,c=e.height;if(v.isArray(o)){var d=o[0],h=o[1];switch(l){case"left":_.set(s,"x",-d),_.set(s,"y",h);break;case"right":_.set(s,"x",u+d),_.set(s,"y",h);break;case"bottom":_.set(s,"x",d),_.set(s,"y",c+h);break;case"top":_.set(s,"x",d),_.set(s,"y",-h);break;default:_.set(s,"x",d),_.set(s,"y",h)}}else switch(v.isObject(o)&&(o=-e.scale(o.scale)(o.value)),l){case"left":_.set(s,"x",-o),_.set(s,"y",0);break;case"right":_.set(s,"x",u+o),_.set(s,"y",0);break;case"bottom":_.set(s,"x",0),_.set(s,"y",c+o);break;case"top":_.set(s,"x",0),_.set(s,"y",-o);break;default:_.set(s,"x",0),_.set(s,"y",0)}n&&n.interpolate(t,s)}function h(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:y.axis.tickColor},strokeWidth:{value:y.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function f(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:y.axis.tickLabelColor},font:{value:y.axis.tickLabelFont},fontSize:{value:y.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function p(){return{type:"text",interactive:!0,properties:{enter:{font:{value:y.axis.titleFont},fontSize:{value:y.axis.titleFontSize},fontWeight:{value:y.axis.titleFontWeight},fill:{value:y.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function g(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:y.axis.axisColor},strokeWidth:{value:y.axis.axisWidth}},update:{}}}}var m=window.d3,v=t("datalib/src/util"),y=t("../util/config"),_=t("../dataflow/tuple"),x=t("../parse/mark"),b={top:1,right:1,bottom:1,left:1},w={bottom:"center",top:"center",left:"right",right:"left"},k={bottom:"top",top:"bottom",left:"middle",right:"middle"};e.exports=r},{"../dataflow/tuple":83,"../parse/mark":97,"../util/config":137,"datalib/src/util":21}],114:[function(t,e,n){function r(t){function e(){w.type=null}function n(t,e){return{data:t,index:e}}function r(t){return"ordinal"===t||"quantize"===t||"quantile"===t||"threshold"===t}function y(t){var e,r,i,a=_(k,E,L,A),s=(null==M?t.ticks?t.ticks.apply(t,D):t.domain():M).map(n),o=null==T?t.tickFormat?t.tickFormat.apply(t,D):String:T,l=5,u=d.range(s.length);

k?(r=s.map(function(t){return Math.sqrt(k(t.data))}),i=d.max(r),r=r.reduce(function(t,e,n,r){return n>0&&(t[n]=t[n-1]+r[n-1]/2+l),t[n]+=e/2,t},[0]).map(Math.round)):(i=Math.round(Math.sqrt(m.legend.symbolSize)),r=S||(e=F.fontSize)&&e.value+l||m.legend.labelFontSize+l,r=u.map(function(t,e){return Math.round(i/2+e*r)}));var c,h=O;N&&(c=R.fontSize,h+=5+(c&&c.value||m.legend.titleFontSize));for(var f=0,p=r.length;p>f;++f)r[f]+=h;var t={name:"legend",type:"ordinal",points:!0,domain:u,range:r},g=(N?[N]:[]).map(n);return s.forEach(function(t){t.label=o(t.data),t.offset=i}),a.scales=[t],a.marks[0].from=function(){return g},a.marks[1].from=function(){return s},a.marks[2].from=a.marks[1].from,a}function _(e,n,r,u){var c=h.extend(q.titles,s()),d=h.extend(q.symbols,o()),f=h.extend(q.labels,l());return a(d,e,n,r,u),h.extend(c.properties.update,R),h.extend(d.properties.update,U),h.extend(f.properties.update,F),c.properties.enter.x.value+=O,c.properties.enter.y.value+=O,f.properties.enter.x.offset+=O+1,d.properties.enter.x.offset=O+1,f.properties.update.x.offset+=O+1,d.properties.update.x.offset=O+1,h.extend(w,{type:"group",interactive:!1,properties:{enter:p(t,"group",z),vg_legendPosition:{encode:i,signals:[],scales:[],data:[],fields:[]}}}),w.marks=[c,d,f].map(function(e){return g(t,e)}),w}function x(t){var e=b(t),r=t.domain(),i=(null==M?t.ticks?t.ticks.apply(t,D):t.domain():M).map(n),a=j.width&&j.width.value||m.legend.gradientWidth,s=null==T?t.tickFormat?t.tickFormat.apply(t,D):String:T,o={name:"legend",type:t.type,round:!0,zero:!1,domain:[r[0],r[r.length-1]],range:[O,a+O]};"pow"===t.type&&(o.exponent=t.exponent());var l=(N?[N]:[]).map(n);return i.forEach(function(t,e){t.label=s(t.data),t.align=e==i.length-1?"right":0==e?"left":"center"}),e.scales=[o],e.marks[0].from=function(){return l},e.marks[1].from=function(){return[1]},e.marks[2].from=function(){return i},e}function b(e){var n=h.extend(q.titles,s()),r=h.extend(q.gradient,u()),a=h.extend(q.labels,c()),o=new f,l=e.domain(),d=l[0],m=l[l.length-1],v=e.copy().domain([d,m]).range([0,1]),y="linear"!==e.type&&e.ticks?e.ticks.call(e,15):l;d!==y[0]&&y.unshift(d),m!==y[y.length-1]&&y.push(m);for(var _=0,x=y.length;x>_;++_)o.stop(v(y[_]),e(y[_]));r.properties.enter.fill={value:o},h.extend(n.properties.update,R),h.extend(r.properties.update,j),h.extend(a.properties.update,F);var b=r.properties,k=j.height,E=k&&k.value||b.enter.height.value;if(a.properties.enter.y.value=E,a.properties.update.y.value=E,N){var L=n.properties,A=R.fontSize,S=4+(A&&A.value||L.enter.fontSize.value);r.properties.enter.y.value+=S,a.properties.enter.y.value+=S,r.properties.update.y.value+=S,a.properties.update.y.value+=S}return n.properties.enter.x.value+=O,n.properties.enter.y.value+=O,r.properties.enter.x.value+=O,r.properties.enter.y.value+=O,a.properties.enter.y.value+=O,r.properties.update.x.value+=O,r.properties.update.y.value+=O,a.properties.update.y.value+=O,h.extend(w,{type:"group",interactive:!1,properties:{enter:p(t,"group",z),vg_legendPosition:{encode:i,signals:[],scales:[],data:[],fields:[]}}}),w.marks=[n,r,a].map(function(e){return g(t,e)}),w}var w,k=null,E=null,L=null,A=null,S=null,M=null,T=null,C=null,N=void 0,I="right",P=m.legend.offset,O=m.legend.padding,D=[5],z={},U={},j={},R={},F={},q={titles:{},symbols:{},labels:{},gradient:{}},G={},w={};return G.def=function(){var t=k||E||L||A;return T=C?"time"===t.type?d.time.format(C):d.format(C):null,w.type||(w=t!==L&&t!==A||r(t.type)?y(t):x(t)),w.orient=I,w.offset=P,w.padding=O,w},G.size=function(t){return arguments.length?(k!==t&&(k=t,e()),G):k},G.shape=function(t){return arguments.length?(E!==t&&(E=t,e()),G):E},G.fill=function(t){return arguments.length?(L!==t&&(L=t,e()),G):L},G.stroke=function(t){return arguments.length?(A!==t&&(A=t,e()),G):A},G.title=function(t){return arguments.length?(N!==t&&(N=t,e()),G):N},G.format=function(t){return arguments.length?(C!==t&&(C=t,e()),G):C},G.spacing=function(t){return arguments.length?(S!==+t&&(S=+t,e()),G):S},G.orient=function(t){return arguments.length?(I=t in v?t+"":m.legend.orient,G):I},G.offset=function(t){return arguments.length?(P=+t,G):P},G.values=function(t){return arguments.length?(M=t,G):M},G.legendProperties=function(t){return arguments.length?(z=t,G):z},G.symbolProperties=function(t){return arguments.length?(U=t,G):U},G.gradientProperties=function(t){return arguments.length?(j=t,G):j},G.labelProperties=function(t){return arguments.length?(F=t,G):F},G.titleProperties=function(t){return arguments.length?(R=t,G):R},G.reset=function(){return e(),G},G}function i(t,e,n,r,i,a){var s,o=n?{}:t,l=t.mark.def.offset,u=t.mark.def.orient,c=2*t.mark.def.padding,d=~~t.bounds.width()+(t.width?0:c),h=~~t.bounds.height()+(t.height?0:c),f=e._legendPositions||(e._legendPositions={right:.5,left:.5});switch(o.x=.5,o.width=d,o.y=f[u],f[u]+=o.height=h,!n&&e.bounds&&(e.bounds.delta=e.bounds.x2-e.width),u){case"left":s=e.bounds?e.bounds.x1:0,o.x+=s-l-d;break;case"right":s=e.width,e.bounds&&(s=n?e.width+e.bounds.delta:e.bounds.x2),o.x+=s+l}n&&n.interpolate(t,o);var p=t.mark.def.properties.enter.encode;p.call(p,t,e,n,r,i,a)}function a(t,e,n,r,i){var a=t.properties.enter,s=t.properties.update;e&&(a.size=s.size={scale:e.scaleName,field:"data"}),n&&(a.shape=s.shape={scale:n.scaleName,field:"data"}),r&&(a.fill=s.fill={scale:r.scaleName,field:"data"}),i&&(a.stroke=s.stroke={scale:i.scaleName,field:"data"})}function s(){var t=m.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{value:0},y:{value:0},fill:{value:t.titleColor},font:{value:t.titleFont},fontSize:{value:t.titleFontSize},fontWeight:{value:t.titleFontWeight},baseline:{value:"top"},text:{field:"data"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function o(){var t=m.legend;return{type:"symbol",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},shape:{value:t.symbolShape},size:{value:t.symbolSize},stroke:{value:t.symbolColor},strokeWidth:{value:t.symbolStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},opacity:{value:1}}}}}function l(){var t=m.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",offset:5},y:{scale:"legend",field:"index"},fill:{value:t.labelColor},font:{value:t.labelFont},fontSize:{value:t.labelFontSize},align:{value:t.labelAlign},baseline:{value:t.labelBaseline},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1},x:{field:"offset",offset:5},y:{scale:"legend",field:"index"}}}}}function u(){var t=m.legend;return{type:"rect",interactive:!1,properties:{enter:{x:{value:0},y:{value:0},width:{value:t.gradientWidth},height:{value:t.gradientHeight},stroke:{value:t.gradientStrokeColor},strokeWidth:{value:t.gradientStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{value:0},y:{value:0},opacity:{value:1}}}}}function c(){var t=m.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{scale:"legend",field:"data"},y:{value:20},dy:{value:2},fill:{value:t.labelColor},font:{value:t.labelFont},fontSize:{value:t.labelFontSize},align:{field:"align"},baseline:{value:"top"},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{scale:"legend",field:"data"},y:{value:20},opacity:{value:1}}}}}var d=window.d3,h=t("datalib/src/util"),f=t("vega-scenegraph/src/util/Gradient"),p=t("../parse/properties"),g=t("../parse/mark"),m=t("../util/config"),v={right:1,left:1};e.exports=r},{"../parse/mark":97,"../parse/properties":102,"../util/config":137,"datalib/src/util":21,"vega-scenegraph/src/util/Gradient":66}],115:[function(t,e,n){e.exports=function r(t,e){var n,i,a,s,o;if(e(t))return!0;var l=["items","axisItems","legendItems"];for(a=0,s=l.length;s>a;++a)if(o=t[l[a]])for(n=0,i=o.length;i>n;++n)if(r(o[n],e))return!0}},{}],116:[function(t,e,n){function r(t){return o.prototype.init.call(this,t),o.addParameters(this,{groupby:{type:"array<field>"},summarize:{type:"custom",set:function(t){function e(t){t.signal&&(u[t.signal]=1)}var n,r,i,a,o,l,u={};if(!s.isArray(a=t)){a=[];for(o in t)l=s.array(t[o]),a.push({name:o,ops:l})}for(n=0,r=a.length;r>n;++n)i=a[n],i.name.signal&&(u[i.name.signal]=1),s.array(i.ops).forEach(e),s.array(i.as).forEach(e);return this._transform._fieldsDef=a,this._transform._aggr=null,this._transform.dependency(h.SIGNALS,s.keys(u)),this._transform}}}),this._fieldsDef=[],this._aggr=null,this._type=p.TUPLE,this._acc={groupby:s["true"],value:s["true"]},this._cache={},this._prev={},this.router(!0).revises(!0)}function i(t){var e=this._acc;return this._type===p.TUPLE?t:this._type===p.VALUE?e.value(t):this._cache[t._id]||(this._cache[t._id]={_id:t._id,groupby:e.groupby(t),value:e.value(t)})}function a(t){var e=this._prev[t._id]||(this._prev[t._id]=Object.create(t));return s.extend(e,t._prev)}var s=t("datalib/src/util"),o=t("./Transform"),l=t("./Facetor"),u=t("../dataflow/tuple"),c=t("../dataflow/changeset"),d=t("../util/log"),h=t("../util/constants"),f=r.prototype=new o,p=r.TYPES={VALUE:1,TUPLE:2,MULTI:3};f.type=function(t){return this._type=t,this},f.accessors=function(t,e){var n=this._acc;n.groupby=s.$(t)||s["true"],n.value=s.$(e)||s["true"]},f.aggr=function(){if(this._aggr)return this._aggr;var t=this._graph,e=this.param("groupby").field,n=this._fieldsDef.map(function(e){var n=s.duplicate(e);return e.get&&(n.get=e.get),n.name=n.name.signal?t.signalRef(n.name.signal):n.name,n.ops=n.ops.signal?t.signalRef(n.ops.signal):s.array(n.ops).map(function(e){return e.signal?t.signalRef(e.signal):e}),n}),r=this._aggr=(new l).groupby(e).stream(!0).summarize(n);return this._type!==p.VALUE&&r.key("_id"),r},f._reset=function(t,e){e.rem.push.apply(e.rem,this.aggr().result()),this.aggr().clear(),this._aggr=null},f.transform=function(t,e){d.debug(t,["aggregate"]);var n=c.create(t);e&&this._reset(t,n);var r=this,s=this._type===p.TUPLE,o=this.aggr();return t.add.forEach(function(t){o._add(s?t:i.call(r,t))}),t.mod.forEach(function(t){if(e)o._add(s?t:i.call(r,t));else if(u.has_prev(t)){var n=a.call(r,t);o._mod(s?t:i.call(r,t),s?n:i.call(r,n))}}),t.rem.forEach(function(t){var e=u.has_prev(t)?a.call(r,t):t;o._rem(s?e:i.call(r,e)),r._cache[t._id]=r._prev[t._id]=null}),o.changes(t,n)};r.VALID_OPS=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","modeskew","min","max","argmin","argmax"];e.exports=r},{"../dataflow/changeset":82,"../dataflow/tuple":83,"../util/constants":138,"../util/log":139,"./Facetor":121,"./Transform":133,"datalib/src/util":21}],117:[function(t,e,n){function r(){this.data=null}var i=t("./Transform"),a=(t("../dataflow/Collector"),r.prototype=new i);a.init=function(t){return i.prototype.init.call(this,t),this},a.transform=function(t){return this.batchTransform(t,this.data())},a.batchTransform=function(t,e){},e.exports=r},{"../dataflow/Collector":77,"./Transform":133}],118:[function(t,e,n){function r(t){return a.prototype.init.call(this,t),a.addParameters(this,{field:{type:"field"},min:{type:"value"},max:{type:"value"},base:{type:"value","default":10},maxbins:{type:"value","default":20},step:{type:"value"},steps:{type:"value"},minstep:{type:"value"},div:{type:"array<value>","default":[5,2]}}),this._output={bin:"bin"},this}var i=t("datalib/src/bins/bins"),a=t("./Transform"),s=t("../dataflow/tuple"),o=r.prototype=new a;o.transform=function(t){function e(e){var i=n.param("field").accessor(e);i=null==i?null:c.start+c.step*~~((i-c.start)/c.step),s.set(e,r,i,t.stamp)}var n=this,r=this._output.bin,a=this.param("step"),o=this.param("steps"),l=this.param("minstep"),u={min:this.param("min"),max:this.param("max"),base:this.param("base"),maxbins:this.param("maxbins"),div:this.param("div")};a&&(u.step=a),o&&(u.steps=o),l&&(u.minstep=l);var c=i(u);return t.add.forEach(e),t.mod.forEach(e),t.rem.forEach(e),t},e.exports=r},{"../dataflow/tuple":83,"./Transform":133,"datalib/src/bins/bins":7}],119:[function(t,e,n){function r(t){return u.prototype.init.call(this,t),u.addParameters(this,{"with":{type:"data"},diagonal:{type:"value","default":"true"}}),this._output={left:"a",right:"b"},this._collector=new c(t),this._lastRem=null,this._lastWith=null,this._ids={},this._cache={},this.router(!0)}function i(t,e){var n=this._cache[t._id]=this._cache[t._id]||{c:[],s:this._stamp};n.c.push(e)}function a(t,e,n,r,a){for(var s,o,l,u=e?n:this._collector.data(),c=0,d=u.length,f=void 0!==a._prev?null:void 0;d>c;++c)o=u[c],l=e?a._id+"_"+o._id:o._id+"_"+a._id,this._ids[l]||(a._id!=o._id||r)&&(s=h.ingest({},f),s[this._output.left]=e?a:o,s[this._output.right]=e?o:a,t.add.push(s),i.call(this,a,s),i.call(this,o,s),this._ids[l]=1)}function s(t,e,n){var r=this,i=this._cache[n._id];this._lastRem>i.s&&(i.c=i.c.filter(function(t){var n=t[r._output[e?"right":"left"]];return null!==r._cache[n._id]}),i.s=this._lastRem),t.mod.push.apply(t.mod,i.c)}function o(t,e){t.rem.push.apply(t.rem,this._cache[e._id].c),this._cache[e._id]=null,this._lastRem=this._stamp}function l(t,e){(t.add.length||t.rem.length)&&(e.fields[this._output.left]=1,e.fields[this._output.right]=1)}var u=t("./Transform"),c=t("../dataflow/Collector"),d=t("../util/log"),h=t("../dataflow/tuple"),f=t("../dataflow/changeset"),p=r.prototype=new u;p.transform=function(t){d.debug(t,["crossing"]),this._collector.evaluate(t);var e=this.param("with"),n=this.param("diagonal"),r=!e.name,i=this._collector.data(),u=r?t:e.source.last(),c=r?i:e.source.values(),h=f.create(t),p=o.bind(this,h);return t.rem.forEach(p),t.add.forEach(a.bind(this,h,!0,c,n)),!r&&u.stamp>this._lastWith&&(u.rem.forEach(p),u.add.forEach(a.bind(this,h,!1,i,n)),u.mod.forEach(s.bind(this,h,!1)),l.call(this,u,h),this._lastWith=u.stamp),t.mod.forEach(s.bind(this,h,!0)),l.call(this,t,h),h},e.exports=r},{"../dataflow/Collector":77,"../dataflow/changeset":82,"../dataflow/tuple":83,"../util/log":139,"./Transform":133}],120:[function(t,e,n){function r(e){return i.addParameters(this,{transform:{type:"custom",set:function(t){return this._transform._pipeline=t,this._transform},get:function(){var e=t("../parse/transforms"),n=this._transform;return n._pipeline.map(function(t){return e(n._graph,t)})}}}),this._pipeline=[],a.call(this,e)}var i=(t("datalib/src/util"),t("./Transform")),a=t("./Aggregate"),s=r.prototype=Object.create(a.prototype);s.aggr=function(){return a.prototype.aggr.call(this).facet(this)},e.exports=r},{"../parse/transforms":106,"./Aggregate":116,"./Transform":133,"datalib/src/util":21}],121:[function(t,e,n){function r(){a.call(this),this._facet=null}function i(t){l.debug({},["deleting cell",this.tuple._id]);var e=this.ds.pipeline();t.removeListener(e[0]),t._graph.disconnect(e)}var a=t("datalib/src/aggregate/aggregator"),s=t("../dataflow/tuple"),o=t("../dataflow/changeset"),l=t("../util/log"),u=t("../util/constants"),c=1,d=r.prototype=new a;d.facet=function(t){return arguments.length?(this._facet=t,this):this._facet},d._ingest=function(t){return s.ingest(t,null)},d._assign=s.set,d._newcell=function(t){var e,n,r=a.prototype._newcell.call(this,t),s=this._facet,o=r.tuple;return null!==this._facet&&(e=s._graph,n=s.param("transform"),r.ds=e.data(o._facetID,n,o),r["delete"]=i,s.addListener(n[0])),r},d._newtuple=function(t){var e=a.prototype._newtuple.call(this,t);return null!==this._facet&&(s.set(e,"key",this._cellkey(t)),s.set(e,"_facetID","vg_"+c++)),e},d.clear=function(){if(null!==this._facet)for(var t in this._cells)this._cells[t]["delete"](this._facet);return a.prototype.clear.call(this)},d._add=function(t){var e=this._cell(t);a.prototype._add.call(this,t),null!==this._facet&&e.ds._input.add.push(t)},d._mod=function(t,e){var n=this._cell(e),r=this._cell(t);a.prototype._mod.call(this,t,e),null!==this._facet&&(n===r?n.ds._input.mod.push(t):(n.ds._input.rem.push(t),r.ds._input.add.push(t)))},d._rem=function(t){var e=this._cell(t);a.prototype._rem.call(this,t),null!==this._facet&&e.ds._input.rem.push(t)},d.changes=function(t,e){var n,r,i,a,s=this._aggr;for(a in this._cells){for(n=this._cells[a],r=n.flag,n.collect&&n.data.values(),i=0;i<s.length;++i)n.aggs[s[i].name].set();n.num<=0?(r===u.MOD_CELL&&e.rem.push(n.tuple),null!==this._facet&&n["delete"](this._facet),delete this._cells[a]):(null!==this._facet&&o.copy(t,n.ds._input),r&u.ADD_CELL?e.add.push(n.tuple):r&u.MOD_CELL&&e.mod.push(n.tuple)),n.flag=0}return this._rems=!1,e},e.exports=r},{"../dataflow/changeset":82,"../dataflow/tuple":83,"../util/constants":138,"../util/log":139,"datalib/src/aggregate/aggregator":4}],122:[function(t,e,n){function r(t){return a.prototype.init.call(this,t),a.addParameters(this,{test:{type:"expr"}}),this._skip={},this.router(!0)}function i(t){return o.eval(this._graph,this.param("test"),{datum:t,signals:this.dependency(u.SIGNALS)})}var a=t("./Transform"),s=t("../dataflow/changeset"),o=t("../parse/expr"),l=t("../util/log"),u=t("../util/constants"),c=r.prototype=new a;c.transform=function(t){l.debug(t,["filtering"]);var e=s.create(t),n=this._skip,r=this;return t.rem.forEach(function(t){1!==n[t._id]?e.rem.push(t):n[t._id]=0}),t.add.forEach(function(t){i.call(r,t)?e.add.push(t):n[t._id]=1}),t.mod.forEach(function(t){var a=i.call(r,t),s=1===n[t._id];a&&s?(n[t._id]=0,e.add.push(t)):a&&!s?e.mod.push(t):!a&&s||(e.rem.push(t),n[t._id]=1)}),e},e.exports=r},{"../dataflow/changeset":82,"../parse/expr":93,"../util/constants":138,"../util/log":139,"./Transform":133}],123:[function(t,e,n){function r(t){return o.prototype.init.call(this,t),o.addParameters(this,{fields:{type:"array<field>"}}),this._output={key:"key",value:"value"},this._cache={},this.router(!0).revises(!0)}function i(t,e){for(var n in this._cache)e.rem.push.apply(e.rem,this._cache[n]);this._cache={}}function a(t,e,n){var r=this._cache[t._id]||(this._cache[t._id]=Array(n));return r[e]||(r[e]=u.derive(t,t._prev))}function s(t,e,n,r,i){for(var s,o,l,c=0,d=t.length,h=e.length;d>c;++c)for(o=t[c],s=0;h>s;++s)l=a.call(this,o,s,h),u.set(l,this._output.key,e[s]),u.set(l,this._output.value,n[s](o)),r.push(l)}var o=t("./Transform"),l=t("../util/log"),u=t("../dataflow/tuple"),c=t("../dataflow/changeset"),d=r.prototype=new o;d.transform=function(t,e){l.debug(t,["folding"]);var n=this,r=this.param("fields"),a=c.create(t);return e&&i.call(this,t,a),s.call(this,t.add,r.field,r.accessor,a.add,t.stamp),s.call(this,t.mod,r.field,r.accessor,e?a.add:a.mod,t.stamp),t.rem.forEach(function(t){a.rem.push.apply(a.rem,n._cache[t._id]),n._cache[t._id]=null}),(t.add.length||t.rem.length||r.field.some(function(e){return!!t.fields[e]}))&&(a.fields[this._output.key]=1,a.fields[this._output.value]=1),a},e.exports=r},{"../dataflow/changeset":82,"../dataflow/tuple":83,"../util/log":139,"./Transform":133}],124:[function(t,e,n){function r(t){return a.prototype.init.call(this,t),a.addParameters(this,{size:{type:"array<value>","default":[500,500]},links:{type:"data"},linkDistance:{type:"field|value","default":20},linkStrength:{type:"field|value","default":1},charge:{type:"field|value","default":-30},chargeDistance:{type:"field|value","default":1/0},iterations:{type:"value","default":500},friction:{type:"value","default":.9},theta:{type:"value","default":.8},gravity:{type:"value","default":.1},alpha:{type:"value","default":.1}}),this._nodes=[],this._links=[],this._layout=i.layout.force(),this._output={x:"layout_x",y:"layout_y",source:"_source",target:"_target"},this}var i=window.d3,a=t("./Transform"),s=t("../dataflow/tuple"),o=r.prototype=new a;o.transform=function(t){var e=this.param("links").source.last(),n=this._layout,r=this._output,i=this._nodes,a=this._links,o=this.param("iterations");t.add.forEach(function(t){i.push({tuple:t})}),e.add.forEach(function(t){var e={tuple:t,source:i[t.source],target:i[t.target]};s.set(t,r.source,e.source.tuple),s.set(t,r.target,e.target.tuple),a.push(e)}),n.size(this.param("size")).linkDistance(this.param("linkDistance")).linkStrength(this.param("linkStrength")).charge(this.param("charge")).chargeDistance(this.param("chargeDistance")).friction(this.param("friction")).theta(this.param("theta")).gravity(this.param("gravity")).alpha(this.param("alpha")).nodes(i).links(a),n.start();for(var l=0;o>l;++l)n.tick();if(n.stop(),i.forEach(function(t){s.set(t.tuple,r.x,t.x),s.set(t.tuple,r.y,t.y)}),t.rem.length>0){var u=s.idMap(t.rem);this._nodes=i.filter(function(t){return!u[t.tuple._id]})}if(e.rem.length>0){var c=s.idMap(e.rem);this._links=a.filter(function(t){return!c[t.tuple._id]})}return t.fields[r.x]=1,t.fields[r.y]=1,t},e.exports=r},{"../dataflow/tuple":83,"./Transform":133}],125:[function(t,e,n){function r(t){return i.prototype.init.call(this,t),i.addParameters(this,{field:{type:"value"},expr:{type:"expr"}}),this}var i=t("./Transform"),a=t("../dataflow/tuple"),s=t("../parse/expr"),o=t("../util/log"),l=t("../util/constants"),u=r.prototype=new i;u.transform=function(t){function e(t){var e=s.eval(n,i,{datum:t,signals:u});a.set(t,r,e)}o.debug(t,["formulating"]);var n=this._graph,r=this.param("field"),i=this.param("expr"),u=this.dependency(l.SIGNALS);return t.add.forEach(e),this.reevaluate(t)&&t.mod.forEach(e),t.fields[r]=1,t},e.exports=r},{"../dataflow/tuple":83,"../parse/expr":93,"../util/constants":138,"../util/log":139,"./Transform":133}],126:[function(t,e,n){function r(t){return s.prototype.init.call(this,t),s.addParameters(this,r.Parameters),s.addParameters(this,{lon:{type:"field"},lat:{type:"field"}}),this._output={x:"layout_x",y:"layout_y"},this}var i=window.d3,a=t("datalib/src/util"),s=t("./Transform"),o=t("../dataflow/tuple");r.Parameters={projection:{type:"value","default":"mercator"},center:{type:"array<value>"},translate:{type:"array<value>"},rotate:{type:"array<value>"},scale:{type:"value"},precision:{type:"value"},clipAngle:{type:"value"},clipExtent:{type:"value"}},r.d3Projection=function(){var t,e,n,s=(this._graph,this.param("projection")),o=r.Parameters;s!==this._mode&&(this._mode=s,this._projection=i.geo[s]()),t=this._projection;for(e in o)"projection"!==e&&t[e]&&(n=this.param(e),void 0===n||a.isArray(n)&&0===n.length||n!==t[e]()&&t[e](n));return t};var l=r.prototype=new s;l.transform=function(t){function e(t){var e=[i(t),a(t)],r=s(e);o.set(t,n.x,r[0]),o.set(t,n.y,r[1])}var n=(this._graph,this._output),i=this.param("lon").accessor,a=this.param("lat").accessor,s=r.d3Projection.call(this);return t.add.forEach(e),this.reevaluate(t)&&(t.mod.forEach(e),t.rem.forEach(e)),t.fields[n.x]=1,t.fields[n.y]=1,t},e.exports=r},{"../dataflow/tuple":83,"./Transform":133,"datalib/src/util":21}],127:[function(t,e,n){function r(t){return o.prototype.init.call(this,t),o.addParameters(this,s.Parameters),o.addParameters(this,{value:{type:"field","default":null}}),this._output={path:"layout_path"},this}var i=window.d3,a=t("datalib/src/util"),s=t("./Geo"),o=t("./Transform"),l=t("../dataflow/tuple"),u=r.prototype=new o;u.transform=function(t){function e(t){l.set(t,n.path,u(r(t)))}var n=this._output,r=this.param("value").accessor||a.identity,o=s.d3Projection.call(this),u=i.geo.path().projection(o);return t.add.forEach(e),this.reevaluate(t)&&(t.mod.forEach(e),t.rem.forEach(e)),t.fields[n.path]=1,t},e.exports=r},{"../dataflow/tuple":83,"./Geo":126,"./Transform":133,"datalib/src/util":21}],128:[function(t,e,n){function r(t){return l.prototype.init.call(this,t),l.addParameters(this,{source:{type:"field","default":"_source"},target:{type:"field","default":"_target"},x:{type:"field","default":"layout_x"},y:{type:"field","default":"layout_y"},tension:{type:"value","default":.2},shape:{type:"value","default":"line"}}),this._output={path:"layout_path"},this}function i(t,e,n,r,i,a){var s=e(t),o=r(s),l=i(s),u=n(t),c=r(u),d=i(u);return"M"+o+","+l+"L"+c+","+d}function a(t,e,n,r,i,a){var s=e(t),o=r(s),l=i(s),u=n(t),c=r(u),d=i(u),h=c-o,f=d-l,p=a*(h+f),g=a*(f-h);return"M"+o+","+l+"C"+(o+p)+","+(l+g)+" "+(c+g)+","+(d-p)+" "+c+","+d}function s(t,e,n,r,i,a){var s=e(t),o=r(s),l=i(s),u=n(t),c=r(u),d=i(u),h=(o+c)/2;return"M"+o+","+l+"C"+h+","+l+" "+h+","+d+" "+c+","+d}function o(t,e,n,r,i,a){var s=e(t),o=r(s),l=i(s),u=n(t),c=r(u),d=i(u),h=(l+d)/2;return"M"+o+","+l+"C"+o+","+h+" "+c+","+h+" "+c+","+d}var l=t("./Transform"),u=t("../dataflow/tuple"),c=r.prototype=new l,d={line:i,curve:a,diagonal:s,diagonalX:s,diagonalY:o};c.transform=function(t){function e(t){var e=r(t,i,a,s,o,l);u.set(t,n.path,e)}var n=this._output,r=d[this.param("shape")]||d.line,i=this.param("source").accessor,a=this.param("target").accessor,s=this.param("x").accessor,o=this.param("y").accessor,l=this.param("tension");return t.add.forEach(e),this.reevaluate(t)&&t.mod.forEach(e),t.fields[n.path]=1,t},e.exports=r},{"../dataflow/tuple":83,"./Transform":133}],129:[function(t,e,n){function r(t,e,n){this._name=t,this._type=e,this._transform=n,this._value=[],this._accessors=[],this._resolution=!1,this._signals={}}function i(){var t=l.test(this._type),e=u.test(this._type),n=c.test(this._type),r=t?this._value:this._value[0],i=t?this._accessors:this._accessors[0];return!a.isValid(i)&&h.test(this._type)?r:e?{name:r,source:i}:n?{field:r,accessor:i}:r}var a=t("datalib/src/util"),s=t("../parse/expr"),o=t("../util/constants"),l=/array/i,u=/data/i,c=/field/i,d=/expr/i,h=/value/i,f=r.prototype;f.get=function(){var t,e,n,r=this._transform._graph,s=u.test(this._type),o=c.test(this._type);if(!this._resolution)return i.call(this);if(s)return this._accessors=this._value.map(function(t){return r.data(t)}),i.call(this);for(t in this._signals)e=this._signals[t],n=r.signalRef(t),o&&(this._accessors[e]=this._value[e]!=n?a.accessor(n):this._accessors[e]),this._value[e]=n;return i.call(this)},f.set=function(t){var e=this,n=d.test(this._type),r=u.test(this._type),i=c.test(this._type);return this._value=a.array(t).map(function(t,l){if(a.isString(t)){if(n){var u=s(t);return e._transform.dependency(o.FIELDS,u.fields),e._transform.dependency(o.SIGNALS,u.signals),u.fn}return i?(e._accessors[l]=a.accessor(t),e._transform.dependency(o.FIELDS,t)):r&&(e._resolution=!0,e._transform.dependency(o.DATA,t)),t}return void 0!==t.value?t.value:void 0!==t.field?(e._accessors[l]=a.accessor(t.field),e._transform.dependency(o.FIELDS,t.field),t.field):void 0!==t.signal?(e._resolution=!0,e._signals[t.signal]=l,e._transform.dependency(o.SIGNALS,t.signal),t.signal):t}),e._transform},e.exports=r},{"../parse/expr":93,"../util/constants":138,"datalib/src/util":21}],130:[function(t,e,n){function r(t){return l.prototype.init.call(this,t),o.addParameters(this,{value:{type:"field","default":null},startAngle:{type:"value","default":0},endAngle:{type:"value","default":2*Math.PI},sort:{type:"value","default":!1}}),this._output={start:"layout_start",end:"layout_end",mid:"layout_mid"},this}function i(){return 1}var a=window.d3,s=t("datalib/src/generate"),o=(t("datalib/src/util"),t("./Transform")),l=t("./BatchTransform"),u=t("../dataflow/tuple"),c=r.prototype=new l;c.batchTransform=function(t,e){var n,r,o,l=(this._graph,this._output),c=this.param("value").accessor||i,d=this.param("startAngle"),h=this.param("endAngle"),f=this.param("sort"),p=e.map(c),g=d,m=(h-d)/a.sum(p),v=s.range(e.length);for(f&&v.sort(function(t,e){return p[t]-p[e]}),n=0;n<v.length;++n)r=e[v[n]],o=p[v[n]],u.set(r,l.start,g),u.set(r,l.mid,g+.5*o*m),u.set(r,l.end,g+=o*m);return t.fields[l.start]=1,t.fields[l.end]=1,t.fields[l.mid]=1,t},e.exports=r},{"../dataflow/tuple":83,"./BatchTransform":117,"./Transform":133,"datalib/src/generate":8,"datalib/src/util":21}],131:[function(t,e,n){function r(t){return a.prototype.init.call(this,t),a.addParameters(this,{by:{type:"array<field>"}}),this.router(!0)}var i=t("datalib/src/util"),a=t("./Transform"),s=(t("../parse/expr"),t("../util/log")),o=r.prototype=new a;o.transform=function(t){return s.debug(t,["sorting"]),(t.add.length||t.mod.length||t.rem.length)&&(t.sort=i.comparator(this.param("by").field)),t},e.exports=r},{"../parse/expr":93,"../util/log":139,"./Transform":133,"datalib/src/util":21}],132:[function(t,e,n){function r(t){return o.prototype.init.call(this,t),s.addParameters(this,{groupby:{type:"array<field>"},sortby:{type:"array<field>"},value:{type:"field"},offset:{type:"value","default":"zero"}}),this._output={start:"layout_start",end:"layout_end",mid:"layout_mid"},this}function i(t,e,n,r){var i,a,s,o,l,u,c,d=[];if(null==e)d.push(t.slice());else for(i={},a=0;a<t.length;++a)s=t[a],o=e.map(function(t){return t(s)}),l=i[o]||(d.push(i[o]=[]),i[o]),l.push(s);for(o=0,c=0;o<d.length;++o){for(l=d[o],a=0,u=0;a<l.length;++a)u+=r(l[a]);l.sum=u,u>c&&(c=u),null!=n&&l.sort(n)}return d.max=c,d}var a=t("datalib/src/util"),s=t("./Transform"),o=t("./BatchTransform"),l=t("../dataflow/tuple"),u=r.prototype=new o;u.batchTransform=function(t,e){for(var n=(this._graph,this.param("groupby").accessor),r=a.comparator(this.param("sortby").field),s=this.param("value").accessor,o=this.param("offset"),u=this._output,c=i(e,n,r,s),d=0,h=c.max;d<c.length;++d){var d,f,p,g=c[d],m=g.sum,v="center"===o?(h-m)/2:0,y="normalize"===o?1/m:1,_=v,x=0;for(j=0;j<g.length;++j)f=g[j],p=_,x+=s(f),_=y*x+v,l.set(f,u.start,p),l.set(f,u.end,_),l.set(f,u.mid,.5*(p+_))}return t.fields[u.start]=1,t.fields[u.end]=1,t.fields[u.mid]=1,t},e.exports=r},{"../dataflow/tuple":83,"./BatchTransform":117,"./Transform":133,"datalib/src/util":21}],133:[function(t,e,n){function r(t){return t&&i.prototype.init.call(this,t),this}var i=t("../dataflow/Node"),a=t("./Parameter"),s=t("../util/constants");r.addParameters=function(t,e){t._parameters=t._parameters||{};for(var n in e){var r=e[n],i=t._parameters[n]=new a(n,r.type,t);"custom"===r.type&&(r.set&&(i.set=r.set.bind(i)),r.get&&(i.get=r.get.bind(i))),r.hasOwnProperty("default")&&i.set(r["default"])}};var o=r.prototype=new i;o.param=function(t,e){var n=this._parameters[t];return void 0===n?this:1===arguments.length?n.get():n.set(e)},o.transform=function(t,e){return t},o.evaluate=function(t){var e=this._stamp<t.stamp&&this.dependency(s.SIGNALS).some(function(e){return!!t.signals[e]});return this.transform(t,e)},o.output=function(t){for(var e in this._output)void 0!==t[e]&&(this._output[e]=t[e]);return this},e.exports=r},{"../dataflow/Node":80,"../util/constants":138,"./Parameter":129}],134:[function(t,e,n){function r(t){return o.prototype.init.call(this,t),s.addParameters(this,{sort:{type:"array<field>","default":["-value"]},children:{type:"field","default":"children"},value:{type:"field","default":"value"},size:{type:"array<value>","default":[500,500]},round:{type:"value","default":!0},sticky:{type:"value","default":!1},ratio:{type:"value","default":u},padding:{type:"value","default":null},mode:{type:"value","default":"squarify"}}),this._layout=i.layout.treemap(),this._output={x:"layout_x",y:"layout_y",width:"layout_width",height:"layout_height"},this}var i=window.d3,a=t("datalib/src/util"),s=t("./Transform"),o=t("./BatchTransform"),l=t("../dataflow/tuple"),u=.5*(1+Math.sqrt(5)),c=r.prototype=new o;c.batchTransform=function(t,e){var n=this._layout,r=this._output;return n.sort(a.comparator(this.param("sort").field)).children(this.param("children").accessor).value(this.param("value").accessor).size(this.param("size")).round(this.param("round")).sticky(this.param("sticky")).ratio(this.param("ratio")).padding(this.param("padding")).mode(this.param("mode")).nodes(e[0]),e.forEach(function(t){l.set(t,r.x,t.x),l.set(t,r.y,t.y),l.set(t,r.width,t.dx),l.set(t,r.height,t.dy)}),t.fields[r.x]=1,t.fields[r.y]=1,t.fields[r.width]=1,t.fields[r.height]=1,t},e.exports=r},{"../dataflow/tuple":83,"./BatchTransform":117,"./Transform":133,"datalib/src/util":21}],135:[function(t,e,n){function r(t){return s.prototype.init.call(this,t),s.addParameters(this,{"with":{type:"data"},as:{type:"value"},key:{type:"field","default":"data"},withKey:{type:"field","default":null},"default":{type:"value"}}),this._map={},this._collector=new o(t),this._lastJoin=0,this.revises(!0)}function i(t){return this._map[t]||(this._map[t]=[])}var a=t("datalib/src/util"),s=t("./Transform"),o=t("../dataflow/Collector"),l=t("../util/log"),u=r.prototype=new s;u.transform=function(t){
var e=this.param("with"),n=e.source,r=n.last(),s=n.values(),o=this.param("key"),u=this.param("withKey"),c=this.param("as"),d=this.param("default"),h=i.bind(this),f={};if(l.debug(t,["zipping",e.name]),u.field)r&&r.stamp>this._lastJoin&&(r.rem.forEach(function(t){var e=h(u.accessor(t));e[0]&&e[0].forEach(function(t){t[c]=d}),e[1]=null}),r.add.forEach(function(t){var e=h(u.accessor(t));e[0]&&e[0].forEach(function(e){e[c]=t}),e[1]=t}),r.fields[u.field]&&r.mod.forEach(function(t){var e;if(t._prev&&void 0!==(e=u.accessor(t._prev))){var n=h(e);n[0]&&n[0].forEach(function(t){t[c]=d}),n[1]=null;var r=h(u.accessor(t));r[0]&&r[0].forEach(function(e){e[c]=t}),r[1]=t}}),this._lastJoin=r.stamp),t.add.forEach(function(t){var e=h(o.accessor(t));t[c]=e[1]||d,(e[0]=e[0]||[]).push(t)}),t.rem.forEach(function(t){var e=o.accessor(t);(f[e]=f[e]||{})[t._id]=1}),t.fields[o.field]&&t.mod.forEach(function(t){var e;if(t._prev&&void 0!==(e=o.accessor(t._prev))){var n=h(o.accessor(t));t[c]=n[1]||d,(n[0]=n[0]||[]).push(t),(f[e]=f[e]||{})[t._id]=1}}),a.keys(f).forEach(function(t){var e=h(t);e[0]&&(e[0]=e[0].filter(function(e){return 1!==f[t][e._id]}))});else{if(0==t.add.length&&0==t.rem.length&&0==r.add.length&&0==r.rem.length)return t;this._collector.evaluate(t);var p,g=this._collector.data(),m=s.length;for(p=0;p<g.length;p++)g[p][c]=s[p%m]}return t.fields[c]=1,t},e.exports=r},{"../dataflow/Collector":77,"../util/log":139,"./Transform":133,"datalib/src/util":21}],136:[function(t,e,n){e.exports={aggregate:t("./Aggregate"),bin:t("./Bin"),cross:t("./Cross"),linkpath:t("./LinkPath"),facet:t("./Facet"),filter:t("./Filter"),fold:t("./Fold"),force:t("./Force"),formula:t("./Formula"),geo:t("./Geo"),geopath:t("./GeoPath"),pie:t("./Pie"),sort:t("./Sort"),stack:t("./Stack"),treemap:t("./Treemap"),zip:t("./Zip")}},{"./Aggregate":116,"./Bin":118,"./Cross":119,"./Facet":120,"./Filter":122,"./Fold":123,"./Force":124,"./Formula":125,"./Geo":126,"./GeoPath":127,"./LinkPath":128,"./Pie":130,"./Sort":131,"./Stack":132,"./Treemap":134,"./Zip":135}],137:[function(t,e,n){var r=window.d3,i={};i.debug=!1,i.load={baseURL:"",domainWhiteList:!1},i.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',i.autopadInset=5,i.scale={time:r.time.scale,utc:r.time.scale.utc},i.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},i.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},i.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},i.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},i.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},e.exports=i},{}],138:[function(t,e,n){e.exports={ADD_CELL:1,MOD_CELL:2,ID:"_id",DATA:"data",FIELDS:"fields",SCALES:"scales",SIGNAL:"signal",SIGNALS:"signals",GROUP:"group",AREA:"area",LINE:"line",ENTER:"enter",UPDATE:"update",EXIT:"exit",SENTINEL:{sentinel:1},SINGLETON:"_singleton",ADD:"add",REMOVE:"remove",TOGGLE:"toggle",CLEAR:"clear",LINEAR:"linear",ORDINAL:"ordinal",LOG:"log",POWER:"pow",SQRT:"sqrt",TIME:"time",TIME_UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",DOMAIN:"domain",RANGE:"range",MARK:"mark",AXIS:"axis",LEGEND:"legend",COUNT:"count",GROUPBY:"groupby",MIN:"min",MAX:"max",VALUE:"value",SORT:"sort",ASC:"asc",DESC:"desc"}},{}],139:[function(t,e,n){(function(n){function r(t){t="[Vega Log] "+t,l.isNode?n.stderr.write(t+"\n"):console.log(t)}function i(t){t="[Vega Err] "+t,l.isNode?n.stderr.write(t+"\n"):console.error(t)}function a(t,e){if(l.debug){var n=Function.prototype.bind.call(console.log,console),r={prevTime:Date.now()-s,stamp:t.stamp};t.add&&o.extend(r,{add:t.add.length,mod:t.mod.length,rem:t.rem.length,reflow:!!t.reflow}),n.apply(console,(e.push(JSON.stringify(r)),e)),s=Date.now()}}var s,o=t("datalib/src/util"),l=t("./config");e.exports={log:r,error:i,debug:a}}).call(this,t("_process"))},{"./config":137,_process:3,"datalib/src/util":21}],140:[function(t,e,n){function r(t,e,n){var r=t.schema;r&&(r.refs&&i.extend(n.refs,r.refs),r.defs&&i.extend(n.defs,r.defs))}var i=t("datalib/src/util"),a=t("datalib/src/import/readers"),s=t("../parse"),o=t("../scene/Scale"),l=t("../util/config");e.exports=function u(t){var u=null;return t=t||{},t.url?u=a.json(i.extend({url:t.url},l.load)):(u={$schema:"http://json-schema.org/draft-04/schema#",title:"Vega Visualization Specification Language",defs:{},refs:{},$ref:"#/defs/spec"},i.keys(s).forEach(function(e){r(s[e],t,u)}),r(o,t,u)),t.properties&&i.keys(t.properties).forEach(function(e){u.defs.propset.properties[e]={$ref:"#/refs/"+t.properties[e]+"Value"}}),t.propertySets&&i.keys(t.propertySets).forEach(function(t){u.defs.mark.properties.properties.properties[t]={$ref:"#/defs/propset"}}),u}},{"../parse":94,"../scene/Scale":111,"../util/config":137,"datalib/src/import/readers":16,"datalib/src/util":21}]},{},[1])(1)});