<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <title>Vega: A Visualization Grammar</title>
    <link rel="shortcut icon" href="http://vega.github.io/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="css/site.css"/>
    <script src="lib/d3.v3.min.js"></script>
    <script src="vega2.js"></script>
  </head>
  <body>
    <div id="main">
      <a href="https://github.com/vega/vega">
        <img style="position:absolute;top:0;right:0;border:0;" width="149" height="149" src="images/forkme.png" alt="Fork me on GitHub">
      </a>
      <div id="logo">
        <div id="links">
          <a href="vega2.min.js"><strong>vega2.min.js</strong></a><br/>
          <!-- <a href="vega2.schema.json"><strong>JSON Schema</strong></a><br />  -->
          <a href="https://github.com/vega/vega"><strong>Source</strong> (GitHub)</a>
        </div>
        <div id="wordmark">
          vega
        </div>
      </div>

      <p><strong>Vega</strong> is a <em>visualization grammar</em>, a declarative format for creating, saving, and sharing interactive visualization designs.</p>

      <p>With Vega, you can describe the visual appearance and interactive behaviour of a visualization in a JSON format, and generate views using HTML5 Canvas or SVG.</p>

      <p>Read the <a href="https://github.com/vega/vega/wiki/Tutorial">tutorial</a>, browse the <a href="https://github.com/trifacta/vega/wiki">documentation</a>, join the <a href="https://groups.google.com/forum/?fromgroups#!forum/vega-js">discussion</a>. A sampling of example visualizations is shown below. Click to explore them using the web-based <a href="editor/">Vega Editor</a>.</p>

      <div id="examples">
      </div>

      <div class="credits">
        <a href="http://trifacta.com" title="Trifacta"><img src="images/trifacta-logo.png"/></a>
        <a href="http://idl.cs.washington.edu" title="UW Interactive Data Lab"><img src="images/idl-logo.png"/></a>
      </div>
  </body>
  <script>
    var examples = [
      {name: 'bar',               editor: true, row: 0, col: 0, x: [90, 36, 97],    y: [-12, -18, 9], width: 275, height: 105},
      {name: 'linking',           editor: true, row: 0, col: 1, x: [10, 10, 175],   y: [-148, -210, 0], width: 710, height: 300},
      {name: 'choropleth',        editor: true, row: 0, col: 2, x: [25, 15, 125],   y: [-10, -65, 5], width: 348, height: 150},
      {name: 'dimpvis',           editor: true, row: 0, col: 3, x: [175, 150, 205], y: [-42, -100, -5], width: 946, height: 300},
      {name: 'crossfilter',       editor: true, row: 0, col: 4, x: [75, -25, 240],  y: [0, -55, 0], width: 997, height: 250},
      {name: 'driving',           editor: true, row: 1, col: 0, x: [25, 25, 25],    y: [0, 0, 0], width: 825, height: 150},
      {name: 'force',             editor: true, row: 1, col: 1, x: [50, 50, 50],    y: [0, 0, 0], width: 200, height: 200},
      {name: 'heatmap',           editor: true, row: 1, col: 2, x: [50, 50, 50],    y: [-5, -5, -5], width: 957, height: 150},
      {name: 'index_chart',       editor: true, row: 1, col: 3, x: [25, 25, 25],    y: [5, 5, 5], width: 650, height: 125},
      {name: 'jobs',              editor: true, row: 1, col: 4, x: [50, 50, 50],    y: [0, 0, 0], width: 880, height: 150},
      {name: 'parallel_coords',   editor: true, row: 2, col: 0, x: [25, 25, 25],    y: [0, 0, 0], width: 729, height: 150},
      {name: 'playfair',          editor: true, row: 2, col: 1, x: [23, 23, 23],    y: [0, 0, 0], width: 815, height: 135},
      {name: 'population',        editor: true, row: 2, col: 2, x: [75, 75, 75],    y: [0, 0, 0], width: 657, height: 135},
      {name: 'budget_forecasts',  editor: true, row: 2, col: 3, x: [10, 10, 10],    y: [0, 0, 0], width: 540, height: 140},
      {name: 'treemap',           editor: true, row: 2, col: 4, x: [0, 0, 0],       y: [0, 0, 0], width: 965, height: 140},
    ];

    var width = 700,
        thumb  = width / 5,
        height = thumb/1.5 * (examples.length/5); 

    var spec = {
      "width": width,
      "height": height,
      "padding": 0,

      "signals": [
        {
          "name": "active",
          "init": {},
          "streams": [
            {"type": "image:mouseover, group:mouseover, group:mouseout, rect:mouseover", "expr": "event.vgExampleItem.datum"},
            {"type": "body:mouseout", "expr": "{}"},
          ]
        },
        {
          "name": "pan",
          "init": {"x": 0, "y": 0},
          "streams": [
            {"type": "body:mouseout", "expr": "{x: 0, y: 0}"},
            {
              "type": "image:mousemove", 
              "expr": "{x: panPrev.x - event.vgExampleX, y: panPrev.y - event.vgExampleY}"
            }
          ]
        },
        {
          "name": "panPrev",
          "init": {"x": 0, "y": 0},
          "streams": [
            {
              "type": "image:mouseover, image:mousemove", 
              "expr": "{x: event.vgExampleX, y: event.vgExampleY}"
            },
          ]
        }
      ],

      "data": [{ 
        "name": "examples", 
        "values": examples,
        "transform": [
          {
            "type": "formula", 
            "field": "pan_x", 
            "expr": "clamp(active._id == datum._id ? datum.pan_x + pan.x/1.5 : datum.pan_x || datum.x[0], datum.x[1], datum.x[2])"
          },
          {
            "type": "formula", 
            "field": "pan_y", 
            "expr": "clamp(active._id == datum._id ? datum.pan_y + pan.y/1.5 : datum.pan_y || datum.y[0], datum.y[1], datum.y[2])"
          },
        ]
      }],

      "predicates": [
        {
          "name": "hovered",
          "type": "==",
          "operands": [{"signal": "active._id"}, {"arg": "id"}]
        }
      ],

      "scales": [
        {
          "name": "x",
          "type": "ordinal",
          "domain": {"data": "examples", "field": "col"},
          "range": "width"
        },
        {
          "name": "y",
          "type": "ordinal",
          "domain": {"data": "examples", "field": "row"},
          "range": "height"
        }
      ],

      "marks": [
        {
          "name": "example",
          "type": "group",
          "from": {"data": "examples"},
          "properties": {
            "enter": {
              "x": {"scale": "x", "field": "col"},
              "width": {"scale": "x", "band": true, "offset": -5},
              "y": {"scale": "y", "field": "row"},
              "height": {"scale": "y", "band": true, "offset": -5},
              "clip": {"value": true},
              "fill": {"value": "#fff"}
            }
          },

          "marks": [
            {
              "name": "example-thumb",
              "type": "image",
              "properties": {
                "enter": {
                  "width": {"field": {"parent": "width"}},
                  "height": {"field": {"parent": "height"}},
                  "url": {"template": "{{parent.name}}.png"},
                  "align": {"value": "center"},
                  "baseline": {"value": "center"}
                },
                "update": {
                  "x": {"field": {"parent": "pan_x"}},
                  "y": {"field": {"parent": "pan_y"}}
                }
              }
            },
            {
              "type": "rect",
              "properties": {
                "enter": {
                  "x": {"value": 0},
                  "y": {"value": 0},
                  "width": {"field": {"group": "width"}},
                  "height": {"field": {"group": "height"}}
                },
                "update": {
                  "stroke": {
                    "rule": [
                      {
                        "predicate": {
                          "name": "hovered",
                          "id": {"field": {"parent": "_id"}}
                        },
                        "value": "#d5a928"
                      },
                      {"value": "#8A5ED3"}
                    ]
                  },

                  "strokeWidth": {
                    "rule": [
                      {
                        "predicate": {
                          "name": "hovered",
                          "id": {"field": {"parent": "_id"}}
                        },
                        "value": 3
                      },
                      {"value": 1}
                    ]
                  }
                }
              }
            }
          ]
        }
      ]
    };

    var view;
    vg.parse.spec(spec, function(chart) {
      view = chart({ el: "#examples", renderer: "svg" })
        .update({});

      view.on('click', function(e, i) {
        if (!i) return;
        if (i.mark.marktype === 'image') i = i.mark.group;
        var d = i.datum;
        window.location = d.editor ? 'editor/index.html?spec=' + d.name : d.url; 
      });
    }, {
      load: { baseURL: "images/examples/" }
    });
  </script>
</html>
