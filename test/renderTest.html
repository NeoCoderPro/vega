<!DOCTYPE html>
<html>
  <head>
    <title>Vega 2.0 Render Tests</title>    
    <style>
      svg { border: 1px dotted black; }
    </style>
    <script src="../node_modules/requirejs/require.js"></script>
    <script>
      var global = window, view = null;
      require.config({
        paths: {
          d3: "../node_modules/d3/d3.min",
          vega: "../node_modules/vega/vega",
          topojson: "../node_modules/vega/node_modules/topojson/topojson.min",
          "js-priority-queue": "../node_modules/js-priority-queue/priority-queue"
        },
      });

      require(['d3', 'spec/index', 'suite/index', './runner', '../src/parse/spec'],
        function(d3, specs, suites, runner, parseSpec) {
          var current_task = 0, 
              name    = null,
              runTask = null,
              spec  = null,
              suite = null;

          d3.select('#spec')
            .selectAll('option')
              .data([""].concat(Object.keys(specs)))
            .enter().append('option').text(function(d) { return d });

          d3.select('#spec').on('change', function() {
            name = this.value, spec = specs[name], suite = suites[name];
            if(!name) return;

            parseSpec(spec, function(chart) {
              var cb = function(id, task, time, ds) {
                d3.select('#task_id').text(id);
                d3.select('#task_label').text(task.label);
              };

              view = chart({ el: '#vis', renderer: 'svg' });
              view.update();

              runTask = runner(view.model(), name, spec, suite, cb);
              runTask(suite.tasks[current_task=0], current_task++);
              d3.select('#next_task')
                  .attr('disabled', current_task >= suite.tasks.length ? true : null);
            });
          });

          d3.select('#next_task').on('click', function() {
            runTask(suite.tasks[current_task], current_task++);
            if(current_task >= suite.tasks.length) this.disabled = true;
          })
        }
      );
    </script>
  </head>
  <body>
    <h1>Vega 2.0 Render Tests</h1>

    <p>Spec: <select id="spec"></select></p>

    <p><input type="button" id="next_task" value=">" /> Task #<span id="task_id"></span>: <span id="task_label"></span></p>

    <div id="vis"></div>

    <ul id="tasks"></ul>
  </body>
</html>