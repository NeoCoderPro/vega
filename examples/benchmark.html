<html>
  <head>
    <title>Vega Scenegraph Benchmark</title/>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="../vega.js"></script>
  </head>
  <body>
    <div id="vis">
    </div>
<script type="text/javascript">
function params() {
  return location.search.slice(1)
    .split("&")
    .map(function(x) { return x.split("="); })
    .reduce(function(a, b) {
      a[b[0]] = b[1]; return a;
    }, {});
}

function buildScene(N, type, w, h) {
  var marks = d3.range(N).map(function(i) {
    return {
      x: ~~(w * Math.random()),
      y: ~~(h * Math.random()),
      size: Math.PI * 25,
      width: 10,
      height: 10,
      fill: "steelblue",
      fillOpacity: 0.3
    };
  });
  self.marks = marks;
  return {
    marktype: "group",
    items: [{x: 10, y: 10, items: [{
      marktype: type,
      items: marks
    }] }]
  };
}

function draw(scene, w, h) {
 return new vg.View("#vis", w+20, h+20)
    .scene(new vg.Scene().root(scene))
    .render()
    .on("mouseover", function(evt, item) {
      console.log(item);
    });
}

var p = params(),
    N = (~~p.N) || 10000,
    type = p.type || "symbol",
    w = (~~p.width) || 960,
    h = (~~p.height) || 500;

var scene = buildScene(N, type, w, h),
    view = draw(scene, w, h);

var count = 0;
d3.timer(function() {
  var marks = scene.items[0].items[0].items;
  for (var i=0; i<marks.length; ++i) {
    marks[i].x += ~~(2 * (2*Math.random() - 1));
    marks[i].y += ~~(2 * (2*Math.random() - 1));
  }
  view.render();
  return (++count > 100);
});

</script>
  </body>
</html>