vg=function(e){function s(e){return e.replace(i,"$1\\'")}function o(e,t,n){var r=0,i=e.split(u);return n?e=(i=i.reverse()).filter(function(e){return r+=e.length,r<=t}).reverse():e=i.filter(function(e){return r+=e.length,r<=t}),e.length?e.join("").trim():i[0].slice(0,t)}function a(e){n.config.isNode?process.stderr.write(e+"\n"):console.log(e)}function p(e){return c.test(e)}function d(e){return e.indexOf(h)===0}function v(t,r){n.log("LOAD: "+t),e.xhr(t,function(e,t){t&&(t=t.responseText),r(e,t)})}function m(e,t){n.log("LOAD FILE: "+e);var r=e.indexOf(h);r>=0&&(e=e.slice(h.length)),require("fs").readFile(e,t)}function b(e,t){n.log("LOAD HTTP: "+e);var r=require("http").request(e,function(e){var n=0,r=new Buffer(parseInt(e.headers["content-length"],10));e.on("error",function(e){t(e,null)}),e.on("data",function(e){e.copy(r,n),n+=e.length}),e.on("end",function(){t(null,r)})});r.on("error",function(e){t(e)}),r.end()}function E(e,t,n){i=[];if(n&&t.length>1){var r=S(e.domain()),i,s=-1,o=t.length,u=(t[1]-t[0])/++n,a,f;while(++s<o)for(a=n;--a>0;)(f=+t[s]-a*u)>=r[0]&&i.push(f);for(--s,a=0;++a<n&&(f=+t[s]+a*u)<r[1];)i.push(f)}return i}function S(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function T(e){return e.rangeExtent?e.rangeExtent():S(e.range())}function k(e,t,r,i,s,o){s=Math.max(s,0)+o;if(e==="left"||e==="top")s*=-1;e==="top"||e==="bottom"?(n.extend(t.properties.enter,{x:r,y:{value:s}}),n.extend(t.properties.update,{x:i,y:{value:s},align:{value:"center"},baseline:{value:C[e]}})):(n.extend(t.properties.enter,{x:{value:s},y:r}),n.extend(t.properties.update,{x:{value:s},y:i,align:{value:N[e]},baseline:{value:"middle"}}))}function L(e,t,r,i,s){var o=e==="left"||e==="top"?-1:1;s===Infinity?s=e==="top"||e==="bottom"?{group:"height",mult:-o}:{group:"width",mult:-o}:s={value:o*s},e==="top"||e==="bottom"?(n.extend(t.properties.enter,{x:r,y:{value:0},y2:s}),n.extend(t.properties.update,{x:i,y:{value:0},y2:s}),n.extend(t.properties.exit,{x:i})):(n.extend(t.properties.enter,{x:{value:0},x2:s,y:r}),n.extend(t.properties.update,{x:{value:0},x2:s,y:i}),n.extend(t.properties.exit,{y:i}))}function A(e,t,r,i){var s=~~((r[1]-r[0])/2),o=e==="top"||e==="left"?-1:1;e==="bottom"||e==="top"?n.extend(t.properties.update,{x:{value:s},y:{value:o*i},angle:{value:0}}):n.extend(t.properties.update,{x:{value:o*i},y:{value:s},angle:{value:-90}})}function O(e,t,n,r){var i;if(e==="top"||e==="left")r=-1*r;e==="bottom"||e==="top"?i="M"+n[0]+","+r+"V0H"+n[1]+"V"+r:i="M"+r+","+n[0]+"H0V"+n[1]+"H"+r,t.properties.update.path={value:i}}function M(e,t,n){var r=n?{}:e,i=e.mark.def.offset,s=e.mark.def.orient,o=t.width,u=t.height;switch(s){case"left":r.x=-i,r.y=0;break;case"right":r.x=o+i,r.y=0;break;case"bottom":r.x=0,r.y=u+i;break;case"top":r.x=0,r.y=-i;break;default:r.x=0,r.y=0}n&&n.interpolate(e,r)}function _(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:n.config.axis.tickColor},strokeWidth:{value:n.config.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function D(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:n.config.axis.tickLabelColor},font:{value:n.config.axis.tickLabelFont},fontSize:{value:n.config.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function P(){return{type:"text",interactive:!0,properties:{enter:{font:{value:n.config.axis.titleFont},fontSize:{value:n.config.axis.titleFontSize},fontWeight:{value:n.config.axis.titleFontWeight},fill:{value:n.config.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function H(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:n.config.axis.axisColor},strokeWidth:{value:n.config.axis.axisWidth}},update:{}}}}function j(e,t,n){var r=n?{}:e,i=e.mark.def.offset,s=e.mark.def.orient,o=e.mark.def.padding*2,u=t.bounds?t.bounds.x1:0,a=t.bounds?t.bounds.x2:t.width,f=~~e.bounds.width()+(r.width?0:o),l=~~e.bounds.height()+(r.height?0:o);r.x=.5,r.y=.5,r.width=f,r.height=l;switch(s){case"left":r.x+=u-i-f;break;case"right":r.x+=a+i}e.mark.def.properties.enter(e,t,n)}function F(e,t,n,r,i){var s=e.properties.enter;t&&(s.size={scale:t.scaleName,field:"data"}),n&&(s.shape={scale:n.scaleName,field:"data"}),r&&(s.fill={scale:r.scaleName,field:"data"}),i&&(s.stroke={scale:i.scaleName,field:"data"})}function I(){var e=n.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{value:0},y:{value:0},fill:{value:e.titleColor},font:{value:e.titleFont},fontSize:{value:e.titleFontSize},fontWeight:{value:e.titleFontWeight},baseline:{value:"top"},text:{field:"data"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function q(){var e=n.config.legend;return{type:"symbol",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},shape:{value:e.symbolShape},size:{value:e.symbolSize},stroke:{value:e.symbolColor},strokeWidth:{value:e.symbolStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function R(){var e=n.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",offset:5},y:{scale:"legend",field:"index"},fill:{value:e.labelColor},font:{value:e.labelFont},fontSize:{value:e.labelFontSize},align:{value:e.labelAlign},baseline:{value:e.labelBaseline},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function U(){var e=n.config.legend;return{type:"rect",interactive:!1,properties:{enter:{x:{value:0},y:{value:0},width:{value:e.gradientWidth},height:{value:e.gradientHeight},stroke:{value:e.gradientStrokeColor},strokeWidth:{value:e.gradientStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function z(){var e=n.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{scale:"legend",field:"data"},y:{value:20},dy:{value:2},fill:{value:e.labelColor},font:{value:e.labelFont},fontSize:{value:e.labelFontSize},align:{field:"align"},baseline:{value:"top"},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}var n={};n.version="1.3.0";var r=Object.prototype.toString;n.isObject=function(e){return e===Object(e)},n.isFunction=function(e){return r.call(e)=="[object Function]"},n.isString=function(e){return r.call(e)=="[object String]"},n.isArray=Array.isArray||function(e){return r.call(e)=="[object Array]"},n.isNumber=function(e){return r.call(e)=="[object Number]"},n.isBoolean=function(e){return r.call(e)=="[object Boolean]"},n.number=function(e){return+e},n.boolean=function(e){return!!e},n.identity=function(e){return e},n.extend=function(e){for(var t,n,r=1,i=arguments.length;r<i;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},n.duplicate=function(e){return JSON.parse(JSON.stringify(e))},n.field=function(e){return e.split("\\.").map(function(e){return e.split(".")}).reduce(function(e,t){return e.length&&(e[e.length-1]+="."+t.shift()),e.push.apply(e,t),e},[])},n.accessor=function(e){var t;return n.isFunction(e)||e==null?e:n.isString(e)&&(t=n.field(e)).length>1?function(e){return t.reduce(function(e,t){return e[t]},e)}:function(t){return t[e]}},n.comparator=function(e){var t=[];return e===undefined&&(e=[]),e=n.array(e).map(function(e){var r=1;return e[0]==="-"?(r=-1,e=e.slice(1)):e[0]==="+"&&(r=1,e=e.slice(1)),t.push(r),n.accessor(e)}),function(n,r){var i,s,o,u,a;for(i=0,s=e.length;i<s;++i){o=e[i],u=o(n),a=o(r);if(u<a)return-1*t[i];if(u>a)return t[i]}return 0}},n.cmp=function(e,t){return e<t?-1:e>t?1:0},n.numcmp=function(e,t){return e-t},n.array=function(e){return e!=null?n.isArray(e)?e:[e]:[]},n.values=function(e){return n.isObject(e)&&!n.isArray(e)&&e.values?e.values:e},n.str=function(e){return n.isArray(e)?"["+str.map(e)+"]":n.isObject(e)?JSON.stringify(e):n.isString(e)?"'"+s(e)+"'":e};var i=/(^|[^\\])'/g;n.keys=function(e){var t=[];for(var n in e)t.push(n);return t},n.unique=function(e,t,r){if(!n.isArray(e)||e.length==0)return[];t=t||n.identity,r=r||[];for(var i,s=0,o=e.length;s<o;++s)i=t(e[s]),r.indexOf(i)<0&&r.push(i);return r},n.minIndex=function(e,t){if(!n.isArray(e)||e.length==0)return-1;t=t||n.identity;var r=0,i=t(e[0]),s=i;for(var o=1,u=e.length;o<u;++o)s=t(e[o]),s<i&&(i=s,r=o);return r},n.maxIndex=function(e,t){if(!n.isArray(e)||e.length==0)return-1;t=t||n.identity;var r=0,i=t(e[0]),s=i;for(var o=1,u=e.length;o<u;++o)s=t(e[o]),s>i&&(i=s,r=o);return r},n.truncate=function(e,t,n,r,i){var s=e.length;if(s<=t)return e;i=i||"...";var u=Math.max(0,t-i.length);switch(n){case"left":return i+(r?o(e,u,1):e.slice(s-u));case"middle":case"center":var a=Math.ceil(u/2),f=Math.floor(u/2);return(r?o(e,a):e.slice(0,a))+i+(r?o(e,f,1):e.slice(s-f));default:return(r?o(e,u):e.slice(0,u))+i}};var u=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;n.log=function(e){a("[Vega Log] "+e)},n.error=function(e){e="[Vega Err] "+e,a(e),typeof alert!="undefined"&&alert(e)},n.config={},n.config.isNode=typeof exports!="undefined"&&this.exports!==exports,n.config.baseURL="",n.config.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',n.config.autopadInset=5,n.config.scale={time:e.time.scale,utc:e.time.scale.utc},n.config.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},n.config.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},n.config.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},n.config.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},n.config.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},n.Bounds=function(){var e=function(e){this.clear(),e&&this.union(e)},t=e.prototype;return t.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},t.set=function(e,t,n,r){return this.x1=e,this.y1=t,this.x2=n,this.y2=r,this},t.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},t.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},t.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},t.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},t.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),s=t-t*r+n*i,o=n-t*i-n*r,u=this.x1,a=this.x2,f=this.y1,l=this.y2;return this.clear().add(r*u-i*f+s,i*u+r*f+o).add(r*u-i*l+s,i*u+r*l+o).add(r*a-i*f+s,i*a+r*f+o).add(r*a-i*l+s,i*a+r*l+o)},t.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},t.encloses=function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},t.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},t.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},t.width=function(){return this.x2-this.x1},t.height=function(){return this.y2-this.y1},e}(),n.Gradient=function(){function e(e){this.id="grad_"+f++,this.type=e||"linear",this.stops=[],this.x1=0,this.x2=1,this.y1=0,this.y2=0}var t=e.prototype;return t.stop=function(e,t){return this.stops.push({offset:e,color:t}),this},e}();var f=0;n.canvas={},n.canvas.path=function(){function i(t){var n=[],i,s,o;t=t.slice().replace(r[0],"###$1").split(r[1]).slice(1);for(var u=0,a,f,l=t.length;u<l;u++){i=t[u],s=i.slice(1).trim().replace(r[2],"$1###-").split(r[3]),f=[i.charAt(0)];for(var a=0,c=s.length;a<c;a++)o=parseFloat(s[a]),isNaN(o)||f.push(o);var h=f[0].toLowerCase(),p=e[h];if(f.length-1>p)for(var d=1,v=f.length;d<v;d+=p)n.push([f[0]].concat(f.slice(d,d+p)));else n.push(f)}return n}function s(e,t,n,r,i,s,o){var u=r[0],a=r[1],f=r[2],l=r[3],c=r[4],d=r[5],v=r[6],m=h(d,v,u,a,l,c,f,t,n);for(var g=0;g<m.length;g++){var y=p.apply(null,m[g]);e.bezierCurveTo.apply(e,y),i.add(y[0]-s,y[1]-o),i.add(y[2]-s,y[3]-o),i.add(y[4]-s,y[5]-o)}}function o(e,n,r,i){var s=r[0],o=r[1],u=r[2],a=r[3],f=r[4],c=r[5],d=r[6],v=h(c,d,s,o,a,f,u,e,n);for(var m=0;m<v.length;m++){var g=p.apply(null,v[m]);i.add(g[0]-l,g[1]-t),i.add(g[2]-l,g[3]-t),i.add(g[4]-l,g[5]-t)}}function h(e,t,n,r,i,s,o,a,l){c=f.call(arguments);if(u[c])return u[c];var h=o*(Math.PI/180),p=Math.sin(h),d=Math.cos(h);n=Math.abs(n),r=Math.abs(r);var v=d*(a-e)*.5+p*(l-t)*.5,m=d*(l-t)*.5-p*(a-e)*.5,g=v*v/(n*n)+m*m/(r*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);var y=d/n,b=p/n,w=-p/r,E=d/r,S=y*a+b*l,x=w*a+E*l,T=y*e+b*t,N=w*e+E*t,C=(T-S)*(T-S)+(N-x)*(N-x),k=1/C-.25;k<0&&(k=0);var L=Math.sqrt(k);s==i&&(L=-L);var A=.5*(S+T)-L*(N-x),O=.5*(x+N)+L*(T-S),M=Math.atan2(x-O,S-A),_=Math.atan2(N-O,T-A),D=_-M;D<0&&s==1?D+=2*Math.PI:D>0&&s==0&&(D-=2*Math.PI);var P=Math.ceil(Math.abs(D/(Math.PI*.5+.001))),H=[];for(var B=0;B<P;B++){var j=M+B*D/P,F=M+(B+1)*D/P;H[B]=[A,O,j,F,n,r,p,d]}return u[c]=H}function p(e,t,n,r,i,s,o,u){c=f.call(arguments);if(a[c])return a[c];var l=u*i,h=-o*s,p=o*i,d=u*s,v=Math.cos(n),m=Math.sin(n),g=Math.cos(r),y=Math.sin(r),b=.5*(r-n),w=Math.sin(b*.5),E=8/3*w*w/Math.sin(b),S=e+v-E*m,x=t+m+E*v,T=e+g,N=t+y,C=T+E*y,k=N-E*g;return a[c]=[l*S+h*x,p*S+d*x,l*C+h*k,p*C+d*k,l*T+h*N,p*T+d*N]}function d(e,t,r,i){var o,u=null,a=0,f=0,l=0,c=0,h,p,d,v,m=new n.Bounds;r==undefined&&(r=0),i==undefined&&(i=0),e.beginPath();for(var g=0,y=t.length;g<y;++g){o=t[g];switch(o[0]){case"l":a+=o[1],f+=o[2],e.lineTo(a+r,f+i),m.add(a,f);break;case"L":a=o[1],f=o[2],e.lineTo(a+r,f+i),m.add(a,f);break;case"h":a+=o[1],e.lineTo(a+r,f+i),m.add(a,f);break;case"H":a=o[1],e.lineTo(a+r,f+i),m.add(a,f);break;case"v":f+=o[1],e.lineTo(a+r,f+i),m.add(a,f);break;case"V":f=o[1],e.lineTo(a+r,f+i),m.add(a,f);break;case"m":a+=o[1],f+=o[2],e.moveTo(a+r,f+i),m.add(a,f);break;case"M":a=o[1],f=o[2],e.moveTo(a+r,f+i),m.add(a,f);break;case"c":h=a+o[5],p=f+o[6],l=a+o[3],c=f+o[4],e.bezierCurveTo(a+o[1]+r,f+o[2]+i,l+r,c+i,h+r,p+i),m.add(a+o[1],f+o[2]),m.add(l,c),m.add(h,p),a=h,f=p;break;case"C":a=o[5],f=o[6],l=o[3],c=o[4],e.bezierCurveTo(o[1]+r,o[2]+i,l+r,c+i,a+r,f+i),m.add(o[1],o[2]),m.add(l,c),m.add(a,f);break;case"s":h=a+o[3],p=f+o[4],l=2*a-l,c=2*f-c,e.bezierCurveTo(l+r,c+i,a+o[1]+r,f+o[2]+i,h+r,p+i),m.add(l,c),m.add(a+o[1],f+o[2]),m.add(h,p),l=a+o[1],c=f+o[2],a=h,f=p;break;case"S":h=o[3],p=o[4],l=2*a-l,c=2*f-c,e.bezierCurveTo(l+r,c+i,o[1]+r,o[2]+i,h+r,p+i),a=h,f=p,m.add(o[1],o[2]),m.add(l,c),m.add(h,p),l=o[1],c=o[2];break;case"q":h=a+o[3],p=f+o[4],l=a+o[1],c=f+o[2],e.quadraticCurveTo(l+r,c+i,h+r,p+i),a=h,f=p,m.add(l,c),m.add(h,p);break;case"Q":h=o[3],p=o[4],e.quadraticCurveTo(o[1]+r,o[2]+i,h+r,p+i),a=h,f=p,l=o[1],c=o[2],m.add(l,c),m.add(h,p);break;case"t":h=a+o[1],p=f+o[2],u[0].match(/[QqTt]/)===null?(l=a,c=f):u[0]==="t"?(l=2*a-d,c=2*f-v):u[0]==="q"&&(l=2*a-l,c=2*f-c),d=l,v=c,e.quadraticCurveTo(l+r,c+i,h+r,p+i),a=h,f=p,l=a+o[1],c=f+o[2],m.add(l,c),m.add(h,p);break;case"T":h=o[1],p=o[2],l=2*a-l,c=2*f-c,e.quadraticCurveTo(l+r,c+i,h+r,p+i),a=h,f=p,m.add(l,c),m.add(h,p);break;case"a":s(e,a+r,f+i,[o[1],o[2],o[3],o[4],o[5],o[6]+a+r,o[7]+f+i],m,r,i),a+=o[6],f+=o[7];break;case"A":s(e,a+r,f+i,[o[1],o[2],o[3],o[4],o[5],o[6]+r,o[7]+i],m,r,i),a=o[6],f=o[7];break;case"z":case"Z":e.closePath()}u=o}return m.translate(r,i)}function v(e,t){var n,r=null,i=0,s=0,u=0,a=0,f,l,c,h;for(var p=0,d=e.length;p<d;++p){n=e[p];switch(n[0]){case"l":i+=n[1],s+=n[2],t.add(i,s);break;case"L":i=n[1],s=n[2],t.add(i,s);break;case"h":i+=n[1],t.add(i,s);break;case"H":i=n[1],t.add(i,s);break;case"v":s+=n[1],t.add(i,s);break;case"V":s=n[1],t.add(i,s);break;case"m":i+=n[1],s+=n[2],t.add(i,s);break;case"M":i=n[1],s=n[2],t.add(i,s);break;case"c":f=i+n[5],l=s+n[6],u=i+n[3],a=s+n[4],t.add(i+n[1],s+n[2]),t.add(u,a),t.add(f,l),i=f,s=l;break;case"C":i=n[5],s=n[6],u=n[3],a=n[4],t.add(n[1],n[2]),t.add(u,a),t.add(i,s);break;case"s":f=i+n[3],l=s+n[4],u=2*i-u,a=2*s-a,t.add(u,a),t.add(i+n[1],s+n[2]),t.add(f,l),u=i+n[1],a=s+n[2],i=f,s=l;break;case"S":f=n[3],l=n[4],u=2*i-u,a=2*s-a,i=f,s=l,t.add(n[1],n[2]),t.add(u,a),t.add(f,l),u=n[1],a=n[2];break;case"q":f=i+n[3],l=s+n[4],u=i+n[1],a=s+n[2],i=f,s=l,t.add(u,a),t.add(f,l);break;case"Q":f=n[3],l=n[4],i=f,s=l,u=n[1],a=n[2],t.add(u,a),t.add(f,l);break;case"t":f=i+n[1],l=s+n[2],r[0].match(/[QqTt]/)===null?(u=i,a=s):r[0]==="t"?(u=2*i-c,a=2*s-h):r[0]==="q"&&(u=2*i-u,a=2*s-a),c=u,h=a,i=f,s=l,u=i+n[1],a=s+n[2],t.add(u,a),t.add(f,l);break;case"T":f=n[1],l=n[2],u=2*i-u,a=2*s-a,i=f,s=l,t.add(u,a),t.add(f,l);break;case"a":o(g,i,s,[n[1],n[2],n[3],n[4],n[5],n[6]+i,n[7]+s],t),i+=n[6],s+=n[7];break;case"A":o(g,i,s,[n[1],n[2],n[3],n[4],n[5],n[6],n[7]],t),i=n[6],s=n[7];break;case"z":case"Z":}r=n}return t}var e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},r=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],u={},a={},f=Array.prototype.join,c;return{parse:i,render:d,bounds:v}}(),n.canvas.marks=function(){function a(e,t){var n=t.x||0,r=t.y||0,i=t.innerRadius||0,s=t.outerRadius||0,o=(t.startAngle||0)-Math.PI/2,u=(t.endAngle||0)-Math.PI/2;e.beginPath(),i===0?e.moveTo(n,r):e.arc(n,r,i,o,u,0),e.arc(n,r,s,u,o,1),e.closePath()}function f(e,n){return r(e,t(n.path),n.x,n.y)}function l(e,t){e.beginPath();var n=t.size!=null?t.size:100,r=t.x,i=t.y,u,a,f,l;if(t.shape==null||t.shape==="circle"){u=Math.sqrt(n/Math.PI),e.arc(r,i,u,0,2*Math.PI,0),e.closePath();return}switch(t.shape){case"cross":u=Math.sqrt(n/5)/2,a=3*u,e.moveTo(r-a,i-u),e.lineTo(r-u,i-u),e.lineTo(r-u,i-a),e.lineTo(r+u,i-a),e.lineTo(r+u,i-u),e.lineTo(r+a,i-u),e.lineTo(r+a,i+u),e.lineTo(r+u,i+u),e.lineTo(r+u,i+a),e.lineTo(r-u,i+a),e.lineTo(r-u,i+u),e.lineTo(r-a,i+u);break;case"diamond":l=Math.sqrt(n/(2*o)),f=l*o,e.moveTo(r,i-l),e.lineTo(r+f,i),e.lineTo(r,i+l),e.lineTo(r-f,i);break;case"square":a=Math.sqrt(n),u=a/2,e.rect(r-u,i-u,a,a);break;case"triangle-down":f=Math.sqrt(n/s),l=f*s/2,e.moveTo(r,i+l),e.lineTo(r+f,i-l),e.lineTo(r-f,i-l);break;case"triangle-up":f=Math.sqrt(n/s),l=f*s/2,e.moveTo(r,i-l),e.lineTo(r+f,i+l),e.lineTo(r-f,i+l)}e.closePath()}function c(n,i){var s=e.svg.area().x(function(e){return e.x}).y1(function(e){return e.y}).y0(function(e){return e.y+e.height}),o=i[0];o.interpolate&&s.interpolate(o.interpolate),o.tension!=undefined&&s.tension(o.tension),r(n,t(s(i)))}function h(n,i){var s=e.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),o=i[0];o.interpolate&&s.interpolate(o.interpolate),o.tension!=undefined&&s.tension(o.tension),r(n,t(s(i)))}function p(e,t){var r=t[0],i=r.strokeWidth,s=r.strokeCap;e.lineWidth=i!=null?i:n.config.render.lineWidth,e.lineCap=s!=null?s:n.config.render.lineCap,h(e,t)}function d(e,t){var r=t.x||0,i=t.y||0,s=t.x2!=null?t.x2:r,o=t.y2!=null?t.y2:i,u=t.strokeWidth,a=t.strokeCap;e.lineWidth=u!=null?u:n.config.render.lineWidth,e.lineCap=a!=null?a:n.config.render.lineCap,e.beginPath(),e.moveTo(r,i),e.lineTo(s,o)}function v(e,t,r,i){var s=r.fill,o=r.stroke,u,a,f;e(t,i),u=r.opacity==null?1:r.opacity;if(u==0||!s&&!o)return;s&&(t.globalAlpha=u*(r.fillOpacity==null?1:r.fillOpacity),t.fillStyle=C(t,r,s),t.fill()),o&&(f=(f=r.strokeWidth)!=null?f:n.config.render.lineWidth,f>0&&(t.globalAlpha=u*(r.strokeOpacity==null?1:r.strokeOpacity),t.strokeStyle=C(t,r,o),t.lineWidth=f,t.lineCap=(a=r.strokeCap)!=null?a:n.config.render.lineCap,t.stroke()))}function m(e,t,n,r){var i,s,o;for(i=0,s=n.items.length;i<s;++i){o=n.items[i];if(r&&!r.intersects(o.bounds))continue;v(e,t,o,o)}}function g(e,t,r){if(!t.items.length)return;var i=t.items,s,o,u,a,f,l,c,h,p,d;for(var v=0,m=i.length;v<m;++v){s=i[v];if(r&&!r.intersects(s.bounds))continue;c=s.x||0,h=s.y||0,p=s.width||0,d=s.height||0,a=s.opacity==null?1:s.opacity;if(a==0)return;if(o=s.fill)e.globalAlpha=a*(s.fillOpacity==null?1:s.fillOpacity),e.fillStyle=C(e,s,o),e.fillRect(c,h,p,d);if(u=s.stroke)l=(l=s.strokeWidth)!=null?l:n.config.render.lineWidth,l>0&&(e.globalAlpha=a*(s.strokeOpacity==null?1:s.strokeOpacity),e.strokeStyle=C(e,s,u),e.lineWidth=l,e.lineCap=(f=s.strokeCap)!=null?f:n.config.render.lineCap,e.strokeRect(c,h,p,d))}}function b(e,t,r){if(!t.items.length)return;var i=t.items,s,o,u,a,f,l,c,h,p;for(var d=0,v=i.length;d<v;++d){s=i[d];if(r&&!r.intersects(s.bounds))continue;l=s.x||0,c=s.y||0,h=s.x2!=null?s.x2:l,p=s.y2!=null?s.y2:c,u=s.opacity==null?1:s.opacity;if(u==0)return;if(o=s.stroke)f=(f=s.strokeWidth)!=null?f:n.config.render.lineWidth,f>0&&(e.globalAlpha=u*(s.strokeOpacity==null?1:s.strokeOpacity),e.strokeStyle=C(e,s,o),e.lineWidth=f,e.lineCap=(a=s.strokeCap)!=null?a:n.config.render.lineCap,e.beginPath(),e.moveTo(l,c),e.lineTo(h,p),e.stroke())}}function w(e,t,n){if(!t.items.length)return;var r=this,i=t.items,s;for(var o=0,u=i.length;o<u;++o){s=i[o];if(n&&!n.intersects(s.bounds))continue;if(!s.image||s.image.url!==s.url)s.image=r.loadImage(s.url),s.image.url=s.url;var a,f,l,c,h;l=s.width||s.image&&s.image.width||0,c=s.height||s.image&&s.image.height||0,a=s.x-(s.align==="center"?l/2:s.align==="right"?l:0),f=s.y-(s.baseline==="middle"?c/2:s.baseline==="bottom"?c:0),s.image.loaded&&(e.globalAlpha=(h=s.opacity)!=null?h:1,e.drawImage(s.image,a,f,l,c))}}function E(e,t,r){if(!t.items.length)return;var i=t.items,s,o,u,a,f,l,c,h;for(var p=0,d=i.length;p<d;++p){s=i[p];if(r&&!r.intersects(s.bounds))continue;e.font=n.scene.fontString(s),e.textAlign=s.align||"left",e.textBaseline=s.baseline||"alphabetic",a=s.opacity==null?1:s.opacity;if(a==0)return;s.angle?(e.save(),e.translate(s.x,s.y),e.rotate(s.angle*Math.PI/180),x=s.dx||0,y=s.dy||0):(x=s.x+(s.dx||0),y=s.y+(s.dy||0));if(o=s.fill)e.globalAlpha=a*(s.fillOpacity==null?1:s.fillOpacity),e.fillStyle=C(e,s,o),e.fillText(s.text,x,y);if(u=s.stroke)f=(f=s.strokeWidth)!=null?f:1,f>0&&(e.globalAlpha=a*(s.strokeOpacity==null?1:s.strokeOpacity),e.strokeStyle=C(s,u),e.lineWidth=f,e.strokeText(s.text,x,y));s.angle&&e.restore()}}function S(e){return function(t,n,r){m(e,t,n,r)}}function T(e){return function(t,n,r){if(!n.items.length)return;if(r&&!r.intersects(n.items[0].bounds))return;v(e,t,n.items[0],n.items)}}function N(e,t,n){if(!t.items.length)return;var r=t.items,i,s,o,u=this,a,f,l,c,h,p,d;g(e,t,n);for(c=0,h=r.length;c<h;++c){i=r[c],s=i.axisItems||[],o=i.legendItems||[],a=i.x||0,f=i.y||0,e.save(),e.translate(a,f),n&&n.translate(-a,-f);for(p=0,d=s.length;p<d;++p)s[p].def.layer==="back"&&u.draw(e,s[p],n);for(p=0,d=i.items.length;p<d;++p)u.draw(e,i.items[p],n);for(p=0,d=s.length;p<d;++p)s[p].def.layer!=="back"&&u.draw(e,s[p],n);for(p=0,d=o.length;p<d;++p)u.draw(e,o[p],n);n&&n.translate(a,f),e.restore()}}function C(e,t,n){return n.id?k(e,n,t.bounds):n}function k(e,t,n){var r=n.width(),i=n.height(),s=n.x1+t.x1*r,o=n.y1+t.y1*i,u=n.x1+t.x2*r,a=n.y1+t.y2*i,f=e.createLinearGradient(s,o,u,a),l=t.stops,c,h;for(c=0,h=l.length;c<h;++c)f.addColorStop(l[c].offset,l[c].color);return f}function L(e,t,n,r,i,s){if(t.items.length===0||t.bounds&&!t.bounds.contains(i,s))return!1;var o=t.items,u,a,f,l,c,h=this;for(var p=0,d=o.length;p<d;++p){a=o[p],l=a.x||0,c=a.y||0,e.save(),e.translate(l,c);for(var v=0,m=a.items.length;v<m;++v){u=a.items[v];if(u.interactive===!1)continue;f=h.pick(u,n,r,i-l,s-c);if(f)return e.restore(),f}e.restore()}return t.interactive?A(P.rect,e,t,n,r,i,s):!1}function A(e,t,n,r,i,s,o){if(!n.items.length)return!1;var u,a,f;t._ratio!==1&&(r*=t._ratio,i*=t._ratio);for(f=n.items.length;--f>=0;){u=n.items[f],a=u.bounds;if(a&&!a.contains(s,o)||!a)continue;if(e(t,u,r,i,s,o))return u}return!1}function O(e,t,n,r,i,s){if(!t.items.length)return!1;var o=t.items,u,a,f,l,c,h,p,d;return a=o[0].bounds,a&&!a.contains(i,s)?!1:(e._ratio!==1&&(n*=e._ratio,r*=e._ratio),P.area(e,o,n,r)?o[0]:!1)}function M(e,t,n,r,i,s){if(!t.items.length)return!1;var o=t.items,u,a,f,l,c,h,p,d;return a=o[0].bounds,a&&!a.contains(i,s)?!1:(e._ratio!==1&&(n*=e._ratio,r*=e._ratio),P.line(e,o,n,r)?o[0]:!1)}function _(e){return function(t,n,r,i,s,o){return A(e,t,n,r,i,s,o)}}function D(e,t,r,i,s,o){if(!t.fontSize)return!1;if(!t.angle)return!0;var a=n.scene.bounds.text(t,u,!0),f=-t.angle*Math.PI/180,l=Math.cos(f),c=Math.sin(f),r=t.x,i=t.y,h=l*s-c*o+(r-r*l+i*c),p=c*s+l*o+(i-r*c-i*l);return a.contains(h,p)}var t=n.canvas.path.parse,r=n.canvas.path.render,i=Math.PI/2,s=Math.sqrt(3),o=Math.tan(30*Math.PI/180),u=new n.Bounds,P={text:D,rect:function(e,t,n,r){return!0},image:function(e,t,n,r){return!0},rule:function(e,t,n,r){return e.isPointInStroke?(d(e,t),e.isPointInStroke(n,r)):!1},line:function(e,t,n,r){return e.isPointInStroke?(p(e,t),e.isPointInStroke(n,r)):!1},arc:function(e,t,n,r){return a(e,t),e.isPointInPath(n,r)},area:function(e,t,n,r){return c(e,t),e.isPointInPath(n,r)},path:function(e,t,n,r){return f(e,t),e.isPointInPath(n,r)},symbol:function(e,t,n,r){return l(e,t),e.isPointInPath(n,r)}};return{draw:{group:N,area:T(c),line:T(h),arc:S(a),path:S(f),symbol:S(l),rect:g,rule:b,text:E,image:w,drawOne:T,drawAll:S},pick:{group:L,area:O,line:M,arc:_(P.arc),path:_(P.path),symbol:_(P.symbol),rect:_(P.rect),rule:_(P.rule),text:_(P.text),image:_(P.image),pickAll:A}}}(),n.canvas.Renderer=function(){function i(e,t){var n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;if(n!==r){var s=e.width,o=e.height;e.setAttribute("width",s*i),e.setAttribute("height",o*i),e.style.width=s+"px",e.style.height=o+"px"}return i}function s(e,t){var r=new n.Bounds(t);while((e=e.mark.group)!=null)r.translate(e.x||0,e.y||0);return r}function o(e){return e?n.array(e).reduce(function(e,t){return e.union(s(t,t.bounds)).union(s(t,t.bounds_prev))},new n.Bounds):null}function u(e,t){var r=null;return t&&(r=(new n.Bounds(t)).round(),e.beginPath(),e.rect(r.x1,r.y1,r.width(),r.height()),e.clip()),r}var t=function(){this._ctx=null,this._el=null,this._imgload=0},r=t.prototype;return r.initialize=function(t,n,r,i){this._el=t,this._padding=i;if(!t)return this;var s=e.select(t).selectAll("canvas.marks").data([1]);return s.enter().append("canvas").attr("class","marks"),this.resize(n,r,i)},r.resize=function(t,n,r){this._width=t,this._height=n,this._padding=r;var s=e.select(this._el).select("canvas.marks");s.attr("width",t+r.left+r.right).attr("height",n+r.top+r.bottom);var o;return this._ctx=s.node().getContext("2d"),this._ctx._ratio=o=i(s.node(),this._ctx)||1,this._ctx.setTransform(o,0,0,o,o*r.left,o*r.top),this},r.context=function(e){return e?(this._ctx=e,this):this._ctx},r.element=function(){return this._el},r.pendingImages=function(){return this._imgload},r.render=function(e,t){var n=this._ctx,r=this._padding,i=this._width+r.left+r.right,s=this._height+r.top+r.bottom,a=null,f;this._scene=e,n.save(),a=u(n,o(t)),n.clearRect(-r.left,-r.top,i,s),this.draw(n,e,a),t&&(n.restore(),n.save(),f=u(n,o(t)),a.encloses(f)||(n.clearRect(-r.left,-r.top,i,s),this.draw(n,e,f))),n.restore(),this._scene=null},r.draw=function(e,t,r){var i=t.marktype,s=n.canvas.marks.draw[i];s.call(this,e,t,r),t.bounds=t.items.reduce(function(e,t){return t.bounds?e.union(t.bounds):e},t.bounds||new n.Bounds)},r.renderAsync=function(e){var t=this;t._async_id&&clearTimeout(t._async_id),t._async_id=setTimeout(function(){t.render(e),delete t._async_id},50)},r.loadImage=function(e){var t=this,r=t._scene,i=null;return t._imgload+=1,n.config.isNode?(i=new(require("canvas").Image),n.data.load(e,function(e,r){if(e){n.error(e);return}i.src=r,i.loaded=!0,t._imgload-=1})):(i=new Image,i.onload=function(){n.log("LOAD IMAGE: "+e),i.loaded=!0,t._imgload-=1,t.renderAsync(r)},i.src=e),i},t}(),n.canvas.Handler=function(){function s(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)}var t=function(e,t){this._active=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},r=t.prototype;r.initialize=function(t,n,s){this._el=e.select(t).node(),this._canvas=e.select(t).select("canvas.marks").node(),this._padding=n,this._obj=s||null;var o=this._canvas,u=this;return i.forEach(function(e){o.addEventListener(e,function(t){r[e].call(u,t)})}),this},r.padding=function(e){return this._padding=e,this},r.model=function(e){return arguments.length?(this._model=e,this):this._model},r.handlers=function(){var e=this._handlers;return n.keys(e).reduce(function(t,n){return e[n].reduce(function(e,t){return e.push(t),e},t)},[])};var i=["mousedown","mouseup","click","dblclick","wheel","keydown","keypress","keyup","mousewheel"];return i.forEach(function(e){r[e]=function(t){this.fire(e,t)}}),i.push("mousemove"),i.push("mouseout"),r.mousemove=function(e){var t=this._padding,n=e.target.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,s=this._active,o=this.pick(this._model.scene(),r,i,r-t.left,i-t.top);if(o===s){this.fire("mousemove",e);return}s&&this.fire("mouseout",e),this._active=o,o&&this.fire("mouseover",e)},r.mouseout=function(e){this._active&&this.fire("mouseout",e),this._active=null},r.DOMMouseScroll=function(e){this.fire("mousewheel",e)},r.fire=function(e,t){var n=this._active,r=this._handlers[e];if(n&&r)for(var i=0,s=r.length;i<s;++i)r[i].handler.call(this._obj,t,n)},r.on=function(e,t){var n=s(e),r=this._handlers;return r=r[n]||(r[n]=[]),r.push({type:e,handler:t}),this},r.off=function(e,t){var n=s(e),r=this._handlers[n];if(!r)return;for(var i=r.length;--i>=0;){if(r[i].type!==e)continue;(!t||r[i].handler===t)&&r.splice(i,1)}return this},r.context=function(){return this._canvas.getContext("2d")},r.pick=function(e,t,r,i,s){var o=this.context(),u=e.marktype,a=n.canvas.marks.pick[u];return a.call(this,o,e,t,r,i,s)},t}(),n.svg={},n.svg.marks=function(){function t(e){return e.x||0}function r(e){return e.y||0}function i(e){return e.y+e.height||0}function s(e){return e.key}function o(e){return e.size==null?100:e.size}function u(e){return e.shape||"circle"}function m(e){var t,r,i,s,o,u=e.mark?e:e.length?e[0]:null;if(u===null)return;for(t=0,r=v.length;t<r;++t)i=v[t],s=d[i],o=u[i],o==null?s==="fill"?this.style.setProperty(s,"none",null):this.style.removeProperty(s):(o.id&&(n.svg._cur._defs[o.id]=o,o="url(#"+o.id+")"),this.style.setProperty(s,o,null))}function g(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",a(e))}function y(e){if(!e.length)return;var t=e[0];f.interpolate(t.interpolate||"linear").tension(t.tension==null?.7:t.tension),this.setAttribute("d",f(e))}function b(e){if(!e.length)return;var t=e[0];l.interpolate(t.interpolate||"linear").tension(t.tension==null?.7:t.tension),this.setAttribute("d",l(e))}function w(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",e.path)}function E(e){this.setAttribute("x",e.x||0),this.setAttribute("y",e.y||0),this.setAttribute("width",e.width||0),this.setAttribute("height",e.height||0)}function S(e){var t=e.x||0,n=e.y||0;this.setAttribute("x1",t),this.setAttribute("y1",n),this.setAttribute("x2",e.x2!=null?e.x2:t),this.setAttribute("y2",e.y2!=null?e.y2:n)}function x(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",c(e))}function T(e){var t=e.width||e.image&&e.image.width||0,n=e.height||e.image&&e.image.height||0,r=e.x-(e.align==="center"?t/2:e.align==="right"?t:0),i=e.y-(e.baseline==="middle"?n/2:e.baseline==="bottom"?n:0);this.setAttributeNS("http://www.w3.org/1999/xlink","href",e.url),this.setAttribute("x",r),this.setAttribute("y",i),this.setAttribute("width",t),this.setAttribute("height",n)}function N(e){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(e.fontSize!=null?e.fontSize:n.config.render.fontSize)+"px "+(e.font||n.config.render.font)}function C(e){var t=e.x||0,n=e.y||0,r=e.dx||0,i=e.dy||0,s=e.angle||0,o=p[e.align||"left"],u=e.baseline==="top"?".9em":e.baseline==="middle"?".35em":0;this.setAttribute
("x",t+r),this.setAttribute("y",n+i),this.setAttribute("dy",i),this.setAttribute("text-anchor",o),s?this.setAttribute("transform","rotate("+s+" "+t+","+n+")"):this.removeAttribute("transform"),u?this.setAttribute("dy",u):this.removeAttribute("dy"),this.textContent=e.text,this.style.setProperty("font",N(e),null)}function k(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")")}function L(e){var t=e.width||0,n=e.height||0;this.setAttribute("width",t),this.setAttribute("height",n)}function A(e,t,n){return function(r,i,s){O(r,i,s,"mark_",e,t,n)}}function O(t,n,r,i,s,o,u){var a=u?[n.items]:n.items,f=n.interactive===!1?"none":null,l=t.node().childNodes,c=s!=="g",p=(p=l[r+1])?e.select(p):t.append("g").attr("id","g"+ ++h),d="#"+p.attr("id"),v=d+" > "+s,g=p.selectAll(v).data(a),y=g.enter().append(s);return c?(p.style("pointer-events",f),y.each(function(e){e.mark?e._svg=this:e.length&&(e[0]._svg=this)})):y.append("rect").attr("class","background").style("pointer-events",f),g.exit().remove(),g.each(o),c?g.each(m):p.selectAll(v+" > rect.background").each(L).each(m),p}function M(t,n,r,i){var s=O(t,n,r,i||"group_","g",k),o=s.node().childNodes,u=o.length,a,f,l;for(a=0;a<u;++a){var c=o[a].__data__.items,h=o[a].__data__.legendItems||[],p=o[a].__data__.axisItems||[],d=e.select(o[a]),v=0;for(f=0,l=p.length;f<l;++f)p[f].def.layer==="back"&&M.call(this,d,p[f],v++,"axis_");for(f=0,l=c.length;f<l;++f)this.draw(d,c[f],v++);for(f=0,l=p.length;f<l;++f)p[f].def.layer!=="back"&&M.call(this,d,p[f],v++,"axis_");for(f=0,l=h.length;f<l;++f)M.call(this,d,h[f],v++,"legend_")}}var a=e.svg.arc(),f=e.svg.area().x(t).y1(r).y0(i),l=e.svg.line().x(t).y(r),c=e.svg.symbol().type(u).size(o),h=0,p={left:"start",center:"middle",right:"end"},d={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",opacity:"opacity"},v=n.keys(d);return{update:{group:E,area:y,line:b,arc:g,path:w,symbol:x,rect:E,rule:S,text:C,image:T},nested:{area:!0,line:!0},style:m,draw:{group:M,area:A("path",y,!0),line:A("path",b,!0),arc:A("path",g),path:A("path",w),symbol:A("path",x),rect:A("rect",E),rule:A("line",S),text:A("text",C),image:A("image",T),draw:A}}}(),n.svg.Renderer=function(){var t=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={}},r=t.prototype;return r.initialize=function(t,n,r,i){return this._el=t,e.select(t).select("svg.marks").remove(),this._svg=e.select(t).append("svg").attr("class","marks"),this._ctx=this._svg.append("g"),this.resize(n,r,i)},r.resize=function(e,t,n){return this._width=e,this._height=t,this._padding=n,this._svg.attr("width",e+n.left+n.right).attr("height",t+n.top+n.bottom),this._ctx.attr("transform","translate("+n.left+","+n.top+")"),this},r.context=function(){return this._ctx},r.element=function(){return this._el},r.updateDefs=function(){var t=this._svg,r=this._defs,i=n.keys(r),s=t.select("defs"),o;if(i.length===0){s.remove();return}s.empty()&&(s=t.insert("defs",":first-child")),o=s.selectAll("linearGradient").data(i,n.identity),o.enter().append("linearGradient").attr("id",n.identity),o.exit().remove(),o.each(function(t){var n=r[t],i=e.select(this);i.attr({x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),stop=i.selectAll("stop").data(n.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color})})},r.render=function(e,t){n.svg._cur=this,t?this.renderItems(n.array(t)):this.draw(this._ctx,e,-1),this.updateDefs(),delete n.svg._cur},r.renderItems=function(e){var t,r,i,s,o,u,a=n.svg.marks;for(o=0,u=e.length;o<u;++o)t=e[o],r=t._svg,i=t.mark.marktype,t=a.nested[i]?t.mark.items:t,a.update[i].call(r,t),a.style.call(r,t)},r.draw=function(e,t,r){var i=t.marktype,s=n.svg.marks.draw[i];s.call(this,e,t,r)},t}(),n.svg.Handler=function(){function r(e){var t=this;return function(n){var r=n.target,i=r.__data__;i&&(i=i.mark?i:i[0],e.call(t._obj,n,i))}}function i(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)}var t=function(e,t){this._active=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},s=t.prototype;return s.initialize=function(t,n,r){return this._el=e.select(t).node(),this._svg=e.select(t).select("svg.marks").node(),this._padding=n,this._obj=r||null,this},s.padding=function(e){return this._padding=e,this},s.model=function(e){return arguments.length?(this._model=e,this):this._model},s.handlers=function(){var e=this._handlers;return n.keys(e).reduce(function(t,n){return e[n].reduce(function(e,t){return e.push(t),e},t)},[])},s.on=function(t,n){var s=i(t),o=this._handlers,u=e.select(this._svg).node(),a={type:t,handler:n,svg:r.call(this,n)};return o=o[s]||(o[s]=[]),o.push(a),u.addEventListener(s,a.svg),this},s.off=function(t,n){var r=i(t),s=this._handlers[r],o=e.select(this._svg).node();if(!s)return;for(var u=s.length;--u>=0;){if(s[u].type!==t)continue;if(!n||s[u].handler===n)o.removeEventListener(r,s[u].svg),s.splice(u,1)}return this},t}(),n.data={},n.data.ingest=function(e,t){return{data:e,index:t}},n.data.mapper=function(e){return function(t){return t.forEach(e),t}},n.data.size=function(e,t){return e=n.isArray(e)?e:[0,e],e=e.map(function(e){return typeof e=="string"?t[e]:e}),e},n.data.load=function(e,t){if(n.config.isNode){var r=p(e)?e:n.config.baseURL+e,i=d(r)?m:b;i(r,t)}else v(e,t)};var c=/^[A-Za-z]+\:\/\//,h="file://";n.data.read=function(){function i(e,n){var r=n&&n.type||"json";return e=t[r](e,n),n&&n.parse&&s(e,n.parse),e}function s(e,t){var i=n.keys(t),s=i.map(function(e){return r[t[e]]}),o,u,a,f,l;for(u=0,f=e.length;u<f;++u){o=e[u];for(a=0,l=i.length;a<l;++a)o[i[a]]=s[a](o[i[a]])}}var t={},r={number:n.number,"boolean":n.boolean,date:Date.parse};return t.json=function(e,t){var r=JSON.parse(e);return t&&t.property&&(r=n.accessor(t.property)(r)),r},t.csv=function(t,n){var r=e.csv.parse(t);return r},t.tsv=function(t,n){var r=e.tsv.parse(t);return r},i.formats=t,i.parse=s,i}(),n.data.array=function(){function t(t){return t.map(function(t){var n=[];for(var r=0,i=e.length;r<i;++r)n.push(e[r](t));return n})}var e=[];return t.fields=function(r){return e=n.array(r).map(n.accessor),t},t},n.data.copy=function(){var e=n.accessor("data"),t=[],r=null,i=n.data.mapper(function(n){var i=e(n),s,o,u=t,a=r||t;for(s=0,o=t.length;s<o;++s)n[a[s]]=i[t[s]];return n});return i.from=function(t){return e=n.accessor(t),i},i.fields=function(e){return t=n.array(e),i},i.as=function(e){return r=n.array(e),i},i},n.data.facet=function(){function r(n){var r={key:"",keys:[],values:[]},i={},s=r.values,o,u,a,f,l,c,h,p,d;if(e.length===0)return s.push(o={key:"",keys:[],index:0,values:t?n.slice():n}),t&&o.values.sort(t),r;for(l=0,f=n.length;l<f;++l){for(h=0,u=[],a="";h<e.length;++h)p=e[h](n[l]),u.push(p),a+=(h>0?"|":"")+String(p);o=i[a],o===undefined&&s.push(o=i[a]={key:a,keys:u,index:s.length,values:[]}),o.values.push(n[l])}if(t)for(l=0,f=s.length;l<f;++l)s[l].values.sort(t);return r}var e=[],t=null;return r.keys=function(t){return e=n.array(t).map(n.accessor),r},r.sort=function(e){return t=n.comparator(e),r},r},n.data.filter=function(){function t(t){return e?t.filter(e):t}var e=null;return t.test=function(r){return e=n.isFunction(r)?r:n.parse.expr(r),t},t},n.data.flatten=function(){function e(e){return t(e,[])}function t(e,n){if(e.values)for(var r=0,i=e.values.length;r<i;++r)t(e.values[r],n);else n.push(e);return n}return e},n.data.fold=function(){function i(n){var i=[],s,o,u,a,f=e.length;for(o=0,a=n.length;o<a;++o){s=n[o];for(u=0;u<f;++u){var l={index:i.length,data:s.data};l[r.key]=e[u],l[r.value]=t[u](s),i.push(l)}}return i}var e=[],t=[],r={key:"key",value:"value"};return i.fields=function(r){return e=n.array(r),t=e.map(n.accessor),i},i.output=function(e){return n.keys(r).forEach(function(t){e[t]!==undefined&&(r[t]=e[t])}),i},i},n.data.force=function(){function l(e,i,s){t.size(n.data.size(a,s)).nodes(e),r&&i[r]&&t.links(i[r]),t.start();for(var o=0;o<u;++o)t.tick();return t.stop(),e}var t=e.layout.force(),r=null,i=20,s=1,o=-30,u=500,a=["width","height"],f=["friction","theta","gravity","alpha"];return l.links=function(e){return r=e,l},l.size=function(e){return a=e,l},l.linkDistance=function(e){return i=typeof e=="number"?e:n.accessor(e),t.linkDistance(i),l},l.linkStrength=function(e){return s=typeof e=="number"?e:n.accessor(e),t.linkStrength(s),l},l.charge=function(e){return o=typeof e=="number"?e:n.accessor(e),t.charge(o),l},l.iterations=function(e){return u=e,l},f.forEach(function(e){l[e]=function(n){return t[e](n),l}}),l},n.data.formula=function(){return function(){var e=null,t=n.identity,r=n.data.mapper(function(n){return e&&(n[e]=t.call(null,n)),n});return r.field=function(t){return e=t,r},r.expr=function(e){return t=n.isFunction(e)?e:n.parse.expr(e),r},r}}(),n.data.geo=function(){function r(){var r={},i="mercator",s=e.geo[i](),o=n.identity,u=n.identity,a={x:"x",y:"y"},f=n.data.mapper(function(e){var t=[u(e),o(e)],n=s(t);return e[a.x]=n[0],e[a.y]=n[1],e});return f.func=function(){return s},f.projection=function(t){if(i!==t){i=t,s=e.geo[i]();for(var n in r)s[n](r[n])}return f},t.forEach(function(e){f[e]=function(t){return r[e]=t,s[e](t),f}}),f.lon=function(e){return u=n.accessor(e),f},f.lat=function(e){return o=n.accessor(e),f},f.output=function(e){return n.keys(a).forEach(function(t){e[t]!==undefined&&(a[t]=e[t])}),e},f}var t=["center","scale","translate","rotate","precision","clipAngle"];return r.params=t,r}(),n.data.geopath=function(){var t=e.geo.path().projection(e.geo.mercator()),r="mercator",i=n.identity,s={},o={path:"path"},u=n.data.mapper(function(e){return e[o.path]=t(i(e)),e});return u.projection=function(n){if(r!==n){r=n;var i=e.geo[r]();for(var o in s)i[o](s[o]);t.projection(i)}return u},n.data.geo.params.forEach(function(e){u[e]=function(n){return s[e]=n,t.projection()[e](n),u}}),u.value=function(e){return i=n.accessor(e),u},u.output=function(e){return n.keys(o).forEach(function(t){e[t]!==undefined&&(o[t]=e[t])}),e},u},n.data.link=function(){function o(e){var n=t(e),i=r(e);return"M"+n.x+","+n.y+"L"+i.x+","+i.y}function u(e){var n=t(e),s=r(e),o=s.x-n.x,u=s.y-n.y,a=i*(o+u),f=i*(u-o);return"M"+n.x+","+n.y+"C"+(n.x+a)+","+(n.y+f)+" "+(s.x+f)+","+(s.y-a)+" "+s.x+","+s.y}function a(e){var n=t(e),i=r(e),s=(n.x+i.x)/2;return"M"+n.x+","+n.y+"C"+s+","+n.y+" "+s+","+i.y+" "+i.x+","+i.y}function f(e){var n=t(e),i=r(e),s=(n.y+i.y)/2;return"M"+n.x+","+n.y+"C"+n.x+","+s+" "+i.x+","+s+" "+i.x+","+i.y}function c(t){var n=l[e];return t.forEach(function(e){e[s.path]=n(e)}),t}var e="line",t=n.accessor("source"),r=n.accessor("target"),i=.2,s={path:"path"},l={line:o,curve:u,diagonal:a,diagonalX:a,diagonalY:f};return c.shape=function(t){return e=t,c},c.tension=function(e){return i=e,c},c.source=function(e){return t=n.accessor(e),c},c.target=function(e){return r=n.accessor(e),c},c.output=function(e){return n.keys(s).forEach(function(t){e[t]!==undefined&&(s[t]=e[t])}),c},c},n.data.pie=function(){function a(t){var n=t.map(function(e,t){return+r(e)}),a=i,f=(s-i)/e.sum(n),l=e.range(t.length);return o&&l.sort(function(e,t){return n[e]-n[t]}),l.forEach(function(e){var r;t[e].value=r=n[e],t[e][u.startAngle]=a,t[e][u.endAngle]=a+=r*f}),t}var t=function(){return 1},r=t,i=0,s=2*Math.PI,o=!1,u={startAngle:"startAngle",endAngle:"endAngle"};return a.sort=function(e){return o=e,a},a.value=function(e){return r=e?n.accessor(e):t,a},a.startAngle=function(e){return i=Math.PI*e/180,a},a.endAngle=function(e){return s=Math.PI*e/180,a},a.output=function(e){return n.keys(u).forEach(function(t){e[t]!==undefined&&(u[t]=e[t])}),a},a},n.data.slice=function(){function r(r){r=n.values(r);if(e==="min")r=[r[n.minIndex(r,t)]];else if(e==="max")r=[r[n.maxIndex(r,t)]];else if(e==="median"){var i=r.slice().sort(function(e,n){return e=t(e),n=t(n),e<n?-1:e>n?1:0});r=[r[~~(i.length/2)]]}else{var s=n.array(e);r=r.slice(s[0],s[1])}return r}var e=null,t=n.accessor("data");return r.by=function(t){return e=t,r},r.field=function(e){return t=n.accessor(e),r},r},n.data.sort=function(){function t(t){t=n.isArray(t)?t:t.values||[],t.sort(e);for(var r=0,i=t.length;r<i;++r)t[r].index=r;return t}var e=null;return t.by=function(r){return e=n.comparator(r),t},t},n.data.stack=function(){function u(e){var n=o.y0,r=o.y1,i=o.cy;return t.out(function(e,t,s){e.datum&&(e.datum[n]=t,e.datum[r]=s+t,e.datum[i]=t+s/2)})(a(e)),e}function a(e){var t=n.values(e),s=[],o=[],u,a,f,l,c,h,p,d,v;for(a=0,f=t.length;a<f;++a){u=n.values(t[a]);for(l=0,c=u.length;l<c;++l)s.push({x:r(u[l]),y:i(u[l]),z:a,datum:u[l]});o.push([])}s.sort(function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.z<t.z?-1:e.z>t.z?1:0});for(v=s[0].x,a=0,l=0,h=0,f=s.length;h<f;++h){p=s[h];if(p.x!==v){while(a<o.length)o[a++].push({x:l,y:0});v=p.x,a=0,l+=1}while(p.z>a)o[a++].push({x:l,y:0});p.x=l,o[a++].push(p)}while(a<o.length)o[a++].push({x:l,y:0});return o}var t=e.layout.stack(),r=n.accessor("index"),i=n.accessor("data"),s=["offset","order"],o={y0:"y2",y1:"y",cy:"cy"};return u.point=function(e){return r=n.accessor(e),u},u.height=function(e){return i=n.accessor(e),u},s.forEach(function(e){u[e]=function(n){return t[e](n),u}}),u.output=function(t){return e.keys(o).forEach(function(e){t[e]!==undefined&&(o[e]=t[e])}),u},u},n.data.stats=function(){function i(i){var s=+Infinity,o=-Infinity,u=0,a=0,f=0,l,c,h,p,d=(n.isArray(i)?i:i.values||[]).map(e);for(l=0,c=d.length;l<c;++l)h=d[l],h<s&&(s=h),h>o&&(o=h),u+=h,p=h-a,a+=p/(l+1),f+=p*(h-a);f/=c-1;var v=n.isArray(i)?{}:i;return t&&(d.sort(n.numcmp),l=d.length>>1,v[r.median]=d.length%2?d[l]:(d[l-1]+d[l])/2),v[r.count]=c,v[r.min]=s,v[r.max]=o,v[r.sum]=u,v[r.mean]=a,v[r.variance]=f,v[r.stdev]=Math.sqrt(f),v}function s(e){return(n.isArray(e)?[e]:e.values||[]).map(i)}var e=n.accessor("data"),t=!1,r={count:"count",min:"min",max:"max",sum:"sum",mean:"mean",variance:"variance",stdev:"stdev",median:"median"};return s.median=function(e){return t=e||!1,s},s.value=function(t){return e=n.accessor(t),s},s.output=function(e){return n.keys(r).forEach(function(t){e[t]!==undefined&&(r[t]=e[t])}),s},s},n.data.treemap=function(){function u(e,s,u){e=t.size(n.data.size(i,u)).value(r).nodes(e);var a=n.keys(o),f=a.length;return e.forEach(function(e){var t,n;for(var r=0;r<f;++r)t=a[r],t!==o[t]&&(n=e[t],delete e[t],e[o[t]]=n)}),e}var t=e.layout.treemap().children(function(e){return e.values}),r=n.accessor("data"),i=["width","height"],s=["round","sticky","ratio","padding"],o={x:"x",y:"y",dx:"width",dy:"height"};return u.size=function(e){return i=e,u},u.value=function(e){return r=n.accessor(e),u},s.forEach(function(e){u[e]=function(n){return t[e](n),u}}),u.output=function(e){return n.keys(o).forEach(function(t){e[t]!==undefined&&(o[t]=e[t])}),u},u},n.data.truncate=function(){var e=n.accessor("data"),t="truncate",r="right",i="...",s=!0,o=100,u=n.data.mapper(function(u){var a=n.truncate(e(u),o,r,s,i);return u[t]=a,u});return u.value=function(t){return e=n.accessor(t),u},u.as=function(e){return t=e,u},u.limit=function(e){return o=+e,u},u.position=function(e){return r=e,u},u.ellipsis=function(e){return i=e+"",u},u.wordBreak=function(e){return s=!!e,u},u},n.data.unique=function(){function r(r){return n.unique(r,e).map(function(e){var n={};return n[t]=e,n})}var e=null,t="field";return r.field=function(t){return e=n.accessor(t),r},r.as=function(e){return t=e,r},r},n.data.wordcloud=function(){function f(e,u,f){function l(r,i){var o=t.size(),u=o[0]/2,f=o[1]/2,l=n.keys(a),c,h,p,d,v,m=l.length;e.sort(function(e,t){return s(t)-s(e)});for(p=0,d=r.length;p<d;++p){h=e[p];for(v=0;v<m;++v)c=l[v],h[a[c]]=r[p][c],c==="x"&&(h[a.x]+=u),c==="y"&&(h[a.y]+=f)}}return t.size(n.data.size(i,f)).text(r).fontSize(s).rotate(o).words(e).on("end",l).start(),e}var t=e.layout.cloud().size([900,500]),r=n.accessor("data"),i=["width","height"],s=function(){return 14},o=function(){return 0},u=["font","fontStyle","fontWeight","padding"],a={x:"x",y:"y",size:"fontSize",font:"font",rotate:"angle"};return f.text=function(e){return r=n.accessor(e),f},f.size=function(e){return i=e,f},f.fontSize=function(e){return s=n.accessor(e),f},f.rotate=function(e){var t;return n.isObject(e)&&!Array.isArray(e)?e.random!==undefined?(t=(t=e.random)?n.array(t):[0],o=function(){return t[~~(Math.random()*t.length-1e-5)]}):e.alternate!==undefined&&(t=(t=e.alternate)?n.array(t):[0],o=function(e,n){return t[n%t.length]}):o=n.accessor(field),f},u.forEach(function(e){f[e]=function(n){return t[e](n),f}}),f.output=function(e){return n.keys(a).forEach(function(t){e[t]!==undefined&&(a[t]=e[t])}),f},f},n.data.zip=function(){function o(n,o){var u=o[e],a=u.length,f,l,c,h,p;s&&(p={},u.forEach(function(e){p[s(e)]=e}));for(c=0,h=n.length;c<h;++c)l=n[c],l[t]=p?(f=p[r(l)])!=null?f:i:u[c%a];return n}var e=null,t="zip",r=n.accessor("data"),i=undefined,s=null;return o["with"]=function(t){return e=t,o},o["default"]=function(e){return i=e,o},o.as=function(e){return t=e,o},o.key=function(e){return r=n.accessor(e),o},o.withKey=function(e){return s=n.accessor(e),o},o},n.parse={},n.parse.axes=function(){function r(e,t,r){(e||[]).forEach(function(e,s){t[s]=t[s]||n.scene.axis(),i(e,s,t[s],r)})}function i(r,i,s,o){r.scale!==undefined&&s.scale(o[r.scale]),s.orient(r.orient||t[r.type]),s.offset(r.offset||0),s.layer(r.layer||"front"),s.grid(r.grid||!1),s.title(r.title||null),s.titleOffset(r.titleOffset!=null?r.titleOffset:n.config.axis.titleOffset),s.tickValues(r.values||null),s.tickFormat(r.format?e.format(r.format):null),s.tickSubdivide(r.subdivide||0),s.tickPadding(r.tickPadding||n.config.axis.padding);var u=[];if(r.tickSize!==undefined)for(var a=0;a<3;++a)u.push(r.tickSize);else{var f=n.config.axis.tickSize;u=[f,f,f]}r.tickSizeMajor!=null&&(u[0]=r.tickSizeMajor),r.tickSizeMinor!=null&&(u[1]=r.tickSizeMinor),r.tickSizeEnd!=null&&(u[2]=r.tickSizeEnd),u.length&&s.tickSize.apply(s,u);if(r.ticks!=null){var l=n.isArray(r.ticks)?r.ticks:[r.ticks];s.ticks.apply(s,l)}else s.ticks(n.config.axis.ticks);var c=r.properties;c&&c.ticks?(s.majorTickProperties(c.majorTicks?n.extend({},c.ticks,c.majorTicks):c.ticks),s.minorTickProperties(c.minorTicks?n.extend({},c.ticks,c.minorTicks):c.ticks)):(s.majorTickProperties(c&&c.majorTicks||{}),s.minorTickProperties(c&&c.minorTicks||{})),s.tickLabelProperties(c&&c.labels||{}),s.titleProperties(c&&c.title||{}),s.gridLineProperties(c&&c.grid||{}),s.domainProperties(c&&c.axis||{})}var t={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};return r}(),n.parse.data=function(e,t){function s(e){return function(s,o){s?n.error("LOADING FAILED: "+e.url):r.load[e.name]=n.data.read(o.toString(),e.format),--i===0&&t()}}var r={defs:e,load:{},flow:{},source:{}},i=0;return(e||[]).forEach(function(e){e.url&&(i+=1,n.data.load(e.url,s(e))),e.values&&(e.format&&e.format.parse&&n.data.read.parse(e.values,e.format.parse),r.load[e.name]=e.values);if(e.source){var t=r.source[e.source]||(r.source[e.source]=[]);t.push(e.name)}e.transform&&(r.flow[e.name]=n.parse.dataflow(e))}),i===0&&setTimeout(t,1),r},n.parse.dataflow=function(e){var t=(e.transform||[]).map(n.parse.transform);return t.length?function(e,n,r){return t.reduce(function(e,t){return t(e,n,r)},e)}:n.identity},n.parse.expr=function(){var e={E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},t={abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan"},n=/([\"\']|[\=\<\>\~\&\|\?\:\+\-\/\*\%\!\^\,\;\[\]\{\}\(\) ]+)/;return function(r){var i=r.split(n),s,o,u,a,f,l;for(f=0,l=0,u=0,a=i.length;u<a;++u){var s=i[u];if(s==="'"){l||(f=!f);continue}if(s==='"'){f||(l=!l);continue}if(l||f)continue;e[s]&&(i[u]=e[s]),t[s]&&(o=i[u+1])&&o[0]==="("&&(i[u]=t[s])}return Function("d","return ("+i.join("")+");")}}(),n.parse.legends=function(){function t(e,t,i){(e||[]).forEach(function(e,s){t[s]=t[s]||n.scene.legend(),r(e,s,t[s],i)})}function r(t,n,r,i){r.size(t.size?i[t.size]:null),r.shape(t.shape?i[t.shape]:null),r.fill(t.fill?i[t.fill]:null),r.stroke(t.stroke?i[t.stroke]:null),t.orient&&r.orient(t.orient),t.offset!=null&&r.offset(t.offset),r.title(t.title||null),r.values(t.values||null),r.format(t.format!==undefined?e.format(t.format):null);var s=t.properties;r.titleProperties(s&&s.title||{}),r.labelProperties(s&&s.labels||{}),r.legendProperties(s&&s.legend||{}),r.symbolProperties(s&&s.symbols||{}),r.gradientProperties(s&&s.gradient||{})}return t}(),n.parse.mark=function(e){var t=e.properties,r=e.marks;n.keys(t).forEach(function(e){t[e]=n.parse.properties(t[e])}),e.delay&&(e.delay=n.parse.properties({delay:e.delay}));if(e.from){var i=e.from.data,s=n.parse.dataflow(e.from);e.from=function(e,t,r){var o=n.scene.data(i?e[i]:null,r);return s(o,e,t)}}return r&&(e.marks=r.map(n.parse.mark)),e},n.parse.marks=function(e,t,r){return{type:"group",width:t,height:r,scales:e.scales||[],axes:e.axes||[],legends:e.legends||[],marks:(e.marks||[]).map(n.parse.mark)}},n.parse.padding=function(e){if(n.isString(e)||e==null)return"auto";if(n.isObject(e))return e;var t=n.isNumber(e)?e:20;return{top:t,left:t,right:t,bottom:t}},n.parse.properties=function(){function e(e){var r="",i=n.keys(e),s,o,u,a,f={};r+="var o = trans ? {} : item;\n";for(s=0,o=i.length;s<o;++s)a=e[u=i[s]],r+=s>0?"\n  ":"  ",r+="o."+u+" = "+t(a)+";",f[u]=!0;return f.x2&&(f.width?r+="\n  o.x = (o.x2 - o.width);":f.x&&(r+="\n  if (o.x > o.x2) { var t = o.x; o.x = o.x2; o.x2 = t; };",r+="\n  o.width = (o.x2 - o.x);")),f.y2&&(f.height?r+="\n  o.y = (o.y2 - o.height);":f.y&&(r+="\n  if (o.y > o.y2) { var t = o.y; o.y = o.y2; o.y2 = t; };",r+="\n  o.height = (o.y2 - o.y);")),r+="if (trans) trans.interpolate(item, o);",Function("item","group","trans",r)}function t(e){if(e==null)return null;if(e.c)return r("hcl",e.h,e.c,e.l);if(e.h||e.s)return r("hsl",e.h,e.s,e.l);if(e.l||e.a)return r("lab",e.l,e.a,e.b);if(e.r||e.g||e.b)return r("rgb",e.r,e.g,e.b);var t="item.datum.data";e.value!==undefined&&(t=n.str(e.value)),e.group!==undefined&&(t="group["+n.str(e.group)+"]"),e.field!==undefined&&(t="item.datum["+n.field(e.field).map(n.str).join("][")+"]");if(e.scale!==undefined){var i="group.scales["+n.str(e.scale)+"]";e.band?t=i+".rangeBand()":t=i+"("+t+")"}return"("+(e.mult?n.number(e.mult)+" * ":"")+t+")"+(e.offset?" + "+n.number(e.offset):"")}function r(e,r,i,s){var o=r?t(r):n.config.color[e][0],u=i?t(i):n.config.color[e][1],a=s?t(s):n.config.color[e][2];return"(d3."+e+"("+[o,u,a].join(",")+') + "")'}return e}(),n.parse.scales=function(){function a(e,t,n,r){return(e||[]).reduce(function(e,t){var i=t.name,s=i+":prev";return e[i]=f(t,e[i],n,r),e[s]=e[s]||e[i],e},t||{})}function f(e,t,i,s){var o=l(e,t),u=o.type===r?c:h,a=p(e,s),f=n.values(s.datum);return u(e,o,a,i,f),o}function l(r,i){var s=r.type||t;if(!i||s!==i.type){var o=n.config.scale[s]||e.scale[s];o||n.error("Unrecognized scale type: "+s),(i=o()).type=i.type||s,i.scaleName=r.name}return i}function c(e,t,r,i,s){var o,u,a,f;o=e.domain,n.isArray(o)?t.domain(o):n.isObject(o)&&(u=e.domain.fields||n.array(e.domain),a=u.reduce(function(e,t){var r=i[t.data]||s,o=n.accessor(t.field);return n.unique(r,o,e)},[]),e.sort&&a.sort(n.cmp),t.domain(a)),f=typeof r[0]=="string",f||r.length>2?t.range(r):e.points?t.rangePoints(r,e.padding||0):e.round||e.round===undefined?t.rangeRoundBands(r,e.padding||0):t.rangeBands(r,e.padding||0)}function h(t,r,u,a,f){function d(t,r,i,s){var o=a[t.data]||f;n.array(t.field).forEach(function(t,u){t=n.accessor(t),r&&(l[0]=e.min([l[0],e.min(o,t)])),i&&(l[s]=e.max([l[s],e.max(o,t)]))})}var l,c,h,p;l=[null,null],t.domain!==undefined&&(n.isArray(t.domain)?l=t.domain.slice():n.isObject(t.domain)?(c=t.domain.fields||n.array(t.domain),c.forEach(function(e){d(e,1,1,1)})):l=t.domain),p=l.length-1,t.domainMin!==undefined&&(n.isObject(t.domainMin)?(l[0]=null,c=t.domainMin.fields||n.array(t.domainMin),c.forEach(function(e){d(e,1,0,p)})):l[0]=t.domainMin),t.domainMax!==undefined&&(n.isObject(t.domainMax)?(l[p]=null,c=t.domainMax.fields||n.array(t.domainMax),c.forEach(function(e){d(e,0,1,p)})):l[p]=t.domainMax),t.type!==i&&t.type!==o&&(t.zero||t.zero===undefined)&&(l[0]=Math.min(0,l[0]),l[p]=Math.max(0,l[p])),r.domain(l),t.range==="height"&&(u=u.reverse()),r[t.round&&r.rangeRound?"rangeRound":"range"](u),t.exponent&&t.type===s&&r.exponent(t.exponent),t.clamp&&r.clamp(!0),t.nice&&(t.type===o?(h=e.time[t.nice],h||n.error("Unrecognized interval: "+h),r.nice(h)):r.nice())}function p(e,t){var r=[null,null];if(e.range!==undefined)if(typeof e.range=="string")if(u[e.range])r=[0,t[e.range]];else{if(!n.config.range[e.range])return n.error("Unrecogized range: "+e.range),r;r=n.config.range[e.range]}else n.isArray(e.range)?r=e.range:r=[0,e.range];e.rangeMin!==undefined&&(r[0]=e.rangeMin),e.rangeMax!==undefined&&(r[r.length-1]=e.rangeMax);if(e.reverse!==undefined){var i=e.reverse;n.isObject(i)&&(i=n.accessor(i.field)(t.datum)),i&&(r=r.reverse())}return r}var t="linear",r="ordinal",i="log",s="pow",o="time",u={width:1,height:1};return a}(),n.parse.spec=function(t,r,i){function s(e){e=n.duplicate(e);var t=e.width||500,s=e.height||500,o=e.viewport||null,u={width:t,height:s,viewport:o,padding:n.parse.padding(e.padding),marks:n.parse.marks(e,t,s),data:n.parse.data(e.data,function(){r(a)})},a=i(u)}i=i||n.ViewFactory,n.isObject(t)?s(t):e.json(t,function(e,t){e?n.error(e):s(t)})},n.parse.transform=function(e){var t=n.data[e.type]();return n.keys(e).forEach(function(n){if(n==="type")return;t[n](e[n])}),t},n.scene={},n.scene.GROUP="group",n.scene.ENTER=0,n.scene.UPDATE=1,n.scene.EXIT=2,n.scene.DEFAULT_DATA={sentinel:1},n.scene.data=function(e,t){var r=n.scene.DEFAULT_DATA;return e=n.values(e||t||[r]),e===r&&(e=[r]),e},n.scene.fontString=function(e){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(e.fontSize!=null?e.fontSize:n.config.render.fontSize)+"px "+(e.font||n.config.render.font)},n.scene.Item=function(){function e(e){this.mark=e}var t=e.prototype;return t.hasPropertySet=function(e){var t=this.mark.def.properties;return t&&t[e]!=null},t.cousin=function(e,t){if(e===0)return this;e=e||-1;var n=this.mark,r=n.group,i=t==null?n.items.indexOf(this):t,s=r.items.indexOf(n)+e;return r.items[s].items[i]},t.sibling=function(e){if(e===0)return this;e=e||-1;var t=this.mark,n=t.items.indexOf(this)+e;return t.items[n]},t.remove=function(){var e=this,t=e.mark.items,n=t.indexOf(e);return n>=0&&(n===t.length-1?t.pop():t.splice(n,1)),e},e}(),n.scene.item=function(e){return new n.scene.Item(e)},n.scene.build=function(){function u(e,r,i,s){var o=n.scene.data(e.from?e.from(r,i,s):null,s);return i=a(e,i),i.items=f(e,o,i),c(e,i),e.type===t&&l(e,r,i),i}function a(e,t){return t=t||{},t.def=e,t.marktype=e.type,t.interactive=e.interactive!==!1,t}function f(e,t,o){var u=h(e.key),a=o.items||[],f=[],l={},c,p,d,v,m,g;for(c=0,d=a.length;c<d;++c)v=a[c],v.status=s,u&&(l[v.key]=v);for(c=0,d=t.length;c<d;++c)m=t[c],p=c,v=u?l[p=u(m)]:a[c],g=v?!1:(v=n.scene.item(o),!0),v.status=g?r:i,v.datum=m,v.key=p,f.push(v);for(c=0,d=a.length;c<d;++c)v=a[c],v.status===s&&(v.key=u?v.key:f.length,f.push(v));return f}function l(e,t,n){var r=n.items,i=e.marks,s,o,a,f,l,c;for(s=0,o=r.length;s<o;++s){c=r[s];if(c.scales)for(l in c.scales)l.indexOf(":prev")<0&&(c.scales[l+":prev"]=c.scales[l].copy());c.items=c.items||[];for(a=0,f=i.length;a<f;++a)c.items[a]=u(i[a],t,c.items[a],c.datum),c.items[a].group=c}}function c(t,n){t.duration&&(n.duration=t.duration),t.ease&&(n.ease=e.ease(t.ease));if(t.delay){var r=n.items,i=n.group,s=r.length,o;for(o=0;o<s;++o)t.delay.call(this,r[o],i)}}function h(e){if(e==null)return null;var t=n.array(e).map(n.accessor);return function(e){for(var n="",r=0,i=t.length;r<i;++r)r>0&&(n+="|"),n+=String(t[r](e));return n}}var t=n.scene.GROUP,r=n.scene.ENTER,i=n.scene.UPDATE,s=n.scene.EXIT,o={sentinel:1};return u}(),n.scene.bounds=function(){function o(){return s||(s=(n.config.isNode?new Canvas(0,0):e.select("body").append("canvas").style("display","none").attr("class","vega_hidden").attr("width",0).attr("height",0).node()).getContext("2d"))}function u(e,n,i){return r(t(n),i),e.stroke&&e.opacity!==0&&e.strokeWidth>0&&i.expand(e.strokeWidth),i}function a(e,t){return u(e,e.path,t)}function f(t,n){var r=t.mark.items,i=e.svg.area().x(function(e){return e.x}).y1(function(e){return e.y}).y0(function(e){return e.y+e.height});return t=r[0],t.interpolate&&i.interpolate(t.interpolate),t.tension!=undefined&&i.tension(t.tension),u(t,i(r),n)}function l(t,n){var r=t.mark.items,i=e.svg.line().x(function(e){return e.x}).y(function(e){return e.y});return t=r[0],t.interpolate&&i.interpolate(t.interpolate),t.tension!=undefined&&i.tension(t.tension),u(t,i(r),n)}function c(e,t){return t.set(e.x||0,e.y||0,e.x+e.width||0,e.y+e.height||0),e.stroke&&e.opacity!==0&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function h(e,t){var n=e.width||0,r=e.height||0,i=e.x-(e.align==="center"?n/2:e.align==="right"?n:0),s=e.y-(e.baseline==="middle"?r/2:e.baseline==="bottom"?r:0);return t.set(i,s,i+n,s+r)}function p(e,t){var n,r;return t.set(n=e.x||0,r=e.y||0,e.x2!=null?e.x2:n,e.y2!=null?e.y2:r),e.stroke&&e.opacity!==0&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function d(e,t){var n=e.x||0,r=e.y||0,s=e.innerRadius||0,o=e.outerRadius||0,u=(e.startAngle||0)-i,a=(e.endAngle||0)-i,f=Infinity,l=-Infinity,c=Infinity,h=-Infinity,p,d,v,m,g,y,b,w,E,S=[u,a],x=u-u%i+i;for(var d=0;d<4&&x<a;++d,x+=i)S.push(x);for(d=0,v=S.length;d<v;++d)p=S[d],m=Math.cos(p),y=s*m,w=o*m,g=Math.sin(p),b=s*g,E=o*g,f=Math.min(f,y,w),l=Math.max(l,y,w),c=Math.min(c,b,E),h=Math.max(h,b,E);return t.set(n+f,r+c,n+l,r+h),e.stroke&&e.opacity!==0&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function v(e,t){var n=e.size!=null?e.size:100,r=e.x,i=e.y,s,o,u,a;switch(e.shape){case"cross":s=Math.sqrt(n/5)/2,o=3*s,t.set(r-o,i-o,r+i,i+o);break;case"diamond":a=Math.sqrt(n/(2*tan30)),u=a*tan30,t.set(r-u,i-a,r+u,i+a);break;case"square":o=Math.sqrt(n),s=o/2,t.set(r-s,i-s,r+s,i+s);break;case"triangle-down":u=Math.sqrt(n/sqrt3),a=u*sqrt3/2,t.set(r-u,i-a,r+u,i+a);break;case"triangle-up":u=Math.sqrt(n/sqrt3),a=u*sqrt3/2,t.set(r-u,i-a,r+u,i+a);break;default:s=Math.sqrt(n/Math.PI),t.set(r-s,i-s,r+s,i+s)}return e.stroke&&e.opacity!==0&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function m(e,t,r){var i=e.x+(e.dx||0),s=e.y+(e.dy||0),u=e.fontSize||n.config.render.fontSize,a=e.align,f=e.baseline,l=o(),c;return l.font=n.scene.fontString(e),l.textAlign=e.align||"left",l.textBaseline=e.baseline||"alphabetic",c=l.measureText(e.text).width,a==="center"?i-=c/2:a==="right"&&(i-=c),f==="top"?s+=u/5:f==="bottom"?s-=u:f==="middle"?s=s-u/2+u/10:s-=4*u/5,t.set(i,s,i+c,s+u),e.angle&&!r&&t.rotate(e.angle*Math.PI/180,e.x,e.y),t.expand(r?0:1)}function g(e,t,n){var r=e.axisItems||[],i=e.legendItems||[],s,o;for(s=0,o=r.length;s<o;++s)t.union(r[s].bounds);for(s=0,o=e.items.length;s<o;++s)t.union(e.items[s].bounds);if(n){for(s=0,o=i.length;s<o;++s)t.union(i[s].bounds);e.width!=null&&e.height!=null&&t.add(e.width,e.height),e.x!=null&&e.y!=null&&t.add(0,0)}return t.translate(e.x||0,e.y||0),t}function b(e,t,r){t=t||y[e.mark.marktype],e.bounds_prev||(e.bounds_prev=new n.Bounds);var i=e.bounds,s=e.bounds_prev;return i&&s.clear().union(i),e.bounds=t(e,i?i.clear():new n.Bounds,r),i||s.clear().union(e.bounds),e.bounds}function w(e,t,r){t=t||e.bounds&&e.bounds.clear()||new n.Bounds;var i=e.marktype,s=y[i],o=e.items,u,a,f;if(i==="area"||i==="line")o[0].bounds=s(o[0],t);else for(a=0,f=o.length;a<f;++a)t.union(b(o[a],s,r));e.bounds=t}var t=n.canvas.path.parse,r=n.canvas.path.bounds,i=Math.PI/2,s=null,y={group:g,symbol:v,image:h,rect:c,rule:p,arc:d,text:m,path:a,area:f,line:l};return{mark:w,item:b,text:m,group:g}}(),n.scene.encode=function(){function o(e,t,n,r,i){return r&&i?u.call(this,e,t,n,r,i):a.call(this,e,e,t,n,r),e}function u(e,t,r,i,s){s=n.array(s);var o,u,a,f,l,c;for(o=0,u=s.length;o<u;++o)a=s[o],f=a.mark.group||null,l=a.mark.def.properties,c=l&&l[i],c&&(c.call(this,a,f,r),n.scene.bounds.item(a))}function a(t,r,i,s,o){c.call(this,t,r.items,i,s,o),r.marktype===e?l.call(this,r,i,t,s,o):n.scene.bounds.mark(r)}function f(e,t,r,i,s){l.call(this,t,r,e,i,s),c.call(this,e,t.items,r,i,s),n.scene.bounds.mark(t,null,!0)}function l(e,t,r,i,s){var o,u,l,c,h,p,d,v,m,g,y,b;for(o=0,u=e.items.length;o<u;++o){h=e.items[o],p=h.scales||(h.scales=n.extend({},r.scales)),t.scales&&n.parse.scales(t.scales,p,this._data,h),t.axes&&(d=h.axes||(h.axes=[]),v=h.axisItems||(h.axisItems=[]),n.parse.axes(t.axes,d,h.scales),d.forEach(function(e,t){m=e.def(),v[t]=n.scene.build(m,this._data,v[t]),a.call(this,h,h.axisItems[t],m,i)}));for(l=0,c=h.items.length;l<c;++l)a.call(this,h,h.items[l],t.marks[l],i,s)}n.scene.bounds.mark(e,null
,!t.legends);if(t.legends){for(o=0,u=e.items.length;o<u;++o)h=e.items[o],g=h.legends||(h.legends=[]),y=h.legendItems||(h.legendItems=[]),n.parse.legends(t.legends,g,h.scales),g.forEach(function(e,t){b=e.def(),y[t]=n.scene.build(b,this._data,y[t]),f.call(this,h,h.legendItems[t],b,i)});n.scene.bounds.mark(e,null,!0)}}function c(e,n,o,u,a){if(o.properties==null)return;var f=o.properties,l=f.enter,c=f.update,h=f.exit,p,d,v,m;if(a&&(m=f[a])){for(p=0,d=n.length;p<d;++p)m.call(this,n[p],e,u);return}for(p=0;p<n.length;++p)v=n[p],v.status===t&&(l&&l.call(this,v,e),v.status=r),v.status!==i&&c&&c.call(this,v,e,u),v.status===i&&(h&&u?h.call(this,v,e,u):u?u.interpolate(v,s):n[p--].remove())}var e=n.scene.GROUP,t=n.scene.ENTER,r=n.scene.UPDATE,i=n.scene.EXIT,s={};return o}(),n.scene.Transition=function(){function t(t,n){this.duration=t||500,this.ease=n&&e.ease(n)||e.ease("cubic-in-out"),this.updates={next:null}}function i(e){var t=this.updates,r=t,i=r.next,s=this.duration,o,u,a,f,l,c,h=!0;for(;i!=null;r=i,i=r.next){o=i.item,u=o.delay||0,a=(e-u)/s;if(a<0){h=!1;continue}a>1&&(a=1),f=i.ease(a);for(l=0,c=i.length;l<c;++l)o[i[l].property]=i[l](f),n.scene.bounds.item(o);a===1?(i.remove&&o.remove(),r.next=i.next,i=r):h=!1}return this.callback(),h}var r=t.prototype;return r.interpolate=function(t,r){var i,s,o,u,a=null;for(i in r)s=t[i],o=r[i],s!==o&&(i==="text"?t[i]=o:(u=e.interpolate(s,o),u.property=i,(a||(a=[])).push(u)));return a===null&&t.status===n.scene.EXIT&&(a=[]),a!=null&&(a.item=t,a.ease=t.mark.ease||this.ease,a.next=this.updates.next,this.updates.next=a),this},r.start=function(t){var r=this,s=r.updates,o=s.next;for(;o!=null;s=o,o=s.next)o.item.status===n.scene.EXIT&&(o.remove=!0);r.callback=t,e.timer(function(e){return i.call(r,e)})},t}(),n.scene.transition=function(e,t){return new n.scene.Transition(e,t)},n.scene.axis=function(){function B(e){var r,s,o;e.type==="ordinal"?(r={scale:e.scaleName,offset:.5+e.rangeBand()/2},s=r):(r={scale:e.scaleName,offset:.5},s={scale:e.scaleName+":prev",offset:.5}),o=T(e);var u=_(),a=_(),p=_(),d=D(),v=H(),m=P();u.properties.enter.stroke={value:n.config.axis.gridColor},L(t,u,s,r,Infinity),L(t,a,s,r,f),L(t,p,s,r,l),k(t,d,s,r,f,h),O(t,v,o,c),A(t,m,o,i),n.extend(u.properties.update,g),n.extend(a.properties.update,b),n.extend(p.properties.update,S),n.extend(d.properties.update,y),n.extend(v.properties.update,N),n.extend(m.properties.update,x);var w=[u,a,p,d,v,m];return{type:"group",interactive:!1,properties:{enter:M,update:M},marks:w.map(n.parse.mark)}}var e,t=n.config.axis.orient,r=0,i=n.config.axis.titleOffset,s=null,o="front",u=!1,a=null,f=n.config.axis.tickSize,l=n.config.axis.tickSize,c=n.config.axis.tickSize,h=n.config.axis.padding,p=null,d=null,v=0,m=[n.config.axis.ticks],g={},y={},b={},S={},x={},N={},C={};return C.def=function(){var i=s=B(e),f=p==null?e.ticks?e.ticks.apply(e,m):e.domain():p,l=E(e,f,v).map(n.data.ingest);f=f.map(n.data.ingest);var c=d==null?e.tickFormat?e.tickFormat.apply(e,m):String:d;f.forEach(function(e){e.label=c(e.data)});var h=a?[a].map(n.data.ingest):[];return i.marks[0].from=function(){return u?f:[]},i.marks[1].from=function(){return f},i.marks[2].from=function(){return l},i.marks[3].from=i.marks[1].from,i.marks[4].from=function(){return[1]},i.marks[5].from=function(){return h},i.offset=r,i.orient=t,i.layer=o,i},C.scale=function(t){return arguments.length?(e=t,C):e},C.orient=function(e){return arguments.length?(t=e in w?e+"":n.config.axis.orient,C):t},C.title=function(e){return arguments.length?(a=e,C):a},C.ticks=function(){return arguments.length?(m=arguments,C):m},C.tickValues=function(e){return arguments.length?(p=e,C):p},C.tickFormat=function(e){return arguments.length?(d=e,C):d},C.tickSize=function(e,t){if(!arguments.length)return f;var n=arguments.length-1;return f=+e,l=n>1?+t:f,c=n>0?+arguments[n]:f,C},C.tickPadding=function(e){return arguments.length?(h=+e,C):h},C.tickSubdivide=function(e){return arguments.length?(v=+e,C):v},C.offset=function(e){return arguments.length?(r=+e,C):p},C.titleOffset=function(e){return arguments.length?(i=+e,C):i},C.layer=function(e){return arguments.length?(o=e,C):o},C.grid=function(e){return arguments.length?(u=e,C):u},C.gridLineProperties=function(e){return arguments.length?(g=e,C):g},C.majorTickProperties=function(e){return arguments.length?(b=e,C):b},C.minorTickProperties=function(e){return arguments.length?(S=e,C):S},C.tickLabelProperties=function(e){return arguments.length?(y=e,C):y},C.titleProperties=function(e){return arguments.length?(x=e,C):x},C.domainProperties=function(e){return arguments.length?(N=e,C):N},C};var w={top:1,right:1,bottom:1,left:1},N={bottom:"center",top:"center",left:"right",right:"left"},C={bottom:"top",top:"bottom",left:"middle",right:"middle"};n.scene.legend=function(){function E(e){return e==="ordinal"||e==="quantize"||e==="quantile"||e==="threshold"}function S(l){var c=x(t,r,i,s),p=(u==null?l.ticks?l.ticks.apply(l,d):l.domain():u).map(n.data.ingest),v=a==null?l.tickFormat?l.tickFormat.apply(l,d):String:a,m,g,w,E=5,S=e.range(p.length);t?(g=p.map(function(e){return Math.sqrt(t(e.data))}),w=e.max(g),g=g.reduce(function(e,t,n,r){return n>0&&(e[n]=e[n-1]+r[n-1]/2+E),e[n]+=t/2,e},[0]).map(Math.round)):(w=Math.round(Math.sqrt(n.config.legend.symbolSize)),g=o||(m=b.fontSize)&&m.value+E||n.config.legend.labelFontSize+E,g=S.map(function(e,t){return Math.round(w/2+t*g)}));var T=h,N;f&&(N=y.fontSize,T+=5+(N&&N.value||n.config.legend.titleFontSize));for(var C=0,k=g.length;C<k;++C)g[C]+=T;var l={name:"legend",type:"ordinal",points:!0,domain:S,range:g},L=(f?[f]:[]).map(n.data.ingest);return p.forEach(function(e){e.label=v(e.data),e.offset=w}),c.scales=[l],c.marks[0].from=function(){return L},c.marks[1].from=function(){return p},c.marks[2].from=c.marks[1].from,c}function x(e,t,r,i){var s=I(),o=q(),u=R();return F(o,e,t,r,i),n.extend(s.properties.update,y),n.extend(o.properties.update,m),n.extend(u.properties.update,b),s.properties.enter.x.value+=h,s.properties.enter.y.value+=h,u.properties.enter.x.offset+=h+1,o.properties.enter.x.offset=h+1,{type:"group",interactive:!1,properties:{enter:n.parse.properties(v),update:j},marks:[s,o,u].map(n.parse.mark)}}function T(e){var t=N(e),r=e.domain(),i=r.map(n.data.ingest),s=g.width&&g.width.value||n.config.legend.gradientWidth,o=a==null?e.tickFormat?e.tickFormat.apply(e,d):String:a,u={name:"legend",type:e.type,round:!0,zero:!1,domain:[r[0],r[r.length-1]],range:[h,s+h]};e.type==="pow"&&(u.exponent=e.exponent());var l=(f?[f]:[]).map(n.data.ingest);return i.forEach(function(e,t){e.label=o(e.data),e.align=t==i.length-1?"right":t==0?"left":"center"}),t.scales=[u],t.marks[0].from=function(){return l},t.marks[1].from=function(){return[1]},t.marks[2].from=function(){return i},t}function N(e){var t=I(),r=U(),i=z(),s=new n.Gradient,o=e.domain(),u=o[0],a=o[o.length-1],l=e.copy().domain([u,a]).range([0,1]),c=e.type!=="linear"&&e.ticks?e.ticks.call(e,15):o;u!==c[0]&&c.unshift(u),a!==c[c.length-1]&&c.push(a);for(var p=0,d=c.length;p<d;++p)s.stop(l(c[p]),e(c[p]));r.properties.enter.fill={value:s},n.extend(t.properties.update,y),n.extend(r.properties.update,g),n.extend(i.properties.update,b);var m=r.properties,w=g.height,E=w&&w.value||m.enter.height.value;i.properties.enter.y.value=E;if(f){var S=t.properties,x=y.fontSize,T=4+(x&&x.value||S.enter.fontSize.value);r.properties.enter.y.value+=T,i.properties.enter.y.value+=T}return t.properties.enter.x.value+=h,t.properties.enter.y.value+=h,r.properties.enter.x.value+=h,r.properties.enter.y.value+=h,i.properties.enter.y.value+=h,{type:"group",interactive:!1,properties:{enter:n.parse.properties(v),update:j},marks:[t,r,i].map(n.parse.mark)}}var t=null,r=null,i=null,s=null,o=null,u=null,a=null,f=undefined,l="right",c=n.config.legend.offset,h=n.config.legend.padding,p,d=[5],v={},m={},g={},y={},b={},w={},p=null;return w.def=function(){var e=t||r||i||s;return p=e!==i&&e!==s||!!E(e.type)?S(e):T(e),p.orient=l,p.offset=c,p.padding=h,p},w.size=function(e){return arguments.length?(t=e,w):t},w.shape=function(e){return arguments.length?(r=e,w):r},w.fill=function(e){return arguments.length?(i=e,w):i},w.stroke=function(e){return arguments.length?(s=e,w):s},w.title=function(e){return arguments.length?(f=e,w):f},w.format=function(e){return arguments.length?(a=e,w):a},w.spacing=function(e){return arguments.length?(o=+e,w):o},w.orient=function(e){return arguments.length?(l=e in B?e+"":n.config.legend.orient,w):l},w.offset=function(e){return arguments.length?(c=+e,w):c},w.values=function(e){return arguments.length?(u=e,w):u},w.legendProperties=function(e){return arguments.length?(v=e,w):v},w.symbolProperties=function(e){return arguments.length?(m=e,w):m},w.gradientProperties=function(e){return arguments.length?(g=e,w):g},w.labelProperties=function(e){return arguments.length?(b=e,w):b},w.titleProperties=function(e){return arguments.length?(y=e,w):y},w};var B={right:1,left:1};return n.Model=function(){function e(){this._defs=null,this._data={},this._scene=null}var t=e.prototype;return t.defs=function(e){return arguments.length?(this._defs=e,this):this._defs},t.data=function(e){if(!arguments.length)return this._data;var t=this._defs.data.flow||{},r=this._defs.data.defs.map(n.accessor("name")),i,s,o,u,a;for(i=0,o=r.length;i<o;++i){if(!e[u=r[i]])continue;this._data[u]=t[u]?t[u](e[u],this._data,this._defs.marks):e[u],a=this._defs.data.source[u]||[];for(s=0;s<a.length;++s)this._data[a[s]]=t[a[s]]?t[a[s]](this._data[u],this._data,this._defs.marks):this._data[u]}return this},t.width=function(e){return this._defs&&(this._defs.width=e),this._defs&&this._defs.marks&&(this._defs.marks.width=e),this._scene&&(this._scene.items[0].width=e),this},t.height=function(e){return this._defs&&(this._defs.height=e),this._defs&&this._defs.marks&&(this._defs.marks.height=e),this._scene&&(this._scene.items[0].height=e),this},t.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},t.build=function(){var e=this,t=e._data,r=e._defs.marks;return e._scene=n.scene.build.call(e,r,t,e._scene),e._scene.items[0].width=r.width,e._scene.items[0].height=r.height,e._scene.interactive=!1,this},t.encode=function(e,t,r){var i=this,s=i._scene,o=i._defs;return n.scene.encode.call(i,s,o.marks,e,t,r),this},e}(),n.View=function(){var t=function(e,t,r){this._el=null,this._build=!1,this._model=new n.Model,this._width=t||500,this._height=r||500,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=n.canvas,e&&this.initialize(e)},r=t.prototype;return r.width=function(e){return arguments.length?(this._width!==e&&(this._width=e,this._el&&this.initialize(this._el.parentNode),this._model.width(e)),this):this._width},r.height=function(e){return arguments.length?(this._height!==e&&(this._height=e,this._el&&this.initialize(this._el.parentNode),this._model.height(this._height)),this):this._height},r.padding=function(e){return arguments.length?(this._padding!==e&&(e==="auto"?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0}):(this._autopad=0,this._padding=e),this._el&&(this._renderer.resize(this._width,this._height,e),this._handler.padding(e))),this):this._padding},r.autopad=function(e){if(this._autopad<1)return this;this._autopad=0;var t=this._padding,r=this.model().scene().bounds,i=-r.x1,s=-r.y1,o=+r.x2-this._width,u=+r.y2-this._height,a=n.config.autopadInset;this.padding({left:t&&t.left>i?t.left:i+a,right:t&&t.right>o?t.right:o+a,top:t&&t.top>s?t.top:s+a,bottom:t&&t.bottom>u?t.bottom:u+a}).update(e)},r.viewport=function(e){return arguments.length?(this._viewport!==e&&(this._viewport=e,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},r.renderer=function(e){return arguments.length?(e==="canvas"&&(e=n.canvas),e==="svg"&&(e=n.svg),this._io!==e&&(this._io=e,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},r.defs=function(e){return arguments.length?(this._model.defs(e),this):this._model.defs()},r.data=function(e){if(!arguments.length)return this._model.data();var t=n.keys(e).reduce(function(t,r){return t[r]=e[r].map(n.data.ingest),t},{});return this._model.data(t),this._build=!1,this},r.model=function(e){return arguments.length?(this._model!==e&&(this._model=e,this._handler&&this._handler.model(e)),this):this._model},r.initialize=function(t){var n=this,r,i=n._width,s=n._height,o=n._padding;return e.select(t).select("div.vega").remove(),this._el=t=e.select(t).append("div").attr("class","vega").style("position","relative").node(),n._viewport&&e.select(t).style("width",(n._viewport[0]||i)+"px").style("height",(n._viewport[1]||s)+"px").style("overflow","auto"),n._renderer=(n._renderer||new this._io.Renderer).initialize(t,i,s,o),r=n._handler,n._handler=(new this._io.Handler).initialize(t,o,n).model(n._model),r&&r.handlers().forEach(function(e){n._handler.on(e.type,e.handler)}),this},r.render=function(e){return this._renderer.render(this._model.scene(),e),this},r.on=function(){return this._handler.on.apply(this._handler,arguments),this},r.off=function(){return this._handler.off.apply(this._handler,arguments),this},r.update=function(e){e=e||{};var t=this,r=e.duration?n.scene.transition(e.duration,e.ease):null;return t._build=t._build||(t._model.build(),!0),t._model.encode(r,e.props,e.items),r?r.start(function(e){t._renderer.render(t._model.scene(),e)}):t.render(e.items),t.autopad(e)},t}(),n.ViewFactory=function(e){return function(t){t=t||{};var r=(new n.View).width(e.width).height(e.height).padding(e.padding).viewport(e.viewport).renderer(t.renderer||"canvas").defs(e);return e.data.load&&r.data(e.data.load),t.data&&r.data(t.data),t.el&&r.initialize(t.el),t.hover!==!1&&r.on("mouseover",function(e,t){t.hasPropertySet("hover")&&this.update({props:"hover",items:t})}).on("mouseout",function(e,t){t.hasPropertySet("hover")&&this.update({props:"update",items:t})}),r}},n.Spec=function(){var e=function(e){this.spec={width:500,height:500,padding:0,data:[],scales:[],axes:[],marks:[]},e&&n.extend(this.spec,e)},t=e.prototype;return t.width=function(e){return this.spec.width=e,this},t.height=function(e){return this.spec.height=e,this},t.padding=function(e){return this.spec.padding=e,this},t.viewport=function(e){return this.spec.viewport=e,this},t.data=function(e,t){return t?t.name=e:t=n.isString(e)?{name:e}:e,this.spec.data.push(t),this},t.scale=function(e,t){return t?t.name=e:t=n.isString(e)?{name:e}:e,this.spec.scales.push(t),this},t.axis=function(e){return this.spec.axes.push(e),this},t.mark=function(e,t){t?t.type=e:t={type:e},t.properties={},this.spec.marks.push(t);var r=this;return{from:function(e,r){return t.from=r?(r.data=e,r):n.isString(e)?{data:e}:e,this},prop:function(e,r){return t.properties[e]=n.keys(r).reduce(function(e,t){var i=r[t];return e[t]=n.isObject(i)?i:{value:i},e},{}),this},done:function(){return r}}},t.parse=function(e){n.parse.spec(this.spec,e)},t.json=function(){return this.spec},e}(),n.spec=function(e){return new n.Spec(e)},n.headless={},n.headless.View=function(){var t=function(e,t,r,i){this._canvas=null,this._type=i,this._el="body",this._build=!1,this._model=new n.Model,this._width=e||500,this._height=t||500,this._padding=r||{top:0,left:0,bottom:0,right:0},this._renderer=new n[i].Renderer,this.initialize()},r=t.prototype;return r.el=function(e){return arguments.length?(this._el!==e&&(this._el=e,this.initialize()),this):this._el},r.width=function(e){return arguments.length?(this._width!==e&&(this._width=e,this.initialize(),this._model.width(e)),this):this._width},r.height=function(e){return arguments.length?(this._height!==e&&(this._height=e,this.initialize(),this._model.height(this._height)),this):this._height},r.padding=function(e){return arguments.length?(this._padding!==e&&(this._padding=e,this.initialize()),this):this._padding},r.viewport=function(){return arguments.length?this:null},r.defs=function(e){return arguments.length?(this._model.defs(e),this):this._model.defs()},r.data=function(e){if(!arguments.length)return this._model.data();var t=n.keys(e).reduce(function(t,r){return t[r]=e[r].map(n.data.ingest),t},{});return this._model.data(t),this._build=!1,this},r.renderer=function(){return this._renderer},r.canvas=function(){return this._canvas},r.canvasAsync=function(e){function n(){t.pendingImages()===0?(this.render(),e(this._canvas)):setTimeout(n,10)}var t=this._renderer;t.pendingImages()>0?n():e(this._canvas)},r.svg=function(){if(this._type!=="svg")return null;var t=this._padding,r=this._width+(t?t.left+t.right:0),i=this._height+(t?t.top+t.bottom:0),s=e.select(this._el).select("svg").node().innerHTML.replace(/ href=/g," xlink:href=");return'<svg width="'+r+'" '+'height="'+i+'" '+n.config.svgNamespace+">"+s+"</svg>"},r.initialize=function(){var e=this._width,t=this._height,n=this._padding;return this._type==="svg"?this.initSVG(e,t,n):this.initCanvas(e,t,n),this},r.initCanvas=function(e,t,n){var r=require("canvas"),i=e+n.left+n.right,s=t+n.top+n.bottom,o=this._canvas=new r(i,s),u=o.getContext("2d");u.setTransform(1,0,0,1,n.left,n.top),this._renderer.initialize(null,e,t,n),this._renderer.context(u)},r.initSVG=function(e,t,n){var r=e+n.left+n.right,i=t+n.top+n.bottom;this._renderer.initialize(this._el,e,t,n)},r.render=function(e){return this._renderer.render(this._model.scene(),e),this},r.update=function(e){e=e||{};var t=this;return t._build=t._build||(t._model.build(),!0),t._model.encode(null,e.props,e.items),t.render(e.items),t},t}(),n.headless.View.Factory=function(e){return function(t){t=t||{};var r=e.width,i=e.height,s=e.padding,o=t.renderer||"canvas",u=(new n.headless.View(r,i,s,o)).defs(e);return e.data.load&&u.data(e.data.load),t.data&&u.data(t.data),u}},n.headless.render=function(e,t){function r(n){try{var r=n({data:e.data,renderer:e.renderer}).update();e.renderer==="svg"?t(null,{svg:r.svg()}):r.canvasAsync(function(e){t(null,{canvas:e})})}catch(i){t(i,null)}}n.parse.spec(e.spec,r,n.headless.View.Factory)},n}(d3);