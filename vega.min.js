(function(){typeof vg=="undefined"&&(vg={}),vg.version="1.0.0",vg.identity=function(e){return e},vg.duplicate=function(e){return JSON.parse(JSON.stringify(e))},vg.isObject=function(e){return e===Object(e)},vg.accessor=function(e){return typeof e=="function"||e==null?e:Array.isArray(e)?function(t){return e.reduce(function(e,t){return e[t]},t)}:function(t){return t[e]}},vg.comparator=function(e){var t=[];return e===undefined&&(e=[]),e=vg.array(e).map(function(e){var n=1;return e[0]==="-"?(n=-1,e=e.slice(1)):field[0]==="+"&&(e=e.slice(1)),t.push(n),e}),function(n,r){var i,s;for(i=0;i<e.length;++i){s=e[i];if(n[s]<r[s])return-1*t[i];if(n[s]>r[s])return t[i]}return 0}},vg.array=function(e){return e!=null?Array.isArray(e)?e:[e]:[]},vg.str=function(e){return Array.isArray(e)?"["+e.map(vg.str)+"]":typeof e=="string"?"'"+e+"'":e},vg.keys=function(e){var t=[];for(var n in e)t.push(n);return t},vg.unique=function(e,t){t=t||vg.identity;var n=[],r;for(var i=0;i<e.length;++i)r=t(e[i]),n.indexOf(r)<0&&n.push(r);return n},vg.log=function(e){console.log(e)},vg.error=function(e){console.log(e),alert(e)},vg.Bounds=function(){var e=function(e){this.clear(),e&&this.union(e)},t=e.prototype;return t.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},t.set=function(e,t,n,r){return this.x1=e,this.y1=t,this.x2=n,this.y2=r,this},t.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},t.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},t.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},t.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),s=t-t*r+n*i,o=n-t*i-n*r,u=this.x1,a=this.x2,f=this.y1,l=this.y2;return this.clear().add(r*u-i*f+s,i*u+r*f+o).add(r*u-i*l+s,i*u+r*l+o).add(r*a-i*f+s,i*a+r*f+o).add(r*a-i*l+s,i*a+r*l+o)},t.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},t.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},t.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},t.width=function(){return this.x2-this.x1},t.height=function(){return this.y2-this.y1},e}(),vg.canvas={},vg.canvas.path=function(){function n(n){var r=[],i,s,o;n=n.slice().replace(t[0],"###$1").split(t[1]).slice(1);for(var u=0,a,f,l=n.length;u<l;u++){i=n[u],s=i.slice(1).trim().replace(t[2],"$1###-").split(t[3]),f=[i.charAt(0)];for(var a=0,c=s.length;a<c;a++)o=parseFloat(s[a]),isNaN(o)||f.push(o);var h=f[0].toLowerCase(),p=e[h];if(f.length-1>p)for(var d=1,v=f.length;d<v;d+=p)r.push([f[0]].concat(f.slice(d,d+p)));else r.push(f)}return r}function r(e,t,n,r,i,s,o){var u=r[0],l=r[1],c=r[2],h=r[3],p=r[4],d=r[5],v=r[6],m=a(d,v,u,l,h,p,c,t,n);for(var g=0;g<m.length;g++){var y=f.apply(null,m[g]);e.bezierCurveTo.apply(e,y),i.add(y[0]-s,y[1]-o),i.add(y[2]-s,y[3]-o),i.add(y[4]-s,y[5]-o)}}function a(e,t,n,r,s,a,f,l,c){u=o.call(arguments);if(i[u])return i[u];var h=f*(Math.PI/180),p=Math.sin(h),d=Math.cos(h);n=Math.abs(n),r=Math.abs(r);var v=d*(l-e)*.5+p*(c-t)*.5,m=d*(c-t)*.5-p*(l-e)*.5,g=v*v/(n*n)+m*m/(r*r);g>1&&(g=Math.sqrt(g),n*=g,r*=g);var y=d/n,b=p/n,w=-p/r,E=d/r,S=y*l+b*c,x=w*l+E*c,T=y*e+b*t,N=w*e+E*t,C=(T-S)*(T-S)+(N-x)*(N-x),k=1/C-.25;k<0&&(k=0);var L=Math.sqrt(k);a==s&&(L=-L);var A=.5*(S+T)-L*(N-x),O=.5*(x+N)+L*(T-S),M=Math.atan2(x-O,S-A),_=Math.atan2(N-O,T-A),D=_-M;D<0&&a==1?D+=2*Math.PI:D>0&&a==0&&(D-=2*Math.PI);var P=Math.ceil(Math.abs(D/(Math.PI*.5+.001))),H=[];for(var B=0;B<P;B++){var j=M+B*D/P,F=M+(B+1)*D/P;H[B]=[A,O,j,F,n,r,p,d]}return i[u]=H}function f(e,t,n,r,i,a,f,l){u=o.call(arguments);if(s[u])return s[u];var c=l*i,h=-f*a,p=f*i,d=l*a,v=.5*(r-n),m=8/3*Math.sin(v*.5)*Math.sin(v*.5)/Math.sin(v),g=e+Math.cos(n)-m*Math.sin(n),y=t+Math.sin(n)+m*Math.cos(n),b=e+Math.cos(r),w=t+Math.sin(r),E=b+m*Math.sin(r),S=w-m*Math.cos(r);return s[u]=[c*g+h*y,p*g+d*y,c*E+h*S,p*E+d*S,c*b+h*w,p*b+d*w]}function l(e,t,n,i){var s,o=null,u=0,a=0,f=0,l=0,c,h,p,d,v=new vg.Bounds;n==undefined&&(n=0),i==undefined&&(i=0),e.beginPath();for(var m=0,g=t.length;m<g;++m){s=t[m];switch(s[0]){case"l":u+=s[1],a+=s[2],e.lineTo(u+n,a+i),v.add(u,a);break;case"L":u=s[1],a=s[2],e.lineTo(u+n,a+i),v.add(u,a);break;case"h":u+=s[1],e.lineTo(u+n,a+i),v.add(u,a);break;case"H":u=s[1],e.lineTo(u+n,a+i),v.add(u,a);break;case"v":a+=s[1],e.lineTo(u+n,a+i),v.add(u,a);break;case"V":a=s[1],e.lineTo(u+n,a+i),v.add(u,a);break;case"m":u+=s[1],a+=s[2],e.moveTo(u+n,a+i),v.add(u,a);break;case"M":u=s[1],a=s[2],e.moveTo(u+n,a+i),v.add(u,a);break;case"c":c=u+s[5],h=a+s[6],f=u+s[3],l=a+s[4],e.bezierCurveTo(u+s[1]+n,a+s[2]+i,f+n,l+i,c+n,h+i),v.add(u+s[1],a+s[2]),v.add(f,l),v.add(c,h),u=c,a=h;break;case"C":u=s[5],a=s[6],f=s[3],l=s[4],e.bezierCurveTo(s[1]+n,s[2]+i,f+n,l+i,u+n,a+i),v.add(s[1],s[2]),v.add(f,l),v.add(u,a);break;case"s":c=u+s[3],h=a+s[4],f=2*u-f,l=2*a-l,e.bezierCurveTo(f+n,l+i,u+s[1]+n,a+s[2]+i,c+n,h+i),v.add(f,l),v.add(u+s[1],a+s[2]),v.add(c,h),f=u+s[1],l=a+s[2],u=c,a=h;break;case"S":c=s[3],h=s[4],f=2*u-f,l=2*a-l,e.bezierCurveTo(f+n,l+i,s[1]+n,s[2]+i,c+n,h+i),u=c,a=h,v.add(s[1],s[2]),v.add(f,l),v.add(c,h),f=s[1],l=s[2];break;case"q":c=u+s[3],h=a+s[4],f=u+s[1],l=a+s[2],e.quadraticCurveTo(f+n,l+i,c+n,h+i),u=c,a=h,v.add(f,l),v.add(c,h);break;case"Q":c=s[3],h=s[4],e.quadraticCurveTo(s[1]+n,s[2]+i,c+n,h+i),u=c,a=h,f=s[1],l=s[2],v.add(f,l),v.add(c,h);break;case"t":c=u+s[1],h=a+s[2],o[0].match(/[QqTt]/)===null?(f=u,l=a):o[0]==="t"?(f=2*u-p,l=2*a-d):o[0]==="q"&&(f=2*u-f,l=2*a-l),p=f,d=l,e.quadraticCurveTo(f+n,l+i,c+n,h+i),u=c,a=h,f=u+s[1],l=a+s[2],v.add(f,l),v.add(c,h);break;case"T":c=s[1],h=s[2],f=2*u-f,l=2*a-l,e.quadraticCurveTo(f+n,l+i,c+n,h+i),u=c,a=h,v.add(f,l),v.add(c,h);break;case"a":r(e,u+n,a+i,[s[1],s[2],s[3],s[4],s[5],s[6]+u+n,s[7]+a+i],v,n,i),u+=s[6],a+=s[7];break;case"A":r(e,u+n,a+i,[s[1],s[2],s[3],s[4],s[5],s[6]+n,s[7]+i],v,n,i),u=s[6],a=s[7];break;case"z":case"Z":e.closePath()}o=s}return v.translate(n,i)}var e={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},t=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],i={},s={},o=Array.prototype.join,u;return{parse:n,render:l}}(),vg.canvas.marks=function(){function o(r,i){return t(r,e(n(i)),i.x,i.y)}function u(n,r){return t(n,e(r.path),r.x,r.y)}function a(e,t){e.beginPath();var n=t.size!=undefined?t.size:100,s=t.x,o=t.y,u,a,f,l,c=new vg.Bounds;if(t.shape==undefined||t.shape==="circle")return u=Math.sqrt(n/Math.PI),e.arc(s,o,u,0,2*Math.PI,0),e.closePath(),c.set(s-u,o-u,s+u,o+u);switch(t.shape){case"cross":u=Math.sqrt(n/5)/2,a=3*u,e.moveTo(s-a,o-u),e.lineTo(s-u,o-u),e.lineTo(s-u,o-a),e.lineTo(s+u,o-a),e.lineTo(s+u,o-u),e.lineTo(s+a,o-u),e.lineTo(s+a,o+u),e.lineTo(s+u,o+u),e.lineTo(s+u,o+a),e.lineTo(s-u,o+a),e.lineTo(s-u,o+u),e.lineTo(s-a,o+u),c.set(s-a,o-a,s+o,o+a);break;case"diamond":l=Math.sqrt(n/(2*i)),f=l*i,e.moveTo(s,o-l),e.lineTo(s+f,o),e.lineTo(s,o+l),e.lineTo(s-f,o),c.set(s-f,o-l,s+f,o+l);break;case"square":a=Math.sqrt(n),u=a/2,e.rect(s-u,o-u,a,a),c.set(s-u,o-u,s+u,o+u);break;case"triangle-down":f=Math.sqrt(n/r),l=f*r/2,e.moveTo(s,o+l),e.lineTo(s+f,o-l),e.lineTo(s-f,o-l),c.set(s-f,o-l,s+f,o+l);break;case"triangle-up":f=Math.sqrt(n/r),l=f*r/2,e.moveTo(s,o-l),e.lineTo(s+f,o+l),e.lineTo(s-f,o+l),c.set(s-f,o-l,s+f,o+l)}return e.closePath(),c}function f(n,r){var i=d3.svg.area().x(function(e){return e.x}).y1(function(e){return e.y}).y0(function(e){return e.y+e.height}),s=r[0];return s.interpolate&&i.interpolate(s.interpolate),s.tension!=undefined&&i.tension(s.tension),t(n,e(i(r)))}function l(n,r){var i=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}),s=r[0];return s.interpolate&&i.interpolate(s.interpolate),s.tension!=undefined&&i.tension(s.tension),t(n,e(i(r)))}function c(e,t,n,r){var i=n.fill,s=n.stroke,o,u,a;if(!i&&!s)return;n.bounds=e(t,r),i&&(t.globalAlpha=(o=n.fillOpacity)!=undefined?o:1,t.fillStyle=i,t.fill()),s&&(t.globalAlpha=(o=n.strokeOpacity)!=undefined?o:1,t.strokeStyle=s,t.lineWidth=(a=n.strokeWidth)!=undefined?a:1,t.lineCap=(u=n.strokeCap)!=undefined?u:"butt",t.stroke(),n.bounds.expand(2+(a||0)))}function h(e,t,n,r){var i,s,o;for(i=0,s=n.items.length;i<s;++i){o=n.items[i];if(r&&!r.intersects(o.bounds))continue;c(e,t,o,o)}}function p(e,t,n){if(!t.items.length)return;var r=t.items,i,s,o,u,a,f,l;for(var c=0,h=r.length;c<h;++c){i=r[c];if(n&&!n.intersects(i.bounds))continue;i.bounds=(i.bounds||new vg.Bounds).set(i.x,i.y,i.x+i.width,i.y+i.height);if(o=i.fill)e.globalAlpha=(a=i.fillOpacity)!=undefined?a:1,e.fillStyle=o,e.fillRect(i.x,i.y,i.width,i.height);if(u=i.stroke)e.globalAlpha=(a=i.strokeOpacity)!=undefined?a:1,e.strokeStyle=u,e.lineWidth=(l=i.strokeWidth)!=undefined?l:1,e.lineCap=(f=i.strokeCap)!=undefined?f:"butt",e.strokeRect(i.x,i.y,i.width,i.height),i.bounds.expand(2+(l||0))}}function d(e,t,n){if(!t.items.length)return;var r=this,i=t.items,s;for(var o=0,u=i.length;o<u;++o){s=i[o];if(n&&!n.intersects(s.bounds))continue;if(!s.image||s.image.url!==s.url)s.image=r.loadImage(s.url),s.image.url=s.url;var a,f,l,c,h;l=s.width||s.image&&s.image.width||0,c=s.height||s.image&&s.image.height||0,a=s.x-(s.align==="center"?l/2:s.align==="right"?l:0),f=s.y-(s.baseline==="middle"?c/2:s.baseline==="bottom"?c:0),s.bounds=(s.bounds||new vg.Bounds).set(a,f,a+l,f+c),e.globalAlpha=(h=s.fillOpacity)!=undefined?h:1,e.drawImage(s.image,a,f,l,c)}}function v(e){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+e.fontSize+"px "+e.fontFamily}function m(e,t,n){if(!t.items.length)return;var r=t.items,i,s,o,u,a,f,l,c,h;for(var p=0,d=r.length;p<d;++p){i=r[p];if(n&&!n.intersects(i.bounds))continue;e.font=v(i),e.textAlign=i.align||"left",e.textBaseline=i.baseline||"alphabetic",i.bounds=g(e,i,i.bounds||new vg.Bounds).expand(1),i.angle?(e.save(),e.translate(i.x,i.y),e.rotate(i.angle*Math.PI/180),x=i.dx||0,y=i.dy||0):(x=i.x+(i.dx||0),y=i.y+(i.dy||0));if(o=i.fill)e.globalAlpha=(a=i.fillOpacity)!=undefined?a:1,e.fillStyle=o,e.fillText(i.text,x,y);if(u=i.stroke)e.globalAlpha=(a=i.strokeOpacity)!=undefined?a:1,e.strokeStyle=u,e.lineWidth=(w=i.strokeWidth)!=undefined?w:1,e.strokeText(i.text,x,y);i.angle&&e.restore()}}function g(e,t,n,r){var i=t.x+(t.dx||0),s=t.y+(t.dy||0),o=e.measureText(t.text).width,u=t.fontSize,a=t.align,f=t.baseline,l,c,h,p,d;return a==="center"?i-=o/2:a==="right"&&(i-=o),f==="top"?s+=u/5:f==="bottom"?s-=u:f==="middle"?s=s-u/2+u/10:s-=4*u/5,n.set(i,s,i+o,s+u),!r&&t.angle&&n.rotate(t.angle*Math.PI/180,t.x,t.y),n}function b(e){return function(t,n,r){h(e,t,n,r)}}function E(e){return function(t,n,r){if(!n.items.length)return;if(r&&!r.intersects(n.items[0].bounds))return;c(e,t,n.items[0],n.items)}}function S(e,t,n){if(!t.items.length)return;var r=t.items,i,s=this;for(var o=0,u=r.length;o<u;++o){i=r[o],e.save(),e.translate(i.x,i.y);for(var a=0,f=i.items.length;a<f;++a)s.draw(e,i.items[a],n);e.restore()}}function T(e,t,n,r,i,s){if(t.items.length===0||t.bounds&&!t.bounds.contains(i,s))return!1;var o=t.items,u,a,f,l,c,h=this;for(var p=0,d=o.length;p<d;++p){a=o[p],l=a.x||0,c=a.y||0,e.save(),e.translate(l,c);for(var v=0,m=a.items.length;v<m;++v){u=a.items[v];if(u.interactive===!1)continue;f=h.pick(u,n,r,i-l,s-c);if(f)return e.restore(),f.push(u,a,t),f}e.restore()}return!1}function N(e,t,n,r,i,s,o){if(!n.items.length)return!1;var u,a,f;for(f=n.items.length;--f>=0;){u=n.items[f],a=u.bounds;if(a&&!a.contains(s,o))continue;if(e(t,u,r,i,s,o))return[u]}return!1}function C(e,t,n,r,i,s){if(!t.items.length)return!1;var o=t.items,u,a,f,l,c,h,p,d;return a=o[0].bounds,a&&!a.contains(i,s)?!1:A.area(e,o,n,r)?[o[0]]:!1}function k(e,t,n,r,i,s){return!1}function L(e){return function(t,n,r,i,s,o){return N(e,t,n,r,i,s,o)}}function O(e,t,n,r,i,o){if(!t.angle)return!0;e.font=v(t);var u=g(e,t,s,!0),a=-t.angle*Math.PI/180,f=Math.cos(a),l=Math.sin(a),n=t.x,r=t.y,c=f*i-l*o+(n-n*f+r*l),h=l*i+f*o+(r-n*l-r*f);return u.contains(c,h)}var e=vg.canvas.path.parse,t=vg.canvas.path.render,n=d3.svg.arc(),r=Math.sqrt(3),i=Math.tan(30*Math.PI/180),s=new vg.Bounds,A={text:O,rect:function(e,t,n,r){return!0},image:function(e,t,n,r){return!0},arc:function(e,t,n,r){return o(e,t),e.isPointInPath(n,r)},area:function(e,t,n,r){return f(e,t),e.isPointInPath(n,r)},path:function(e,t,n,r){return u(e,t),e.isPointInPath(n,r)},symbol:function(e,t,n,r){return a(e,t),e.isPointInPath(n,r)}};return{draw:{group:S,area:E(f),line:E(l),arc:b(o),path:b(u),symbol:b(a),rect:p,text:m,image:d,drawOne:E,drawAll:b},pick:{group:T,area:C,line:k,arc:L(A.arc),path:L(A.path),symbol:L(A.symbol),rect:L(A.rect),text:L(A.text),image:L(A.image),pickAll:N}}}(),vg.canvas.Renderer=function(){var e=function(){this._ctx=null,this._el=null},t=e.prototype;return t.initialize=function(e,t,n,r){this._el=e,this._width=t,this._height=n,this._padding=r;var i=d3.select(e).selectAll("canvas").data([1]);return i.enter().append("canvas"),i.attr("width",t+r.left+r.right).attr("height",n+r.top+r.bottom),this._ctx=i.node().getContext("2d"),this._ctx.setTransform(1,0,0,1,r.left,r.top),this},t.context=function(){return this._ctx},t.element=function(){return this._el},t.render=function(e,t){var n=Date.now(),r=this._ctx,i=this._padding,s=this._width+i.left+i.right,o=this._width+i.top+i.bottom;this._scene=e,r.save(),t&&(r.beginPath(),r.rect(t.x1,t.y1,t.width(),t.height()),r.clip()),r.clearRect(-i.left,-i.top,s,o),this.draw(r,e,t),r.restore(),this._scene=null;var u=Date.now();vg.log("RENDER TIME: "+(u-n))},t.draw=function(e,t,n){var r=t.marktype,i=vg.canvas.marks.draw[r];i.call(this,e,t,n)},t.renderAsync=function(e){var t=this;t._async_id&&clearTimeout(t._async_id),t._async_id=setTimeout(function(){t.render(e),delete t._async_id},50)},t.loadImage=function(e){var t=this,n=this._scene,r=new Image;return r.onload=function(){vg.log("LOAD IMAGE: "+this.src),t.renderAsync(n)},r.src=e,r},e}(),vg.canvas.Handler=function(){function r(e){var t=e.indexOf(".");return t<0?e:e.slice(0,t)}function i(e,t){if(e==null||t==null||e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;++n)if(e[n]!==t[n])return!1;return!0}var e=function(e,t){this._active=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},t=e.prototype;t.initialize=function(e,r,i){this._el=d3.select(e).node(),this._canvas=d3.select(e).select("canvas").node(),this._padding=r,this._obj=i||null;var s=this._canvas,o=this;return n.forEach(function(e){s.addEventListener(e,function(n){t[e].call(o,n)})}),this},t.model=function(e){return arguments.length?(this._model=e,this):this._model};var n=["mousedown","mouseup","click","dblclick","wheel","keydown","keypress","keyup","mousewheel"];return n.forEach(function(e){t[e]=function(t){this.fire(e,t)}}),n.push("mousemove"),n.push("mouseout"),t.mousemove=function(e){var t=this._padding,n=e.target.getBoundingClientRect(),r=e.clientX-n.left,s=e.clientY-n.top,o=this._active,u=this.pick(this._model.scene(),r,s,r-t.left,s-t.top);if(i(u,o)){this.fire("mousemove",e);return}o&&this.fire("mouseout",e),this._active=u,u&&this.fire("mouseover",e)},t.mouseout=function(e){this._active&&this.fire("mouseout",e),this._active=null},t.DOMMouseScroll=function(e){this.fire("mousewheel",e)},t.fire=function(e,t){var n=this._active,r=this._handlers[e];if(n&&r){n=n?{item:n[0],path:n}:n;for(var i=0,s=r.length;i<s;++i)r[i].handler.call(this._obj,t,n)}},t.on=function(e,t){var n=r(e),i=this._handlers;return i=i[n]||(i[n]=[]),i.push({type:e,handler:t}),this},t.off=function(e,t){var n=r(e),i=this._handlers[n];if(!i)return;for(var s=i.length;--s>=0;){if(i[s].type!==e)continue;(!t||i[s].handler===t)&&i.splice(s,1)}return this},t.context=function(){return this._canvas.getContext("2d")},t.pick=function(e,t,n,r,i){var s=this.context(),o=e.marktype,u=vg.canvas.marks.pick[o];return u.call(this,s,e,t,n,r,i)},e}(),vg.data={},vg.data.ingest=function(e,t){return{data:e,index:t}},vg.data.mapper=function(e){return function(t){return t.forEach(e),t}},vg.data.read=function(e,t){return vg.data.json(e,t)},vg.data.json=function(e,t){var n=JSON.parse(e);return t&&t.property&&(n=vg.accessor(t.property)(n)),n},vg.data.array=function(){function t(t){return t.map(function(t){var n=[];for(var r=0,i=e.length;r<i;++r)n.push(e[r](t));return n})}var e=[];return t.fields=function(n){return e=vg.array(n).map(vg.accessor),t},t},vg.data.copy=function(){var e=vg.accessor("data"),t=[],n=vg.data.mapper(function(n){var r=e(n),i,s;for(i=0,s=t.length;i<s;++i)n[t[i]]=r[t[i]];return n});return n.from=function(t){return e=vg.accessor(t),n},n.fields=function(e){return t=vg.array(e),n},n},vg.data.facet=function(){function n(n){var r={key:"",keys:[],values:[]},i={"":r},s=r.values,o,u,a,f,l,c,h,p,d;for(l=0,f=n.length;l<f;++l){for(h=0,u=[],a="";h<e.length;++h)p=e[h](n[l]),u.push(p),a+=(h>0?"|":"")+String(p);o=i[a],o===undefined&&r.values.push(o=i[a]={key:a,keys:u,values:[]}),o.values.push(n[l])}if(t)for(l=0,f=s.length;l<f;++l)s[l].values.sort(t);return r}var e=[],t=null;return n.keys=function(t){return e=vg.array(t).map(vg.accessor),n},n.sort=function(e){return t=vg.comparator(e),n},n},vg.data.filter=function(){function t(t){return e?t.filter(e):t}var e=null;return t.test=function(n){return e=typeof n=="function"?n:new Function("d","return "+n),t},t},vg.data.force=function(){function u(n){e.nodes(n).links(this[t]),e.start();for(var r=0;r<s;++r)e.tick();return e.stop(),n}var e=d3.layout.force(),t=[],n=20,r=1,i=-30,s=500,o=["size","friction","theta","gravity","alpha"];return u.links=function(e){return t=e,u},u.linkDistance=function(t){return n=typeof t=="number"?t:vg.accessor(t),e.linkDistance(n),u},u.linkStrength=function(t){return r=typeof t=="number"?t:vg.accessor(t),e.linkStrength(r),u},u.charge=function(t){return i=typeof t=="number"?t:vg.accessor(t),e.charge(i),u},u.iterations=function(e){return s=e,u},o.forEach(function(t){u[t]=function(n){return e[t](n),u}}),u},vg.data.geo=function(){function t(){var t={},n="mercator",r=d3.geo[n](),i=vg.identity,s=vg.identity,o="x",u="y",a=vg.data.mapper(function(e){var t=[s(e),i(e)],n=r(t);return e[o]=n[0],e[u]=n[1],e});return a.func=function(){return r},a.projection=function(e){if(n!==e){n=e,r=d3.geo[n]();for(var i in t)r[i](t[i])}return a},e.forEach(function(e){a[e]=function(n){return t[e]=n,r[e](n),a}}),a.lon=function(e){return s=vg.accessor(e),a},a.lat=function(e){return i=vg.accessor(e),a},a.x=function(e){return o=e,a},a.y=function(e){return u=e,a},a}var e=["center","scale","translate","rotate","precision","clipAngle"];return t.params=e,t}(),vg.data.geopath=function(){var e=d3.geo.path(),t="mercator",n=vg.identity,r={},i="path",s=vg.data.mapper(function(t){return t[i]=e(n(t)),t});return s.projection=function(n){if(t!==n){t=n;var i=d3.geo[t]();for(var o in r)i[o](r[o]);e.projection(i)}return s},vg.data.geo.params.forEach(function(t){s[t]=function(n){return r[t]=n,e.projection()[t](n),s}}),s.field=function(e){return n=vg.accessor(e),s},s.path=function(e){return i=e,s},s},vg.data.link=function(){function s(e){var r=t(e),i=n(e);return"M"+r.x+","+r.y+"L"+i.x+","+i.y}function o(e){var i=t(e),s=n(e),o=s.x-i.x,u=s.y-i.y,a=r*(o+u),f=r*(u-o);return"M"+i.x+","+i.y+"C"+(i.x+a)+","+(i.y+f)+" "+(s.x+f)+","+(s.y-a)+" "+s.x+","+s.y}function u(e){var r=t(e),i=n(e),s=(r.x+i.x)/2;return"M"+r.x+","+r.y+"C"+s+","+r.y+" "+s+","+i.y+" "+i.x+","+i.y}function a(e){var r=t(e),i=n(e),s=(r.y+i.y)/2;return"M"+r.x+","+r.y+"C"+r.x+","+s+" "+i.x+","+s+" "+i.x+","+i.y}function l(t){var n=f[e];return t.forEach(function(e){e[i.path]=n(e)}),t}var e="line",t=vg.accessor("source"),n=vg.accessor("target"),r=.2,i={path:"path"},f={line:s,curve:o,diagonal:u,diagonalX:u,diagonalY:a};return l.shape=function(t){return e=t,l},l.tension=function(e){return r=e,l},l.source=function(e){return t=vg.accessor(e),l},l.target=function(e){return n=vg.accessor(e),l},l.output=function(e){return vg.keys(i).forEach(function(t){e[t]!==undefined&&(i[t]=e[t])}),l},l},vg.data.pie=function(){function o(o){var u=o.map(function(t,n){return+e(t)}),a=t,f=(n-t)/d3.sum(u),l=d3.range(o.length);return r&&l.sort(function(e,t){return u[e]-u[t]}),l.forEach(function(e){var t;o[e].value=t=u[e],o[e][i]=a,o[e][s]=a+=t*f}),o}var e=vg.accessor("data"),t=0,n=2*Math.PI,r=!1,i="startAngle",s="endAngle";return o.sort=function(e){return r=e,o},o.value=function(t){return e=vg.accessor(t),o},o.startAngle=function(e){return i=e,o},o.endAngle=function(e){return s=e,o},o},vg.data.stack=function(){function s(r){var s=i.y0,o=i.y1;return e.x(t).y(n).out(function(e,t,n){e[s]=t,e[o]=n+t})(r.values)}var e=d3.layout.stack().values(function(e){return e.values}),t=null,n=null,r=["offset","order"],i={y0:"y2",y1:"y"};return s.point=function(e){return t=vg.accessor(e),s},s.height=function(e){return n=vg.accessor(e),s},r.forEach(function(t){s[t]=function(n){return e[t](n),s}}),s.output=function(e){return d3.keys(i).forEach(function(t){e[t]!==undefined&&(i[t]=e[t])}),s},s},vg.data.treemap=function(){function i(n){n=e.value(t).nodes(n);var i=vg.keys(r),s=i.length;return n.forEach(function(e){var t,n;for(var o=0;o<s;++o)t=i[o],t!==r[t]&&(n=e[t],delete e[t],e[r[t]]=n)}),n}var e=d3.layout.treemap().children(function(e){return e.values}),t=vg.accessor("data"),n=["round","sticky","ratio","padding","size"],r={x:"x",y:"y",dx:"width",dy:"height"};return i.value=function(e){return t=vg.accessor(e),i},n.forEach(function(t){i[t]=function(n){return e[t](n),i}}),i.output=function(e){return vg.keys(r).forEach(function(t){e[t]!==undefined&&(r[t]=e[t])}),i},i},vg.data.wordcloud=function(){function o(i){function o(t,r){var o=e.size(),u=o[0]/2,a=o[1]/2,f=vg.keys(s),l,c;i.sort(function(e,t){return n(t)-n(e)});for(var h=0;h<t.length;++h){c=i[h];for(var p=0;p<f.length;++p)l=f[p],c[s[l]]=t[h][l],l==="x"&&(c[s.x]+=u),l==="y"&&(c[s.y]+=a)}}return e.text(t).fontSize(n).rotate(r).words(i).on("end",o).start(),i}var e=d3.layout.cloud().size([900,500]),t=vg.accessor("data"),n=function(){return 14},r=function(e){return~~(Math.random()*5)*30-60},i=["size","font","fontStyle","fontWeight","padding"],s={x:"x",y:"y",size:"fontSize",font:"fontFamily",rotate:"angle"};return o.text=function(e){return t=vg.accessor(e),o},o.fontSize=function(e){return n=vg.accessor(e),o},o.rotate=function(e){var t;return vg.isObject(e)&&!Array.isArray(e)?e.random!==undefined?(t=(t=e.random)?vg.array(t):[0],r=function(){return t[~~(Math.random()*t.length-1e-5)]}):e.alternate!==undefined&&(t=(t=e.alternate)?vg.array(t):[0],r=function(e,n){return t[n%t.length]}):r=vg.accessor(field),o},i.forEach(function(t){o[t]=function(n){return e[t](n),o}}),o.output=function(e){return vg.keys(s).forEach(function(t){e[t]!==undefined&&(s[t]=e[t])}),o},o},vg.data.zip=function(){function i(i){var s=this[e],o,u,a,f;r&&(f={},s.forEach(function(e){f[r(e)]=e}));for(u=0,a=i.length;u<a;++u)o=i[u],o[t]=f?f[n(o)]:s[u];return i}var e=null,t="zip",n=vg.accessor("data"),r=null;return i["with"]=function(t){return e=t,i},i.as=function(e){return t=e,i},i.key=function(e){return n=vg.accessor(e),i},i.withKey=function(e){return r=vg.accessor(e),i},i},vg.parse={},vg.parse.axes=function(){function t(e,t,r){(e||[]).forEach(function(e,i){t[i]=t[i]||d3.svg.axis(),n(e,i,t[i],r)})}function n(t,n,r,i){t.scale!==undefined&&(r.scale(i[t.scale]),r.scaleName=t.scale);var s=t.orient||e[t.type];r.orient(s),t.values!==undefined&&r.tickValues(t.values),t.format!==undefined&&r.tickFormat(d3.format(t.format)),t.subdivide!==undefined&&r.tickSubdivide(t.subdivide),t.tickPadding!==undefined&&r.tickPadding(t.tickPadding);var o=[];if(t.tickSize!==undefined)for(var u=0;u<3;++u)o.push(t.tickSize);else o=[6,6,6];t.tickSizeMajor!==undefined&&(o[0]=t.tickSizeMajor),t.tickSizeMinor!==undefined&&(o[1]=t.tickSizeMinor),t.tickSizeEnd!==undefined&&(o[2]=t.tickSizeEnd),o.length&&r.tickSize.apply(r,o);if(t.ticks!==undefined){var a=Array.isArray(t.ticks)?t.ticks:[t.ticks];r.ticks.apply(r,a)}t.offset&&(r.offset=t.offset)}var e={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};return t}(),vg.parse.data=function(e,t){function i(e){return function(i,s){i?vg.error("LOADING ERROR: "+e.url):n.load[e.name]=vg.data.read(s.responseText,e.format),--r===0&&t()}}var n={load:{},flow:{}},r=0;return(e||[]).forEach(function(e){e.url&&(r+=1,vg.log("LOADING: "+e.url),d3.xhr(e.url,i(e))),e.values&&(n.load[e.name]=e.values),e.transform&&(n.flow[e.name]=vg.parse.dataflow(e))}),r===0&&setTimeout(t,1),n},vg.parse.dataflow=function(e){var t=(e.transform||[]).map(vg.parse.transform);return t.length?function(e){var n=this;return t.reduce(function(e,t){return t.call(n,e)},e)}:vg.identity},vg.parse.marks=function(){function e(t){var n=t.properties,r=t.marks;vg.keys(n).forEach(function(e){n[e]=vg.parse.properties(n[e])});if(t.from){var i=t.from.data,s=vg.parse.dataflow(t.from);t.from=function(e){return s(e[i])}}return r&&(t.marks=r.map(e)),t}return function(t){return{type:"group",marks:vg.duplicate(t).map(e)}}}(),vg.parse.properties=function(){function e(e){var n="",r=vg.keys(e),i,s,o,u,a={};for(i=0,s=r.length;i<s;++i)u=e[o=r[i]],n+=i>0?"\n  ":"  ",n+="item."+o+" = "+t(u)+";",a[o]=!0;return a.x2&&(n+="\n  if (item.x > item.x2) { var t = item.x; item.x = item.x2; item.x2 = t; };",n+="\n  item.width = (item.x2 - item.x);"),a.y2&&(n+="\n  if (item.y > item.y2) { var t = item.y; item.y = item.y2; item.y2 = t; };",n+="\n  item.height = (item.y2 - item.y);"),Function("item",n)}function t(e){if(e==null)return null;var t=e.value!==undefined?vg.str(e.value):"item.datum['data']";e.field!==undefined&&(t="item.datum["+vg.array(e.field).map(vg.str).join("][")+"]");if(e.scale!==undefined){var n="this._scales['"+e.scale+"']";e.band?t=n+".rangeBand()":t=n+"("+t+")"}return t+(e.offset?" + "+e.offset:"")}return e}(),vg.parse.scales=function(){function s(e,t,n){return(e||[]).reduce(function(e,t){return e[t.name]=o(t,e[t.name],n),e},t||{})}function o(n,r,i){var s=n.type||e,o=r||d3.scale[s](),l=f(n,o);return(s===t?u:a)(n,o,l,i),o}function u(e,t,n,r){var i,s,o,u;i=e.domain,Array.isArray(i)?t.domain(i):vg.isObject(i)&&(s=r[i.data],o=vg.accessor(i.field),t.domain(vg.unique(s,o))),u=typeof n[0]=="string",e.reverse&&(n=n.reverse()),u?t.range(n):e.round||e.round===undefined?t.rangeRoundBands(n,e.padding||0):t.rangeBands(n,e.padding||0)}function a(e,t,i,s){var o,u,a;o=[null,null],e.domain!==undefined&&(Array.isArray(e.domain)?o=e.domain.slice():vg.isObject(e.domain)?(u=s[e.domain.data],a=vg.accessor(e.domain.field),o[0]=d3.min(u,a),o[1]=d3.max(u,a)):o=e.domain),e.domainMin!==undefined&&(vg.isObject(e.domainMin)?(u=s[e.domainMin.data],a=vg.accessor(e.domainMin.field),o[0]=d3.min(u,a)):o[0]=e.domainMin),e.domainMax!==undefined&&(vg.isObject(e.domainMax)?(u=s[e.domainMax.data],a=vg.accessor(e.domainMax.field),o[1]=d3.max(u,a)):o[1]=e.domainMax),e.type!==n&&(e.zero||e.zero===undefined)&&(o[0]=Math.min(0,o[0]),o[1]=Math.max(0,o[1])),t.domain(o),i=!!e.reverse!=(e.range=="height")?i.reverse():i,t[e.round?"rangeRound":"range"](i),e.clamp&&t.clamp(!0),e.nice&&t.nice(),e.exponent&&e.type===r&&t.exponent(e.exponent)}function f(e){var t=[null,null];if(e.range!==undefined)if(typeof e.range=="string"){if(!i[e.range])return vg.error("Unrecogized range: "+e.range),t;t=[0,e.range]}else Array.isArray(e.range)?t=e.range:t=[0,e.range];return e.rangeMin!==undefined&&(t[0]=e.rangeMin),e.rangeMax!==undefined&&(t[1]=e.rangeMax),t}var e="linear",t="ordinal",n="log",r="pow",i={width:1,height:1};return s}(),vg.parse.spec=function(e,t){function n(e){var n={scales:e.scales,axes:e.axes,marks:vg.parse.marks(e.marks),data:vg.parse.data(e.data,function(){t(r)})},r=function(t,r){return(new vg.View).width(e.width||500).height(e.height||500).padding(e.padding||{top:20,left:20,right:20,bottom:20}).viewport(e.viewport||null).initialize(t).defs(n).data(n.data.load).data(r).on("mouseover",function(e,t){this.update("hover",t)}).on("mouseout",function(e,t){this.update("update",t)})}}vg.isObject(e)?n(e):d3.json(e,function(e,t){e?vg.error(e):n(t)})},vg.parse.transform=function(e){var t=vg.data[e.type]();return vg.keys(e).forEach(function(n){if(n==="type")return;t[n](e[n])}),t},vg.scene={},vg.scene.GROUP="group",vg.scene.ENTER=0,vg.scene.UPDATE=1,vg.scene.EXIT=2,vg.scene.bounds=function(e){var t=new vg.Bounds(e[0].bounds),n,r;for(n=2,r=e.length;n<r;++n)t.translate(e[n].x||0,e[n].y||0);return t},vg.scene.build=function(){function s(t,n,r,s){var f=t.from?t.from(n):s||[i];return vg.isObject(f)&&f.values&&(f=f.values),f===i&&(f=[i]),r=o(t,r),r.items=u(t,f,r),t.type===e&&a(t,n,r),r}function o(e,t){return t=t||{},t.def=e,t.marktype=e.type,t.interactive=e.interactive!==!1,t}function u(e,i,s){var o=f(e.key),u=s.items||[],a=[],l={},c,h,p,d,v;for(c=0,p=u.length;c<p;++c)d=u[c],d.status=r,o&&(l[d.key]=d);for(c=0,p=i.length;c<p;++c)v=i[c],h=c,d=o?l[h=o(v)]:u[c],enter=d?!1:(d={},!0),d.status=enter?t:n,d.datum=v,d.key=h,a.push(d);for(c=0,p=u.length;c<p;++c)d=u[c],d.status===r&&(d.key=o?d.key:a.length,a.push(d));return a}function a(e,t,n){var r=n.items,i=e.marks,o,u,a,f,l;for(o=0,u=r.length;o<u;++o){l=r[o],l.items=l.items||[];for(a=0,f=i.length;a<f;++a)l.items[a]=s(i[a],t,l.items[a],l.datum)}}function f(e){return e?vg.accessor(e):null}var e=vg.scene.GROUP,t=vg.scene.ENTER,n=vg.scene.UPDATE,r=vg.scene.EXIT,i={sentinel:1};return s}(),vg.scene.encode=function(){function i(e,t,n,r,i){return r?s.call(this,e,t,n,r,i):o.call(this,e,t,n),e}function s(e,t,n,r,i){i=vg.array(i);var s,o,u,a;for(s=0,o=i.length;s<o;++s)u=i[s],a=u.path[1].def.properties[r],a&&a.call(this,u.item,n)}function o(t,n,r){a.call(this,t.items,n,r),t.marktype===e&&u.apply(this,arguments)}function u(e,t,n){var r,i,s,u,a;for(r=0,i=e.items.length;r<i;++r){a=e.items[r];for(s=0,u=a.items.length;s<u;++s)o.call(this,a.items[s],t.marks[s],n)}}function a(e,n,i){if(n.properties==null)return;var s=n.properties,o=s.enter,u=s.update,a=s.exit,f,l,c;if(o)for(f=0,l=e.length;f<l;++f){c=e[f];if(c.status!==t)continue;o.call(this,c,i)}if(u)for(f=0,l=e.length;f<l;++f){c=e[f];if(c.status===r)continue;u.call(this,c,i)}if(a)for(f=0,l=e.length;f<l;++f){c=e[f];if(c.status!==r)continue;a.call(this,c,i)}}var e=vg.scene.GROUP,t=vg.scene.ENTER,n=vg.scene.UPDATE,r=vg.scene.EXIT;return i}(),vg.scene.visit=function(){function e(t,n,r){var i,s,o,u,a,f,l=t.items,c=t.marktype===vg.scene.GROUP;for(i=0,o=l.length;i<o;++i){a=l[i];if(n){f=n.call(this,a);if(f)return f}if(c)for(s=0,u=a.items.length;s<u;++s){f=e.call(this,a.items[s],n,r);if(f)return f}if(r){f=r.call(this,a);if(f)return f}}}return e}(),vg.Axes=function(){var e=function(){this._svg=null,this._el=null,this._init=!1},t=e.prototype;return t.initialize=function(e,t,n,r){this._el=e,this._width=t,this._height=n,this._padding=r;var i=d3.select(e).selectAll("svg.axes").data([1]);i.enter().append("svg").style("pointer-events","none"),i.attr("class","axes").attr("width",t+r.left+r.right).attr("height",n+r.top+r.bottom).style({position:"absolute",left:0,top:0});var s=i.selectAll("g").data([1]);return s.enter().append("g"),s.attr("transform","translate("+r.left+","+r.top+")"),this._init=!1,this},t.element=function(){return this._el},t.update=function(e,t,n){n=n||0;var r=this._init;this._init=!0;var i=d3.selectAll("svg.axes").select("g");r||i.selectAll("g.axis").data(e).enter().append("g").attr("class",function(e,t){return"axis axis-"+t});var s=n&&r?i.transition(n):i,o=this._width,u=this._height;s.selectAll("g.axis").attr("transform",function(e,t){var n=e.offset||0,r;switch(e.orient()){case"left":r=[-n,0];break;case"right":r=[o+n,0];break;case"bottom":r=[0,u+n];break;case"top":r=[0,-n];break;default:r=[0,0]}return"translate("+r[0]+", "+r[1]+")"}).each(function(e){e.scale(t[e.scaleName]);var i=d3.select(this);(n&&r?i.transition().duration(n):i).call(e)})},e}(),vg.Model=function(){function e(){this._defs=null,this._axes=[],this._data={},this._scales={},this._scene=null}var t=e.prototype;return t.defs=function(e){return arguments.length?(this._defs=e,this):this._defs},t.data=function(e){if(!arguments.length)return this._data;var t=this._data,n=this._defs?this._defs.data.flow:{};return vg.keys(e).forEach(function(r){t[r]=n[r]?n[r].call(t,e[r]):e[r]}),this},t.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},t.build=function(){return this._scene=vg.scene.build.call(this,this._defs.marks,this._data,this._scene),vg.parse.scales(this._defs.scales,this._scales,this._data),vg.parse.axes(this._defs.axes,this._axes,this._scales),this},t.encode=function(e,t){return vg.scene.encode.call(this,this._scene,this._defs.marks,null,e,t),this},t.visit=function(e,t){return vg.scene.visit(this._scene,e,t)},e}(),vg.View=function(){var e=function(e,t,n){this._el=null,this._build=!1,this._model=new vg.Model,this._width=t||500,this._height=n||500,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,e&&this.initialize(e)},t=e.prototype;return t.width=function(
e){return arguments.length?(this._width!==e&&(this._width=e,this._el&&this.initialize(this._el)),this):this._width},t.height=function(e){return arguments.length?(this._height!==e&&(this._height=e,this._el&&this.initialize(this._el)),this):this._height},t.padding=function(e){return arguments.length?(this._padding!==e&&(this._padding=e,this._el&&this.initialize(this._el)),this):this._padding},t.viewport=function(e){return arguments.length?(this._viewport!==e&&(this._viewport=e,this._el&&this.initialize(this._el)),this):this._viewport},t.defs=function(e){return arguments.length?(this._model.defs(e),this):this._model.defs()},t.data=function(e){if(!arguments.length)return this._model.data();var t=vg.keys(e).reduce(function(t,n){return t[n]=e[n].map(vg.data.ingest),t},{});return this._model.data(t),this},t.model=function(e){return arguments.length?(this._model!==e&&(this._model=e,this._handler&&this._handler.model(e)),this):this._model},t.initialize=function(e){this._el=d3.select(e).style("position","relative").node();if(this._viewport){var t=this._viewport[0]||this._width,n=this._viewport[1]||this._height;d3.select(e).style("width",t+"px").style("height",n+"px").style("overflow","auto")}return this._axes=(this._axes||new vg.Axes).initialize(this._el,this._width,this._height,this._padding),this._renderer=(this._renderer||new vg.canvas.Renderer).initialize(this._el,this._width,this._height,this._padding),this._handler||(this._handler=(new vg.canvas.Handler).initialize(this._el,this._padding,this).model(this._model)),this},t.render=function(e){var t=this._model;return this._axes.update(t._axes,t._scales),this._renderer.render(t.scene(),e),this},t.on=function(){return this._handler.on.apply(this._handler,arguments),this},t.off=function(){return this._handler.off.apply(this._handler,arguments),this},t.update=function(e,t){function n(){return t?vg.array(t).reduce(function(e,t){return e.union(vg.scene.bounds(t.path))},new vg.Bounds):null}return this._build=this._build||(this._model.build(),!0),this._model.encode(e,t),this.render(n()),t?this.render(n()):this},e}()})();